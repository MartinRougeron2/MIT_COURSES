<!DOCTYPE html><html lang="en">
      
      
        
    
    
    
    

      
      
      <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">  
        
        <title>Lecture 7: Sandboxing Native Code	 | Lecture Videos | Computer Systems Security | Electrical Engineering and Computer Science | MIT OpenCourseWare</title>
    <!-- Begin Automatic Metadata Insertion -->
    <meta content="6-858-computer-systems-security-fall-2014" name="WT.cg_n">
    <meta content="Lecture 7: Sandboxing Native Code	" name="WT.cg_s">
    <meta content="In this lecture, Professor Zeldovich introduces the Native Client system, and its approach to software fault isolation." name="Description">
    <meta content="Zeldovich, Nickolai" name="Author">
    <meta content="6.858,Native Client,software fault isolation,privilege separation,web browser,x86,Computer Design and Engineering,Software Design and Engineering" name="keywords">
    <meta content="6.858 Computer Systems Security | Lecture 7: Sandboxing Native Code	" name="Search_Display">
    <meta content="Computer Design and Engineering" itemprop="about">
    <meta content="Software Design and Engineering" itemprop="about">
    <!-- End Automatic Metadata Insertion -->

	<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/grid.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/base.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/menu.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/jquery.bubblepopup.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/search.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/courses.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/courses_new.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/jquery.jscrollpane.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/media_tabs.css">
	<link href="../../../common/xml/ocwcc.rdf" type="application/rdf+xml" rel="metadata">
	<link rel="canonical" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-7-sandboxing-native-code/">
	<link rel="apple-touch-icon" href="../../../common/images/apple-touch-icon.png">
	
	
      
	
	<script type="text/javascript" src="../../../common/scripts/jquery.js"></script>
	<script type="text/javascript" src="../../../common/scripts/ocw-media-utils-offline.js"></script>
	<script type="text/javascript" src="../../../common/scripts/ocw-offline.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery.bubblepopup.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery.jscrollpane.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/expandy.js"></script>
	<script type="text/javascript" src="../../../common/scripts/bubble-popup-offline.js"></script>
	
	
	
    <script type="text/javascript">
      $(document).ready(function() {
        $("#tabs").tabs();
        IpadScroller();
      });
    </script>
    
    
    
    
    
    
      
       
		 

        
        
        

        
        
        
        
        
        
        
        
        
      </head>
    <body itemscope itemtype="http://schema.org/WebPage">
        
	

        <header id="top">
			<div id="grid">
				
				
					
<div id="portletwrapper-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d686561646572" class="portletWrapper kssattr-portlethash-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d686561646572">
<div class="portletStaticText portlet-static-site-header">
<!--googleoff: index-->
<div class="grid_6 alpha" id="banner"><a href="https://ocw.mit.edu/"><img src="../../../common/images/ocw_mast.png" class="logo" alt="MIT OpenCourseWare, Massachusetts Institute of Technology"></a></div>
<div class="grid_6 omega" id="subscribe">
<aside class="module" aria-label="Connect with OCW">
<table class="social">
    <tbody>
        <tr>
            <td class="socialbutton"><a aria-label="Subscribe to the OCW Newsletter" href="https://ocw.mit.edu/subscribe/index.htm?utm_source=header"><img src="../../../common/images/trans.gif" alt="An icon depicting an envelope.">Subscribe to the OCW Newsletter</a></td>
            <td>
<a aria-label="Facebook" href="https://facebook.com/mitocw"><img src="../../../common/images/icon_fb.png" alt="Click to visit our Facebook page."></a>  <a aria-label="Instagram" href="https://www.instagram.com/mitocw/"><img src="https://ocw.mit.edu/images/icon_ig.png" alt="Click to visit our Instagram page."></a> <a aria-label="Twitter" href="https://twitter.com/mitocw"><img src="https://ocw.mit.edu/images/icon_twitter.png" alt="Click to visit our Twitter feed."></a><a aria-label="YouTube" href="https://www.youtube.com/mitocw" style="font-size: 12.208px;"><img src="https://ocw.mit.edu/images/icon_yt.png" alt="Click to visit our YouTube page."></a><span style="font-size: 12.208px;">   </span><a aria-label="Open Matters blog on WordPress" href="https://www.ocw-openmatters.org/" style="font-size: 12.208px;"><img src="https://ocw.mit.edu/images/icon_wp.png" alt="Click to visit our blog on WordPress."></a>
</td>
        </tr>
    </tbody>
</table>
</aside><nav aria-label="Help Links" class="helplinks">     <a aria-label="OCW Site Help" href="https://ocw.mit.edu/help">Help</a><span aria-hidden="true">|</span>     <a href="../../../common/about/contactus.htm">Contact Us</a>   </nav>
</div>
<div class="clear"> </div>
<!--googleon: index-->
</div>

</div>

<div id="portletwrapper-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a6d6567612d6d656e75" class="portletWrapper kssattr-portlethash-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a6d6567612d6d656e75">
<div class="portletStaticText portlet-static-mega-menu"><div><nav id="mega" class="grid_8 alpha" aria-label="Site">
<ul id="menu" role="presentation">
    <li id="menu_home">
<a href="https://ocw.mit.edu/" aria-label="Homepage"><img src="../../../common/images/top-nav_home.png" class="home_icon" alt="Click for site home page."></a><!-- Begin Home Item -->
</li>
    <!-- End Home Item -->
    <li id="drop_1" aria-label="Find Courses">
<a href="#" aria-hidden="true">FIND COURSES</a><!-- Begin 5 columns Item -->
    <div class="dropdown_5columns-a mega-courses">
    <div class="col_1a">
    <div class="row_1a">
<nav aria-labelledby="mm-find-courses-by">     <span id="mm-find-courses-by" class="nav" aria-hidden="true">Find courses by:</span>
    <ul class="find_by" role="presentation">
        <li><a href="https://ocw.mit.edu/courses/find-by-topic/">Topic</a></li>
        <li><a href="https://ocw.mit.edu/courses/find-by-number/">MIT Course Number</a></li>
        <li><a href="https://ocw.mit.edu/courses/find-by-department/">Department</a></li>
    </ul>
    </nav>     <nav aria-labelledby="mm-collections">     <span id="mm-collections" class="nav" aria-hidden="true">Collections</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/new-courses/">New Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/most-visited-courses/">Most Visited Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/ocw-scholar/">OCW Scholar Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/audio-video-courses/">Audio/Video Lectures</a></li>
        <li><a href="https://ocw.mit.edu/courses/online-textbooks/">Online Textbooks</a></li>
        <li><a href="https://ocw.mit.edu/resources/">Supplemental Resources</a></li>
        <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
        <li><a href="https://ocw.mit.edu/courses/mitx-related-courseware/">MITx &amp; Related OCW Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/mit-open-learning-library/">MIT Open Learning Library</a></li>
    </ul>
    </nav>     <nav class="col_1b" aria-labelledby="mm-translated-courses">     <span id="mm-translated-courses" class="nav" aria-hidden="true" style="line-height: 1.3;">Cross-Disciplinary Topic Lists</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/energy-courses">Energy</a></li>
        <li><a href="https://ocw.mit.edu/courses/entrepreneurship">Entrepreneurship</a></li>
        <li><a href="https://ocw.mit.edu/courses/environment-courses">Environment</a></li>
        <li><a href="https://ocw.mit.edu/courses/intro-programming">Introductory Programming</a></li>
        <li><a href="https://ocw.mit.edu/courses/life-sciences">Life Sciences</a></li>
        <li><a href="https://ocw.mit.edu/courses/transportation-courses">Transportation</a></li>
    </ul>
    </nav>
</div>
    <div class="row_1b"><nav aria-labelledby="mm-cross-disciplinary-topic-lists">     <span id="mm-cross-disciplinary-topic-lists" class="nav" aria-hidden="true">Translated Courses</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/translated-courses/traditional-chinese" aria-label="Traditional Chinese">繁體字 / Traditional Chinese</a></li>
        <li><a href="https://ocw.mit.edu/courses/translated-courses/turkish" aria-label="Turkish">Türkçe / Turkish</a></li>
        <li><a href="https://ocw.mit.edu/courses/translated-courses/korean" aria-label="Korean">(비디오)한국 / Korean</a></li>
    </ul>
    </nav></div>
    </div>
    </div>
    </li>
    <li id="drop_2">
<a href="#" aria-label="For Educators">For Educators</a>
    <div class="dropdown_1column-a" style="width: 270px;"><nav aria-labelledby="mm-find-courses-by">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/educator/chalk-radio-podcast">Chalk Radio Podcast</a></li>
        <li><a href="https://ocw.mit.edu/educator/">OCW Educator Portal</a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights by Department</a></li>
        <li><a href="https://openlearning.mit.edu/campus/digital-innovations/">Residential Digital Innovations </a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/educator/additional-resources/">Additional Resources</a></li>
    </ul>
    </nav></div>
    </li>
    <li id="drop_3">
<a href="#" aria-hidden="true">Give Now</a>
    <div class="dropdown_1column-a"><nav class="col_1" aria-label="Donate">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/give/">Make a Donation</a></li>
        <li><a href="https://ocw.mit.edu/give/why-give/">Why Give?</a></li>
        <li><a href="https://ocw.mit.edu/give/our-supporters/">Our Supporters</a></li>
        <li><a href="https://ocw.mit.edu/give/other-ways-to-contribute/">Other Ways to Contribute</a></li>
        <li><a href="https://ocw.mit.edu/support/">Become a Corporate Sponsor</a></li>
    </ul>
    </nav></div>
    </li>
    <li id="drop_4">
<a href="#" aria-hidden="true">About</a>
    <div class="dropdown_1column-a"><nav class="col_1" aria-label="About">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/about/">About MIT OpenCourseWare</a></li>
        <li><a href="https://ocw.mit.edu/about/site-statistics/">Site Statistics</a></li>
        <li><a href="https://ocw.mit.edu/about/ocw-stories/">OCW Stories</a></li>
        <li><a href="https://ocw.mit.edu/about/newsletter/">Newsletter</a></li>
        <li><a href="https://chalk-radio.simplecast.com/">Chalk Radio Podcast</a></li>
        <li><a href="https://www.ocw-openmatters.org/">Open Matters Blog</a></li>
    </ul>
    </nav></div>
    </li>
</ul>
</nav></div></div>

</div>





<!--googleoff: index-->
<script>
  (function() {
	var cx = '012626166551961672889:owjdpuboktq';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
  })();
  window.onload = function(){
	document.getElementById('gsc-i-id1').placeholder = 'Search';	
  };

$(document).ready(function(){

$('.advanceSearch a').keydown(function(event){showSearchTips($(this),event);})
$('#searchTipsModal').keydown(function(event){showSearchTips($(this),event);})

function showSearchTips(obj,evt) {
// if pressed enter key
	if ( evt.which == 13 || evt.which == 32) {
		showModal();
		ga('send', 'pageview', "AdvanceSearch");
		$(".advanceSearch a").attr('aria-expanded', 'true');
		$('.searchTipsModal').focus();
		evt.preventDefault();
		}
	if ( evt.which == 27 ) {
		hideModal();
		$(".advanceSearch a").attr('aria-expanded', 'false');
		var modal = document.getElementById('searchTipsModal');
		modal.style.display = "none";
		$(".advanceSearch a").focus();
		evt.preventDefault();
		}
}

});
function showModal(){
	var modal = document.getElementById('searchTipsModal');
	modal.style.display = "block";
	ga('send', 'pageview', "AdvanceSearch");
	document.getElementById("searchTipsBtn").setAttribute("aria-expanded", true);
	window.setTimeout(function () {
    document.getElementById('searchTipsModal').focus(); }, 0);
}

function hideModal(){
	var modal = document.getElementById('searchTipsModal');
	modal.style.display = "none";
	document.getElementById("searchTipsBtn").setAttribute("aria-expanded", false);
}
</script>
<div id="search" role="search" class="grid_4 omega">
    	<table class="search">
				<tbody>
					<tr>
						<td><div class="searchboxheader"><searchbox-only resultsurl="/search/ocwsearch.htm"></searchbox-only></div></td>
						<td>
							<div class="advanceSearch">
								<a id="searchTipsBtn" onclick="showModal();" href="#" role="button" aria-label="search tips" aria-expanded="false" aria-describedby="searchtips">Search Tips</a>

								<!-- The Modal -->
								<div id="searchTipsModal" class="modal" tabindex="-1">
								  <!-- Modal content -->
									<div class="modal-content">
										<div class="modal-body">
											<button class="close" onclick="hideModal();" aria-label="close">X</button>
											<span>
												<b>Exclude words from your search</b>
												<br>Put - in front of a word you want to leave out. For example, jaguar speed -car
												<br><br>
												<b>Search for an exact match</b>
												<br>Put a word or phrase inside quotes. For example, "tallest building".
												<br><br>
												<b>Search for wildcards or unknown words</b>
												<br>Put a * in your word or phrase where you want to leave a placeholder. For example, "largest * in the world".
												<br><br>
												<b>Search within a range of numbers</b>
												<br>Put .. between two numbers. For example, camera $50..$100.
												<br><br>
												<b>Combine searches</b>
												<br>Put "OR" between each search query. For example,  marathon OR race.
												<br><br>
											</span>
										</div>
								  </div>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
		</table>
</div>
<div class="clear"></div>
<!--googleon: index-->
<!-- *end header* -->

				
				
			</div>
<!-- top grid end -->
		</header><!-- top end -->
			
		<div id="center_media">
      	<div id="grid">
      		<div id="left">
        		<nav id="breadcrumb_media" aria-label="Breadcrumb">
                	<p>

    <a href="https://ocw.mit.edu/">Home</a>
    
        »
        
    
    
        
            <a href="https://ocw.mit.edu/courses">Courses</a>
            
                »
                
            
            
         
    
    
        
            <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science">Electrical Engineering and Computer Science</a>
            
                »
                
            
            
         
    
    
        
            <a href="../../../contents/index.htm">Computer Systems Security</a>
            
                »
                
            
            
         
    
    
        
            <a href="../../../contents/video-lectures/index.htm">Lecture Videos</a>
            
                »
                
            
            
         
    
    
        
            
            
            Lecture 7: Sandboxing Native Code	
         
    
</p>

            	</nav>
            	<div class="clear"></div>
        		<div id="media_title">
        		<h1 class="title" itemprop="name" property="dct:title">
        <span class="" id="parent-fieldname-title">
            Lecture 7: Sandboxing Native Code	
        </span>
    </h1>
        		</div>
           		<div class="clear"></div>
           		<div id="course_wrapper_media">
           			<nav id="course_nav" aria-label="Course">
           				<script language="javascript" type="text/javascript">
function toggleMenu(objID) {
  if (!document.getElementById) return;
  var ob = document.getElementById(objID);
  ob.className = (ob.className == 'selected')?'': 'selected';
}
function toggleClass(id)
{
  var divtoggleClass= document.getElementById(id);
  divtoggleClass.className = (divtoggleClass.className == 'mO')?'mC': 'mO';
  return false;
}
function changeAlt(id)
{
  id.alt = (id.alt == 'Expand Menu')?'Collapse Menu' : 'Expand Menu';
  id.title = (id.title == 'Expand Menu')?'Collapse Menu' : 'Expand Menu';
}
</script>
<!--Left Nav Starts -->


	<ul>			  
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/index.htm">
		                  Course Home  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/syllabus/index.htm">
		                  Syllabus  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/calendar/index.htm">
		                  Calendar  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/readings/index.htm">
		                  Readings  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/lecture-notes/index.htm">
		                  Lecture Notes  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="selected">
			   			<a href="../../../contents/video-lectures/index.htm">
		                  Lecture Videos  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/labs/index.htm">
		                  Labs  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/exams/index.htm">
		                  Exams  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/final-project/index.htm">
		                  Final Project  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/related-resources/index.htm">
		                  Related Resources  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    
		    
         	
	<!--second tal block close-->  
	
</ul>


<!--Left Nav Ends -->





           			</nav>
           			<main id="course_inner_media" aria-labelledby="media_title">
      					 
        <div class="" id="parent-fieldname-text">
            
            
        </div>
    
      					     
    
    



<script type="text/javascript">var caption_embed_1 ={'English - US': '/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-7-sandboxing-native-code/I0Psvvky-44.srt'}</script>     
     <div id="media-embed">
         <div class="attention_message" id="embed_1">
<p>Flash and JavaScript are required for this feature.</p>
<p>Download the video from <a href="https://itunes.apple.com/us/itunes-u/id1017908130">iTunes U</a> or the <a href="https://archive.org/download/MIT6.858F14/MIT6_858F14_lec07_300k.mp4">Internet Archive</a>.</p>
</div>
     </div>
    
     <script type="text/javascript">ocw_embed_chapter_media('embed_1', 'https://www.youtube.com/v/I0Psvvky-44', 'youtube', '/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-7-sandboxing-native-code', 'https://img.youtube.com/vi/I0Psvvky-44/0.jpg',0,0, 'https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-7-sandboxing-native-code/I0Psvvky-44.srt')</script>
	 
	 
	 		
	 		<div id="transcript1"></div>
				 <script type="text/javascript">createThreePlayParams(2, 678376, "embed_1", 0, 0)</script>
			 
	

     <div id="media_resource_next_prev_nav" style="margin-top: 1em;">
        <p>
        
            <a href="../../../contents/video-lectures/lecture-6-capabilities/index.htm">
                <img src="../../../common/images/btn_previous_resource.png" style="margin: 0 30px 0 50px;" alt="Previous track" title="Previous track"></a>
     	
     	
        
            <a href="../../../contents/video-lectures/lecture-8-web-security-model/index.htm"> 
                <img src="../../../common/images/btn_next_resource.png" alt="Next track" title="Next track"></a>
       
       </p>
     </div>
 


<script type="text/javascript">
		window.onload=function(){
		init();
		
		}
		var tabLinks = new Array();
		var contentDivs = new Array();
		function init() {
		  // Grab the tab links and content divs from the page
		  var tabListItems = document.getElementById('tabs').childNodes;
		  for ( var i = 0; i < tabListItems.length; i++ ) {
			if ( tabListItems[i].nodeName == "LI" ) {
			  var tabLink = getFirstChildWithTagName( tabListItems[i], 'A' );
			  var id = getHash( tabLink.getAttribute('href') );
			  tabLinks[id] = tabLink;
			  contentDivs[id] = document.getElementById( id );
			}
		  }
		  // Assign onclick events to the tab links, and
		  // highlight the first tab
		  var i = 0;
		  for ( var id in tabLinks ) {
			tabLinks[id].onclick = showTab;
			tabLinks[id].onfocus = function() { this.blur() };
			if ( i == 0 ) tabLinks[id].className = 'selected';
			i++;
		  }
		  // Hide all content divs except the first
		  var i = 0;
		  for ( var id in contentDivs ) {
			if ( i != 0 ) contentDivs[id].className = 'tabContent hide';
			i++;
		  }
		}
		function showTab() {
		  var selectedId = getHash( this.getAttribute('href') );
		  // Highlight the selected tab, and dim all others.
		  // Also show the selected content div, and hide all others.
		  for ( var id in contentDivs ) {
			if ( id == selectedId ) {
			  tabLinks[id].className = 'selected';
			  contentDivs[id].className = 'tabContent';
			} else {
			  tabLinks[id].className = '';
			  contentDivs[id].className = 'tabContent hide';
			}
		  }
		  // Stop the browser following the link
		  return false;
		}
		function getFirstChildWithTagName( element, tagName ) {
		  for ( var i = 0; i < element.childNodes.length; i++ ) {
			if ( element.childNodes[i].nodeName == tagName ) return element.childNodes[i];
		  }
		}
		function getHash( url ) {
		  var hashPos = url.lastIndexOf ( '#' );
		  return url.substring( hashPos + 1 );
		}
 </script>	
 

  <div id="media_tabs">
     
        <ul id="tabs">
            <li class="first">
                <a href="#vid_about" class="selected">About this Video</a>
            </li>
            <li class="">
                <a href="#vid_index" class="">Playlist</a>
            </li>
            <li class="">
                <a href="#vid_playlist" class="">Transcript</a>
            </li>
            <li class="">
                <a href="#vid_related" class="">Download this Video</a>
            </li>
        </ul>
   
        <div id="vid_about" itemprop="description" class="tabContent">
<p><strong>Description:</strong> In this lecture, Professor Zeldovich introduces the Native Client system, and its approach to software fault isolation.</p>  <p><strong>Instructor:</strong> Nickolai Zeldovich</p>
</div>
        <div id="vid_index" itemprop="description" class="tabContent hide">
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-1-introduction-threat-models/index.htm">
<img src="https://img.youtube.com/vi/GqmQg-cszw4/default.jpg" title="Lecture 1: Introduction, Threat Models" alt="Lecture 1: Introduction, Threat Models">
<p>Lecture 1: Introduction, Th...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-2-control-hijacking-attacks/index.htm">
<img src="https://img.youtube.com/vi/r4KjHEgg9Wg/default.jpg" title="Lecture 2: Control Hijacking Attacks" alt="Lecture 2: Control Hijacking Attacks">
<p>Lecture 2: Control Hijackin...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/index.htm">
<img src="https://img.youtube.com/vi/xSQxaie_h1o/default.jpg" title="Lecture 3: Buffer Overflow Exploits and Defenses" alt="Lecture 3: Buffer Overflow Exploits and Defenses">
<p>Lecture 3: Buffer Overflow ...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-4-privilege-separation/index.htm">
<img src="https://img.youtube.com/vi/dNl22h1kW1k/default.jpg" title="Lecture 4: Privilege Separation" alt="Lecture 4: Privilege Separation">
<p>Lecture 4: Privilege Separa...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-6-capabilities/index.htm">
<img src="https://img.youtube.com/vi/TQhmua7Z2cY/default.jpg" title="Lecture 6: Capabilities" alt="Lecture 6: Capabilities">
<p>Lecture 6: Capabilities</p></a>
</div>
<div class="related-media-thumbnail-nolink">
<div class="now-playing-resource">Now Playing</div>
<img src="https://img.youtube.com/vi/I0Psvvky-44/default.jpg" title="Lecture 7: Sandboxing Native Code	" alt="Lecture 7: Sandboxing Native Code	">
<p>Lecture 7: Sandboxing Nativ...</p>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-8-web-security-model/index.htm">
<img src="https://img.youtube.com/vi/eRJ_r8WF1Y0/default.jpg" title="Lecture 8: Web Security Model" alt="Lecture 8: Web Security Model">
<p>Lecture 8: Web Security Model</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-9-securing-web-applications/index.htm">
<img src="https://img.youtube.com/vi/WlmKwIe9z1Q/default.jpg" title="Lecture 9: Securing Web Applications" alt="Lecture 9: Securing Web Applications">
<p>Lecture 9: Securing Web App...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-10-symbolic-execution/index.htm">
<img src="https://img.youtube.com/vi/yRVZPvHYHzw/default.jpg" title="Lecture 10: Symbolic Execution" alt="Lecture 10: Symbolic Execution">
<p>Lecture 10: Symbolic Execution</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-11-ur-web/index.htm">
<img src="https://img.youtube.com/vi/XMEFdofERLI/default.jpg" title="Lecture 11: Ur/Web" alt="Lecture 11: Ur/Web">
<p>Lecture 11: Ur/Web</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-12-network-security/index.htm">
<img src="https://img.youtube.com/vi/BZTWXl9QNK8/default.jpg" title="Lecture 12: Network Security" alt="Lecture 12: Network Security">
<p>Lecture 12: Network Security</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-13-network-protocols/index.htm">
<img src="https://img.youtube.com/vi/QOtA76ga_fY/default.jpg" title="Lecture 13: Network Protocols" alt="Lecture 13: Network Protocols">
<p>Lecture 13: Network Protocols</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-14-ssl-and-https/index.htm">
<img src="https://img.youtube.com/vi/q1OF_0ICt9A/default.jpg" title="Lecture 14: SSL and HTTPS" alt="Lecture 14: SSL and HTTPS">
<p>Lecture 14: SSL and HTTPS</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-15-medical-software/index.htm">
<img src="https://img.youtube.com/vi/bA3xCpYLA34/default.jpg" title="Lecture 15: Medical Software" alt="Lecture 15: Medical Software">
<p>Lecture 15: Medical Software</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-16-side-channel-attacks/index.htm">
<img src="https://img.youtube.com/vi/3v5Von-oNUg/default.jpg" title="Lecture 16: Side-Channel Attacks" alt="Lecture 16: Side-Channel Attacks">
<p>Lecture 16: Side-Channel At...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-17-user-authentication/index.htm">
<img src="https://img.youtube.com/vi/MT7X17ZRo1U/default.jpg" title="Lecture 17: User Authentication" alt="Lecture 17: User Authentication">
<p>Lecture 17: User Authentica...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-18-private-browsing/index.htm">
<img src="https://img.youtube.com/vi/YTWXAFJf8bw/default.jpg" title="Lecture 18: Private Browsing" alt="Lecture 18: Private Browsing">
<p>Lecture 18: Private Browsing</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-19-anonymous-communication/index.htm">
<img src="https://img.youtube.com/vi/OgGTJIgNewE/default.jpg" title="Lecture 19: Anonymous Communication" alt="Lecture 19: Anonymous Communication">
<p>Lecture 19: Anonymous Commu...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-20-mobile-phone-security/index.htm">
<img src="https://img.youtube.com/vi/uT7BXusDgDM/default.jpg" title="Lecture 20: Mobile Phone Security" alt="Lecture 20: Mobile Phone Security">
<p>Lecture 20: Mobile Phone Se...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-21-data-tracking/index.htm">
<img src="https://img.youtube.com/vi/WG5UbMrUiLU/default.jpg" title="Lecture 21: Data Tracking" alt="Lecture 21: Data Tracking">
<p>Lecture 21: Data Tracking</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-22-guest-lecture-by-mit-is-t/index.htm">
<img src="https://img.youtube.com/vi/2PO8h1pVW50/default.jpg" title="Lecture 22: Guest Lecture by MIT IS&amp;T" alt="Lecture 22: Guest Lecture by MIT IS&amp;T">
<p>Lecture 22: Guest Lecture b...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-23-security-economics/index.htm">
<img src="https://img.youtube.com/vi/8PdnOZI7H5E/default.jpg" title="Lecture 23: Security Economics" alt="Lecture 23: Security Economics">
<p>Lecture 23: Security Economics</p></a>
</div>
</div>
        <div id="vid_playlist" itemprop="description" class="tabContent hide">
<ul><li><a class="transcript-link" title="Open in a new window." alt="Open in a new window." style="text-decoration: none; font-size: 1.0em;" target="_blank" text-decoration: none font-size: href="../../../contents/video-lectures/lecture-7-sandboxing-native-code/I0Psvvky-44.pdf"> Download English-US transcript (PDF)</a></li></ul>
<p><span m="70">The</span> <span m="170">following</span> <span m="610">content</span> <span m="1120">is</span> <span m="1230">provided</span> <span m="1670">under</span> <span m="1940">a</span> <span m="1980">Creative</span> <span m="2430">Commons</span> <span m="2830">license.</span> <span m="3820">Your</span> <span m="3920">support</span> <span m="4420">will</span> <span m="4560">help</span> <span m="4820">MIT</span> <span m="5310">OpenCourseWare</span> <span m="6060">continue</span> <span m="6540">to</span> <span m="6680">offer</span> <span m="7000">high</span> <span m="7210">quality</span> <span m="7720">educational</span> <span m="8370">resources</span> <span m="8940">for</span> <span m="9080">free.</span> <span m="10150">To</span> <span m="10250">make</span> <span m="10340">a</span> <span m="10400">donation</span> <span m="11090">or</span> <span m="11340">to</span> <span m="11450">view</span> <span m="11660">additional</span> <span m="12070">materials</span> <span m="12700">from</span> <span m="12860">hundreds</span> <span m="13190">of</span> <span m="13300">MIT</span> <span m="13680">courses,</span> <span m="15000">visit</span> <span m="15160">MIT</span> <span m="15690">OpenCourseWare</span> <span m="16600">at</span> <span m="16830">ocw.mit.edu.</span> </p>
<p><span m="26730">PROFESSOR: All</span> <span m="26870">right,</span> <span m="27720">let's</span> <span m="27830">get</span> <span m="27940">started.</span> <span m="29110">So</span> <span m="29960">today</span> <span m="30170">we're</span> <span m="30260">going</span> <span m="30390">to</span> <span m="30460">talk</span> <span m="30700">about</span> <span m="31450">the</span> <span m="31670">system</span> <span m="32150">called</span> <span m="32490">Native</span> <span m="32590">Client,</span> <span m="33320">which</span> <span m="34800">is</span> <span m="35480">actually</span> <span m="35830">a</span> <span m="35950">real</span> <span m="36160">world</span> <span m="36340">system</span> <span m="36730">used</span> <span m="37120">by</span> <span m="37860">Google.</span> <span m="39890">One</span> <span m="39990">example,</span> <span m="40340">they</span> <span m="40440">actually</span> <span m="40590">use</span> <span m="40800">it</span> <span m="40900">in</span> <span m="41060">the</span> <span m="41200">Chrome</span> <span m="41500">browser</span> <span m="42070">to</span> <span m="42690">allow</span> <span m="43340">web</span> <span m="43400">applications to</span> <span m="43860">run</span> <span m="44120">arbitrary</span> <span m="44630">native</span> <span m="44940">code.</span> <span m="45290">It's</span> <span m="45790">actually</span> <span m="45960">a</span> <span m="46130">pretty cool</span> <span m="46620">system,</span> <span m="47070">and</span> <span m="47830">it's</span> <span m="48320">also</span> <span m="48730">an</span> <span m="49020">illustration.</span> </p>
<p><span m="49560">Another</span> <span m="50310">isolation</span> <span m="51020">or</span> <span m="51250">sort</span> <span m="51360">of</span> <span m="51580">sandboxing</span> <span m="52390">or</span> <span m="52520">privilege</span> <span m="52900">separation</span> <span m="53400">technique,</span> <span m="54230">that's</span> <span m="54490">called</span> <span m="54700">software</span> <span m="55070">fault</span> <span m="55320">isolation,</span> <span m="56920">doesn't</span> <span m="57200">rely</span> <span m="57700">on</span> <span m="58010">operating</span> <span m="58420">systems</span> <span m="58850">to</span> <span m="58980">sandbox</span> <span m="59250">a</span> <span m="59520">process</span> <span m="59775">or</span> <span m="60030">virtual</span> <span m="60330">machines.</span> <span m="61130">But</span> <span m="61260">instead,</span> <span m="61400">it</span> <span m="61870">has</span> <span m="62050">a</span> <span m="62420">very</span> <span m="62570">different</span> <span m="62810">approach</span> <span m="63330">to</span> <span m="63450">looking</span> <span m="63780">at</span> <span m="63900">the</span> <span m="64010">particular</span> <span m="64349">instructions</span> <span m="65000">in</span> <span m="65090">a</span> <span m="65129">binary,</span> <span m="65830">to</span> <span m="65920">figure</span> <span m="66210">out</span> <span m="66380">whether</span> <span m="66620">it's</span> <span m="66730">going</span> <span m="66830">to</span> <span m="66870">be</span> <span m="66980">safe</span> <span m="67280">to</span> <span m="67400">run</span> <span m="67850">or</span> <span m="68030">not.</span> </p>
<p><span m="69390">So</span> <span m="69810">before</span> <span m="70100">we</span> <span m="70720">I guess</span> <span m="70810">start</span> <span m="71590">looking</span> <span m="71900">at</span> <span m="72030">the</span> <span m="72160">technical</span> <span m="72470">details</span> <span m="72820">of</span> <span m="72920">the</span> <span m="73020">system,</span> <span m="74470">let's</span> <span m="74610">figure out,</span> <span m="75000">why</span> <span m="75260">do</span> <span m="75300">these</span> <span m="75500">guys</span> <span m="75740">actually</span> <span m="76080">want</span> <span m="76630">to</span> <span m="77270">run</span> <span m="78180">native</span> <span m="78520">code?</span> <span m="78960">So</span> <span m="79040">the</span> <span m="79340">particular</span> <span m="79720">context</span> <span m="80730">they</span> <span m="80970">are</span> <span m="81580">interested</span> <span m="82100">in</span> <span m="82680">applying</span> <span m="83070">their</span> <span m="83250">solution</span> <span m="83670">to</span> <span m="83980">is</span> <span m="84230">a</span> <span m="84310">web</span> <span m="84500">browser,</span> <span m="84940">where</span> <span m="85540">you</span> <span m="85640">can</span> <span m="85770">already</span> <span m="86420">run</span> <span m="86770">JavaScript</span> <span m="87420">code</span> <span m="88010">and</span> <span m="88380">maybe</span> <span m="88680">Flash,</span> <span m="89400">and</span> <span m="89570">maybe</span> <span m="89750">a</span> <span m="89820">couple</span> <span m="90010">of</span> <span m="90090">other</span> <span m="90250">things.</span> <span m="91510">Why</span> <span m="91730">are</span> <span m="91780">these</span> <span m="92000">guys</span> <span m="92180">so</span> <span m="92300">excited</span> <span m="92620">about</span> <span m="92840">running</span> <span m="93120">raw</span> <span m="93420">x86?</span> <span m="94070">It</span> <span m="94170">seems</span> <span m="95370">like</span> <span m="95460">a</span> <span m="95530">step</span> <span m="95800">backwards.</span> </p>
<p><span m="96758">AUDIENCE: Really</span> <span m="97216">fast</span> <span m="97674">computation.</span> </p>
<p><span m="98590">PROFESSOR: Yeah,</span> <span m="98890">that's</span> <span m="98990">one</span> <span m="99220">huge</span> <span m="99530">advantage</span> <span m="99830">of</span> <span m="99910">native</span> <span m="100170">code.</span> <span m="100410">Even</span> <span m="100590">though</span> <span m="100730">it</span> <span m="100830">might</span> <span m="101090">be</span> <span m="101230">unsafe</span> <span m="101850">from</span> <span m="102050">some</span> <span m="102370">perspectives,</span> <span m="103560">it's</span> <span m="103880">really</span> <span m="104310">high</span> <span m="104560">performance.</span> <span m="105210">And</span> <span m="105390">whatever</span> <span m="105710">you</span> <span m="105870">can</span> <span m="106400">do</span> <span m="106630">in</span> <span m="106920">JavaScript,</span> <span m="107490">presumably</span> <span m="107850">you</span> <span m="107910">could</span> <span m="108060">just</span> <span m="108280">write</span> <span m="108860">the</span> <span m="108950">same</span> <span m="109160">thing</span> <span m="109380">and</span> <span m="109480">assemble it,</span> <span m="109870">and it'll</span> <span m="110490">go</span> <span m="111210">at</span> <span m="111390">least</span> <span m="111720">as</span> <span m="111860">fast--</span> <span m="112510">probably</span> <span m="112730">much</span> <span m="112930">faster.</span> <span m="114070">Any</span> <span m="114230">other</span> <span m="114370">reasons?</span> <span m="114650">Yeah?</span> </p>
<p><span m="115395">AUDIENCE: Run existing</span> <span m="115830">code?</span> </p>
<p><span m="116700">PROFESSOR: Yeah.</span> <span m="117090">So</span> <span m="117450">another</span> <span m="117730">big</span> <span m="117910">thing</span> <span m="118100">is</span> <span m="118210">maybe</span> <span m="118400">not</span> <span m="118610">everything</span> <span m="118890">is</span> <span m="118990">written</span> <span m="119160">in</span> <span m="119240">JavaScript.</span> <span m="119830">So</span> <span m="120130">if</span> <span m="120370">you</span> <span m="120430">have</span> <span m="120610">an</span> <span m="120680">existing</span> <span m="121100">application--</span> <span m="123090">I guess</span> <span m="123430">'legacy'</span> <span m="124120">in</span> <span m="124230">industry</span> <span m="124570">terminology--</span> <span m="126811">if</span> <span m="127210">you</span> <span m="127370">have</span> <span m="127510">some</span> <span m="127620">existing</span> <span m="128000">code that you</span> <span m="128370">really</span> <span m="128580">want</span> <span m="128740">to</span> <span m="128850">run</span> <span m="129110">in</span> <span m="129289">the</span> <span m="129389">web,</span> <span m="130389">then</span> <span m="130729">this</span> <span m="130870">seems like</span> <span m="131020">a</span> <span m="131190">great</span> <span m="131540">solution.</span> <span m="131940">Because</span> <span m="132190">you</span> <span m="132260">could</span> <span m="132350">just</span> <span m="132540">take</span> <span m="132730">an</span> <span m="132800">existing</span> <span m="133240">library,</span> <span m="134530">like</span> <span m="134650">some</span> <span m="134820">complicated</span> <span m="135830">graphics</span> <span m="136310">processing</span> <span m="136950">engine</span> <span m="137340">that's both</span> <span m="137630">performance</span> <span m="138320">sensitive</span> <span m="139045">and</span> <span m="139570">lots of</span> <span m="140200">complicated</span> <span m="140390">stuff</span> <span m="140650">you</span> <span m="140720">don't</span> <span m="140880">want</span> <span m="141000">to re-implement,</span> <span m="141050">then</span> <span m="141550">this</span> <span m="141800">seems</span> <span m="141990">like</span> <span m="142120">a</span> <span m="142140">good</span> <span m="142310">solution.</span> <span m="143990">Anything</span> <span m="144280">else--</span> <span m="144530">if</span> <span m="144610">you're just</span> <span m="144860">like</span> <span m="145040">programming</span> <span m="145530">a new</span> <span m="145630">web</span> <span m="145920">app,</span> <span m="146260">should</span> <span m="146500">you</span> <span m="147170">use</span> <span m="147450">Native</span> <span m="148020">Client</span> <span m="148440">if</span> <span m="148650">you</span> <span m="149460">don't</span> <span m="149610">care</span> <span m="149740">about</span> <span m="149900">legacy</span> <span m="150390">or</span> <span m="150530">performance</span> <span m="150970">so</span> <span m="151080">much?</span> <span m="153910">Any</span> <span m="154310">other</span> <span m="154960">reasons?</span> <span m="157800">I</span> <span m="157850">guess</span> <span m="158010">another--</span> <span m="158070">yeah?</span> </p>
<p><span m="158550">AUDIENCE: You don't have</span> <span m="159030">to use</span> <span m="159510">JavaScript.</span> </p>
<p><span m="159990">PROFESSOR: Yeah,</span> <span m="160470">that's</span> <span m="160700">an awesome</span> <span m="160750">reason, right?</span> <span m="162300">If</span> <span m="162470">you</span> <span m="162800">don't</span> <span m="163040">like</span> <span m="163250">JavaScript,</span> <span m="163680">then you</span> <span m="163810">don't</span> <span m="163980">have</span> <span m="164090">to</span> <span m="164150">use</span> <span m="164390">it,</span> <span m="164450">right?</span> <span m="164590">You</span> <span m="164660">can</span> <span m="164740">actually</span> <span m="164940">use,</span> <span m="165610">well,</span> <span m="165870">C,</span> <span m="166220">if</span> <span m="166310">you are</span> <span m="166510">so</span> <span m="166680">inclined.</span> <span m="167140">You</span> <span m="167210">could</span> <span m="167320">run</span> <span m="167490">Python</span> <span m="168020">code,</span> <span m="168370">you</span> <span m="168460">could</span> <span m="168660">write</span> <span m="169050">Haskell,</span> <span m="169680">whatever</span> <span m="170360">you</span> <span m="170480">think</span> <span m="170690">is</span> <span m="170800">useful.</span> <span m="171910">You</span> <span m="172030">could</span> <span m="172150">actually</span> <span m="172420">support</span> <span m="172720">other</span> <span m="172950">languages</span> <span m="173420">all</span> <span m="173620">of a</span> <span m="174010">sudden.</span> </p>
<p><span m="178240">So this</span> <span m="178420">is a</span> <span m="178570">reasonably</span> <span m="179170">compelling</span> <span m="180590">list</span> <span m="180930">of--</span> <span m="182270">motivation</span> <span m="183490">for</span> <span m="184040">them</span> <span m="184350">to</span> <span m="184500">run</span> <span m="185050">native</span> <span m="185360">code</span> <span m="185550">in</span> <span m="185610">the</span> <span m="185680">browser,</span> <span m="186700">and</span> <span m="187960">it</span> <span m="188200">turns out to</span> <span m="188260">be</span> <span m="188580">reasonably</span> <span m="189220">tricky</span> <span m="189520">to</span> <span m="189590">get</span> <span m="189720">right.</span> <span m="190000">And we'll</span> <span m="190160">look</span> <span m="190330">at</span> <span m="190390">the</span> <span m="190480">technical</span> <span m="190830">details,</span> <span m="191270">I</span> <span m="191370">guess,</span> <span m="191430">of</span> <span m="191930">how</span> <span m="192110">it</span> <span m="192190">works</span> <span m="192510">in</span> <span m="192600">a</span> <span m="192660">second.</span> <span m="193100">But</span> <span m="193460">just</span> <span m="193690">to</span> <span m="194150">show</span> <span m="194320">you</span> <span m="194440">guys</span> <span m="194680">what</span> <span m="194830">this</span> <span m="194960">paper is</span> <span m="195260">talking</span> <span m="195500">about,</span> <span m="195730">I</span> <span m="196310">just</span> <span m="196420">want</span> <span m="196530">to</span> <span m="196580">show</span> <span m="196930">a</span> <span m="197040">very</span> <span m="197310">simple</span> <span m="197860">tutorial</span> <span m="198390">demo</span> <span m="198760">almost</span> <span m="199220">that</span> <span m="199420">I</span> <span m="199850">got</span> <span m="200050">out</span> <span m="200200">of</span> <span m="200330">their</span> <span m="200470">Native</span> <span m="200750">Client</span> <span m="201420">website.</span> </p>
<p><span m="202410">It's</span> <span m="202500">fairly</span> <span m="202780">simple</span> <span m="203440">as</span> <span m="203520">it</span> <span m="203600">turns</span> <span m="203810">out</span> <span m="203970">to</span> <span m="204050">just</span> <span m="204350">take</span> <span m="204550">a</span> <span m="204870">C++</span> <span m="205460">or</span> <span m="205560">a</span> <span m="205620">C</span> <span m="205850">program</span> <span m="206500">and</span> <span m="206800">run</span> <span m="207010">in</span> <span m="207140">the</span> <span m="207230">browser.</span> <span m="208130">So</span> <span m="208290">just</span> <span m="208460">to</span> <span m="208540">show</span> <span m="208710">you</span> <span m="208830">what</span> <span m="208950">this</span> <span m="209100">looks</span> <span m="209310">like,</span> <span m="209970">here's</span> <span m="210460">basically a</span> <span m="210950">demo</span> <span m="211280">I</span> <span m="211410">mostly</span> <span m="212150">sort</span> <span m="212300">of</span> <span m="212420">took</span> <span m="212640">from</span> <span m="213120">one</span> <span m="213320">of their</span> <span m="213520">examples.</span> <span m="214600">So</span> <span m="214720">you</span> <span m="214820">can</span> <span m="215080">look</span> <span m="215310">at</span> <span m="216080">a</span> <span m="216420">web</span> <span m="216520">page</span> <span m="217160">like</span> <span m="217340">this</span> <span m="217590">index</span> <span m="217670">HTML</span> <span m="218270">file.</span> <span m="219110">And</span> <span m="219470">inside</span> <span m="219800">of</span> <span m="219910">it,</span> <span m="220690">you</span> <span m="220820">have a</span> <span m="221080">bunch</span> <span m="221290">of</span> <span m="221380">JavaScript</span> <span m="221920">code.</span> </p>
<p><span m="222360">And</span> <span m="223150">the</span> <span m="223280">reason</span> <span m="223520">this</span> <span m="223670">JavaScript</span> <span m="224120">code</span> <span m="224290">exists</span> <span m="224620">is</span> <span m="224790">to</span> <span m="224830">sort</span> <span m="224960">of</span> <span m="225060">interact</span> <span m="225940">with</span> <span m="226240">the</span> <span m="226620">Native</span> <span m="226930">Client</span> <span m="227410">piece.</span> <span m="227710">So</span> <span m="227780">the</span> <span m="227870">way</span> <span m="228420">you</span> <span m="228490">can</span> <span m="228600">sort</span> <span m="228730">of</span> <span m="228850">think</span> <span m="229050">of</span> <span m="229160">this</span> <span m="229370">running</span> <span m="229700">in</span> <span m="229770">the</span> <span m="229850">browser</span> <span m="230810">is</span> <span m="230950">that</span> <span m="231110">you</span> <span m="231200">have</span> <span m="231410">the</span> <span m="231480">browser--</span> <span m="233680">well,</span> <span m="233870">we'll</span> <span m="233990">talk</span> <span m="234290">much</span> <span m="234480">more</span> <span m="234610">about</span> <span m="234800">web</span> <span m="234920">security</span> <span m="235240">later,</span> <span m="235570">but</span> <span m="235950">roughly</span> <span m="236370">you</span> <span m="236480">have</span> <span m="236700">some</span> <span m="236870">sort</span> <span m="237040">of</span> <span m="237110">a</span> <span m="237190">page,</span> <span m="238430">web</span> <span m="238720">page</span> <span m="239070">that</span> <span m="239320">contains</span> <span m="239720">some</span> <span m="239870">JavaScript</span> <span m="240480">code.</span> <span m="241540">And</span> <span m="241750">this</span> <span m="241950">runs</span> <span m="243200">with</span> <span m="243550">the</span> <span m="243670">pages</span> <span m="244050">privileges.</span> <span m="245310">And</span> <span m="245720">this</span> <span m="245850">can</span> <span m="246030">do</span> <span m="246890">various</span> <span m="247220">things</span> <span m="247530">to</span> <span m="247630">the</span> <span m="247750">web</span> <span m="247940">page</span> <span m="248160">itself,</span> <span m="248880">maybe</span> <span m="249110">talk</span> <span m="249310">to</span> <span m="249390">the</span> <span m="249470">network</span> <span m="249770">in</span> <span m="249880">some</span> <span m="250040">circumstances.</span> </p>
<p><span m="251140">But</span> <span m="251390">what</span> <span m="251570">Native</span> <span m="251840">Client</span> <span m="252260">allows</span> <span m="252540">you</span> <span m="252640">to</span> <span m="252680">do</span> <span m="253080">is</span> <span m="253240">to</span> <span m="253320">have</span> <span m="253640">this</span> <span m="254240">Native</span> <span m="254580">Client</span> <span m="254990">module</span> <span m="256370">running</span> <span m="257060">sort of</span> <span m="257380">to</span> <span m="257519">the</span> <span m="257649">side</span> <span m="258329">in</span> <span m="258519">the</span> <span m="258600">browser</span> <span m="258990">as</span> <span m="259079">well.</span> <span m="259670">And</span> <span m="259899">the</span> <span m="259980">JavaScript</span> <span m="260430">code</span> <span m="260649">can</span> <span m="260720">actually</span> <span m="260970">interact</span> <span m="261540">with</span> <span m="261640">the</span> <span m="261709">Native</span> <span m="262000">Client</span> <span m="262300">module</span> <span m="263050">and</span> <span m="263260">get</span> <span m="263430">responses</span> <span m="264070">back.</span> </p>
<p><span m="265600">And</span> <span m="266030">what</span> <span m="266140">you</span> <span m="266240">see</span> <span m="266420">here</span> <span m="266700">in</span> <span m="266770">this</span> <span m="266910">web</span> <span m="267090">page</span> <span m="267440">is</span> <span m="267720">the</span> <span m="267980">little</span> <span m="268210">bit</span> <span m="268340">of</span> <span m="268430">JavaScript</span> <span m="268920">code</span> <span m="269140">that's</span> <span m="269310">necessary</span> <span m="270160">in</span> <span m="270390">Native</span> <span m="270630">Client</span> <span m="270980">to</span> <span m="271110">interract</span> <span m="271530">with</span> <span m="271660">the</span> <span m="271880">particular</span> <span m="273200">NaCl</span> <span m="273630">module</span> <span m="274060">that</span> <span m="274180">we're</span> <span m="274300">going</span> <span m="274410">to</span> <span m="274470">be</span> <span m="275070">running.</span> <span m="275920">And</span> <span m="276290">you</span> <span m="276410">can</span> <span m="276670">send</span> <span m="276930">messages</span> <span m="277440">to</span> <span m="277540">this</span> <span m="277820">module.</span> <span m="278300">The</span> <span m="278380">way</span> <span m="278490">you</span> <span m="278580">do</span> <span m="278760">it</span> <span m="278830">is</span> <span m="278980">you</span> <span m="279420">take</span> <span m="279610">this</span> <span m="279780">module</span> <span m="280170">object</span> <span m="280540">in</span> <span m="280610">JavaScript,</span> <span m="281090">and</span> <span m="281180">you</span> <span m="281550">call it</span> <span m="281820">postMessage.</span> <span m="282440">And</span> <span m="282690">you</span> <span m="282770">could</span> <span m="282870">actually</span> <span m="283100">supply</span> <span m="284050">a</span> <span m="284130">message</span> <span m="284530">to</span> <span m="284710">send</span> <span m="285020">to</span> <span m="285120">the</span> <span m="285520">Native</span> <span m="285750">Client</span> <span m="286030">module.</span> <span m="287560">And</span> <span m="287680">when</span> <span m="287910">the</span> <span m="288040">Native Client</span> <span m="288310">module</span> <span m="288620">responds,</span> <span m="289430">it'll</span> <span m="289710">run</span> <span m="289950">this</span> <span m="290650">handle</span> <span m="291040">message</span> <span m="291360">function</span> <span m="291690">in</span> <span m="291800">JavaScript.</span> <span m="292980">And</span> <span m="293120">in</span> <span m="293220">this</span> <span m="293290">particular</span> <span m="293640">case,</span> <span m="293910">it</span> <span m="294020">just</span> <span m="294250">pops</span> <span m="294530">up</span> <span m="294670">and</span> <span m="294810">alerts</span> <span m="295360">dialog</span> <span m="296160">box</span> <span m="296960">in</span> <span m="297110">my</span> <span m="297220">browser.</span> </p>
<p><span m="299080">So</span> <span m="299280">it's</span> <span m="299450">a</span> <span m="299540">fairly</span> <span m="299810">simple</span> <span m="300110">interface</span> <span m="300470">from</span> <span m="300640">the</span> <span m="300780">web</span> <span m="301020">page</span> <span m="301270">side,</span> <span m="301520">from</span> <span m="301590">the</span> <span m="301680">JavaScript</span> <span m="302220">side.</span> <span m="303030">And</span> <span m="303240">the</span> <span m="303290">only</span> <span m="303480">thing</span> <span m="303620">you</span> <span m="303810">additional</span> <span m="304190">you</span> <span m="304240">have</span> <span m="304370">to</span> <span m="304450">do,</span> <span m="304630">is you</span> <span m="304740">actually</span> <span m="305200">have</span> <span m="305310">to</span> <span m="305450">declare</span> <span m="306090">this</span> <span m="306890">Native</span> <span m="307190">Client</span> <span m="307560">module</span> <span m="308670">this</span> <span m="309000">way.</span> <span m="309210">So</span> <span m="309330">you</span> <span m="309470">just</span> <span m="309620">say</span> <span m="309790">embed</span> <span m="310890">module</span> <span m="311450">with</span> <span m="311580">a</span> <span m="311630">particular</span> <span m="311970">ID.</span> <span m="312620">And</span> <span m="312830">the</span> <span m="313070">sort of</span> <span m="313420">most interesting</span> <span m="313800">part</span> <span m="314030">is</span> <span m="314170">this</span> <span m="314290">source</span> <span m="314730">equals</span> <span m="315440">Hello.</span> <span m="316290">some</span> <span m="316580">NMF</span> <span m="318100">barch</span> <span m="318490">attribute.</span> <span m="319230">And</span> <span m="319490">this</span> <span m="319620">one</span> <span m="319780">just</span> <span m="319970">says,</span> <span m="320190">well</span> <span m="320340">here's</span> <span m="320630">the</span> <span m="320850">roughly</span> <span m="321150">executable</span> <span m="321710">file</span> <span m="322140">that</span> <span m="322340">you</span> <span m="322480">need</span> <span m="322690">to</span> <span m="322850">load</span> <span m="323090">and</span> <span m="323240">start</span> <span m="323490">running</span> <span m="324220">in</span> <span m="324460">the</span> <span m="325140">native</span> <span m="325440">side</span> <span m="325680">of</span> <span m="325780">things.</span> </p>
<p><span m="327230">And</span> <span m="327390">this</span> <span m="327520">native</span> <span m="327800">code</span> <span m="328020">actually</span> <span m="328230">looks</span> <span m="328730">like</span> <span m="328990">any</span> <span m="329210">other</span> <span m="329750">C++</span> <span m="330090">code</span> <span m="330880">you</span> <span m="330960">might</span> <span m="331160">write</span> <span m="331460">roughly.</span> <span m="332230">So</span> <span m="332330">here's</span> <span m="332730">the</span> <span m="333440">program.</span> <span m="334290">The</span> <span m="334630">interesting</span> <span m="335020">part</span> <span m="335350">is</span> <span m="335480">roughly</span> <span m="335810">this</span> <span m="336020">handle</span> <span m="336380">message</span> <span m="336690">function.</span> <span m="337620">So</span> <span m="337740">this</span> <span m="337880">is</span> <span m="338060">a</span> <span m="338260">C++</span> <span m="338900">class,</span> <span m="339370">and</span> <span m="339930">whenever</span> <span m="341260">the</span> <span m="341480">JavaScript</span> <span m="342100">code</span> <span m="342380">sends</span> <span m="342690">some</span> <span m="342740">message</span> <span m="343240">to</span> <span m="343850">the</span> <span m="343960">native</span> <span m="344250">code,</span> <span m="344510">it'll</span> <span m="344700">actually</span> <span m="344940">run</span> <span m="345120">this</span> <span m="345260">function.</span> <span m="346230">And</span> <span m="346400">it'll</span> <span m="346610">check</span> <span m="346880">if</span> <span m="347010">the</span> <span m="347110">message that's</span> <span m="347600">being</span> <span m="347810">sent is</span> <span m="348110">hello.</span> <span m="348800">And</span> <span m="348940">if</span> <span m="349030">so,</span> <span m="349630">construct</span> <span m="349890">a</span> <span m="350150">reply</span> <span m="350510">string</span> <span m="350830">of</span> <span m="350900">some</span> <span m="351090">sort</span> <span m="351310">and</span> <span m="351460">send</span> <span m="351640">it</span> <span m="351740">back.</span> <span m="352920">It's</span> <span m="352960">fairly</span> <span m="353220">simple</span> <span m="353470">stuff.</span> <span m="353850">But</span> <span m="354040">just</span> <span m="354210">to</span> <span m="354860">be</span> <span m="355250">concrete,</span> <span m="356020">let's</span> <span m="356260">try</span> <span m="356420">to</span> <span m="356510">run it</span> <span m="356810">and</span> <span m="356950">see</span> <span m="357070">what</span> <span m="357200">happens.</span> </p>
<p><span m="358300">So</span> <span m="358400">we</span> <span m="358500">can</span> <span m="358600">actually</span> <span m="358700">build</span> <span m="359070">it,</span> <span m="360220">and</span> <span m="361680">run</span> <span m="361920">a</span> <span m="361970">little</span> <span m="362190">web</span> <span m="362360">server</span> <span m="362950">that</span> <span m="364610">is</span> <span m="364760">going</span> <span m="366690">serve</span> <span m="367130">up</span> <span m="367390">this</span> <span m="367670">page</span> <span m="368090">and</span> <span m="368230">Native</span> <span m="368510">Client</span> <span m="368850">module.</span> <span m="369950">So here</span> <span m="370090">I can</span> <span m="370500">go</span> <span m="370640">to</span> <span m="370700">this</span> <span m="370880">URL</span> <span m="371830">and</span> <span m="372470">here</span> <span m="372590">we</span> <span m="372670">go.</span> <span m="372850">Right,</span> <span m="373040">it's</span> <span m="373170">actually</span> <span m="373390">loaded in</span> <span m="373820">the</span> <span m="373890">module.</span> <span m="374640">The</span> <span m="374740">module</span> <span m="375200">seems to</span> <span m="375440">have</span> <span m="375600">gotten</span> <span m="375860">our</span> <span m="376100">hello</span> <span m="376280">message</span> <span m="376580">from</span> <span m="376750">JavaScript.</span> <span m="377436">It</span> <span m="377780">replied</span> <span m="378250">back</span> <span m="378520">with</span> <span m="378680">the</span> <span m="378780">string</span> <span m="379210">back</span> <span m="379420">to</span> <span m="379520">JavaScript.</span> <span m="379720">And</span> <span m="380700">the</span> <span m="380760">JavaScript</span> <span m="381240">code</span> <span m="381510">popped</span> <span m="381760">up</span> <span m="381880">a</span> <span m="381940">dialog</span> <span m="382310">box</span> <span m="382600">containing</span> <span m="383000">that</span> <span m="383170">response.</span> <span m="384390">So</span> <span m="384530">it actually does</span> <span m="384860">kind</span> <span m="385010">of</span> <span m="385100">work.</span> </p>
<p><span m="386710">We</span> <span m="386790">can</span> <span m="386890">try</span> <span m="387030">to</span> <span m="387140">see</span> <span m="387240">if</span> <span m="387330">we</span> <span m="387400">could</span> <span m="387560">crash</span> <span m="388030">Native</span> <span m="388260">Client--</span> <span m="389350">hopefully</span> <span m="389680">not,</span> <span m="389980">but</span> <span m="390960">we</span> <span m="391160">can</span> <span m="392300">take</span> <span m="392570">this</span> <span m="393170">code</span> <span m="393440">and</span> <span m="393500">we</span> <span m="393580">have</span> <span m="393710">this</span> <span m="393850">buffer.</span> <span m="394690">We</span> <span m="394920">could</span> <span m="395900">write</span> <span m="396100">a</span> <span m="396140">bunch</span> <span m="396360">of</span> <span m="396470">As</span> <span m="396860">to</span> <span m="396990">it--</span> <span m="397890">I don't</span> <span m="398030">know,</span> <span m="398800">quite</span> <span m="399010">a</span> <span m="399290">lot--</span> <span m="400630">and</span> <span m="400780">see</span> <span m="400860">what</span> <span m="400960">happens.</span> <span m="402020">So</span> <span m="402320">hopefully</span> <span m="402680">this</span> <span m="402780">shouldn't</span> <span m="403070">crash</span> <span m="403380">my</span> <span m="403460">browser,</span> <span m="403970">because</span> <span m="404220">Native</span> <span m="404430">Client</span> <span m="404660">is</span> <span m="404750">trying</span> <span m="404940">to</span> <span m="405000">provide</span> <span m="405320">isolation.</span> <span m="407760">But</span> <span m="408460">let's</span> <span m="408630">see</span> <span m="408710">what</span> <span m="408810">happens.</span> </p>
<p><span m="410740">So</span> <span m="410800">we</span> <span m="410870">can</span> <span m="411170">rebuild</span> <span m="411660">it,</span> <span m="412310">rerun</span> <span m="412640">the</span> <span m="412720">web</span> <span m="412860">server.</span> <span m="413930">And</span> <span m="414240">here</span> <span m="415350">if</span> <span m="415510">you</span> <span m="415650">run</span> <span m="415840">it,</span> <span m="416670">nothing</span> <span m="416900">happens.</span> <span m="417290">We</span> <span m="417370">don't</span> <span m="417490">get</span> <span m="417610">the</span> <span m="417680">message</span> <span m="418010">back</span> <span m="418250">anymore,</span> <span m="418620">so</span> <span m="419160">clearly</span> <span m="419520">the</span> <span m="419600">message didn't</span> <span m="420080">get</span> <span m="420260">sent</span> <span m="420620">back</span> <span m="420920">from</span> <span m="421080">the</span> <span m="421150">Native</span> <span m="421350">Client</span> <span m="421630">module,</span> <span m="421890">because</span> <span m="422130">I</span> <span m="422170">don't</span> <span m="422340">see any</span> <span m="422740">popup.</span> <span m="423150">We</span> <span m="423270">can</span> <span m="423370">look</span> <span m="423540">at</span> <span m="423660">the</span> <span m="424330">JavaScript</span> <span m="424910">console</span> <span m="425320">here,</span> <span m="425980">and</span> <span m="426120">we</span> <span m="426190">can</span> <span m="426320">see</span> <span m="426540">that</span> <span m="426760">the</span> <span m="426880">Native</span> <span m="427170">Client</span> <span m="427480">module</span> <span m="427830">tells</span> <span m="428100">us</span> <span m="428920">NaCl</span> <span m="429320">module</span> <span m="429700">crash.</span> </p>
<p><span m="430270">So</span> <span m="430600">somehow</span> <span m="430780">it</span> <span m="431150">caught</span> <span m="431560">this</span> <span m="431790">buffer</span> <span m="432240">flow</span> <span m="433670">scribbling</span> <span m="434250">over</span> <span m="434480">some</span> <span m="434670">memory,</span> <span m="435030">or</span> <span m="435120">maybe</span> <span m="435370">it</span> <span m="435490">jumped</span> <span m="435920">to</span> <span m="436070">some</span> <span m="436260">bad</span> <span m="436570">address</span> <span m="436940">containing</span> <span m="437420">all</span> <span m="437710">As.</span> <span m="438780">But</span> <span m="439150">any</span> <span m="439420">case,</span> <span m="440110">the</span> <span m="440220">Native</span> <span m="440430">Client</span> <span m="440790">module</span> <span m="441110">is</span> <span m="441240">actually</span> <span m="441350">able</span> <span m="441600">to</span> <span m="441680">contain</span> <span m="442090">this</span> <span m="442460">without</span> <span m="443080">this</span> <span m="443360">arbitrary</span> <span m="443850">sort</span> <span m="443970">of</span> <span m="444030">memory</span> <span m="444310">corruption in</span> <span m="444720">the</span> <span m="444790">module</span> <span m="445540">affecting</span> <span m="446170">the</span> <span m="446370">rest</span> <span m="446620">of</span> <span m="446730">the</span> <span m="446810">browser.</span> <span m="448620">So this is</span> <span m="448920">roughly</span> <span m="449250">just</span> <span m="449450">a</span> <span m="450190">quick</span> <span m="450410">demo</span> <span m="450760">of</span> <span m="451050">what</span> <span m="451240">the</span> <span m="451320">system</span> <span m="451640">is,</span> <span m="452150">and</span> <span m="454610">how</span> <span m="454730">you</span> <span m="454790">use</span> <span m="455080">it</span> <span m="455570">as</span> <span m="455760">an</span> <span m="456015">end</span> <span m="456270">user or</span> <span m="456640">web</span> <span m="456820">developer.</span> </p>
<p><span m="458400">So</span> <span m="458500">let's</span> <span m="458670">look</span> <span m="458840">now</span> <span m="459120">at some</span> <span m="459300">more.</span> <span m="459500">So that's all</span> <span m="460000">in</span> <span m="460120">terms</span> <span m="460330">of</span> <span m="460580">demos</span> <span m="460920">I</span> <span m="460990">have</span> <span m="461150">to</span> <span m="461220">show</span> <span m="461400">you.</span> <span m="462380">So</span> <span m="462500">let's</span> <span m="462650">look</span> <span m="462810">more</span> <span m="463110">now</span> <span m="463590">at</span> <span m="464220">how a</span> <span m="464520">Native</span> <span m="464850">Client</span> <span m="465110">is</span> <span m="465220">going</span> <span m="465330">to</span> <span m="465390">work,</span> <span m="465770">or</span> <span m="466300">perhaps</span> <span m="466670">even</span> <span m="466940">why</span> <span m="467180">we</span> <span m="467310">need</span> <span m="467620">this</span> <span m="467880">particular</span> <span m="468580">design</span> <span m="468970">as</span> <span m="469060">opposed</span> <span m="469400">to</span> <span m="469480">some of</span> <span m="469780">the</span> <span m="470670">alternatives.</span> </p>
<p><span m="474120">So</span> <span m="474230">if</span> <span m="474320">your</span> <span m="474520">goal,</span> <span m="475460">I</span> <span m="475560">guess</span> <span m="475750">is</span> <span m="475890">to</span> <span m="476170">sandbox</span> <span m="477550">native</span> <span m="477920">code,</span> <span m="479520">there's</span> <span m="479830">a</span> <span m="479890">number</span> <span m="480140">of</span> <span m="480200">alternatives</span> <span m="480750">you</span> <span m="480850">can</span> <span m="480870">make.</span> <span m="481300">People</span> <span m="481590">actually</span> <span m="481800">had</span> <span m="482090">these</span> <span m="482280">problems</span> <span m="482600">before,</span> <span m="483080">performance</span> <span m="483600">existing</span> <span m="483900">legacy</span> <span m="484260">code</span> <span m="484640">and</span> <span m="484730">other</span> <span m="484920">languages</span> <span m="485690">before</span> <span m="486020">Native</span> <span m="486260">Client</span> <span m="486590">came</span> <span m="486770">around.</span> <span m="487780">And</span> <span m="488250">people</span> <span m="488550">just</span> <span m="488750">solved</span> <span m="489090">them</span> <span m="489370">in</span> <span m="490300">different</span> <span m="490640">ways</span> <span m="490960">that</span> <span m="491080">maybe</span> <span m="491300">weren't</span> <span m="491670">as</span> <span m="491870">satisfying</span> <span m="493220">from</span> <span m="493460">a</span> <span m="493580">security</span> <span m="494020">standpoint</span> <span m="494540">or</span> <span m="494720">usability</span> <span m="495380">standpoint</span> <span m="495820">as</span> <span m="495910">Native</span> <span m="496150">Client.</span> <span m="497570">But</span> <span m="497720">it</span> <span m="497780">is</span> <span m="497930">doable.</span> </p>
<p><span m="499780">So let's see.</span> <span m="500190">So</span> <span m="500290">what</span> <span m="500750">could you</span> <span m="500910">do</span> <span m="501170">if</span> <span m="501210">you</span> <span m="501330">really</span> <span m="501520">want</span> <span m="501670">to</span> <span m="502120">run</span> <span m="503540">native</span> <span m="503860">code</span> <span m="504410">in</span> <span m="504550">a</span> <span m="504590">browser?</span> <span m="508730">So</span> <span m="508850">one</span> <span m="509360">option</span> <span m="510140">that</span> <span m="510930">people</span> <span m="511390">did</span> <span m="511740">was</span> <span m="513159">to</span> <span m="513299">trust</span> <span m="513590">the</span> <span m="513650">developer.</span> <span m="517440">And</span> <span m="517780">maybe</span> <span m="517990">a</span> <span m="518039">variant</span> <span m="518470">of</span> <span m="518600">this</span> <span m="518789">approach</span> <span m="519500">is</span> <span m="519659">to</span> <span m="519760">ask</span> <span m="520030">the</span> <span m="520130">user</span> <span m="521480">whether</span> <span m="522440">they</span> <span m="522559">want</span> <span m="522730">to</span> <span m="522809">run</span> <span m="523039">some</span> <span m="523250">piece</span> <span m="523440">of</span> <span m="523559">code</span> <span m="523870">in</span> <span m="523990">their</span> <span m="524130">browser</span> <span m="524590">or</span> <span m="524630">not.</span> </p>
<p><span m="527050">So</span> <span m="527120">does everybody</span> <span m="527300">understand</span> <span m="527660">roughly</span> <span m="527920">what</span> <span m="528030">the</span> <span m="528100">plan</span> <span m="528350">is,</span> <span m="528450">right?</span> <span m="528610">Like</span> <span m="528790">instead</span> <span m="529090">of</span> <span m="529800">having</span> <span m="530110">that</span> <span m="530160">whole</span> <span m="530440">Native</span> <span m="530710">Client</span> <span m="531070">compilation</span> <span m="531660">strategy,</span> <span m="532150">I could have</span> <span m="532290">just</span> <span m="532440">built</span> <span m="532710">a</span> <span m="532760">simple</span> <span m="533070">C</span> <span m="533260">program,</span> <span m="533600">served</span> <span m="533860">it</span> <span m="533930">up</span> <span m="534130">on</span> <span m="534200">the</span> <span m="534280">browser,</span> <span m="534700">and</span> <span m="534770">maybe</span> <span m="534930">the</span> <span m="535010">browser</span> <span m="535330">asked,</span> <span m="535610">do</span> <span m="535880">you</span> <span m="536030">want</span> <span m="536140">to</span> <span m="536180">run</span> <span m="536370">this</span> <span m="536460">site</span> <span m="536770">or</span> <span m="536830">not?</span> <span m="537160">If</span> <span m="537450">I</span> <span m="537510">click</span> <span m="537790">yes,</span> <span m="538090">then</span> <span m="538690">it</span> <span m="538820">accidentally</span> <span m="539270">scribbled</span> <span m="539640">over</span> <span m="539740">the</span> <span m="539820">browser's</span> <span m="540170">memory</span> <span m="540620">and</span> <span m="541040">crashes</span> <span m="541390">the</span> <span m="541460">browser.</span> </p>
<p><span m="542550">So</span> <span m="544230">it's</span> <span m="544380">possible,</span> <span m="544770">right?</span> <span m="544930">It</span> <span m="545030">certainly</span> <span m="545300">solves all</span> <span m="545760">these</span> <span m="546000">goals,</span> <span m="546360">but</span> <span m="547340">what's</span> <span m="547550">wrong</span> <span m="547740">with</span> <span m="547890">it?</span> <span m="547980">Well,</span> <span m="548130">I</span> <span m="548180">guess</span> <span m="548340">there's</span> <span m="548580">the</span> <span m="549215">insecurity</span> <span m="549880">part,</span> <span m="550950">which</span> <span m="551180">is</span> <span m="551300">unfortunate.</span> <span m="552560">One</span> <span m="552770">way</span> <span m="552920">to</span> <span m="553430">potentially</span> <span m="553780">get</span> <span m="553930">around</span> <span m="554230">this--</span> <span m="554840">and</span> <span m="555060">some</span> <span m="555200">systems</span> <span m="555590">did.</span> <span m="555840">Like</span> <span m="556480">Microsoft</span> <span m="556920">had</span> <span m="557070">the</span> <span m="557150">system</span> <span m="557490">called</span> <span m="557720">ActiveX,</span> <span m="559870">that</span> <span m="560980">basically</span> <span m="561330">implemented</span> <span m="561680">this</span> <span m="561850">plan.</span> <span m="562190">You</span> <span m="562290">could</span> <span m="562440">serve</span> <span m="562960">binaries</span> <span m="563670">to</span> <span m="564070">IE,</span> <span m="564670">the</span> <span m="564800">browser</span> <span m="565520">on</span> <span m="565670">your</span> <span m="565770">machine.</span> <span m="566410">And</span> <span m="566570">as</span> <span m="566670">long</span> <span m="566880">as</span> <span m="566970">it</span> <span m="567220">came</span> <span m="567480">with</span> <span m="567700">a</span> <span m="567770">certificate</span> <span m="568400">from</span> <span m="568570">particular</span> <span m="568930">developer</span> <span m="569820">signed</span> <span m="570350">by</span> <span m="570540">let's</span> <span m="570750">say</span> <span m="570860">Microsoft</span> <span m="571520">or</span> <span m="571590">someone</span> <span m="571880">else,</span> <span m="572850">then</span> <span m="573250">it would</span> <span m="573440">actually</span> <span m="573720">run</span> <span m="573930">this</span> <span m="574120">code.</span> <span m="575600">What</span> <span m="575730">do</span> <span m="575770">you guys</span> <span m="575930">think</span> <span m="576090">about</span> <span m="576240">this</span> <span m="576380">plan,</span> <span m="576940">is this</span> <span m="577260">useful?</span> <span m="577620">Yeah?</span> </p>
<p><span m="578496">AUDIENCE: [INAUDIBLE].</span> </p>
<p><span m="585310">PROFESSOR: That's</span> <span m="585520">right,</span> <span m="585720">yeah.</span> <span m="586000">So</span> <span m="586885">right,</span> <span m="587280">you</span> <span m="587510">really</span> <span m="587720">have</span> <span m="587850">to</span> <span m="587970">put</span> <span m="588230">quite</span> <span m="588430">a</span> <span m="588480">bit</span> <span m="588600">of</span> <span m="588720">trust</span> <span m="589160">into</span> <span m="589620">whoever it</span> <span m="589850">is</span> <span m="589980">that's</span> <span m="590240">signing</span> <span m="590690">this,</span> <span m="590990">that</span> <span m="591620">they</span> <span m="591760">will</span> <span m="591940">only</span> <span m="592280">sign</span> <span m="592590">binaries</span> <span m="593120">that</span> <span m="593280">will</span> <span m="593620">not</span> <span m="594090">to</span> <span m="594300">do</span> <span m="594470">something</span> <span m="594830">bad.</span> <span m="596120">But</span> <span m="596290">it's</span> <span m="596470">kind</span> <span m="596610">of</span> <span m="596710">vague what</span> <span m="596940">this</span> <span m="597210">bad</span> <span m="597450">thing</span> <span m="597650">is.</span> <span m="597870">And</span> <span m="597980">presumably</span> <span m="598350">they're</span> <span m="598510">just</span> <span m="598660">writing</span> <span m="598920">C</span> <span m="599140">code</span> <span m="599410">and</span> <span m="600240">signing</span> <span m="600680">it</span> <span m="600880">blindly</span> <span m="601440">without</span> <span m="601770">doing</span> <span m="602020">a</span> <span m="602370">huge</span> <span m="602560">amount</span> <span m="602760">of</span> <span m="603020">work.</span> <span m="604250">In</span> <span m="604460">which</span> <span m="604620">case,</span> <span m="605050">you</span> <span m="605180">might</span> <span m="605420">well</span> <span m="605640">be</span> <span m="605760">susceptible</span> <span m="606230">to</span> <span m="606300">some</span> <span m="606460">problems</span> <span m="607480">down</span> <span m="607650">the</span> <span m="607740">line.</span> <span m="609210">What</span> <span m="609370">if</span> <span m="609470">we ask</span> <span m="609720">the</span> <span m="609840">user?</span> <span m="610762">Yeah?</span> </p>
<p><span m="612178">AUDIENCE: [INAUDIBLE].</span> </p>
<p><span m="616770">PROFESSOR: Oh yeah,</span> <span m="616920">yeah,</span> <span m="617290">yeah.</span> <span m="617530">Like</span> <span m="617760">the</span> <span m="617920">user's</span> <span m="618250">goal is</span> <span m="618570">to</span> <span m="618750">run</span> <span m="618990">this</span> <span m="619260">thing.</span> <span m="619970">And</span> <span m="621080">even</span> <span m="621280">if</span> <span m="621370">the</span> <span m="621470">user</span> <span m="622100">wants</span> <span m="622480">to</span> <span m="622580">be</span> <span m="622790">cautious,</span> <span m="623770">it's</span> <span m="623790">actually</span> <span m="623950">not</span> <span m="624180">clear</span> <span m="624390">how</span> <span m="624570">should</span> <span m="624770">the</span> <span m="624840">user</span> <span m="625080">decide?</span> <span m="625700">Suppose</span> <span m="625970">I</span> <span m="626100">really</span> <span m="626370">want</span> <span m="626530">to</span> <span m="626570">understand,</span> <span m="627410">should</span> <span m="627710">I</span> <span m="627750">allow</span> <span m="628100">this</span> <span m="628250">program</span> <span m="628580">to</span> <span m="628710">run?</span> <span m="629250">All</span> <span m="629480">it</span> <span m="629580">tells</span> <span m="629780">me</span> <span m="629950">is well,</span> <span m="630260">maybe</span> <span m="630390">it's</span> <span m="630650">created</span> <span m="630890">from</span> <span m="631060">Google.com</span> <span m="631820">or</span> <span m="631870">Microsoft.com,</span> <span m="632250">and</span> <span m="633180">its</span> <span m="633340">file</span> <span m="633650">name</span> <span m="633870">as</span> <span m="634030">foo.exe.</span> <span m="634590">I</span> <span m="635950">don't</span> <span m="636420">know, like</span> <span m="636580">what's</span> <span m="636890">in</span> <span m="637020">there?</span> <span m="637770">Even</span> <span m="637920">if</span> <span m="638020">I</span> <span m="638090">dissemble</span> <span m="638660">the</span> <span m="638740">code, it</span> <span m="639020">might</span> <span m="639170">be</span> <span m="639250">very</span> <span m="639420">hard</span> <span m="639600">to</span> <span m="639700">tell</span> <span m="640010">whether</span> <span m="640200">it's</span> <span m="640480">going</span> <span m="640680">to</span> <span m="640760">do</span> <span m="640910">something</span> <span m="641210">bad</span> <span m="641490">or</span> <span m="641580">not.</span> </p>
<p><span m="642310">So</span> <span m="642590">it's</span> <span m="642870">actually</span> <span m="643010">really</span> <span m="643270">hard</span> <span m="643520">to</span> <span m="643630">decide.</span> <span m="644270">So</span> <span m="644620">one</span> <span m="644810">way</span> <span m="644920">to</span> <span m="645010">think</span> <span m="645230">of</span> <span m="645330">Native</span> <span m="645610">Client</span> <span m="645980">is</span> <span m="646210">it's</span> <span m="646380">a</span> <span m="646440">mechanism</span> <span m="646870">by</span> <span m="647040">which</span> <span m="647490">users</span> <span m="648050">can</span> <span m="648220">actually</span> <span m="648870">get</span> <span m="649020">some</span> <span m="649160">confidence</span> <span m="649660">whether</span> <span m="649860">they</span> <span m="649990">should</span> <span m="650210">say</span> <span m="650390">yes</span> <span m="650680">or</span> <span m="650760">not to</span> <span m="651040">running</span> <span m="651350">this</span> <span m="651560">thing.</span> <span m="651770">So</span> <span m="652810">in</span> <span m="652960">practice,</span> <span m="653330">I</span> <span m="653380">guess</span> <span m="653590">like</span> <span m="653790">Paul</span> <span m="654100">Young,</span> <span m="654300">who was</span> <span m="654430">giving</span> <span m="654610">his guest</span> <span m="654950">lecture</span> <span m="655190">last</span> <span m="655450">week,</span> <span m="655670">and</span> <span m="655770">he</span> <span m="655970">suggested</span> <span m="656200">that</span> <span m="656380">you should</span> <span m="656680">enable</span> <span m="656935">this</span> <span m="657190">click</span> <span m="657400">to</span> <span m="657490">play</span> <span m="657720">extension</span> <span m="657985">in</span> <span m="658250">Chrome.</span> </p>
<p><span m="658560">So</span> <span m="658660">every</span> <span m="658950">extension,</span> <span m="659410">including</span> <span m="659760">Native</span> <span m="660000">Client,</span> <span m="660550">you should</span> <span m="660640">rush</span> <span m="660990">click</span> <span m="661250">on</span> <span m="661330">this</span> <span m="661470">thing</span> <span m="661710">before</span> <span m="662130">it</span> <span m="662200">starts</span> <span m="662490">running.</span> <span m="663370">So</span> <span m="663530">in some ways, that's</span> <span m="664000">ask</span> <span m="664300">the</span> <span m="664430">user.</span> <span m="664750">But</span> <span m="665050">then the user</span> <span m="665250">actually</span> <span m="665470">has</span> <span m="665630">some</span> <span m="665810">sense,</span> <span m="666080">that</span> <span m="666190">well,</span> <span m="666390">if</span> <span m="666480">I</span> <span m="666540">click</span> <span m="666850">it,</span> <span m="667160">I'm</span> <span m="667310">still</span> <span m="667730">hopefully</span> <span m="668130">safe</span> <span m="668940">in</span> <span m="669060">the</span> <span m="669140">sense</span> <span m="669440">that</span> <span m="669520">Native Client</span> <span m="669820">will protect</span> <span m="670270">me.</span> <span m="670630">So</span> <span m="671220">the two</span> <span m="671680">aren't</span> <span m="672040">necessarily</span> <span m="672490">exclusive,</span> <span m="673210">but</span> <span m="673330">you</span> <span m="673520">really</span> <span m="673720">want</span> <span m="674020">some</span> <span m="674500">technical</span> <span m="675100">guarantee</span> <span m="675640">from</span> <span m="675850">Native</span> <span m="676100">Client</span> <span m="676880">that</span> <span m="677560">ensures</span> <span m="678120">that</span> <span m="678470">even</span> <span m="678630">if</span> <span m="678730">you</span> <span m="678810">say</span> <span m="678930">yes,</span> <span m="679300">there</span> <span m="679440">are</span> <span m="679500">something</span> <span m="679850">meaningful</span> <span m="680840">that</span> <span m="681290">isn't</span> <span m="681860">enforcing</span> <span m="682280">your</span> <span m="682440">security.</span> <span m="684210">So</span> <span m="684370">does this make</span> <span m="684530">sense?</span> <span m="686440">OK.</span> </p>
<p><span m="687410">So</span> <span m="687780">the</span> <span m="687880">other</span> <span m="688440">I</span> <span m="688500">guess</span> <span m="688710">approach</span> <span m="689430">that</span> <span m="690250">people</span> <span m="690560">have</span> <span m="690660">taken,</span> <span m="691340">is</span> <span m="692630">to</span> <span m="693150">use</span> <span m="693760">an</span> <span m="694370">OS</span> <span m="694930">or</span> <span m="695150">hardware</span> <span m="695550">sandboxing,</span> <span m="696580">or</span> <span m="697050">isolation.</span> <span m="701730">So</span> <span m="701870">this is</span> <span m="703160">things</span> <span m="703340">we</span> <span m="703500">looked</span> <span m="703700">at</span> <span m="703880">in</span> <span m="704220">the</span> <span m="704440">last</span> <span m="704770">couple</span> <span m="704980">of</span> <span m="705040">lectures.</span> <span m="705470">So</span> <span m="706500">maybe</span> <span m="706710">you</span> <span m="706820">would</span> <span m="706930">use</span> <span m="707170">Unix,</span> <span m="707720">isolation</span> <span m="708230">mechanisms.</span> <span m="709800">Maybe</span> <span m="710310">if</span> <span m="710400">you</span> <span m="710490">had</span> <span m="710720">something</span> <span m="710960">more</span> <span m="711200">sophisticated,</span> <span m="711790">if</span> <span m="711870">you're</span> <span m="712000">running</span> <span m="712380">a free</span> <span m="712720">[INAUDIBLE]</span> <span m="713060">maybe</span> <span m="713400">you would</span> <span m="713695">use</span> <span m="713990">Capsicum.</span> <span m="714790">It</span> <span m="714920">seems</span> <span m="715090">very</span> <span m="715330">well</span> <span m="715550">suited</span> <span m="715970">to</span> <span m="716270">sandboxing</span> <span m="716920">some</span> <span m="717130">piece</span> <span m="717330">of</span> <span m="717430">code.</span> <span m="718060">Because</span> <span m="718270">you can</span> <span m="718500">give it</span> <span m="718850">very</span> <span m="719190">few</span> <span m="719350">capabilities,</span> <span m="719970">and</span> <span m="720090">then</span> <span m="720450">it</span> <span m="720800">seems</span> <span m="721500">great.</span> <span m="722070">And</span> <span m="722640">Linux has a</span> <span m="722700">similar</span> <span m="723020">mechanism</span> <span m="723810">called</span> <span m="724040">Seccomp</span> <span m="724380">that</span> <span m="724770">we</span> <span m="724890">briefly</span> <span m="725260">touched</span> <span m="725570">on</span> <span m="725790">in</span> <span m="726050">the</span> <span m="726310">last</span> <span m="726570">lecture,</span> <span m="726990">that could</span> <span m="727420">allow you</span> <span m="727860">to</span> <span m="727930">do</span> <span m="728050">similar</span> <span m="728400">things.</span> </p>
<p><span m="729844">So it seems</span> <span m="730271">like</span> <span m="730700">there</span> <span m="730800">is</span> <span m="731190">already a</span> <span m="731660">mechanism</span> <span m="732150">for</span> <span m="732470">writing</span> <span m="732850">code</span> <span m="733120">in</span> <span m="733220">isolation</span> <span m="733750">on</span> <span m="733920">your</span> <span m="734060">machine.</span> <span m="735410">Why are</span> <span m="735760">these</span> <span m="735980">guys</span> <span m="736210">opposed</span> <span m="736510">to</span> <span m="736810">using</span> <span m="737210">this</span> <span m="737760">existing</span> <span m="738280">solution?</span> <span m="738810">Then they are</span> <span m="738950">like</span> <span m="739230">reinventing the</span> <span m="739510">wheel</span> <span m="739850">for</span> <span m="739950">some</span> <span m="740070">reason.</span> <span m="742130">So</span> <span m="742560">what's</span> <span m="742660">going</span> <span m="742850">on?</span> <span m="744110">Yeah?</span> <span m="745110">Oh yeah?</span> </p>
<p><span m="747110">AUDIENCE: Maybe they</span> <span m="747610">want to</span> <span m="748110">minimize the</span> <span m="748610">[INAUDIBLE]?</span> </p>
<p><span m="750110">PROFESSOR: Yeah,</span> <span m="750660">so</span> <span m="750910">in</span> <span m="751180">some sense, maybe</span> <span m="751450">they</span> <span m="751800">don't</span> <span m="752010">want</span> <span m="752140">to</span> <span m="752480">trust</span> <span m="754200">the</span> <span m="754410">operating</span> <span m="754720">system.</span> <span m="755100">So maybe they're</span> <span m="755500">here, and</span> <span m="755770">they're</span> <span m="756010">actually</span> <span m="756220">worried</span> <span m="756860">about</span> <span m="757240">OS</span> <span m="757620">bugs.</span> <span m="759430">It</span> <span m="759550">might</span> <span m="759740">be</span> <span m="759880">that</span> <span m="760070">the</span> <span m="760170">previous</span> <span m="760560">dekernel, the</span> <span m="761090">Linux</span> <span m="761550">kernel,</span> <span m="762410">has</span> <span m="763100">quite</span> <span m="763300">a</span> <span m="763350">lot</span> <span m="763580">of</span> <span m="763690">C code</span> <span m="764190">written</span> <span m="764570">that</span> <span m="764780">they</span> <span m="765250">don't</span> <span m="765800">want</span> <span m="766000">to</span> <span m="766140">audit for</span> <span m="766540">correctness,</span> <span m="767250">or</span> <span m="767320">maybe</span> <span m="767680">can't even</span> <span m="768060">audit for</span> <span m="768360">correctness,</span> <span m="768830">even</span> <span m="768980">if</span> <span m="769090">they</span> <span m="769180">wanted</span> <span m="769390">to.</span> <span m="770360">And</span> <span m="771300">in</span> <span m="771660">one</span> <span m="771820">of</span> <span m="771880">these</span> <span m="772160">Capsicum</span> <span m="772610">or</span> <span m="772930">Seccomp</span> <span m="773360">based</span> <span m="773830">isolation</span> <span m="774280">plan,</span> <span m="774550">you probably</span> <span m="774890">do</span> <span m="775100">trust</span> <span m="775430">quite</span> <span m="775610">a</span> <span m="775660">bit</span> <span m="775790">of</span> <span m="776060">code</span> <span m="776340">in</span> <span m="776410">the</span> <span m="776520">kernel</span> <span m="776840">to</span> <span m="776920">be</span> <span m="777040">correct,</span> <span m="777940">for</span> <span m="778150">the</span> <span m="778290">sandbox</span> <span m="778590">to</span> <span m="778890">actually</span> <span m="779150">hold</span> <span m="779620">and</span> <span m="779810">enforce</span> <span m="780176">isolation.</span> <span m="780910">Yeah?</span> </p>
<p><span m="782370">AUDIENCE: As</span> <span m="783080">you</span> <span m="783240">get</span> <span m="783370">a</span> <span m="783440">lot</span> <span m="783690">more</span> <span m="784870">ways</span> <span m="785270">to</span> <span m="785450">use</span> <span m="785650">browsers</span> <span m="785770">and stuff,</span> <span m="786105">like</span> <span m="787010">you'd</span> <span m="787130">have</span> <span m="787310">to</span> <span m="787430">deal</span> <span m="787640">with</span> <span m="787810">having</span> <span m="788050">some</span> <span m="788260">sort</span> <span m="788500">of thing</span> <span m="788620">you're doing with it</span> <span m="789118">on like</span> <span m="789616">iOS</span> <span m="790114">and Android,</span> <span m="790612">and all</span> <span m="791110">these other</span> <span m="791610">things,</span> <span m="792060">accessing--</span> </p>
<p><span m="792420">PROFESSOR: Yeah,</span> <span m="792780">so it's</span> <span m="792920">actually</span> <span m="793220">another</span> <span m="793700">interesting</span> <span m="794000">consideration</span> <span m="794295">is</span> <span m="794590">that</span> <span m="794840">normally</span> <span m="795720">my</span> <span m="795870">OSes</span> <span m="796630">have</span> <span m="796900">bugs.</span> <span m="797200">But</span> <span m="797310">actually</span> <span m="797820">the</span> <span m="797970">OSs</span> <span m="798530">are</span> <span m="798800">incompatible</span> <span m="799450">with</span> <span m="799580">each</span> <span m="799740">other</span> <span m="800020">in</span> <span m="800110">some</span> <span m="800310">ways,</span> <span m="801320">meaning</span> <span m="801660">that</span> <span m="801880">each</span> <span m="802140">OS</span> <span m="802520">has</span> <span m="802830">it's own--</span> <span m="803110">like</span> <span m="803570">right</span> <span m="803750">here.</span> <span m="804240">Well,</span> <span m="804430">there's</span> <span m="804580">Unix,</span> <span m="805030">there's</span> <span m="805170">Capsicum,</span> <span m="805680">there's</span> <span m="805790">Seccomp,</span> <span m="806235">but</span> <span m="806680">this is just a</span> <span m="806850">Unix</span> <span m="807030">variances.</span> <span m="807290">There's</span> <span m="807550">Mac</span> <span m="807870">OS</span> <span m="808170">seatbelt,</span> <span m="808620">there's</span> <span m="808770">Windows</span> <span m="809190">something</span> <span m="809580">else,</span> <span m="809920">and</span> <span m="810080">the</span> <span m="810160">list</span> <span m="810650">just</span> <span m="810790">keeps</span> <span m="810990">going</span> <span m="811180">on</span> <span m="811320">and</span> <span m="811670">on.</span> <span m="811970">So</span> <span m="812380">as</span> <span m="812470">a</span> <span m="812520">result,</span> <span m="812890">every</span> <span m="814160">platform</span> <span m="814770">you</span> <span m="814920">will</span> <span m="815040">have</span> <span m="815270">to</span> <span m="815380">use</span> <span m="815610">a</span> <span m="815700">different</span> <span m="816210">isolation</span> <span m="816830">mechanism.</span> <span m="817750">And</span> <span m="817870">the</span> <span m="817960">thing</span> <span m="818110">that</span> <span m="818240">actually</span> <span m="818520">bothers</span> <span m="819040">them</span> <span m="819480">is</span> <span m="819600">not</span> <span m="819760">so</span> <span m="819850">much</span> <span m="820080">that</span> <span m="820150">they'll</span> <span m="820290">have</span> <span m="820420">to</span> <span m="820520">write</span> <span m="820740">different</span> <span m="821110">code</span> <span m="821410">for</span> <span m="821550">Mac</span> <span m="821970">and</span> <span m="822110">Windows</span> <span m="822510">and</span> <span m="822630">Linux.</span> <span m="823390">But</span> <span m="823610">more</span> <span m="823910">of</span> <span m="824000">that,</span> <span m="824540">this</span> <span m="824770">impacts</span> <span m="825420">how</span> <span m="825590">you</span> <span m="825770">write</span> <span m="825990">the</span> <span m="826080">thing</span> <span m="826510">inside</span> <span m="826965">of</span> <span m="827420">the</span> <span m="827520">sandbox.</span> <span m="829000">Because</span> <span m="829220">in</span> <span m="829330">Native</span> <span m="829630">Client,</span> <span m="830170">you actually</span> <span m="830330">write</span> <span m="830520">a</span> <span m="830560">piece</span> <span m="830830">of</span> <span m="830970">code</span> <span m="831210">that</span> <span m="831450">runs</span> <span m="831740">the</span> <span m="831850">same</span> <span m="832330">way,</span> <span m="833140">or</span> <span m="833240">it's</span> <span m="833340">the</span> <span m="833430">same</span> <span m="833700">piece of</span> <span m="833840">code</span> <span m="834070">the</span> <span m="834210">runs</span> <span m="834670">on</span> <span m="835180">Apple</span> <span m="835860">or</span> <span m="836070">Windows</span> <span m="836580">or</span> <span m="836700">Linux</span> <span m="837050">systems.</span> <span m="838420">And</span> <span m="838910">if</span> <span m="839090">you</span> <span m="839190">use</span> <span m="839520">these</span> <span m="839810">isolation</span> <span m="840370">mechanisms,</span> <span m="840655">they</span> <span m="840940">actually</span> <span m="841260">impose</span> <span m="841700">different</span> <span m="842050">restrictions</span> <span m="842790">on</span> <span m="842910">the</span> <span m="843000">program</span> <span m="843340">being</span> <span m="843550">sandboxed.</span> <span m="844440">So</span> <span m="844520">you'll</span> <span m="844650">have</span> <span m="844850">to</span> <span m="845660">write</span> <span m="846170">one</span> <span m="846410">program that's</span> <span m="846840">going</span> <span m="846970">to</span> <span m="847060">run</span> <span m="847330">inside</span> <span m="847670">of a Linux</span> <span m="848110">sandbox,</span> <span m="848560">another</span> <span m="848810">program</span> <span m="849170">inside</span> <span m="849440">of a</span> <span m="849510">Windows</span> <span m="849970">sandbox,</span> <span m="850860">and</span> <span m="851030">so on. So</span> <span m="851430">this</span> <span m="851540">is</span> <span m="851700">actually</span> <span m="852490">not</span> <span m="852690">acceptable</span> <span m="853150">to</span> <span m="853220">them.</span> <span m="853400">They</span> <span m="853510">don't</span> <span m="853650">want</span> <span m="853790">to</span> <span m="853850">deal</span> <span m="854120">with</span> <span m="854280">these</span> <span m="855220">kinds</span> <span m="855480">of</span> <span m="855590">problems.</span> </p>
<p><span m="857202">So are</span> <span m="857690">there</span> <span m="858020">other</span> <span m="859410">considerations?</span> <span m="860620">Yeah?</span> </p>
<p><span m="862090">AUDIENCE: Presumably</span> <span m="862580">performance as</span> <span m="863070">well.</span> <span m="863400">Because</span> <span m="863710">if</span> <span m="863850">you</span> <span m="864720">say</span> <span m="865730">Capsicum,</span> <span m="866370">you</span> <span m="866710">need</span> <span m="866890">to</span> <span m="867235">fork up a</span> <span m="867580">set of</span> <span m="867955">[INAUDIBLE],</span> <span m="868590">or</span> <span m="868970">whatever</span> <span m="869510">is</span> <span m="869690">running</span> <span m="869850">inside</span> <span m="869920">the</span> <span m="870460">sandbox.</span> <span m="871370">With</span> <span m="871510">here, they</span> <span m="871710">can actually</span> <span m="872195">run it</span> <span m="872680">in the same</span> <span m="873165">[INAUDIBLE].</span> </p>
<p><span m="874135">PROFESSOR: That's true,</span> <span m="874620">yeah.</span> <span m="874830">So</span> <span m="874980">potentially</span> <span m="875600">the</span> <span m="875680">approach</span> <span m="876030">they</span> <span m="876150">take,</span> <span m="876440">the</span> <span m="876550">software</span> <span m="876950">fault</span> <span m="877190">isolation</span> <span m="877620">plan</span> <span m="877880">is</span> <span m="878000">actually</span> <span m="878260">highly</span> <span m="878660">performant,</span> <span m="879260">and</span> <span m="879620">could</span> <span m="879840">outperform</span> <span m="880600">these</span> <span m="881430">sandboxes</span> <span m="881855">at</span> <span m="882280">the</span> <span m="882650">OS</span> <span m="883000">level.</span> <span m="883700">It</span> <span m="883800">turns</span> <span m="883920">out</span> <span m="884100">that in</span> <span m="884540">Native</span> <span m="884770">Client, they</span> <span m="885180">actually</span> <span m="885570">use</span> <span m="885855">both</span> <span m="886140">their</span> <span m="886430">sandbox</span> <span m="887270">and</span> <span m="888340">the</span> <span m="888450">OS</span> <span m="888800">sandbox,</span> <span m="889390">just</span> <span m="889640">for</span> <span m="889830">extra</span> <span m="890520">precaution</span> <span m="891450">for</span> <span m="891680">safety.</span> <span m="892110">So</span> <span m="892820">they</span> <span m="893020">don't</span> <span m="893190">actually</span> <span m="893420">win on</span> <span m="893710">performance</span> <span m="894260">in</span> <span m="894370">their</span> <span m="894630">implementation,</span> <span m="895290">but</span> <span m="895390">they</span> <span m="895500">could,</span> <span m="895830">right.</span> <span m="896080">Yeah?</span> </p>
<p><span m="896800">AUDIENCE: There is</span> <span m="897135">some like</span> <span m="897470">control</span> <span m="897930">aspect</span> <span m="898410">to it.</span> <span m="898710">Because it can</span> <span m="899010">control what</span> <span m="899370">happens</span> <span m="899830">in the browser,</span> <span m="900310">but if</span> <span m="900790">they sent</span> <span m="901270">one out</span> <span m="901750">to the client's</span> <span m="902230">machine</span> <span m="902710">into</span> <span m="903190">their</span> <span m="903670">OS,</span> <span m="904150">they sort  of</span> <span m="904630">don't necessarily</span> <span m="905110">know</span> <span m="905590">what</span> <span m="906070">might be happening</span> <span m="906550">to it?</span> </p>
<p><span m="907990">PROFESSOR: So</span> <span m="908140">I</span> <span m="908220">guess</span> <span m="909060">maybe</span> <span m="909520">one</span> <span m="909790">way</span> <span m="909930">to</span> <span m="910060">think</span> <span m="910260">of that</span> <span m="910700">is</span> <span m="911210">that</span> <span m="911490">yeah,</span> <span m="911770">the OS</span> <span m="911990">might have</span> <span m="912350">bugs,</span> <span m="912630">or</span> <span m="912770">my</span> <span m="912930">OS</span> <span m="913260">might not</span> <span m="913560">do as good</span> <span m="913860">of</span> <span m="914030">a</span> <span m="914090">job</span> <span m="914320">at</span> <span m="914550">sandboxing</span> <span m="914770">it.</span> <span m="915710">Or</span> <span m="915810">maybe</span> <span m="916980">the</span> <span m="917070">interface</span> <span m="917500">is a</span> <span m="917570">little</span> <span m="917800">different,</span> <span m="918310">so</span> <span m="918410">you</span> <span m="918510">don't</span> <span m="918610">know</span> <span m="918710">what</span> <span m="918750">the</span> <span m="918830">OS is</span> <span m="919130">going to</span> <span m="919430">expose.</span> </p>
<p><span m="920958">AUDIENCE: So it doesn't</span> <span m="921906">like prevent  the</span> <span m="922380">code from</span> <span m="922854">doing</span> <span m="923328">some</span> <span m="923802">bad things.</span> <span m="924655">Like</span> <span m="925030">there are</span> <span m="925180">a lot of</span> <span m="925455">cases of</span> <span m="925730">bad</span> <span m="926160">things</span> <span m="926590">that</span> <span m="927085">the code can just do, like</span> <span m="927580">maybe you</span> <span m="927995">want to</span> <span m="928410">statically</span> <span m="928700">analyze</span> <span m="928990">the</span> <span m="929450">distance,</span> <span m="929910">but they both</span> <span m="930370">sit in a</span> <span m="930830">loop and then not</span> <span m="931290">allow that as a</span> <span m="931750">valid</span> <span m="932210">program.</span> </p>
<p><span m="933590">PROFESSOR: So</span> <span m="933760">you</span> <span m="933920">could, right?</span> <span m="934240">So</span> <span m="934390">their</span> <span m="934540">approach</span> <span m="934950">is</span> <span m="935350">quite</span> <span m="935570">powerful</span> <span m="935970">in</span> <span m="936010">the</span> <span m="936080">sense</span> <span m="936280">that</span> <span m="936400">you</span> <span m="936590">could</span> <span m="936880">try</span> <span m="937270">to</span> <span m="937430">look</span> <span m="937740">for</span> <span m="937880">various</span> <span m="938190">kinds</span> <span m="938410">of</span> <span m="938540">problems</span> <span m="939090">in</span> <span m="939140">the</span> <span m="939240">code</span> <span m="939510">like</span> <span m="939830">maybe</span> <span m="940270">infinite</span> <span m="940570">loops,</span> <span m="940930">et</span> <span m="941250">cetera.</span> <span m="941740">It's</span> <span m="941880">hard</span> <span m="942040">to</span> <span m="942120">decide,</span> <span m="942830">kind of</span> <span m="943210">like the</span> <span m="943640">holding</span> <span m="943940">problem,</span> <span m="944480">whether</span> <span m="944750">it's</span> <span m="944870">going</span> <span m="944970">to</span> <span m="945010">have</span> <span m="945295">infinite</span> <span m="945580">loops</span> <span m="945750">or</span> <span m="945820">not.</span> <span m="946740">But</span> <span m="947130">in</span> <span m="947240">principle,</span> <span m="947920">you</span> <span m="948040">might</span> <span m="948220">be</span> <span m="948280">able</span> <span m="948460">to</span> <span m="948530">catch</span> <span m="948780">some</span> <span m="948960">problems.</span> </p>
<p><span m="950390">I</span> <span m="950490">think</span> <span m="950800">one</span> <span m="951450">actually</span> <span m="951760">interesting</span> <span m="952070">example</span> <span m="952790">that</span> <span m="953500">I</span> <span m="953660">almost</span> <span m="953900">didn't</span> <span m="954130">realize</span> <span m="954610">this sort of</span> <span m="954910">existed</span> <span m="955270">before</span> <span m="955540">reading</span> <span m="955770">this</span> <span m="955960">paper,</span> <span m="956340">is</span> <span m="956680">these guys</span> <span m="956890">are worried</span> <span m="957150">about</span> <span m="957250">hardware</span> <span m="957870">bugs</span> <span m="958580">as</span> <span m="958720">well,</span> <span m="959400">that</span> <span m="959850">not</span> <span m="960150">only are they</span> <span m="960460">worried</span> <span m="960780">that the</span> <span m="960990">operating</span> <span m="961310">system</span> <span m="961690">might</span> <span m="961880">have</span> <span m="962010">vulnerabilities</span> <span m="962760">that</span> <span m="963035">the</span> <span m="963310">motions</span> <span m="963700">code will</span> <span m="964010">exploit.</span> <span m="964870">But</span> <span m="964990">also</span> <span m="965370">that the</span> <span m="965730">processor</span> <span m="966280">itself</span> <span m="967300">has</span> <span m="967570">some</span> <span m="968090">instructions</span> <span m="969030">that will</span> <span m="969330">hang</span> <span m="969665">it,</span> <span m="970000">or</span> <span m="970600">it'll</span> <span m="970860">reboot</span> <span m="971310">your</span> <span m="971420">machine.</span> <span m="972250">And</span> <span m="972740">in</span> <span m="972870">principle,</span> <span m="973610">your</span> <span m="974250">hardware</span> <span m="974620">shouldn't</span> <span m="974990">have such</span> <span m="975450">bug,</span> <span m="975850">because</span> <span m="976680">the</span> <span m="976810">operating</span> <span m="977190">system</span> <span m="977470">relies</span> <span m="978270">on</span> <span m="978590">the</span> <span m="978660">hardware</span> <span m="979440">to</span> <span m="979780">trap</span> <span m="980140">into</span> <span m="980310">the</span> <span m="980460">kernel</span> <span m="980920">if</span> <span m="981030">there's</span> <span m="981240">anything</span> <span m="981710">bad</span> <span m="982690">executing</span> <span m="983290">user</span> <span m="983550">mode,</span> <span m="984180">so</span> <span m="984420">that the</span> <span m="984530">operating</span> <span m="984840">system</span> <span m="985160">can</span> <span m="985320">take</span> <span m="985550">care</span> <span m="985780">of</span> <span m="985890">it.</span> </p>
<p><span m="986650">But</span> <span m="987580">experimentally,</span> <span m="987940">it</span> <span m="988300">turns</span> <span m="988570">out</span> <span m="988770">that</span> <span m="989030">processors</span> <span m="989280">are</span> <span m="989555">so</span> <span m="989830">complicated</span> <span m="990105">that</span> <span m="990380">they</span> <span m="990710">do</span> <span m="990910">have</span> <span m="991150">bugs,</span> <span m="991520">and</span> <span m="991680">these</span> <span m="991880">guys</span> <span m="992060">actually</span> <span m="992240">say,</span> <span m="992440">well,</span> <span m="992640">we</span> <span m="992670">actually</span> <span m="992890">found</span> <span m="993590">some</span> <span m="993760">evidence</span> <span m="994170">that</span> <span m="994280">this</span> <span m="994440">happens.</span> <span m="994705">If</span> <span m="994970">you</span> <span m="995280">have</span> <span m="995880">some</span> <span m="996050">complicated</span> <span m="996370">instruction</span> <span m="996840">that the</span> <span m="997310">CPU</span> <span m="997460">wasn't</span> <span m="997760">expecting,</span> <span m="998800">the</span> <span m="999065">CPU</span> <span m="999620">will</span> <span m="999750">actually</span> <span m="999970">halt</span> <span m="1000490">instead</span> <span m="1000965">of</span> <span m="1001570">trapping to</span> <span m="1001750">the</span> <span m="1001880">kernel.</span> <span m="1002950">This</span> <span m="1003010">seems</span> <span m="1003130">bad.</span> <span m="1003960">But I guess</span> <span m="1004160">it's</span> <span m="1004430">not</span> <span m="1004600">a</span> <span m="1004770">disastrous,</span> <span m="1005280">if</span> <span m="1005410">I'm</span> <span m="1005730">sort of</span> <span m="1006010">only</span> <span m="1006290">running</span> <span m="1006640">reasonable</span> <span m="1007090">things</span> <span m="1007350">on</span> <span m="1007430">my</span> <span m="1007550">laptop.</span> <span m="1008560">But</span> <span m="1009060">it</span> <span m="1009170">is</span> <span m="1009400">bad</span> <span m="1009730">if</span> <span m="1009900">you</span> <span m="1010010">visit</span> <span m="1010300">some</span> <span m="1010490">web page and</span> <span m="1010820">your</span> <span m="1011040">computer</span> <span m="1011430">hangs.</span> </p>
<p><span m="1012300">So</span> <span m="1012310">they</span> <span m="1012430">want</span> <span m="1012730">basically</span> <span m="1012840">a</span> <span m="1013310">stronger</span> <span m="1013870">level</span> <span m="1014130">of</span> <span m="1014210">protection</span> <span m="1014730">for</span> <span m="1015050">these</span> <span m="1015710">Native</span> <span m="1016010">Client</span> <span m="1016360">modules</span> <span m="1017290">than</span> <span m="1017660">what</span> <span m="1017810">you would</span> <span m="1018080">get</span> <span m="1018510">out</span> <span m="1019000">of</span> <span m="1019470">sort of an</span> <span m="1019940">OS</span> <span m="1020290">level</span> <span m="1020550">isolation,</span> <span m="1021410">even</span> <span m="1021680">from</span> <span m="1021860">a</span> <span m="1021890">hardware</span> <span m="1022280">[INAUDIBLE]</span> <span m="1022545">bug</span> <span m="1022810">standpoint.</span> <span m="1024430">So</span> <span m="1024480">they're</span> <span m="1024890">actually</span> <span m="1025200">pretty cool.</span> <span m="1025480">They're like really</span> <span m="1025760">paranoid</span> <span m="1026170">about</span> <span m="1028140">security,</span> <span m="1029450">including</span> <span m="1030069">hardware</span> <span m="1031240">problems.</span> <span m="1032612">All</span> <span m="1032960">right, so</span> <span m="1033240">any</span> <span m="1033369">questions</span> <span m="1033710">about</span> <span m="1034090">all these</span> <span m="1034470">alternatives,</span> <span m="1035140">how</span> <span m="1035250">that</span> <span m="1035390">works,</span> <span m="1035690">or</span> <span m="1035800">why</span> <span m="1036060">these</span> <span m="1036140">guys</span> <span m="1036599">are</span> <span m="1036950">not</span> <span m="1037400">excited</span> <span m="1037660">about</span> <span m="1037849">that?</span> <span m="1039454">Makes</span> <span m="1039800">sense?</span> <span m="1041496">All</span> <span m="1041930">right.</span> </p>
<p><span m="1042700">So</span> <span m="1043349">I</span> <span m="1043450">guess</span> <span m="1043640">let's</span> <span m="1044510">try</span> <span m="1044700">to</span> <span m="1044760">look</span> <span m="1044980">at</span> <span m="1045430">now,</span> <span m="1045990">how</span> <span m="1046480">Native</span> <span m="1046730">Client</span> <span m="1047140">does</span> <span m="1047359">actually</span> <span m="1047990">decide</span> <span m="1048720">to</span> <span m="1048800">sandbox</span> <span m="1049310">processes.</span> <span m="1050566">Let</span> <span m="1051062">me pull</span> <span m="1051560">up these</span> <span m="1051950">boards.</span> <span m="1054760">So</span> <span m="1054880">Native</span> <span m="1055000">Client</span> <span m="1055660">takes</span> <span m="1055910">this</span> <span m="1056270">different</span> <span m="1056580">approach</span> <span m="1057340">that's</span> <span m="1058140">in</span> <span m="1058270">general</span> <span m="1058630">called</span> <span m="1059760">software</span> <span m="1060260">fault</span> <span m="1060590">isolation.</span> </p>
<p><span m="1069040">And the</span> <span m="1069150">plan</span> <span m="1069580">is</span> <span m="1069800">actually</span> <span m="1070180">not</span> <span m="1070700">rely</span> <span m="1071780">on</span> <span m="1072140">the</span> <span m="1072220">operating</span> <span m="1072630">system</span> <span m="1072890">or</span> <span m="1073000">hardware</span> <span m="1073345">to</span> <span m="1073690">check</span> <span m="1074120">things</span> <span m="1074400">at</span> <span m="1074600">runtime,</span> <span m="1075500">but</span> <span m="1075610">instead</span> <span m="1076380">to</span> <span m="1076700">somehow</span> <span m="1077010">look</span> <span m="1077430">at</span> <span m="1077560">the</span> <span m="1077670">instructions</span> <span m="1079040">ahead</span> <span m="1079340">of</span> <span m="1079490">time,</span> <span m="1080000">and</span> <span m="1080260">decide</span> <span m="1081280">that</span> <span m="1081620">there are</span> <span m="1081760">always</span> <span m="1082330">going</span> <span m="1082450">to</span> <span m="1082530">be</span> <span m="1082900">safe</span> <span m="1083270">to</span> <span m="1083610">execute.</span> <span m="1083950">So</span> <span m="1084290">actually</span> <span m="1084970">look</span> <span m="1085200">at</span> <span m="1085310">the</span> <span m="1085400">binary,</span> <span m="1085760">and</span> <span m="1086120">you</span> <span m="1086350">check</span> <span m="1086750">all</span> <span m="1086950">the</span> <span m="1087030">possible</span> <span m="1087390">instructions</span> <span m="1088610">to</span> <span m="1088690">see</span> <span m="1088910">whether</span> <span m="1089340">they're</span> <span m="1089480">going</span> <span m="1089580">to</span> <span m="1089620">be</span> <span m="1090030">safe</span> <span m="1090370">instructions</span> <span m="1091480">or</span> <span m="1091670">unsafe</span> <span m="1092000">instructions.</span> </p>
<p><span m="1092660">And</span> <span m="1093970">once</span> <span m="1094290">you've</span> <span m="1094820">decided</span> <span m="1095250">that it's</span> <span m="1095420">all going to</span> <span m="1095690">be safe,</span> <span m="1095960">you</span> <span m="1096340">can just</span> <span m="1096610">jump</span> <span m="1096900">in</span> <span m="1097130">and</span> <span m="1097250">start</span> <span m="1097500">executing.</span> <span m="1098050">Because</span> <span m="1098290">you know</span> <span m="1098585">it's</span> <span m="1099520">all</span> <span m="1099780">composed</span> <span m="1100200">of</span> <span m="1100380">safe</span> <span m="1100710">things,</span> <span m="1100970">so</span> <span m="1101230">it</span> <span m="1101410">cannot</span> <span m="1101790">go</span> <span m="1101940">wrong.</span> </p>
<p><span m="1102850">So</span> <span m="1103340">we'll</span> <span m="1103630">talk</span> <span m="1103810">about</span> <span m="1104040">exactly</span> <span m="1104340">what</span> <span m="1104600">this</span> <span m="1104790">means.</span> <span m="1105800">But</span> <span m="1106420">roughly</span> <span m="1107320">what</span> <span m="1107460">they're</span> <span m="1107590">going</span> <span m="1107680">to</span> <span m="1107750">do</span> <span m="1107880">is,</span> <span m="1108130">they're</span> <span m="1108260">going</span> <span m="1108350">to</span> <span m="1108430">look</span> <span m="1108710">at</span> <span m="1109300">pretty much</span> <span m="1109560">every</span> <span m="1109880">instruction</span> <span m="1111000">in</span> <span m="1111250">the</span> <span m="1111350">binary</span> <span m="1111800">code</span> <span m="1112110">that is</span> <span m="1112380">served</span> <span m="1112730">up to</span> <span m="1112950">the</span> <span m="1113020">browser.</span> <span m="1114050">And</span> <span m="1114140">they're</span> <span m="1114230">going</span> <span m="1114360">to</span> <span m="1115050">decide</span> <span m="1115920">that</span> <span m="1116510">particular</span> <span m="1116830">instructions are</span> <span m="1117290">going to</span> <span m="1117670">be safe</span> <span m="1119190">or</span> <span m="1119720">unsafe.</span> </p>
<p><span m="1122235">What do</span> <span m="1122660">they do for</span> <span m="1122950">safe</span> <span m="1123100">instructions?</span> <span m="1123455">Well, they're</span> <span m="1123810">just going</span> <span m="1123990">to</span> <span m="1124120">allow</span> <span m="1124600">them.</span> <span m="1126010">What's an</span> <span m="1126100">example</span> <span m="1126510">of a</span> <span m="1126840">safe</span> <span m="1127040">instruction?</span> <span m="1128315">What are</span> <span m="1128580">they</span> <span m="1128800">thinking</span> <span m="1129030">of</span> <span m="1129380">that</span> <span m="1129800">don't</span> <span m="1130030">need</span> <span m="1130230">any</span> <span m="1130470">extra</span> <span m="1130860">checks</span> <span m="1131260">or</span> <span m="1131860">protections,</span> <span m="1132150">et cetera?</span> </p>
<p><span m="1133432">AUDIENCE: [INAUDIBLE].</span> </p>
<p><span m="1134424">PROFESSOR: Yeah,</span> <span m="1135190">so</span> <span m="1135680">like</span> <span m="1136070">any</span> <span m="1136250">kind</span> <span m="1136430">of</span> <span m="1136540">ALU</span> <span m="1136880">operation.</span> <span m="1137900">Basically</span> <span m="1138260">you have</span> <span m="1138460">math,</span> <span m="1139010">presumably</span> <span m="1139730">moves</span> <span m="1141480">between</span> <span m="1141890">registers</span> <span m="1143010">and</span> <span m="1143480">so on.</span> <span m="1143840">So</span> <span m="1143940">this</span> <span m="1144150">doesn't</span> <span m="1144270">actually</span> <span m="1144545">affect</span> <span m="1144820">the</span> <span m="1144930">security</span> <span m="1145320">of</span> <span m="1145440">the</span> <span m="1145520">system,</span> <span m="1146490">as</span> <span m="1146590">far</span> <span m="1146720">as</span> <span m="1146790">they're</span> <span m="1146980">concerned.</span> <span m="1147410">Because</span> <span m="1147630">all</span> <span m="1147820">they</span> <span m="1147940">really</span> <span m="1148180">care</span> <span m="1148380">about</span> <span m="1148600">is</span> <span m="1148730">things</span> <span m="1148930">like</span> <span m="1149110">memory</span> <span m="1149410">safety,</span> <span m="1149940">where</span> <span m="1150210">what</span> <span m="1150410">code you</span> <span m="1150720">execute,</span> <span m="1151045">and so</span> <span m="1151370">on.</span> <span m="1152460">So as</span> <span m="1152660">long as</span> <span m="1152910">you are</span> <span m="1153160">just</span> <span m="1153710">computing</span> <span m="1154110">on some</span> <span m="1154200">stuff, and</span> <span m="1154690">registers,</span> <span m="1155340">they</span> <span m="1155460">don't</span> <span m="1155620">really</span> <span m="1155830">care.</span> <span m="1156120">It's</span> <span m="1156250">not</span> <span m="1156350">going</span> <span m="1156460">to</span> <span m="1156500">affect</span> <span m="1156860">the</span> <span m="1156970">rest</span> <span m="1157250">of</span> <span m="1157360">the</span> <span m="1157480">browser.</span> </p>
<p><span m="1159660">So</span> <span m="1159920">what</span> <span m="1160220">about unsafe</span> <span m="1160480">operations?</span> <span m="1161350">I</span> <span m="1161420">guess</span> <span m="1161580">these</span> <span m="1161760">are</span> <span m="1161950">things</span> <span m="1162290">that</span> <span m="1162870">they</span> <span m="1162960">might</span> <span m="1163350">care</span> <span m="1163570">much</span> <span m="1163790">more</span> <span m="1164010">about.</span> <span m="1164330">So</span> <span m="1164800">this</span> <span m="1165270">anything</span> <span m="1165620">that</span> <span m="1165780">maybe</span> <span m="1166810">does a</span> <span m="1167090">memory</span> <span m="1167390">access,</span> <span m="1168930">or</span> <span m="1169570">maybe</span> <span m="1169740">some</span> <span m="1169900">privileged</span> <span m="1170350">instruction,</span> <span m="1172930">maybe</span> <span m="1173470">invoking</span> <span m="1173930">a</span> <span m="1173990">system</span> <span m="1174400">call</span> <span m="1174810">on</span> <span m="1174960">this</span> <span m="1175090">machine.</span> <span m="1177670">Maybe</span> <span m="1178330">trying</span> <span m="1178540">to</span> <span m="1178630">jump</span> <span m="1178840">out</span> <span m="1179010">of</span> <span m="1179090">the</span> <span m="1179190">sandbox,</span> <span m="1180340">who knows</span> <span m="1180625">what?</span> <span m="1181450">So for</span> <span m="1181890">these</span> <span m="1182180">kinds</span> <span m="1182380">of</span> <span m="1182450">instructions,</span> <span m="1183450">they</span> <span m="1183570">are</span> <span m="1183660">going</span> <span m="1183970">to</span> <span m="1184690">do</span> <span m="1184790">one</span> <span m="1184940">of</span> <span m="1185070">two things.</span> </p>
<p><span m="1186180">If the</span> <span m="1186540">instruction</span> <span m="1188110">actually</span> <span m="1188420">is</span> <span m="1188560">necessary</span> <span m="1189130">for</span> <span m="1189340">the</span> <span m="1189430">application</span> <span m="1190090">to do</span> <span m="1190565">it's job,</span> <span m="1191040">like</span> <span m="1191270">accessing</span> <span m="1191650">memory</span> <span m="1192000">seems</span> <span m="1192210">important,</span> <span m="1192922">then they're</span> <span m="1193280">going</span> <span m="1193830">to</span> <span m="1194120">somehow</span> <span m="1194860">make</span> <span m="1195110">sure</span> <span m="1195430">that</span> <span m="1195750">they</span> <span m="1195980">can</span> <span m="1197130">execute</span> <span m="1197390">this</span> <span m="1197650">unsafe</span> <span m="1197930">instruction</span> <span m="1198730">safely.</span> <span m="1199650">Or if</span> <span m="1199910">you're</span> <span m="1200130">jumping</span> <span m="1200520">around</span> <span m="1200870">for</span> <span m="1200970">example</span> <span m="1201390">in</span> <span m="1201530">the</span> <span m="1202010">program's</span> <span m="1202300">address</span> <span m="1202670">space,</span> <span m="1203020">[INAUDIBLE]</span> <span m="1203380">what they're</span> <span m="1203480">going to</span> <span m="1203890">do is somehow</span> <span m="1204310">instrument</span> <span m="1204600">the</span> <span m="1204890">instruction.</span> </p>
<p><span m="1207048">And</span> <span m="1207460">what</span> <span m="1207660">instrumenting</span> <span m="1207840">the</span> <span m="1208340">instruction</span> <span m="1208720">means</span> <span m="1209050">is</span> <span m="1209210">that</span> <span m="1209780">you</span> <span m="1210055">used to</span> <span m="1210330">have</span> <span m="1210560">one</span> <span m="1210790">unsafe</span> <span m="1211160">instruction</span> <span m="1211465">that</span> <span m="1212280">sometimes</span> <span m="1212720">does</span> <span m="1212970">good things,</span> <span m="1213500">that the</span> <span m="1213580">application</span> <span m="1214090">might</span> <span m="1214280">actually</span> <span m="1214630">want</span> <span m="1214810">to</span> <span m="1214890">do</span> <span m="1215200">legitimately.</span> <span m="1215960">And</span> <span m="1216130">sometimes</span> <span m="1216500">the instruction</span> <span m="1216810">can</span> <span m="1217120">do</span> <span m="1217320">bad</span> <span m="1217690">things.</span> <span m="1218620">So what</span> <span m="1219020">instrumenting</span> <span m="1219610">it</span> <span m="1219730">means</span> <span m="1220416">is</span> <span m="1220760">that you</span> <span m="1221000">add some</span> <span m="1221150">extra</span> <span m="1221530">instructions</span> <span m="1222070">before</span> <span m="1222375">it,</span> <span m="1222680">that</span> <span m="1223280">it'll</span> <span m="1223640">check</span> <span m="1224030">or enforce,</span> <span m="1225110">but</span> <span m="1225340">only</span> <span m="1225800">good</span> <span m="1225920">things</span> <span m="1226240">are</span> <span m="1226330">going</span> <span m="1226460">to</span> <span m="1226720">happen with</span> <span m="1227080">that</span> <span m="1227220">instruction.</span> </p>
<p><span m="1228383">So for</span> <span m="1228866">example, if</span> <span m="1229350">you</span> <span m="1229470">are</span> <span m="1229770">accessing</span> <span m="1230070">a memory</span> <span m="1230290">location,</span> <span m="1230850">which</span> <span m="1230980">you</span> <span m="1231190">could</span> <span m="1231440">do--</span> <span m="1232290">it turns out, they</span> <span m="1232430">don't</span> <span m="1232630">do</span> <span m="1232730">it</span> <span m="1232830">for</span> <span m="1232930">performance</span> <span m="1233320">reasons--</span> <span m="1233570">but</span> <span m="1234000">one</span> <span m="1234310">way</span> <span m="1234570">to</span> <span m="1234650">instrument</span> <span m="1234930">a</span> <span m="1235210">memory</span> <span m="1235440">access</span> <span m="1235890">would</span> <span m="1236030">be</span> <span m="1236180">to</span> <span m="1236290">put</span> <span m="1236650">some</span> <span m="1237200">checks,</span> <span m="1237610">like</span> <span m="1237730">an</span> <span m="1237850">if</span> <span m="1238040">statement</span> <span m="1238450">before</span> <span m="1238700">the</span> <span m="1238790">instructions,</span> <span m="1239450">saying,</span> <span m="1239580">well,</span> <span m="1240050">is</span> <span m="1240440">this</span> <span m="1240660">address</span> <span m="1240850">you're</span> <span m="1241030">accessing</span> <span m="1241370">in</span> <span m="1241490">range</span> <span m="1242370">of</span> <span m="1242530">what's</span> <span m="1242690">allowed</span> <span m="1243040">for</span> <span m="1243120">this</span> <span m="1243270">module?</span> <span m="1243660">And</span> <span m="1243860">if so,</span> <span m="1244150">do</span> <span m="1244320">that--</span> <span m="1244800">otherwise,</span> <span m="1245670">exit.</span> </p>
<p><span m="1246620">So</span> <span m="1246770">that would</span> <span m="1247180">instrument an</span> <span m="1247550">instruction.</span> <span m="1248220">And</span> <span m="1248410">that</span> <span m="1248670">would</span> <span m="1248840">turn an</span> <span m="1249230">unsafe</span> <span m="1249590">instruction</span> <span m="1250370">into</span> <span m="1250580">one</span> <span m="1250770">that's</span> <span m="1250980">always</span> <span m="1251370">safe</span> <span m="1251610">to</span> <span m="1251980">execute,</span> <span m="1252110">because</span> <span m="1252460">there's</span> <span m="1252620">always</span> <span m="1252990">that</span> <span m="1253220">check</span> <span m="1253490">in</span> <span m="1253610">front</span> <span m="1253860">of</span> <span m="1253950">it.</span> <span m="1255080">So</span> <span m="1255160">does that</span> <span m="1255340">make</span> <span m="1255490">sense?</span> <span m="1256020">This is</span> <span m="1256130">their</span> <span m="1256405">sort</span> <span m="1256680">of</span> <span m="1256760">big</span> <span m="1257030">idea</span> <span m="1257750">for</span> <span m="1258540">running</span> <span m="1258940">this</span> <span m="1259840">enforcing</span> <span m="1260380">safety</span> <span m="1260730">without</span> <span m="1261260">support</span> <span m="1261680">from</span> <span m="1261930">that</span> <span m="1262480">operating</span> <span m="1262830">system</span> <span m="1263270">at some</span> <span m="1263715">level.</span> </p>
<p><span m="1265050">And</span> <span m="1265320">I guess</span> <span m="1265370">for</span> <span m="1265770">other</span> <span m="1266010">unsafe</span> <span m="1266140">instructions,</span> <span m="1266880">they</span> <span m="1266980">don't</span> <span m="1267340">instrument</span> <span m="1267740">all of</span> <span m="1267960">them.</span> <span m="1268330">Some of</span> <span m="1268550">them they</span> <span m="1268790">actually</span> <span m="1269100">prohibit,</span> <span m="1269990">if</span> <span m="1270250">they</span> <span m="1270390">believe</span> <span m="1270760">that</span> <span m="1270880">this</span> <span m="1271090">is</span> <span m="1271820">an</span> <span m="1271930">instruction</span> <span m="1272260">that's not</span> <span m="1272590">really</span> <span m="1273000">necessary</span> <span m="1273680">during</span> <span m="1273930">normal</span> <span m="1274200">operation,</span> <span m="1274830">and</span> <span m="1275370">if</span> <span m="1275500">an</span> <span m="1275600">application</span> <span m="1276100">tried to</span> <span m="1276490">run it,</span> <span m="1276875">we</span> <span m="1277260">should</span> <span m="1277420">just</span> <span m="1277710">kill the</span> <span m="1278190">application</span> <span m="1278780">or</span> <span m="1278880">not</span> <span m="1279210">allow it</span> <span m="1279650">to</span> <span m="1279720">run in</span> <span m="1279970">the</span> <span m="1280050">first</span> <span m="1280310">place.</span> </p>
<p><span m="1282450">Makes sense?</span> <span m="1283150">Those are</span> <span m="1283560">their</span> <span m="1283970">sort of</span> <span m="1284120">big</span> <span m="1284350">plan</span> <span m="1284850">for</span> <span m="1285350">software</span> <span m="1285500">fault</span> <span m="1286010">isolation.</span> <span m="1286840">And</span> <span m="1287360">once</span> <span m="1287700">you've</span> <span m="1287960">checked</span> <span m="1288840">the</span> <span m="1289480">application's</span> <span m="1290040">binary,</span> <span m="1290480">and it</span> <span m="1290660">all</span> <span m="1290940">passes,</span> <span m="1291560">and</span> <span m="1291830">everything</span> <span m="1292250">seems to</span> <span m="1292410">be</span> <span m="1292650">properly</span> <span m="1293010">instrumented,</span> <span m="1293630">then</span> <span m="1294020">you</span> <span m="1294100">can</span> <span m="1294230">just</span> <span m="1294570">run</span> <span m="1294830">the</span> <span m="1294920">program</span> <span m="1295660">and</span> <span m="1296120">off it</span> <span m="1296410">goes.</span> <span m="1296690">And</span> <span m="1297510">by</span> <span m="1297660">definition</span> <span m="1298160">almost,</span> <span m="1298750">it will</span> <span m="1298800">not</span> <span m="1299115">do</span> <span m="1299430">bad</span> <span m="1299730">things,</span> <span m="1300240">if</span> <span m="1300490">we</span> <span m="1300950">do</span> <span m="1301070">all</span> <span m="1301170">these</span> <span m="1301380">checks and</span> <span m="1301880">instrumentation</span> <span m="1302360">[INAUDIBLE].</span> </p>
<p><span m="1304310">And</span> <span m="1304510">I guess</span> <span m="1304620">there's</span> <span m="1304840">one</span> <span m="1305060">more</span> <span m="1305560">part</span> <span m="1305820">to</span> <span m="1306310">the</span> <span m="1306460">software</span> <span m="1306810">fault</span> <span m="1307010">isolation</span> <span m="1307440">story,</span> <span m="1307710">which</span> <span m="1307860">is</span> <span m="1307990">that</span> <span m="1309090">once</span> <span m="1309480">you've</span> <span m="1310090">make</span> <span m="1310350">sure</span> <span m="1310550">that</span> <span m="1310660">everything</span> <span m="1311050">is</span> <span m="1311180">safe,</span> <span m="1311650">then it</span> <span m="1312140">can't</span> <span m="1312360">actually</span> <span m="1312630">do</span> <span m="1312770">anything</span> <span m="1313090">terribly</span> <span m="1313470">interesting,</span> <span m="1314040">other</span> <span m="1314355">than</span> <span m="1314670">compute</span> <span m="1315080">stuff</span> <span m="1315330">in</span> <span m="1315430">it's</span> <span m="1315570">own</span> <span m="1315630">little</span> <span m="1316030">memory.</span> <span m="1316813">So</span> <span m="1317166">it</span> <span m="1317520">can't access the</span> <span m="1317740">network, it can't</span> <span m="1318010">access</span> <span m="1318420">the</span> <span m="1318800">disk, it can't</span> <span m="1319030">access</span> <span m="1319300">your</span> <span m="1319420">browser,</span> <span m="1319930">display,</span> <span m="1320450">keyboard,</span> <span m="1321320">almost</span> <span m="1321640">anything.</span> </p>
<p><span m="1322580">So</span> <span m="1322630">pretty much</span> <span m="1322820">every</span> <span m="1323220">software fault</span> <span m="1323680">isolation</span> <span m="1324180">story,</span> <span m="1324770">there's</span> <span m="1324970">actually</span> <span m="1325270">also</span> <span m="1325710">some</span> <span m="1326270">trusted</span> <span m="1327030">service</span> <span m="1327430">runtime.</span> <span m="1332580">And</span> <span m="1333440">this</span> <span m="1333940">trusted</span> <span m="1334040">runtime</span> <span m="1334870">is</span> <span m="1335130">going</span> <span m="1335370">to</span> <span m="1335990">not</span> <span m="1336420">be</span> <span m="1336530">subject</span> <span m="1337080">to</span> <span m="1337160">these</span> <span m="1337700">checks</span> <span m="1338080">on</span> <span m="1338230">it's</span> <span m="1338340">instructions.</span> <span m="1339070">So</span> <span m="1339110">the</span> <span m="1339210">trusted</span> <span m="1339510">runtime</span> <span m="1339770">could</span> <span m="1340140">actually</span> <span m="1340410">do</span> <span m="1340550">all</span> <span m="1340690">these</span> <span m="1340820">potentially</span> <span m="1341120">unsafe</span> <span m="1341530">things.</span> <span m="1341990">But</span> <span m="1342270">this</span> <span m="1342330">trusted</span> <span m="1342420">runtime</span> <span m="1342660">is</span> <span m="1343045">written</span> <span m="1343430">by</span> <span m="1343530">Google.</span> <span m="1343980">So</span> <span m="1344170">hopefully</span> <span m="1344550">they</span> <span m="1344670">get a</span> <span m="1344970">[INAUDIBLE].</span> <span m="1345940">And</span> <span m="1346070">it's going to</span> <span m="1346400">implement</span> <span m="1346980">all</span> <span m="1347260">the</span> <span m="1347370">functions</span> <span m="1347990">that</span> <span m="1349140">Google's</span> <span m="1349650">Native</span> <span m="1349900">Client</span> <span m="1350320">team</span> <span m="1350890">believes</span> <span m="1351530">are</span> <span m="1351910">OK</span> <span m="1352140">throughout</span> <span m="1352740">for</span> <span m="1352860">these</span> <span m="1353040">modules.</span> </p>
<p><span m="1353690">So these</span> <span m="1354040">are</span> <span m="1354170">going</span> <span m="1354280">to</span> <span m="1354330">be</span> <span m="1354470">things</span> <span m="1354820">like</span> <span m="1355655">maybe</span> <span m="1356180">allocated</span> <span m="1356420">memory,</span> <span m="1357850">maybe</span> <span m="1358110">creating</span> <span m="1358390">a</span> <span m="1358670">thread,</span> <span m="1361620">maybe</span> <span m="1362020">communicating</span> <span m="1362850">with</span> <span m="1363050">the</span> <span m="1363120">browser</span> <span m="1363670">as</span> <span m="1363790">we</span> <span m="1363910">saw--</span> <span m="1364060">so some</span> <span m="1364530">sort</span> <span m="1364750">of</span> <span m="1364830">a</span> <span m="1364960">message</span> <span m="1365260">passing</span> <span m="1366240">system,</span> <span m="1368596">et</span> <span m="1369030">cetera.</span> <span m="1369900">And</span> <span m="1370410">the</span> <span m="1370500">way</span> <span m="1370650">it's</span> <span m="1370780">going</span> <span m="1370900">to</span> <span m="1370970">be</span> <span m="1371120">exposed</span> <span m="1371930">to</span> <span m="1372010">this</span> <span m="1372870">isolated</span> <span m="1373520">module</span> <span m="1374310">is</span> <span m="1374650">through</span> <span m="1375370">certain</span> <span m="1376940">presumably</span> <span m="1378560">special</span> <span m="1379190">jumps</span> <span m="1379640">or</span> <span m="1380040">operations</span> <span m="1380730">that</span> <span m="1380860">the</span> <span m="1382310">module</span> <span m="1382840">is</span> <span m="1383115">going to</span> <span m="1383390">perform</span> <span m="1383860">to</span> <span m="1384390">transition</span> <span m="1384980">control</span> <span m="1385530">into</span> <span m="1385800">this</span> <span m="1386060">trusted</span> <span m="1386370">runtime,</span> <span m="1387180">but</span> <span m="1387290">hopefully</span> <span m="1388100">in</span> <span m="1388440">a</span> <span m="1388490">very</span> <span m="1388880">predictable</span> <span m="1389390">way</span> <span m="1390120">to--</span> <span m="1390730">question?</span> </p>
<p><span m="1391440">AUDIENCE: I'm just curious</span> <span m="1391823">about,</span> <span m="1392590">you have to</span> <span m="1393030">design</span> <span m="1393620">this application,</span> <span m="1395840">knowing that it's</span> <span m="1396284">going to be</span> <span m="1396730">sent to</span> <span m="1397120">the</span> <span m="1397602">NaCl</span> <span m="1398084">module?</span> <span m="1398566">Or does it</span> <span m="1399048">like</span> <span m="1399530">change the</span> <span m="1400012">code to</span> <span m="1400976">[INAUDIBLE]</span> <span m="1401458">making the</span> <span m="1401940">[INAUDIBLE]</span> <span m="1402422">sort of stuff bad?</span> </p>
<p><span m="1403386">PROFESSOR: So</span> <span m="1403880">I</span> <span m="1404030">think</span> <span m="1405960">if</span> <span m="1406230">you are</span> <span m="1406360">building an</span> <span m="1406720">application,</span> <span m="1407540">you</span> <span m="1408010">do</span> <span m="1408210">have</span> <span m="1408390">to</span> <span m="1408480">be</span> <span m="1408600">sort</span> <span m="1408780">of</span> <span m="1408880">aware</span> <span m="1409300">that</span> <span m="1409430">it's</span> <span m="1409550">going</span> <span m="1409670">to</span> <span m="1409720">be</span> <span m="1409850">running</span> <span m="1410260">inside</span> <span m="1410700">of</span> <span m="1410820">Native</span> <span m="1411160">Client.</span> <span m="1412580">So</span> <span m="1412720">some</span> <span m="1413190">function</span> <span m="1413710">calls</span> <span m="1414020">like</span> <span m="1414230">malloc</span> <span m="1414970">or</span> <span m="1415300">pthread_create,</span> <span m="1416610">I</span> <span m="1416700">think</span> <span m="1416890">they</span> <span m="1417000">just</span> <span m="1417250">transparently</span> <span m="1417900">are</span> <span m="1418225">placed</span> <span m="1418550">with</span> <span m="1418730">calls</span> <span m="1419005">to</span> <span m="1419280">their</span> <span m="1419550">trusted</span> <span m="1419660">runtime.</span> <span m="1420670">But</span> <span m="1420770">if</span> <span m="1420860">you</span> <span m="1420960">do</span> <span m="1421080">anything</span> <span m="1421520">like</span> <span m="1421830">opening</span> <span m="1422280">a</span> <span m="1422460">file</span> <span m="1422760">by</span> <span m="1423090">path</span> <span m="1423340">name,</span> <span m="1424140">or</span> <span m="1424640">anything</span> <span m="1424930">else</span> <span m="1425180">that</span> <span m="1425410">sort</span> <span m="1425550">of</span> <span m="1425710">you would</span> <span m="1425950">expect to do</span> <span m="1426370">on</span> <span m="1426510">a</span> <span m="1426560">Unix</span> <span m="1426900">machine,</span> <span m="1427790">that</span> <span m="1428090">you would</span> <span m="1428340">probably</span> <span m="1428580">have to</span> <span m="1428720">replace</span> <span m="1429120">with</span> <span m="1429220">something</span> <span m="1429690">else.</span> </p>
<p><span m="1430640">And</span> <span m="1430870">you'd</span> <span m="1431000">probably</span> <span m="1431260">want</span> <span m="1431450">to</span> <span m="1431930">structure</span> <span m="1432325">your</span> <span m="1432720">thing to</span> <span m="1432880">interact</span> <span m="1433510">at least</span> <span m="1433640">a</span> <span m="1433690">little</span> <span m="1433870">bit</span> <span m="1434010">with</span> <span m="1434130">your</span> <span m="1434300">JavaScript or</span> <span m="1434800">web</span> <span m="1435090">page</span> <span m="1435380">in</span> <span m="1435490">some</span> <span m="1435710">way.</span> <span m="1436150">And</span> <span m="1436550">that you would</span> <span m="1436950">have to</span> <span m="1437350">do</span> <span m="1437640">by</span> <span m="1437930">explicitly</span> <span m="1438470">doing</span> <span m="1438680">some</span> <span m="1438850">message</span> <span m="1439160">passing</span> <span m="1439510">or</span> <span m="1439770">RPCs</span> <span m="1440810">into</span> <span m="1441100">the</span> <span m="1441220">JavaScript</span> <span m="1441760">part.</span> <span m="1442420">So</span> <span m="1442540">that</span> <span m="1442820">you would</span> <span m="1442920">have</span> <span m="1443140">to</span> <span m="1443320">probably</span> <span m="1443670">change.</span> </p>
<p><span m="1444890">So there are</span> <span m="1445070">some--</span> <span m="1445820">it's</span> <span m="1446460">not</span> <span m="1446770">like</span> <span m="1447040">you</span> <span m="1447610">can</span> <span m="1447810">run</span> <span m="1448040">an</span> <span m="1448150">arbitrary</span> <span m="1448620">Unix</span> <span m="1449000">program</span> <span m="1449410">in</span> <span m="1449550">there,</span> <span m="1449900">and</span> <span m="1450540">you'll</span> <span m="1450720">just</span> <span m="1450880">sort</span> <span m="1451180">of</span> <span m="1451290">get a shell</span> <span m="1451660">and you can</span> <span m="1451860">run</span> <span m="1452050">commands</span> <span m="1452480">all</span> <span m="1452590">of</span> <span m="1452670">a</span> <span m="1452730">sudden.</span> <span m="1454010">Probably</span> <span m="1454390">if you tried</span> <span m="1454570">hard,</span> <span m="1454880">maybe</span> <span m="1455070">you</span> <span m="1455140">could</span> <span m="1455780">create such</span> <span m="1456150">an</span> <span m="1456300">environment.</span> <span m="1457170">But</span> <span m="1457430">by</span> <span m="1457670">default,</span> <span m="1458170">you</span> <span m="1458370">probably</span> <span m="1458830">have</span> <span m="1459110">to</span> <span m="1460390">make it</span> <span m="1460800">operate</span> <span m="1461370">inside</span> <span m="1461790">of</span> <span m="1461870">this</span> <span m="1462170">web page,</span> <span m="1462530">and then</span> <span m="1462890">[INAUDIBLE].</span> <span m="1463386">Does that</span> <span m="1463882">make sense?</span> <span m="1465866">All right.</span> <span m="1468346">OK.</span> </p>
<p><span m="1469350">So</span> <span m="1469890">that's</span> <span m="1470270">the</span> <span m="1470620">overall</span> <span m="1471100">plan</span> <span m="1471650">software</span> <span m="1471740">fault</span> <span m="1472240">isolation.</span> <span m="1473250">So I guess</span> <span m="1473460">let's</span> <span m="1473680">look</span> <span m="1473860">at</span> <span m="1473950">actually</span> <span m="1474260">what</span> <span m="1474940">safety</span> <span m="1475490">means</span> <span m="1476340">in</span> <span m="1476500">their</span> <span m="1476680">case</span> <span m="1477550">for</span> <span m="1477790">Native</span> <span m="1478060">Client.</span> <span m="1478440">So we</span> <span m="1479050">talked</span> <span m="1479480">loosely</span> <span m="1479850">about</span> <span m="1480130">this</span> <span m="1480290">notion</span> <span m="1480710">of safe</span> <span m="1481190">instructions,</span> <span m="1481550">unsafe</span> <span m="1482240">instructions--</span> <span m="1483130">what do</span> <span m="1483290">they</span> <span m="1483360">actually</span> <span m="1483680">care</span> <span m="1483870">about</span> <span m="1484150">here?</span> </p>
<p><span m="1485070">So</span> <span m="1485560">as</span> <span m="1485660">far</span> <span m="1485790">as</span> <span m="1485860">I</span> <span m="1485930">can</span> <span m="1486140">tell</span> <span m="1486510">for</span> <span m="1486680">Native</span> <span m="1486970">Client,</span> <span m="1487700">safety</span> <span m="1489160">basically</span> <span m="1489610">means</span> <span m="1490620">two</span> <span m="1490830">things.</span> <span m="1491440">One</span> <span m="1491710">is</span> <span m="1491890">that</span> <span m="1492620">there's</span> <span m="1493020">no</span> <span m="1493910">disallowed</span> <span m="1494450">instructions</span> <span m="1497040">that it</span> <span m="1497380">can</span> <span m="1497715">execute.</span> <span m="1500750">And</span> <span m="1501610">these disallowed</span> <span m="1502030">instructions</span> <span m="1502610">are</span> <span m="1502720">things</span> <span m="1503020">like</span> <span m="1503850">maybe</span> <span m="1504030">system</span> <span m="1504400">calls</span> <span m="1505710">or</span> <span m="1507320">triggering</span> <span m="1507430">an</span> <span m="1507710">interop,</span> <span m="1508150">which</span> <span m="1508300">is</span> <span m="1508370">another</span> <span m="1508640">mechanism</span> <span m="1509060">on</span> <span m="1509130">x86</span> <span m="1509730">to</span> <span m="1510020">jump</span> <span m="1510280">into</span> <span m="1510450">the</span> <span m="1510570">kernel</span> <span m="1510960">and</span> <span m="1511180">invoke</span> <span m="1511530">a</span> <span m="1511570">system</span> <span m="1511790">call,</span> <span m="1512310">and</span> <span m="1512730">probably</span> <span m="1513330">other</span> <span m="1513650">privileged</span> <span m="1514230">instructions</span> <span m="1514900">that</span> <span m="1515520">would</span> <span m="1515610">allow</span> <span m="1515830">you</span> <span m="1515970">to</span> <span m="1516030">escape</span> <span m="1516430">out</span> <span m="1516650">of</span> <span m="1516750">the sandbox.</span> </p>
<p><span m="1517520">We'll</span> <span m="1517650">look a little</span> <span m="1517930">bit</span> <span m="1518050">more</span> <span m="1518350">later</span> <span m="1518970">at</span> <span m="1519270">what</span> <span m="1519570">instructions</span> <span m="1520080">could</span> <span m="1520240">actually let you</span> <span m="1520620">jump</span> <span m="1520970">out of a</span> <span m="1521210">sandbox.</span> <span m="1523420">And</span> <span m="1523910">in</span> <span m="1524020">addition</span> <span m="1524350">to</span> <span m="1524440">this</span> <span m="1524670">no disallowed</span> <span m="1525210">instructions</span> <span m="1525770">rule,</span> <span m="1526320">they</span> <span m="1526450">also</span> <span m="1528030">want</span> <span m="1528170">to</span> <span m="1528210">make</span> <span m="1528390">sure</span> <span m="1528650">that</span> <span m="1529400">all</span> <span m="1530290">code and</span> <span m="1530730">data</span> <span m="1530990">accesses</span> <span m="1532950">are</span> <span m="1533900">in bounds</span> <span m="1535840">for</span> <span m="1536100">the</span> <span m="1536190">module.</span> </p>
<p><span m="1539670">So what</span> <span m="1540170">this</span> <span m="1540380">means,</span> <span m="1540640">is</span> <span m="1540760">that</span> <span m="1540900">they</span> <span m="1540990">actually</span> <span m="1541310">dedicate</span> <span m="1542140">a</span> <span m="1542420">particular</span> <span m="1542810">part</span> <span m="1543210">of</span> <span m="1543310">the</span> <span m="1543400">program's</span> <span m="1543800">address</span> <span m="1544230">space--</span> <span m="1544960">specifically</span> <span m="1545440">it</span> <span m="1545920">goes</span> <span m="1546150">from zero</span> <span m="1546290">up</span> <span m="1547150">to</span> <span m="1547990">256</span> <span m="1548820">megs</span> <span m="1549730">in</span> <span m="1549900">the</span> <span m="1550000">process.</span> <span m="1551250">And</span> <span m="1552050">everything</span> <span m="1552470">that</span> <span m="1552770">this</span> <span m="1553070">untrusted</span> <span m="1553650">module</span> <span m="1554010">does</span> <span m="1554570">has</span> <span m="1554800">to refer</span> <span m="1555060">to</span> <span m="1555320">locations</span> <span m="1555880">within</span> <span m="1556210">this</span> <span m="1556420">chunk</span> <span m="1556650">of</span> <span m="1556770">memory</span> <span m="1557950">in</span> <span m="1558080">the</span> <span m="1558180">program.</span> </p>
<p><span m="1560890">All</span> <span m="1560960">right,</span> <span m="1561180">so</span> <span m="1561670">just to</span> <span m="1561820">double</span> <span m="1562090">check.</span> <span m="1562270">So</span> <span m="1562370">why</span> <span m="1562620">do</span> <span m="1562700">they</span> <span m="1562810">want</span> <span m="1563340">to</span> <span m="1563600">disallow</span> <span m="1564070">these</span> <span m="1564230">instructions?</span> <span m="1565910">So what if</span> <span m="1566140">they</span> <span m="1566420">fail to</span> <span m="1566880">disallow  the</span> <span m="1567090">instructions?</span> <span m="1569808">Yeah?</span> </p>
<p><span m="1570285">AUDIENCE: The module can</span> <span m="1570762">manipulate</span> <span m="1571239">the system.</span> </p>
<p><span m="1572670">PROFESSOR: Right,</span> <span m="1572950">so</span> <span m="1573040">that's</span> <span m="1573740">fairly</span> <span m="1574200">straightforward,</span> <span m="1574700">exactly, yeah.</span> <span m="1575030">So it can</span> <span m="1575280">just</span> <span m="1575980">directly</span> <span m="1576320">reboot</span> <span m="1576640">the</span> <span m="1576700">machine</span> <span m="1577040">or</span> <span m="1577330">open</span> <span m="1577430">your</span> <span m="1577700">home</span> <span m="1577900">directory and</span> <span m="1578280">enumerate</span> <span m="1578730">all</span> <span m="1578840">the</span> <span m="1578920">files,</span> <span m="1579625">and</span> <span m="1579890">do</span> <span m="1580280">all</span> <span m="1580360">these</span> <span m="1580530">things.</span> <span m="1580740">So</span> <span m="1580950">that</span> <span m="1581120">seems</span> <span m="1581290">like</span> <span m="1581600">a good thing to</span> <span m="1581680">do.</span> <span m="1582720">Why</span> <span m="1582830">do</span> <span m="1582910">they</span> <span m="1583020">care</span> <span m="1583250">about</span> <span m="1584120">this</span> <span m="1584360">plan,</span> <span m="1585190">like</span> <span m="1585670">isolating</span> <span m="1586140">the</span> <span m="1586250">coded</span> <span m="1586600">data</span> <span m="1586975">to</span> <span m="1587620">only</span> <span m="1587740">access</span> <span m="1588140">these</span> <span m="1588360">low</span> <span m="1588650">addresses?</span> <span m="1590200">What</span> <span m="1590350">goes</span> <span m="1590480">wrong if</span> <span m="1590680">they</span> <span m="1590960">fail</span> <span m="1591220">to</span> <span m="1591320">do</span> <span m="1591400">that?</span> <span m="1596280">Yeah?</span> </p>
<p><span m="1597120">AUDIENCE: Then they</span> <span m="1597540">can sort of</span> <span m="1598025">accessing</span> <span m="1598510">and</span> <span m="1598943">interrupting</span> <span m="1599376">[INAUDIBLE]</span> <span m="1600242">module</span> <span m="1600675">on the</span> <span m="1601110">computer.</span> </p>
<p><span m="1602480">PROFESSOR: Yeah.</span> </p>
<p><span m="1602670">AUDIENCE: We don't</span> <span m="1603145">care if</span> <span m="1603620">they</span> <span m="1604030">ruin</span> <span m="1604530">their own</span> <span m="1605030">program and</span> <span m="1605520">it crashes.</span> <span m="1606010">That's fine,</span> <span m="1606356">as long as</span> <span m="1606702">it's not going to</span> <span m="1607050">crash</span> <span m="1607425">the</span> <span m="1607800">key</span> <span m="1608080">to</span> <span m="1608360">[INAUDIBLE].</span> </p>
<p><span m="1609900">PROFESSOR: Yeah,</span> <span m="1610400">so</span> <span m="1610620">in</span> <span m="1610800">some</span> <span m="1610960">sense,</span> <span m="1611670">that's</span> <span m="1611920">true.</span> <span m="1612100">But</span> <span m="1612440">in</span> <span m="1612700">their</span> <span m="1612850">case, they</span> <span m="1613050">actually</span> <span m="1613360">run</span> <span m="1613660">the</span> <span m="1613910">thing</span> <span m="1614080">in</span> <span m="1614200">a</span> <span m="1614270">separate</span> <span m="1614670">process.</span> <span m="1615250">So</span> <span m="1615770">in</span> <span m="1616130">theory,</span> <span m="1616470">this</span> <span m="1616630">would</span> <span m="1616730">only</span> <span m="1616980">crash</span> <span m="1617370">that</span> <span m="1617650">extra</span> <span m="1617950">process.</span> <span m="1619430">I</span> <span m="1619550">think</span> <span m="1619710">that</span> <span m="1619910">I</span> <span m="1619970">guess</span> <span m="1620140">what</span> <span m="1620410">they're</span> <span m="1620570">really</span> <span m="1620860">worried</span> <span m="1621090">about</span> <span m="1621330">is</span> <span m="1621450">that</span> <span m="1621930">this</span> <span m="1622270">is</span> <span m="1623140">a</span> <span m="1623180">necessary</span> <span m="1623760">condition</span> <span m="1624290">to</span> <span m="1624380">ensure</span> <span m="1624910">this</span> <span m="1625180">no</span> <span m="1625370">disallowed</span> <span m="1625810">instructions</span> <span m="1626420">in</span> <span m="1626540">some</span> <span m="1626720">way,</span> <span m="1627260">because</span> <span m="1628070">there's</span> <span m="1628320">other</span> <span m="1628610">stuff,</span> <span m="1628910">like</span> <span m="1629050">this</span> <span m="1629240">trusted</span> <span m="1629540">runtime</span> <span m="1630080">in</span> <span m="1630270">your</span> <span m="1630510">process.</span> <span m="1631470">So</span> <span m="1632200">if what</span> <span m="1632490">you</span> <span m="1632570">really</span> <span m="1632810">care</span> <span m="1633000">about</span> <span m="1633160">is</span> <span m="1633260">not</span> <span m="1633440">corrupting</span> <span m="1633820">the</span> <span m="1633900">rest</span> <span m="1634060">of</span> <span m="1634130">your</span> <span m="1634270">computer,</span> <span m="1635030">then</span> <span m="1635510">if</span> <span m="1636030">the</span> <span m="1636570">untrusted</span> <span m="1636990">module can</span> <span m="1637450">arbitrarily</span> <span m="1638150">jump</span> <span m="1638430">into</span> <span m="1638590">the trusted</span> <span m="1639270">service</span> <span m="1639600">runtime</span> <span m="1640100">and</span> <span m="1640530">do</span> <span m="1640830">anything</span> <span m="1641190">that</span> <span m="1641250">the</span> <span m="1641410">trusted service</span> <span m="1641800">runtime</span> <span m="1642190">can do,</span> <span m="1642460">then</span> <span m="1642610">they</span> <span m="1642720">could</span> <span m="1643070">sort of</span> <span m="1643560">violate</span> <span m="1644120">this</span> <span m="1644360">property.</span> <span m="1644645">So</span> <span m="1644930">in</span> <span m="1645080">some</span> <span m="1645260">ways,</span> <span m="1645440">this</span> <span m="1645560">is</span> <span m="1645720">really</span> <span m="1645940">like</span> <span m="1646100">a</span> <span m="1646170">supporting</span> <span m="1646600">mechanism</span> <span m="1647040">for</span> <span m="1647460">enforcing</span> <span m="1647840">that.</span> </p>
<p><span m="1650000">In</span> <span m="1650290">principle,</span> <span m="1650870">this</span> <span m="1650950">could</span> <span m="1651050">also</span> <span m="1651940">be</span> <span m="1652080">used</span> <span m="1652330">for</span> <span m="1652970">lighter</span> <span m="1653320">weight</span> <span m="1653670">isolation</span> <span m="1654390">if</span> <span m="1654480">you</span> <span m="1654620">could</span> <span m="1655690">run</span> <span m="1656090">this</span> <span m="1656300">Native</span> <span m="1656550">Client</span> <span m="1656850">module</span> <span m="1657200">inside</span> <span m="1657800">of</span> <span m="1657910">the</span> <span m="1658000">browser</span> <span m="1658390">process</span> <span m="1658670">itself,</span> <span m="1659040">and</span> <span m="1659160">not start</span> <span m="1659480">an</span> <span m="1659580">extra</span> <span m="1659840">process.</span> <span m="1660945">But it</span> <span m="1661300">turns out</span> <span m="1661700">for</span> <span m="1661790">performance</span> <span m="1662240">reasons,</span> <span m="1662520">they</span> <span m="1662630">really</span> <span m="1662840">have</span> <span m="1663020">to</span> <span m="1663160">tie</span> <span m="1663450">down the</span> <span m="1663720">module</span> <span m="1664150">to</span> <span m="1664690">this</span> <span m="1665020">particular</span> <span m="1665780">range</span> <span m="1666040">of</span> <span m="1666120">memory,</span> <span m="1666360">or it has</span> <span m="1666710">to</span> <span m="1666810">start</span> <span m="1667050">at</span> <span m="1667150">zero</span> <span m="1667420">anyway.</span> <span m="1668330">So this</span> <span m="1668790">means that</span> <span m="1669190">you</span> <span m="1669310">can</span> <span m="1669390">only</span> <span m="1669590">have</span> <span m="1669810">one</span> <span m="1670140">really</span> <span m="1670450">Native</span> <span m="1670740">Client</span> <span m="1671000">untrusted</span> <span m="1671420">module</span> <span m="1671830">per</span> <span m="1672010">process.</span> <span m="1673020">So</span> <span m="1673180">you</span> <span m="1673290">probably</span> <span m="1673610">are</span> <span m="1673750">going</span> <span m="1673870">to</span> <span m="1673920">start</span> <span m="1674220">a</span> <span m="1674280">separate</span> <span m="1674640">process</span> <span m="1675020">anyway.</span> <span m="1676956">Makes sense?</span> <span m="1678408">Any questions?</span> <span m="1679376">Yeah?</span> </p>
<p><span m="1680828">AUDIENCE: Is there</span> <span m="1681312">actually</span> <span m="1681796">a reason</span> <span m="1682280">why it has to</span> <span m="1682764">start at</span> <span m="1683248">zero?</span> </p>
<p><span m="1684230">PROFESSOR: Yeah, so it</span> <span m="1684710">turns</span> <span m="1684950">out</span> <span m="1685170">it's</span> <span m="1685350">more</span> <span m="1686550">efficient</span> <span m="1687280">in</span> <span m="1687400">terms</span> <span m="1687620">of</span> <span m="1687810">performance</span> <span m="1689040">to</span> <span m="1689440">enforce</span> <span m="1690280">jump</span> <span m="1690650">targets,</span> <span m="1691480">if</span> <span m="1691670">you</span> <span m="1691790">know</span> <span m="1692100">that</span> <span m="1692450">the</span> <span m="1692480">legitimate</span> <span m="1693010">address</span> <span m="1693740">is</span> <span m="1694480">a</span> <span m="1694840">contiguous</span> <span m="1695410">set of</span> <span m="1695660">addresses</span> <span m="1695800">starting</span> <span m="1696290">at</span> <span m="1696410">zero,</span> <span m="1696640">because</span> <span m="1696860">you</span> <span m="1696920">can</span> <span m="1697260">then do it</span> <span m="1697400">with a</span> <span m="1697610">single</span> <span m="1698010">AND</span> <span m="1698420">mask,</span> <span m="1699050">where</span> <span m="1699270">all</span> <span m="1699520">the</span> <span m="1699590">high</span> <span m="1699830">bits</span> <span m="1700250">are</span> <span m="1700420">one,</span> <span m="1701080">and</span> <span m="1701190">only</span> <span m="1701470">a</span> <span m="1701550">couple</span> <span m="1701900">of low</span> <span m="1702080">bits</span> <span m="1702360">are</span> <span m="1703120">zero--</span> <span m="1703630">well,</span> <span m="1707140">if</span> <span m="1707270">you're</span> <span m="1707390">willing--</span> <span m="1707790">well--</span> </p>
<p><span m="1709629">AUDIENCE: I thought the</span> <span m="1710082">AND mask</span> <span m="1710535">was to</span> <span m="1710990">ensure</span> <span m="1711270">[INAUDIBLE].</span> </p>
<p><span m="1712000">PROFESSOR: Right,</span> <span m="1712310">so the AND mask</span> <span m="1712800">ensures</span> <span m="1713380">alignment,</span> <span m="1714030">you're</span> <span m="1714100">right.</span> <span m="1715240">So</span> <span m="1715830">why do</span> <span m="1716040">they</span> <span m="1716280">start at</span> <span m="1716620">zero?</span> <span m="1718443">I</span> <span m="1718874">think</span> <span m="1719740">it</span> <span m="1719930">probably</span> <span m="1720200">helps</span> <span m="1720520">them</span> <span m="1720840">to--</span> <span m="1721390">well,</span> <span m="1723210">I guess</span> <span m="1723340">they</span> <span m="1723580">rely</span> <span m="1724000">on</span> <span m="1724180">the</span> <span m="1724260">segmentation</span> <span m="1724810">hardware.</span> <span m="1725960">So</span> <span m="1726080">in</span> <span m="1726190">principle,</span> <span m="1726630">maybe they</span> <span m="1726900">could</span> <span m="1727090">use</span> <span m="1727180">the</span> <span m="1727320">segmentation</span> <span m="1727790">hardware</span> <span m="1728120">to</span> <span m="1728450">shift the</span> <span m="1728570">region</span> <span m="1728960">up,</span> <span m="1729390">in terms</span> <span m="1729665">of</span> <span m="1729940">linear</span> <span m="1730060">space.</span> <span m="1730410">Or maybe</span> <span m="1730660">it's</span> <span m="1730810">just</span> <span m="1730970">with the</span> <span m="1731130">application,</span> <span m="1731970">sort</span> <span m="1732380">of sees</span> <span m="1732780">this</span> <span m="1732980">range.</span> <span m="1733480">And you</span> <span m="1733590">can actually</span> <span m="1733820">place</span> <span m="1734130">it</span> <span m="1734250">at</span> <span m="1734330">different</span> <span m="1734490">offsets</span> <span m="1734810">in your</span> <span m="1734910">virtual</span> <span m="1735680">address</span> <span m="1735910">space.</span> <span m="1736260">It</span> <span m="1736430">could be--</span> <span m="1738100">yeah,</span> <span m="1738530">so maybe  you</span> <span m="1738960">could</span> <span m="1739370">actually</span> <span m="1739800">play</span> <span m="1739980">tricks</span> <span m="1740295">with the</span> <span m="1740610">segmentation</span> <span m="1740650">hardware</span> <span m="1741010">to</span> <span m="1741460">run</span> <span m="1741680">multiple</span> <span m="1742000">models</span> <span m="1742380">in</span> <span m="1742790">a</span> <span m="1743000">single</span> <span m="1743210">address</span> <span m="1743525">space.</span> </p>
<p><span m="1744215">AUDIENCE: But is it</span> <span m="1744590">because</span> <span m="1744840">they want</span> <span m="1745180">to catch a</span> <span m="1745616">null pointer</span> <span m="1746052">reception?</span> </p>
<p><span m="1747800">PROFESSOR: Yeah, so</span> <span m="1747960">they want</span> <span m="1748130">to</span> <span m="1748240">catch</span> <span m="1748470">all</span> <span m="1748610">points of</span> <span m="1748980">reception.</span> <span m="1749140">But you</span> <span m="1749480">could</span> <span m="1749740">sort of</span> <span m="1750160">do that.</span> <span m="1750570">Because the null</span> <span m="1750890">pointer--</span> <span m="1751250">I guess</span> <span m="1751610">we'll</span> <span m="1751850">talk</span> <span m="1752150">about</span> <span m="1752350">segmentation</span> <span m="1752790">in a</span> <span m="1752880">second,</span> <span m="1753210">but</span> <span m="1753390">the</span> <span m="1753860">null</span> <span m="1754070">pointer</span> <span m="1754370">actually</span> <span m="1755130">is</span> <span m="1756270">relative</span> <span m="1756840">to</span> <span m="1756920">the</span> <span m="1757020">segment in</span> <span m="1757500">which</span> <span m="1757680">you are</span> <span m="1757800">accessing.</span> <span m="1758670">So</span> <span m="1758930">if</span> <span m="1759100">you</span> <span m="1759190">shift</span> <span m="1759440">the</span> <span m="1759520">segment</span> <span m="1759830">around,</span> <span m="1760120">then</span> <span m="1760290">you can</span> <span m="1760600">map</span> <span m="1761010">an</span> <span m="1761380">unused</span> <span m="1762000">zero</span> <span m="1762430">page at the</span> <span m="1762863">beginning of</span> <span m="1763296">everyone's</span> <span m="1763729">segment.</span> <span m="1765030">So yeah,</span> <span m="1765540">it</span> <span m="1765840">might</span> <span m="1766010">be</span> <span m="1766110">that</span> <span m="1766615">you</span> <span m="1766870">could do</span> <span m="1767280">multiple</span> <span m="1767520">modules.</span> </p>
<p><span m="1770090">I</span> <span m="1770160">think</span> <span m="1770330">for--</span> <span m="1770900">well,</span> <span m="1771890">because</span> <span m="1772930">one</span> <span m="1773320">reason</span> <span m="1773570">they</span> <span m="1773740">probably</span> <span m="1773930">want to do</span> <span m="1774260">this</span> <span m="1774490">is</span> <span m="1774640">that</span> <span m="1775310">when</span> <span m="1775550">they</span> <span m="1775810">port their</span> <span m="1776240">stuff to</span> <span m="1776670">64</span> <span m="1777220">bits,</span> <span m="1777720">they</span> <span m="1777880">have</span> <span m="1778110">a</span> <span m="1778200">slightly</span> <span m="1778490">different</span> <span m="1778820">design.</span> <span m="1779300">This paper</span> <span m="1779650">doesn't really</span> <span m="1779830">talk</span> <span m="1780010">about</span> <span m="1780320">it.</span> <span m="1780630">And</span> <span m="1780750">I</span> <span m="1780810">think</span> <span m="1781010">about</span> <span m="1781210">64-bit</span> <span m="1781790">design,</span> <span m="1782670">the</span> <span m="1783230">hardware</span> <span m="1783610">itself</span> <span m="1784360">got</span> <span m="1784660">rid</span> <span m="1784880">of</span> <span m="1785030">some</span> <span m="1785180">of</span> <span m="1785260">the</span> <span m="1785330">segmentation</span> <span m="1785900">hardware</span> <span m="1786230">they were</span> <span m="1786360">relying</span> <span m="1786930">on</span> <span m="1787460">for</span> <span m="1787660">efficiency</span> <span m="1788110">reasons,</span> <span m="1789110">and</span> <span m="1789720">they</span> <span m="1789840">have</span> <span m="1790060">to</span> <span m="1790160">do</span> <span m="1790340">a</span> <span m="1790420">much more</span> <span m="1790570">software</span> <span m="1790910">oriented</span> <span m="1791480">approach,</span> <span m="1791890">in</span> <span m="1791930">which</span> <span m="1792130">case</span> <span m="1792710">having</span> <span m="1793010">a</span> <span m="1793060">little</span> <span m="1793290">bit</span> <span m="1793550">doesn't</span> <span m="1793860">help</span> <span m="1794120">them.</span> <span m="1794880">But</span> <span m="1795100">in</span> <span m="1795220">this</span> <span m="1795360">32-bit</span> <span m="1795690">version, I</span> <span m="1796230">think,</span> <span m="1796630">yeah,</span> <span m="1796840">maybe</span> <span m="1797230">that's true.</span> <span m="1797580">That's</span> <span m="1797890">not</span> <span m="1798290">a deep</span> <span m="1798690">reason</span> <span m="1798950">why</span> <span m="1799180">it has</span> <span m="1799644">to start at</span> <span m="1800108">zero.</span> <span m="1802430">Other</span> <span m="1802590">questions?</span> <span m="1805500">All</span> <span m="1805560">right.</span> </p>
<p><span m="1806550">So</span> <span m="1807710">I guess we</span> <span m="1808040">sort of</span> <span m="1808250">roughly</span> <span m="1808720">understand</span> <span m="1808980">what</span> <span m="1809800">the</span> <span m="1809900">plan</span> <span m="1810190">is,</span> <span m="1810590">or</span> <span m="1810800">what</span> <span m="1810990">we</span> <span m="1811080">want</span> <span m="1811250">to</span> <span m="1811330">enforce</span> <span m="1811730">in</span> <span m="1811810">terms</span> <span m="1811990">of</span> <span m="1812120">safety.</span> <span m="1812465">So</span> <span m="1812810">how do</span> <span m="1813060">we do</span> <span m="1813250">this?</span> <span m="1814690">So</span> <span m="1814860">let's</span> <span m="1815050">look</span> <span m="1815180">at</span> <span m="1815330">some</span> <span m="1816030">of</span> <span m="1816080">at least</span> <span m="1816260">naive</span> <span m="1816510">approach,</span> <span m="1816920">and</span> <span m="1817060">see</span> <span m="1818465">how could</span> <span m="1818760">we</span> <span m="1818970">screw it</span> <span m="1819420">up, I</span> <span m="1819660">guess,</span> <span m="1819930">and then</span> <span m="1820100">we'll</span> <span m="1820250">try</span> <span m="1820400">to</span> <span m="1820500">fix</span> <span m="1820740">it</span> <span m="1821200">afterwards.</span> </p>
<p><span m="1822580">So</span> <span m="1823840">I</span> <span m="1823930">guess</span> <span m="1824090">the naive</span> <span m="1824500">plan</span> <span m="1824860">that</span> <span m="1825536">sort of</span> <span m="1826330">looks</span> <span m="1826610">like</span> <span m="1826780">what</span> <span m="1826910">they</span> <span m="1827020">do,</span> <span m="1827760">is</span> <span m="1828400">to</span> <span m="1828770">just</span> <span m="1829130">look</span> <span m="1829900">for</span> <span m="1830880">disallowed</span> <span m="1831160">instructions</span> <span m="1831780">by</span> <span m="1831880">just</span> <span m="1832195">scanning</span> <span m="1832510">the</span> <span m="1832600">executable</span> <span m="1833450">from</span> <span m="1833780">the</span> <span m="1833900">start</span> <span m="1834360">going</span> <span m="1834560">forward.</span> <span m="1837612">So how</span> <span m="1838080">do you</span> <span m="1838550">detect</span> <span m="1839100">that</span> <span m="1839320">instructions?</span> <span m="1839790">Well,</span> <span m="1840250">you</span> <span m="1840400">could</span> <span m="1840570">just</span> <span m="1840800">take</span> <span m="1841140">the</span> <span m="1842580">program</span> <span m="1843000">code,</span> <span m="1843380">and you</span> <span m="1843840">sort of</span> <span m="1844020">lay it</span> <span m="1844320">out</span> <span m="1844790">in</span> <span m="1844890">a</span> <span m="1844990">giant</span> <span m="1845400">string</span> <span m="1846150">that</span> <span m="1846320">goes</span> <span m="1846520">from</span> <span m="1846760">zero up</span> <span m="1847450">to</span> <span m="1848220">maybe</span> <span m="1848590">all the</span> <span m="1848830">way to</span> <span m="1849110">56</span> <span m="1849590">megabytes,</span> <span m="1850780">depending</span> <span m="1851110">on</span> <span m="1851200">how</span> <span m="1851350">big</span> <span m="1851590">your</span> <span m="1852040">code</span> <span m="1852350">is,</span> <span m="1852660">and</span> <span m="1853130">you</span> <span m="1853240">start</span> <span m="1853520">looking.</span> <span m="1853850">OK,</span> <span m="1854150">well,</span> <span m="1854370">maybe</span> <span m="1854580">there's</span> <span m="1854820">a nop</span> <span m="1855160">instruction</span> <span m="1855640">here.</span> <span m="1856420">Maybe there's</span> <span m="1856660">some sort of</span> <span m="1856780">an</span> <span m="1857040">add</span> <span m="1857500">instruction</span> <span m="1858030">there.</span> <span m="1858425">Maybe</span> <span m="1858820">there's</span> <span m="1859740">a</span> <span m="1860075">not--</span> <span m="1860410">I don't</span> <span m="1860940">know,</span> <span m="1861310">some</span> <span m="1861680">sort of a</span> <span m="1862050">jump,</span> <span m="1862580">et cetera.</span> <span m="1863350">And</span> <span m="1863735">you just</span> <span m="1864120">keep</span> <span m="1864340">looking.</span> <span m="1865840">And if</span> <span m="1865960">you</span> <span m="1866040">find</span> <span m="1866260">a bad</span> <span m="1866480">instruction,</span> <span m="1867450">you</span> <span m="1867600">say,</span> <span m="1867910">ah,</span> <span m="1868265">that's a bad</span> <span m="1868620">module.</span> <span m="1869580">And</span> <span m="1869680">then you</span> <span m="1869860">discard it.</span> <span m="1870610">And</span> <span m="1870760">if</span> <span m="1870830">you</span> <span m="1870910">don't</span> <span m="1871140">see any</span> <span m="1871490">system call</span> <span m="1871800">[INAUDIBLE]</span> <span m="1872210">instructions,</span> <span m="1873140">then</span> <span m="1873390">you're</span> <span m="1873580">going</span> <span m="1873780">to</span> <span m="1873870">allow</span> <span m="1874190">this module</span> <span m="1874350">to</span> <span m="1874500">run,</span> <span m="1875550">module</span> <span m="1875790">or</span> <span m="1875940">whatever</span> <span m="1876270">it is</span> <span m="1876410">we'll</span> <span m="1876910">do for</span> <span m="1877230">the</span> <span m="1877620">in bounds</span> <span m="1878220">checks.</span> </p>
<p><span m="1880200">So</span> <span m="1880945">is</span> <span m="1881280">this going</span> <span m="1881470">to</span> <span m="1881590">work?</span> <span m="1883301">So</span> <span m="1883770">why</span> <span m="1883880">not?</span> <span m="1884800">What</span> <span m="1884920">are they</span> <span m="1885090">worried</span> <span m="1885360">about?</span> <span m="1886320">Why is</span> <span m="1886570">so</span> <span m="1886980">complicated?</span> </p>
<p><span m="1887470">AUDIENCE: [INAUDIBLE]</span> <span m="1887960">the</span> <span m="1888450">instructions?</span> </p>
<p><span m="1889430">PROFESSOR: Yeah,</span> <span m="1890170">so</span> <span m="1890400">the</span> <span m="1890570">weird</span> <span m="1890970">thing</span> <span m="1891160">is</span> <span m="1891320">that</span> <span m="1891480">x86,</span> <span m="1892170">which</span> <span m="1892310">is</span> <span m="1892470">the</span> <span m="1892750">sort of</span> <span m="1892860">platform</span> <span m="1893115">they</span> <span m="1893370">are</span> <span m="1893500">targeting</span> <span m="1894480">has</span> <span m="1894800">a</span> <span m="1895060">variable</span> <span m="1895590">length</span> <span m="1895850">instructions.</span> <span m="1899448">So</span> <span m="1899900">this</span> <span m="1900030">means</span> <span m="1900320">that</span> <span m="1901050">the</span> <span m="1901580">particular</span> <span m="1902440">size</span> <span m="1902700">of an</span> <span m="1902960">instruction</span> <span m="1903720">depends</span> <span m="1904200">on</span> <span m="1905090">the</span> <span m="1905250">first</span> <span m="1905610">few</span> <span m="1905750">bytes</span> <span m="1906040">of</span> <span m="1906120">that</span> <span m="1906270">instruction. So</span> <span m="1906750">you</span> <span m="1906880">have</span> <span m="1907040">to</span> <span m="1907120">actually</span> <span m="1907310">look</span> <span m="1907470">at</span> <span m="1907510">the</span> <span m="1907600">first byte</span> <span m="1908090">and</span> <span m="1908230">say,</span> <span m="1908460">OK,</span> <span m="1908610">well, the</span> <span m="1909060">instruction is</span> <span m="1909550">going</span> <span m="1909660">to</span> <span m="1909700">be</span> <span m="1909780">this</span> <span m="1909930">much</span> <span m="1910150">more.</span> <span m="1910545">And</span> <span m="1910940">then</span> <span m="1911150">maybe</span> <span m="1911420">you</span> <span m="1911700">sort of have to</span> <span m="1912020">look at</span> <span m="1912230">a</span> <span m="1912290">couple</span> <span m="1912490">more</span> <span m="1912670">bytes, and then</span> <span m="1913090">decide,</span> <span m="1913500">OK, well, that's</span> <span m="1913760">exactly</span> <span m="1914190">how</span> <span m="1914320">long</span> <span m="1914550">it's</span> <span m="1914660">going</span> <span m="1914750">to</span> <span m="1914800">be.</span> <span m="1915440">But you</span> <span m="1915570">don't</span> <span m="1915710">know</span> <span m="1915820">how</span> <span m="1915980">ahead of</span> <span m="1916040">time.</span> <span m="1916330">So</span> <span m="1916430">some</span> <span m="1916690">architectures</span> <span m="1917180">like</span> <span m="1917440">Spark,</span> <span m="1918010">ARM,</span> <span m="1919230">[INAUDIBLE],</span> <span m="1921000">have</span> <span m="1921450">more</span> <span m="1921800">fixed</span> <span m="1922230">length</span> <span m="1922490">instructions.</span> <span m="1923700">Well,</span> <span m="1924000">ARM,</span> <span m="1924500">for example--</span> <span m="1924980">ARM</span> <span m="1925150">is</span> <span m="1925360">like</span> <span m="1925540">weird,</span> <span m="1925930">but</span> <span m="1926150">it has</span> <span m="1926380">two</span> <span m="1926560">instructions</span> <span m="1927030">lengths.</span> <span m="1927230">Either</span> <span m="1927490">everything</span> <span m="1927860">is</span> <span m="1927990">two</span> <span m="1928130">bytes or</span> <span m="1928450">everything is</span> <span m="1928880">four</span> <span m="1929100">bytes.</span> <span m="1930200">But</span> <span m="1930360">x86,</span> <span m="1930560">the</span> <span m="1930850">instructions</span> <span m="1931440">could</span> <span m="1931620">be</span> <span m="1931840">like</span> <span m="1932040">one</span> <span m="1932260">byte</span> <span m="1932720">or</span> <span m="1932940">10</span> <span m="1933220">byte</span> <span m="1933485">or</span> <span m="1933750">five</span> <span m="1934080">bytes,</span> <span m="1934720">anything in</span> <span m="1935060">between,</span> <span m="1935390">as</span> <span m="1935470">well.</span> </p>
<p><span m="1936462">I forget</span> <span m="1936800">actually how big.</span> <span m="1937180">You</span> <span m="1937300">can</span> <span m="1937520">get</span> <span m="1937700">a</span> <span m="1937970">pretty</span> <span m="1938330">long</span> <span m="1938560">instruction. I</span> <span m="1938895">think you can</span> <span m="1939230">get like</span> <span m="1939650">a 15</span> <span m="1939965">byte</span> <span m="1940410">instruction</span> <span m="1940870">with x86</span> <span m="1941150">if</span> <span m="1941300">you</span> <span m="1941600">try</span> <span m="1941840">hard.</span> <span m="1943044">It's</span> <span m="1943491">complicated</span> <span m="1943940">instructions,</span> <span m="1944310">though.</span> <span m="1946260">But</span> <span m="1946860">as</span> <span m="1946980">a</span> <span m="1947030">result,</span> <span m="1947920">the</span> <span m="1947930">problem</span> <span m="1948280">that</span> <span m="1948510">could</span> <span m="1948600">show up is</span> <span m="1949050">that</span> <span m="1949390">maybe</span> <span m="1949560">you're</span> <span m="1949760">scanning</span> <span m="1950340">linearly</span> <span m="1951270">and</span> <span m="1951630">everything</span> <span m="1951980">seems</span> <span m="1952200">to</span> <span m="1952300">be</span> <span m="1952430">fine.</span> <span m="1953240">But</span> <span m="1953750">maybe</span> <span m="1954140">at  runtime,</span> <span m="1955030">you'll</span> <span m="1955260">actually</span> <span m="1955560">jump</span> <span m="1956150">into</span> <span m="1956390">the</span> <span m="1956500">middle</span> <span m="1957140">of</span> <span m="1957240">some</span> <span m="1957410">instruction.</span> <span m="1958420">Maybe it</span> <span m="1958520">was</span> <span m="1958750">a</span> <span m="1959110">multi-byte</span> <span m="1959580">instruction,</span> <span m="1960220">if</span> <span m="1960310">you</span> <span m="1960500">interpret</span> <span m="1960720">it</span> <span m="1960830">starting</span> <span m="1961100">from</span> <span m="1961270">the</span> <span m="1961360">second</span> <span m="1961770">byte,</span> <span m="1962340">it</span> <span m="1962480">looks</span> <span m="1962660">like</span> <span m="1962790">a</span> <span m="1962840">completely</span> <span m="1963270">different</span> <span m="1963670">thing.</span> </p>
<p><span m="1964890">So</span> <span m="1965050">that's just</span> <span m="1965200">one</span> <span m="1965400">example</span> <span m="1966410">of sort of</span> <span m="1966600">playing</span> <span m="1966870">around</span> <span m="1967190">with an</span> <span m="1967410">assembler.</span> <span m="1968290">And</span> <span m="1968830">if</span> <span m="1968970">you</span> <span m="1969070">have an</span> <span m="1969310">instruction</span> <span m="1969740">like</span> <span m="1969920">this,</span> <span m="1970600">25</span> <span m="1972420">CD</span> <span m="1973280">80,</span> <span m="1974510">00,</span> <span m="1975670">00.</span> <span m="1976210">And</span> <span m="1976380">if</span> <span m="1976500">you</span> <span m="1976720">interpret</span> <span m="1977270">it</span> <span m="1977420">as this</span> <span m="1977620">five</span> <span m="1978070">byte</span> <span m="1978220">instruction,</span> <span m="1978900">meaning that</span> <span m="1979110">you</span> <span m="1979450">look</span> <span m="1979660">at</span> <span m="1979730">this</span> <span m="1979910">byte.</span> <span m="1980330">And</span> <span m="1980430">oh</span> <span m="1980640">yeah,</span> <span m="1980780">this is</span> <span m="1981030">going</span> <span m="1981140">to</span> <span m="1981180">be</span> <span m="1981270">a</span> <span m="1981590">five byte</span> <span m="1981760">instruction.</span> <span m="1982210">So you</span> <span m="1982280">have</span> <span m="1982410">to</span> <span m="1982450">look</span> <span m="1983070">five bytes</span> <span m="1983490">forward.</span> <span m="1984130">And</span> <span m="1984290">then</span> <span m="1984850">this</span> <span m="1985220">turns</span> <span m="1985460">out</span> <span m="1985630">to</span> <span m="1985700">be</span> <span m="1986180">a</span> <span m="1986290">fairly</span> <span m="1986630">benign</span> <span m="1987090">instruction</span> <span m="1987680">that's</span> <span m="1987910">an</span> <span m="1988080">and</span> <span m="1989380">of</span> <span m="1989550">the</span> <span m="1989810">EAX</span> <span m="1990170">register,</span> <span m="1990980">with</span> <span m="1991140">some particular</span> <span m="1991720">constant</span> <span m="1991985">that</span> <span m="1992250">happens</span> <span m="1992580">to</span> <span m="1992680">be</span> <span m="1994680">I think</span> <span m="1995210">00,</span> <span m="1996380">00,</span> <span m="1998490">80,</span> <span m="1999250">CD.</span> <span m="1999565">anyway.</span> </p>
<p><span m="2000580">So</span> <span m="2000740">this is</span> <span m="2001120">one of</span> <span m="2001180">the safe</span> <span m="2001660">instructions</span> <span m="2002220">that</span> <span m="2002310">Native</span> <span m="2002610">Client</span> <span m="2003180">should</span> <span m="2003480">just</span> <span m="2003640">allow</span> <span m="2004250">under</span> <span m="2004550">the</span> <span m="2004670">first</span> <span m="2005040">rule</span> <span m="2005330">in</span> <span m="2005625">checking these</span> <span m="2005920">binary</span> <span m="2006180">instructions.</span> <span m="2008020">But if</span> <span m="2008200">it</span> <span m="2008280">turns</span> <span m="2008530">out</span> <span m="2008630">at</span> <span m="2008720">runtime</span> <span m="2009270">the</span> <span m="2009350">CPU</span> <span m="2009780">decides</span> <span m="2010420">this</span> <span m="2010820">is</span> <span m="2010960">where it</span> <span m="2011210">has</span> <span m="2011400">to</span> <span m="2011510">start</span> <span m="2011960">executing the</span> <span m="2012510">code,</span> <span m="2013150">then</span> <span m="2013610">this</span> <span m="2014360">instruction</span> <span m="2015390">is</span> <span m="2015620">actually</span> <span m="2015920">a</span> <span m="2016020">four</span> <span m="2016290">byte</span> <span m="2016440">instruction,</span> <span m="2017310">and</span> <span m="2017440">its</span> <span m="2017540">actually an</span> <span m="2017835">int</span> <span m="2018130">instruction</span> <span m="2019040">that</span> <span m="2019980">makes</span> <span m="2020330">the</span> <span m="2020440">OX80</span> <span m="2021010">interrupt,</span> <span m="2021720">which</span> <span m="2021950">is</span> <span m="2022610">one</span> <span m="2023280">way</span> <span m="2023430">to</span> <span m="2023510">make</span> <span m="2023720">system</span> <span m="2023980">calls in</span> <span m="2024270">Linux.</span> <span m="2025570">So</span> <span m="2026570">if</span> <span m="2026780">you</span> <span m="2027250">miss</span> <span m="2027660">this</span> <span m="2027780">fact,</span> <span m="2028765">then</span> <span m="2029270">eventually</span> <span m="2029580">you're</span> <span m="2029720">going</span> <span m="2029840">to</span> <span m="2031030">allow</span> <span m="2031560">untrusted</span> <span m="2031870">module</span> <span m="2032200">to</span> <span m="2032700">jump</span> <span m="2032980">into</span> <span m="2033170">the</span> <span m="2033240">kernel</span> <span m="2033600">and make</span> <span m="2033820">system</span> <span m="2034120">calls,</span> <span m="2034350">which</span> <span m="2034480">is</span> <span m="2034560">what</span> <span m="2034710">you</span> <span m="2034790">wanted</span> <span m="2035070">to</span> <span m="2035190">prevent.</span> <span m="2036988">Make sense?</span> <span m="2039790">So how can</span> <span m="2040480">we</span> <span m="2040740">prevent</span> <span m="2041060">it?</span> <span m="2041430">Like</span> <span m="2041590">one</span> <span m="2041750">possibility</span> <span m="2042095">is</span> <span m="2042640">like maybe we should</span> <span m="2042850">try</span> <span m="2044090">to</span> <span m="2044480">look</span> <span m="2044720">at</span> <span m="2044940">every</span> <span m="2045330">byte</span> <span m="2045610">offset.</span> <span m="2045980">Because</span> <span m="2046530">at least</span> <span m="2046855">x86</span> <span m="2047590">can</span> <span m="2047760">only</span> <span m="2047870">start</span> <span m="2048490">interpreting</span> <span m="2048770">instruction</span> <span m="2049125">on a byte</span> <span m="2049480">boundary</span> <span m="2049745">instead</span> <span m="2050010">of</span> <span m="2050230">a bit</span> <span m="2050389">boundary.</span> <span m="2051643">So</span> <span m="2052020">you</span> <span m="2052400">like look at</span> <span m="2052679">every</span> <span m="2053070">single</span> <span m="2053370">possible</span> <span m="2053699">byte</span> <span m="2053900">off,</span> <span m="2054130">and you</span> <span m="2054409">see</span> <span m="2054530">what</span> <span m="2054699">instruction</span> <span m="2055170">starts</span> <span m="2055469">there.</span> <span m="2057420">Is this</span> <span m="2057560">a</span> <span m="2057620">reasonable</span> <span m="2057949">plan</span> <span m="2059139">to</span> <span m="2059340">report?</span> <span m="2059670">Yeah?</span> </p>
<p><span m="2059944">AUDIENCE: I mean,</span> <span m="2060219">what</span> <span m="2060679">if</span> <span m="2060969">someone</span> <span m="2061040">actually</span> <span m="2061500">is</span> <span m="2061750">doing</span> <span m="2062110">an</span> <span m="2062409">and,</span> <span m="2062739">and they're never</span> <span m="2063195">going to jump into</span> <span m="2063651">that.</span> <span m="2064107">And now you're</span> <span m="2064563">just allowing their</span> <span m="2065019">program.</span> </p>
<p><span m="2065480">PROFESSOR: Right,</span> <span m="2065909">so</span> <span m="2066310">basically</span> <span m="2066650">it's</span> <span m="2067000">prone to</span> <span m="2067510">eventually</span> <span m="2067920">false</span> <span m="2068270">positives.</span> <span m="2070310">Now</span> <span m="2070790">if you</span> <span m="2071159">really</span> <span m="2071350">wanted</span> <span m="2071580">to,</span> <span m="2071670">you</span> <span m="2071800">could</span> <span m="2071960">probably</span> <span m="2072770">contort</span> <span m="2073139">yourself</span> <span m="2073560">and</span> <span m="2073710">change</span> <span m="2074050">the</span> <span m="2074980">code</span> <span m="2075234">a</span> <span m="2075489">little--</span> <span m="2076889">and</span> <span m="2077070">somehow</span> <span m="2077810">avoid</span> <span m="2078159">this.</span> <span m="2078330">If</span> <span m="2078440">you knew</span> <span m="2078750">exactly</span> <span m="2079230">what</span> <span m="2079429">the</span> <span m="2079520">checker</span> <span m="2079800">was</span> <span m="2079989">looking</span> <span m="2080290">for,</span> <span m="2081080">you could</span> <span m="2081190">potentially</span> <span m="2081480">change</span> <span m="2082040">these</span> <span m="2082230">instructions.</span> <span m="2083620">Maybe</span> <span m="2083800">like</span> <span m="2084179">end it  with</span> <span m="2084650">one</span> <span m="2084850">thing</span> <span m="2085040">first,</span> <span m="2085690">and then</span> <span m="2085969">end it with</span> <span m="2086360">another</span> <span m="2086790">mask</span> <span m="2087199">later.</span> <span m="2088010">But</span> <span m="2088330">just</span> <span m="2089020">avoid</span> <span m="2089730">these</span> <span m="2090040">suspicious</span> <span m="2090570">byte</span> <span m="2090739">patterns.</span> <span m="2091520">But</span> <span m="2091719">that just</span> <span m="2091810">seems</span> <span m="2092480">pretty</span> <span m="2092690">awkward</span> <span m="2093110">to</span> <span m="2093190">do.</span> </p>
<p><span m="2094430">Now it</span> <span m="2094870">is</span> <span m="2095090">actually</span> <span m="2095389">possible</span> <span m="2095730">that the</span> <span m="2096150">architecture</span> <span m="2096650">does</span> <span m="2096949">involve</span> <span m="2097400">changing</span> <span m="2097780">the</span> <span m="2097920">compiler.</span> <span m="2099030">So</span> <span m="2099360">in</span> <span m="2099490">principle,</span> <span m="2099940">they</span> <span m="2100050">do</span> <span m="2100300">have</span> <span m="2100640">some</span> <span m="2100860">component</span> <span m="2101400">that</span> <span m="2101520">actually</span> <span m="2102100">has</span> <span m="2102370">to</span> <span m="2102540">compile</span> <span m="2103200">the</span> <span m="2103330">code</span> <span m="2103600">correctly.</span> <span m="2105150">You</span> <span m="2105440">can't just</span> <span m="2105740">take</span> <span m="2106070">of the</span> <span m="2106540">shelf GCC</span> <span m="2107020">and</span> <span m="2107130">compile</span> <span m="2107435">a</span> <span m="2107740">code for Native</span> <span m="2108105">Client.</span> <span m="2108880">So</span> <span m="2109020">in</span> <span m="2109200">principle</span> <span m="2109455">it's</span> <span m="2109710">doable.</span> <span m="2110100">But</span> <span m="2110420">I</span> <span m="2110490">think</span> <span m="2110740">they're</span> <span m="2110930">just</span> <span m="2111090">thinking</span> <span m="2111170">it's</span> <span m="2111530">too</span> <span m="2111640">much</span> <span m="2111970">hassle,</span> <span m="2112500">and</span> <span m="2113050">it's</span> <span m="2113240">not</span> <span m="2113440">going</span> <span m="2113540">to</span> <span m="2113600">be</span> <span m="2113760">reliable</span> <span m="2114310">or</span> <span m="2114430">high</span> <span m="2114580">performance,</span> <span m="2115065">et</span> <span m="2115550">cetera.</span> <span m="2116506">Make sense?</span> <span m="2118420">And</span> <span m="2118530">plus there's</span> <span m="2118880">a</span> <span m="2119020">couple</span> <span m="2119280">of</span> <span m="2119825">x86</span> <span m="2120510">instructions</span> <span m="2120770">that</span> <span m="2121030">are</span> <span m="2122030">prohibited</span> <span m="2122330">or</span> <span m="2122630">should</span> <span m="2122820">be</span> <span m="2122950">unsafe</span> <span m="2123560">and</span> <span m="2123960">prohibited.</span> <span m="2124780">But</span> <span m="2125000">they're</span> <span m="2125380">like</span> <span m="2125540">one</span> <span m="2125700">byte</span> <span m="2125940">long,</span> <span m="2126310">so</span> <span m="2126540">that</span> <span m="2127110">is</span> <span m="2127310">going</span> <span m="2127720">to</span> <span m="2128050">be</span> <span m="2128380">pretty</span> <span m="2128740">damaging</span> <span m="2129270">to</span> <span m="2129900">look</span> <span m="2130090">for</span> <span m="2130780">or</span> <span m="2130970">filter</span> <span m="2131390">out.</span> </p>
<p><span m="2132836">OK.</span> <span m="2133320">So</span> <span m="2133580">if</span> <span m="2133840">they</span> <span m="2133950">can't</span> <span m="2134380">just</span> <span m="2134580">assemble</span> <span m="2134875">and</span> <span m="2135170">sort</span> <span m="2135290">of</span> <span m="2135380">straight</span> <span m="2135840">up</span> <span m="2136110">and</span> <span m="2136380">hope</span> <span m="2136650">for</span> <span m="2136740">the</span> <span m="2136840">best,</span> <span m="2137470">then</span> <span m="2138020">they</span> <span m="2138120">need</span> <span m="2138330">some</span> <span m="2138600">other</span> <span m="2138920">plan</span> <span m="2139540">for</span> <span m="2140220">doing</span> <span m="2140880">this disassembly</span> <span m="2141690">in</span> <span m="2141820">a</span> <span m="2141940">reliable</span> <span m="2142370">fashion.</span> <span m="2143830">So</span> <span m="2144600">what is</span> <span m="2144850">that</span> <span m="2145130">client</span> <span m="2145340">or</span> <span m="2145430">Native</span> <span m="2145690">Client</span> <span m="2146070">to</span> <span m="2146320">ensure</span> <span m="2147340">they</span> <span m="2147470">don't</span> <span m="2148050">get</span> <span m="2148400">tripped</span> <span m="2148680">up</span> <span m="2148890">by</span> <span m="2148980">this</span> <span m="2149200">variable</span> <span m="2149570">length</span> <span m="2150590">encoding?</span> <span m="2153550">So</span> <span m="2153670">I guess</span> <span m="2153850">one</span> <span m="2154020">way</span> <span m="2154130">to</span> <span m="2154540">think</span> <span m="2154720">about</span> <span m="2154910">it</span> <span m="2155080">is,</span> <span m="2158560">well,</span> <span m="2159070">so</span> <span m="2159395">how are we</span> <span m="2159720">going to solve</span> <span m="2160190">this reliable</span> <span m="2160660">disassembly?</span> </p>
<p><span m="2166310">So</span> <span m="2166950">in</span> <span m="2167130">some</span> <span m="2167340">sense,</span> <span m="2167770">if</span> <span m="2168040">we</span> <span m="2168760">really</span> <span m="2169130">do</span> <span m="2169350">scan</span> <span m="2169870">forward</span> <span m="2170260">from the</span> <span m="2170460">left</span> <span m="2170960">to the</span> <span m="2171300">right,</span> <span m="2171910">and we</span> <span m="2172130">look</span> <span m="2172300">for</span> <span m="2172430">all</span> <span m="2172550">the</span> <span m="2172640">possible</span> <span m="2172895">up</span> <span m="2173150">codes,</span> <span m="2175015">if</span> <span m="2175460">that's the</span> <span m="2175850">way</span> <span m="2175990">the</span> <span m="2176120">code</span> <span m="2176360">executes,</span> <span m="2176910">then</span> <span m="2177140">we're</span> <span m="2177360">in</span> <span m="2177450">good</span> <span m="2177650">shape.</span> <span m="2178080">So even</span> <span m="2178300">if</span> <span m="2178430">there</span> <span m="2178630">are</span> <span m="2178690">some</span> <span m="2179000">weird</span> <span m="2179250">instruction</span> <span m="2180000">and</span> <span m="2180180">has</span> <span m="2180360">some</span> <span m="2180560">offset,</span> <span m="2181190">then</span> <span m="2182160">the</span> <span m="2182320">CPU</span> <span m="2182580">isn't</span> <span m="2182810">actually</span> <span m="2183090">going</span> <span m="2183200">to</span> <span m="2183340">jump</span> <span m="2183660">there.</span> <span m="2184290">It</span> <span m="2184460">actually</span> <span m="2184940">executes</span> <span m="2185530">the</span> <span m="2185670">same</span> <span m="2186000">way</span> <span m="2186130">that</span> <span m="2186290">we're</span> <span m="2186450">scanning</span> <span m="2186930">the</span> <span m="2187010">instruction</span> <span m="2187530">screen</span> <span m="2187840">from</span> <span m="2188050">left</span> <span m="2188290">to</span> <span m="2188380">right.</span> </p>
<p><span m="2189740">So</span> <span m="2190140">the</span> <span m="2190330">problem</span> <span m="2190800">with</span> <span m="2191560">getting</span> <span m="2191840">the disassembly</span> <span m="2192290">to</span> <span m="2192550">be</span> <span m="2192790">reliable</span> <span m="2194020">really</span> <span m="2194370">comes</span> <span m="2194690">from</span> <span m="2195040">the</span> <span m="2195150">fact</span> <span m="2195620">that</span> <span m="2196130">there's</span> <span m="2196460">jumps.</span> <span m="2198320">Because</span> <span m="2198800">if</span> <span m="2199000">we</span> <span m="2199200">execute</span> <span m="2199630">linearly</span> <span m="2200200">from</span> <span m="2200650">left to right,</span> <span m="2200770">then the</span> <span m="2201070">CPU</span> <span m="2201430">will follow the</span> <span m="2201790">same</span> <span m="2202090">rules</span> <span m="2202390">that our</span> <span m="2202770">checker is</span> <span m="2203235">following,</span> <span m="2203700">and</span> <span m="2203880">see</span> <span m="2204020">the</span> <span m="2204130">same</span> <span m="2204490">instruction</span> <span m="2205000">screen.</span> <span m="2205840">So</span> <span m="2206270">the</span> <span m="2206380">problem</span> <span m="2206640">really</span> <span m="2206860">comes</span> <span m="2207190">down</span> <span m="2207540">to</span> <span m="2208070">what</span> <span m="2208230">happens</span> <span m="2208710">if</span> <span m="2208940">there's</span> <span m="2209360">a jump</span> <span m="2209880">somewhere</span> <span m="2210250">in the</span> <span m="2210360">application.</span> <span m="2211490">Could a</span> <span m="2211720">jump to</span> <span m="2212080">some</span> <span m="2212440">position</span> <span m="2212755">in</span> <span m="2213070">the</span> <span m="2213200">code</span> <span m="2213500">that</span> <span m="2213590">we</span> <span m="2213710">didn't</span> <span m="2214230">observe</span> <span m="2215160">in</span> <span m="2215250">our</span> <span m="2215410">left</span> <span m="2215690">to</span> <span m="2215780">right</span> <span m="2216160">scan?</span> </p>
<p><span m="2217990">So</span> <span m="2218280">this is</span> <span m="2218730">what they are</span> <span m="2219130">sort of going</span> <span m="2219480">another in the</span> <span m="2219750">reliable</span> <span m="2220015">disassembly.</span> <span m="2221380">And</span> <span m="2221930">the</span> <span m="2222250">basic</span> <span m="2222580">plan</span> <span m="2223270">is</span> <span m="2223760">to</span> <span m="2223900">just</span> <span m="2224220">check</span> <span m="2224590">where</span> <span m="2224780">all</span> <span m="2224930">the</span> <span m="2225060">jumps</span> <span m="2225370">go.</span> <span m="2226780">It's actually</span> <span m="2227070">fairly</span> <span m="2227500">straightforward</span> <span m="2228100">at</span> <span m="2228200">some</span> <span m="2228370">level.</span> <span m="2230020">They</span> <span m="2230140">have</span> <span m="2230750">a bunch</span> <span m="2230880">of rules</span> <span m="2231240">we'll</span> <span m="2231490">look</span> <span m="2231780">at in</span> <span m="2232070">a</span> <span m="2232130">second,</span> <span m="2232880">but</span> <span m="2233480">roughly</span> <span m="2233880">the</span> <span m="2234010">plan</span> <span m="2234320">is</span> <span m="2234850">if</span> <span m="2235010">you</span> <span m="2235140">see</span> <span m="2235380">a</span> <span m="2235470">jump</span> <span m="2235700">instruction,</span> <span m="2237680">then</span> <span m="2238120">it</span> <span m="2238200">actually</span> <span m="2238470">has</span> <span m="2238790">to</span> <span m="2238900">be--</span> <span m="2239520">well,</span> <span m="2239910">you</span> <span m="2239980">have</span> <span m="2240130">to</span> <span m="2240270">check</span> <span m="2241615">that</span> <span m="2242240">the</span> <span m="2242430">target</span> <span m="2243500">was</span> <span m="2243790">seen</span> <span m="2244030">before.</span> </p>
<p><span m="2248360">So</span> <span m="2248690">you</span> <span m="2248920">basically</span> <span m="2249330">do</span> <span m="2249750">the</span> <span m="2249850">left</span> <span m="2250150">to</span> <span m="2250230">right</span> <span m="2250460">scan</span> <span m="2250850">that</span> <span m="2250940">we</span> <span m="2251340">sort</span> <span m="2251450">of</span> <span m="2251590">described</span> <span m="2251865">in our</span> <span m="2252140">naive</span> <span m="2252500">approach</span> <span m="2252920">here.</span> <span m="2253970">But</span> <span m="2254130">then</span> <span m="2254270">if</span> <span m="2254390">you</span> <span m="2254490">see</span> <span m="2254820">any</span> <span m="2255130">kind</span> <span m="2255330">of</span> <span m="2255390">a</span> <span m="2255480">jump</span> <span m="2255750">instruction,</span> <span m="2256910">then</span> <span m="2257080">you</span> <span m="2257190">see</span> <span m="2257430">what</span> <span m="2257650">is</span> <span m="2257850">the</span> <span m="2258240">address</span> <span m="2258650">to</span> <span m="2258730">which</span> <span m="2258910">the</span> <span m="2258990">jump</span> <span m="2259220">instruction</span> <span m="2259545">is</span> <span m="2259870">pointing</span> <span m="2260240">to,</span> <span m="2260640">and you</span> <span m="2261080">make</span> <span m="2261260">sure</span> <span m="2261520">that</span> <span m="2261800">it's</span> <span m="2262000">an</span> <span m="2262150">address</span> <span m="2262530">that</span> <span m="2262670">you</span> <span m="2262790">saw</span> <span m="2263000">in</span> <span m="2263250">your</span> <span m="2263350">left</span> <span m="2263590">to</span> <span m="2263670">right</span> <span m="2263830">disassembly.</span> </p>
<p><span m="2264750">So</span> <span m="2265130">if</span> <span m="2265510">there's</span> <span m="2265860">a</span> <span m="2265980">jump</span> <span m="2266190">instruction</span> <span m="2266670">for</span> <span m="2266770">example</span> <span m="2267240">that goes</span> <span m="2267480">to that</span> <span m="2267890">CD</span> <span m="2268050">byte,</span> <span m="2269260">then</span> <span m="2269650">we're</span> <span m="2269780">going</span> <span m="2269880">to</span> <span m="2269950">flag</span> <span m="2270500">that</span> <span m="2270760">jump</span> <span m="2271030">as</span> <span m="2271220">invalid</span> <span m="2271820">because</span> <span m="2272980">we</span> <span m="2273160">never</span> <span m="2273340">saw an</span> <span m="2273640">instruction</span> <span m="2274220">starting</span> <span m="2274500">in</span> <span m="2274690">the CD</span> <span m="2275030">byte.</span> <span m="2275250">We</span> <span m="2275320">saw a</span> <span m="2275470">different</span> <span m="2275730">instruction.</span> <span m="2277030">But if</span> <span m="2277230">all</span> <span m="2277360">the</span> <span m="2277800">instruction,</span> <span m="2278530">if</span> <span m="2278770">all</span> <span m="2278900">the</span> <span m="2279030">jumps</span> <span m="2279320">go</span> <span m="2279470">to</span> <span m="2280140">the</span> <span m="2280270">start</span> <span m="2280610">of</span> <span m="2280700">instructions</span> <span m="2281190">we</span> <span m="2281300">saw,</span> <span m="2281540">then</span> <span m="2281910">we're</span> <span m="2282060">in</span> <span m="2282130">good</span> <span m="2282310">shape.</span> <span m="2283622">Does that make</span> <span m="2284120">sense?</span> </p>
<p><span m="2286320">So the</span> <span m="2286670">one</span> <span m="2287370">problem</span> <span m="2287645">is</span> <span m="2287920">that</span> <span m="2288810">you can't</span> <span m="2288910">check</span> <span m="2289220">the</span> <span m="2289340">targets</span> <span m="2289620">of</span> <span m="2289970">every</span> <span m="2290350">jump</span> <span m="2291000">in</span> <span m="2291220">the</span> <span m="2291320">program,</span> <span m="2291690">because</span> <span m="2291980">there</span> <span m="2292120">might</span> <span m="2292320">be</span> <span m="2292450">indirect</span> <span m="2292930">jumps.</span> <span m="2293460">For</span> <span m="2293960">example</span> <span m="2294260">in</span> <span m="2294580">x86,</span> <span m="2294930">you</span> <span m="2295170">could</span> <span m="2295290">actually</span> <span m="2295520">have</span> <span m="2295730">something</span> <span m="2296100">like</span> <span m="2296740">jump</span> <span m="2297150">to</span> <span m="2297710">the</span> <span m="2297810">value</span> <span m="2298190">of</span> <span m="2298400">that</span> <span m="2298670">EAX</span> <span m="2299160">register.</span> <span m="2300105">This is</span> <span m="2300660">great</span> <span m="2300920">for</span> <span m="2301060">implementing</span> <span m="2301430">function</span> <span m="2301780">pointers.</span> <span m="2302510">The</span> <span m="2302610">function</span> <span m="2302920">pointer</span> <span m="2303370">somewhere in</span> <span m="2303710">memory,</span> <span m="2304670">then</span> <span m="2304870">you</span> <span m="2305030">hold</span> <span m="2305290">to</span> <span m="2305360">function</span> <span m="2305690">pointer</span> <span m="2306080">into</span> <span m="2306200">some</span> <span m="2306580">register</span> <span m="2307080">at</span> <span m="2307220">one</span> <span m="2307400">time.</span> <span m="2307870">And</span> <span m="2307980">then you</span> <span m="2308150">jump</span> <span m="2308470">to</span> <span m="2308590">whatever</span> <span m="2308940">address</span> <span m="2309930">was</span> <span m="2310180">in</span> <span m="2310440">the</span> <span m="2311562">[INAUDIBLE]</span> <span m="2311930">relocation</span> <span m="2312530">register.</span> </p>
<p><span m="2314240">So</span> <span m="2314370">how</span> <span m="2314490">do</span> <span m="2314740">these guys</span> <span m="2314870">deal</span> <span m="2315350">with</span> <span m="2315560">these</span> <span m="2315990">indirect</span> <span m="2316530">jumps?</span> <span m="2316940">So</span> <span m="2317090">I</span> <span m="2317240">have</span> <span m="2317390">no</span> <span m="2317490">idea</span> <span m="2317990">if this</span> <span m="2318140">actually</span> <span m="2318390">going</span> <span m="2318560">to</span> <span m="2318690">jump</span> <span m="2319090">to</span> <span m="2319840">the</span> <span m="2320100">CD</span> <span m="2320390">byte</span> <span m="2320700">or</span> <span m="2321270">the 25</span> <span m="2321450">byte.</span> <span m="2322870">What do</span> <span m="2323030">they</span> <span m="2323110">do?</span> <span m="2323340">Yeah?</span> </p>
<p><span m="2323820">AUDIENCE: The</span> <span m="2324316">instrument</span> <span m="2324812">[INAUDIBLE].</span> </p>
<p><span m="2325310">PROFESSOR: Yeah.</span> <span m="2325700">So</span> <span m="2326030">this is</span> <span m="2326210">their</span> <span m="2326320">basically</span> <span m="2326700">main trick</span> <span m="2327150">here, is</span> <span m="2327510">instrumentation.</span> <span m="2328690">So</span> <span m="2328950">whenever</span> <span m="2329330">they</span> <span m="2329520">see</span> <span m="2330300">a</span> <span m="2330440">jump</span> <span m="2330850">like</span> <span m="2331100">this,</span> <span m="2332180">well</span> <span m="2332380">actually</span> <span m="2333100">what</span> <span m="2333210">the</span> <span m="2333330">compiler</span> <span m="2333685">is</span> <span m="2334040">going to</span> <span m="2334430">generate</span> <span m="2335120">is</span> <span m="2335350">a</span> <span m="2335570">proof</span> <span m="2336200">that this</span> <span m="2336530">jump</span> <span m="2336790">is</span> <span m="2336900">actually going to</span> <span m="2337080">do</span> <span m="2337400">the</span> <span m="2337540">right</span> <span m="2337810">thing.</span> <span m="2338740">And</span> <span m="2339025">the</span> <span m="2339310">way they</span> <span m="2339640">actually</span> <span m="2339930">do</span> <span m="2340130">this</span> <span m="2340470">is--</span> <span m="2341730">they</span> <span m="2341950">don't</span> <span m="2342140">actually</span> <span m="2342390">know--</span> <span m="2343640">it's</span> <span m="2343800">actually</span> <span m="2344060">kind</span> <span m="2344210">of</span> <span m="2344320">hard</span> <span m="2344610">to</span> <span m="2344730">put</span> <span m="2344990">in a</span> <span m="2345070">proof</span> <span m="2345340">here</span> <span m="2345610">that</span> <span m="2346050">it's</span> <span m="2346220">one</span> <span m="2346410">of</span> <span m="2346550">the</span> <span m="2347120">addresses</span> <span m="2347540">that</span> <span m="2347640">you</span> <span m="2347740">saw</span> <span m="2347870">during</span> <span m="2348235">the</span> <span m="2348600">left</span> <span m="2348960">right</span> <span m="2349160">disassembly.</span> <span m="2349910">So</span> <span m="2350200">instead</span> <span m="2350480">what</span> <span m="2350760">they</span> <span m="2350890">do</span> <span m="2351080">is</span> <span m="2351190">they</span> <span m="2351570">want</span> <span m="2351670">to</span> <span m="2351720">make</span> <span m="2351910">sure</span> <span m="2352210">that all</span> <span m="2352470">the</span> <span m="2352620">jumps</span> <span m="2352990">go</span> <span m="2353130">to</span> <span m="2353200">multiples</span> <span m="2353535">of</span> <span m="2353870">32</span> <span m="2354680">bytes.</span> <span m="2355770">And</span> <span m="2355880">the</span> <span m="2355950">way</span> <span m="2356050">they</span> <span m="2356150">do</span> <span m="2356360">this</span> <span m="2356590">is</span> <span m="2356700">actually</span> <span m="2357470">change</span> <span m="2358310">all</span> <span m="2358700">the</span> <span m="2359290">jump</span> <span m="2359540">instructions</span> <span m="2360570">into</span> <span m="2361510">something</span> <span m="2362240">that they</span> <span m="2362670">pseudo</span> <span m="2362990">instructions.</span> <span m="2363640">So</span> <span m="2364090">they're</span> <span m="2364260">still</span> <span m="2365000">that</span> <span m="2365860">jump</span> <span m="2366280">to the</span> <span m="2366500">EAX</span> <span m="2366979">register.</span> </p>
<p><span m="2371290">But</span> <span m="2371930">they</span> <span m="2372080">prefix</span> <span m="2372730">it</span> <span m="2373120">with</span> <span m="2373350">an AND</span> <span m="2373720">instruction</span> <span m="2375220">that</span> <span m="2376340">is</span> <span m="2376480">going</span> <span m="2376600">to</span> <span m="2377150">clear</span> <span m="2379180">the</span> <span m="2379960">low</span> <span m="2380410">five</span> <span m="2380690">bits,</span> <span m="2386705">E</span> <span m="2387130">0</span> <span m="2388070">with</span> <span m="2388220">an</span> <span m="2388450">EAX</span> <span m="2388810">register.</span> <span m="2390610">So</span> <span m="2390780">that AND</span> <span m="2391060">instruction</span> <span m="2391980">clears</span> <span m="2392540">the</span> <span m="2392600">low</span> <span m="2392880">five</span> <span m="2393140">bits,</span> <span m="2393820">which</span> <span m="2394010">means</span> <span m="2394350">that</span> <span m="2394740">it</span> <span m="2394960">forces</span> <span m="2395400">this</span> <span m="2395760">value</span> <span m="2396120">to</span> <span m="2396220">be</span> <span m="2396320">a</span> <span m="2396360">multiple</span> <span m="2396740">of</span> <span m="2396820">32,</span> <span m="2397216">two</span> <span m="2397612">to the</span> <span m="2398010">five.</span> <span m="2399690">And</span> <span m="2400280">then</span> <span m="2400430">you</span> <span m="2400520">jump</span> <span m="2400820">to</span> <span m="2401120">it.</span> <span m="2401570">So</span> <span m="2402260">if</span> <span m="2402420">you</span> <span m="2403070">look</span> <span m="2403330">at</span> <span m="2403410">it</span> <span m="2403800">during</span> <span m="2403970">verification</span> <span m="2404320">time,</span> <span m="2404960">then you</span> <span m="2405190">can</span> <span m="2405470">sort</span> <span m="2405760">of</span> <span m="2405920">convince</span> <span m="2406240">yourself</span> <span m="2406800">that</span> <span m="2407680">this</span> <span m="2408080">instruction</span> <span m="2410220">pair</span> <span m="2411210">will</span> <span m="2411500">only</span> <span m="2412170">jump</span> <span m="2412560">to a</span> <span m="2412720">multiple</span> <span m="2413550">32</span> <span m="2413900">bytes.</span> <span m="2415180">And</span> <span m="2415320">then</span> <span m="2415640">in</span> <span m="2415740">order</span> <span m="2415800">to</span> <span m="2415840">make</span> <span m="2416050">sure</span> <span m="2416610">that</span> <span m="2416810">this</span> <span m="2416930">is</span> <span m="2417110">not</span> <span m="2417420">going</span> <span m="2417510">to</span> <span m="2417600">jump</span> <span m="2417940">to</span> <span m="2418030">some</span> <span m="2418280">weird</span> <span m="2418620">instruction,</span> <span m="2419850">you're</span> <span m="2420040">going</span> <span m="2420170">to</span> <span m="2420210">enforce</span> <span m="2420570">an</span> <span m="2420720">extra</span> <span m="2421090">rule,</span> <span m="2421430">which</span> <span m="2421610">is</span> <span m="2421770">that</span> <span m="2422420">during</span> <span m="2422830">your</span> <span m="2423500">disassembly,</span> <span m="2424610">when</span> <span m="2424760">you're</span> <span m="2424920">scanning</span> <span m="2425195">your</span> <span m="2425470">instructions</span> <span m="2426060">from</span> <span m="2426230">left</span> <span m="2426450">to</span> <span m="2426570">right,</span> <span m="2427700">you're</span> <span m="2427710">going</span> <span m="2427820">to</span> <span m="2427870">ensure</span> <span m="2428300">that</span> <span m="2428540">every</span> <span m="2428950">multiple</span> <span m="2429400">of</span> <span m="2429540">32</span> <span m="2429900">bytes</span> <span m="2430640">is</span> <span m="2431140">a</span> <span m="2431250">start of</span> <span m="2431505">a</span> <span m="2431760">valid</span> <span m="2432110">instruction.</span> </p>
<p><span m="2434110">So</span> <span m="2434140">in</span> <span m="2434230">addition</span> <span m="2434540">to</span> <span m="2434600">this</span> <span m="2434770">instrumentation,</span> <span m="2435720">you're also</span> <span m="2436110">are going</span> <span m="2436360">to</span> <span m="2436710">check</span> <span m="2438310">that</span> <span m="2439250">every</span> <span m="2441340">multiple</span> <span m="2441770">of</span> <span m="2442080">32</span> <span m="2444920">is a</span> <span m="2445230">valid</span> <span m="2445570">instruction.</span> <span m="2451070">What</span> <span m="2451400">I</span> <span m="2451460">mean</span> <span m="2451670">by</span> <span m="2451800">valid</span> <span m="2452350">instruction</span> <span m="2452650">here</span> <span m="2453300">is</span> <span m="2454330">an</span> <span m="2454380">instruction</span> <span m="2454635">that you</span> <span m="2454890">see when</span> <span m="2455270">you</span> <span m="2455450">disassemble</span> <span m="2456160">from</span> <span m="2456350">left</span> <span m="2456570">to</span> <span m="2456650">right.</span> <span m="2457942">Yeah?</span> </p>
<p><span m="2458388">AUDIENCE: Why 32?</span> </p>
<p><span m="2459730">PROFESSOR: Well,</span> <span m="2459810">yeah,</span> <span m="2460090">so</span> <span m="2460280">why did they</span> <span m="2460370">choose</span> <span m="2460590">32?</span> <span m="2460850">That seems</span> <span m="2461260">like</span> <span m="2461400">some</span> <span m="2461490">magic</span> <span m="2461920">number</span> <span m="2462060">that they</span> <span m="2462350">pulled out</span> <span m="2462610">of</span> <span m="2462680">a hat.</span> <span m="2463910">Should you</span> <span m="2464190">choose</span> <span m="2464710">1,000</span> <span m="2465470">or</span> <span m="2465620">five?</span> <span m="2467680">Any</span> <span m="2468035">comment?</span> <span m="2468660">OK,</span> <span m="2468930">should</span> <span m="2469140">we</span> <span m="2469300">choose</span> <span m="2469450">five?</span> <span m="2471130">So</span> <span m="2471400">why</span> <span m="2471450">is</span> <span m="2471550">five</span> <span m="2471910">bad?</span> </p>
<p><span m="2472766">AUDIENCE: The power</span> <span m="2473202">of two.</span> </p>
<p><span m="2474950">PROFESSOR: Yes,</span> <span m="2475290">OK,</span> <span m="2475500">so</span> <span m="2475640">we're</span> <span m="2475960">on a</span> <span m="2476270">power of two.</span> <span m="2476440">OK,</span> <span m="2476730">so</span> <span m="2476840">good</span> <span m="2477000">point.</span> <span m="2477310">Because</span> <span m="2477650">otherwise</span> <span m="2478710">ensuring</span> <span m="2479080">something</span> <span m="2479330">is</span> <span m="2479420">a</span> <span m="2479470">multiple</span> <span m="2479810">of</span> <span m="2479930">5</span> <span m="2480220">is</span> <span m="2480300">going</span> <span m="2480420">to</span> <span m="2480530">require</span> <span m="2480900">a</span> <span m="2480990">couple</span> <span m="2481230">of</span> <span m="2481310">instructions</span> <span m="2481720">here,</span> <span m="2481910">which</span> <span m="2482040">is</span> <span m="2482590">going</span> <span m="2482700">to</span> <span m="2483110">lead</span> <span m="2483400">overhead.</span> <span m="2484080">How</span> <span m="2484480">about eight?</span> <span m="2485420">Is</span> <span m="2485570">eight</span> <span m="2485820">good enough,</span> <span m="2486140">yeah?</span> </p>
<p><span m="2486550">AUDIENCE: You can have</span> <span m="2486935">instructions</span> <span m="2487320">longer than</span> <span m="2487705">eight.</span> </p>
<p><span m="2488090">PROFESSOR: Yeah,</span> <span m="2488310">OK,</span> <span m="2488740">so it has</span> <span m="2489000">to be at</span> <span m="2489160">least</span> <span m="2489590">as</span> <span m="2489710">long</span> <span m="2490140">as</span> <span m="2490260">the</span> <span m="2490360">longest</span> <span m="2490800">x86</span> <span m="2491220">instruction</span> <span m="2491800">you want to</span> <span m="2491910">allow.</span> <span m="2492890">So if</span> <span m="2493050">there's a</span> <span m="2493160">ten</span> <span m="2493330">byte</span> <span m="2493460">instruction,</span> <span m="2493940">everything</span> <span m="2494220">has to</span> <span m="2494280">be</span> <span m="2494430">a</span> <span m="2494820">multiple of</span> <span m="2494860">eight,</span> <span m="2495140">well,</span> <span m="2495350">you're</span> <span m="2495520">kind</span> <span m="2495660">of</span> <span m="2495730">screwed</span> <span m="2496060">with a</span> <span m="2496390">ten byte</span> <span m="2496510">instruction.</span> <span m="2497200">There's</span> <span m="2497370">nowhere</span> <span m="2497720">to</span> <span m="2497800">put</span> <span m="2497990">it.</span> <span m="2499260">So it has to be</span> <span m="2499610">at</span> <span m="2499760">least</span> <span m="2499960">as long.</span> <span m="2500400">32</span> <span m="2500540">is</span> <span m="2500610">pretty</span> <span m="2501240">good,</span> <span m="2501490">like</span> <span m="2501670">the</span> <span m="2501930">biggest</span> <span m="2502200">I could</span> <span m="2502380">find was</span> <span m="2502760">15</span> <span m="2503140">bytes.</span> <span m="2503990">So it's</span> <span m="2504220">probably</span> <span m="2504510">good</span> <span m="2504660">enough.</span> <span m="2505598">Yeah?</span> </p>
<p><span m="2506096">AUDIENCE: Can</span> <span m="2506594">[INAUDIBLE]</span> <span m="2507092">be longer</span> <span m="2507590">than</span> <span m="2508088">[INAUDIBLE]</span> <span m="2509582">code,</span> <span m="2510080">they'd have</span> <span m="2510578">to have</span> <span m="2511574">a</span> <span m="2512072">alt instruction</span> <span m="2512570">at the beginning of</span> <span m="2513068">the</span> <span m="2513566">[INAUDIBLE]</span> <span m="2514064">so you can't</span> <span m="2514562">just jumpt</span> <span m="2515060">directly into</span> <span m="2515558">[INAUDIBLE]</span> <span m="2516056">and they also</span> <span m="2516554">need a</span> <span m="2517052">jump instruction</span> <span m="2517550">that</span> <span m="2518048">jumps to</span> <span m="2518546">another</span> <span m="2519044">[INAUDIBLE].</span> </p>
<p><span m="2520050">PROFESSOR: That's</span> <span m="2520130">right,</span> <span m="2520450">yeah.</span> <span m="2520580">So you have</span> <span m="2520750">to</span> <span m="2520830">be</span> <span m="2520920">able</span> <span m="2521130">to</span> <span m="2521270">fit</span> <span m="2521940">for the</span> <span m="2522220">entry</span> <span m="2522390">and exit</span> <span m="2523430">from</span> <span m="2523590">the process</span> <span m="2523970">service</span> <span m="2524280">runtime,</span> <span m="2524970">you</span> <span m="2525150">need to</span> <span m="2525300">be</span> <span m="2525520">able to</span> <span m="2525690">fit</span> <span m="2525860">some</span> <span m="2526200">nontrivial</span> <span m="2526850">amount of</span> <span m="2527170">code</span> <span m="2527580">in</span> <span m="2527700">a</span> <span m="2527750">single</span> <span m="2528370">32</span> <span m="2528720">byte</span> <span m="2529100">slot.</span> <span m="2529880">We'll</span> <span m="2530060">see</span> <span m="2530170">how</span> <span m="2530280">this</span> <span m="2530410">works</span> <span m="2530640">in</span> <span m="2530730">a</span> <span m="2530790">second.</span> <span m="2531340">Or</span> <span m="2531490">even</span> <span m="2531710">31</span> <span m="2532140">bytes</span> <span m="2532480">slot,</span> <span m="2532670">as</span> <span m="2532780">you are</span> <span m="2532940">pointing</span> <span m="2533270">out,</span> <span m="2533590">for</span> <span m="2534090">one</span> <span m="2534590">hold</span> <span m="2534820">instruction.</span> </p>
<p><span m="2537150">Should it</span> <span m="2537410">be</span> <span m="2537530">much</span> <span m="2537800">larger?</span> <span m="2538250">Should</span> <span m="2538410">we</span> <span m="2538640">make</span> <span m="2538940">it,</span> <span m="2539200">I don't</span> <span m="2539460">know,</span> <span m="2540600">a thousand</span> <span m="2541022">byte,</span> <span m="2541444">well,</span> <span m="2541866">10</span> <span m="2542290">24?</span> </p>
<p><span m="2542788">AUDIENCE: [INAUDIBLE]</span> <span m="2543784">sparse,</span> <span m="2544282">because</span> <span m="2544780">you have to</span> <span m="2545278">have</span> <span m="2545776">[INAUDIBLE].</span> </p>
<p><span m="2546780">PROFESSOR: Yeah,</span> <span m="2547220">so if</span> <span m="2547300">you</span> <span m="2547970">have</span> <span m="2548130">a</span> <span m="2548180">lot</span> <span m="2548410">of</span> <span m="2548480">function</span> <span m="2548860">pointers</span> <span m="2549450">or</span> <span m="2549680">lots</span> <span m="2550010">of</span> <span m="2550160">sort</span> <span m="2550300">of</span> <span m="2550370">indirect</span> <span m="2550810">jumps,</span> <span m="2551510">then</span> <span m="2552150">every</span> <span m="2552360">time</span> <span m="2552530">you</span> <span m="2552630">want</span> <span m="2552750">to</span> <span m="2553350">create</span> <span m="2553930">some</span> <span m="2554310">place</span> <span m="2554720">where</span> <span m="2554900">you're</span> <span m="2554990">going</span> <span m="2555100">to</span> <span m="2555190">jump</span> <span m="2555580">to,</span> <span m="2556160">you have</span> <span m="2556580">to</span> <span m="2556690">pad it</span> <span m="2557050">out</span> <span m="2557300">to</span> <span m="2557370">the</span> <span m="2557480">next</span> <span m="2557830">boundary</span> <span m="2558580">of</span> <span m="2558780">whatever</span> <span m="2559130">this</span> <span m="2559460">value</span> <span m="2559810">is.</span> <span m="2560530">So</span> <span m="2560640">with</span> <span m="2560720">32,</span> <span m="2561010">maybe</span> <span m="2561230">that's</span> <span m="2561590">OK.</span> <span m="2561830">You're</span> <span m="2562050">like</span> <span m="2562250">well,</span> <span m="2562490">worst</span> <span m="2562750">case,</span> <span m="2563030">you</span> <span m="2563130">waste</span> <span m="2563210">31</span> <span m="2563800">bytes,</span> <span m="2564740">because</span> <span m="2565100">you</span> <span m="2565250">just</span> <span m="2565490">need</span> <span m="2565630">to</span> <span m="2565750">fast</span> <span m="2566120">forward</span> <span m="2566400">to</span> <span m="2566460">the</span> <span m="2566540">next</span> <span m="2566750">boundary.</span> <span m="2567530">But</span> <span m="2567700">if</span> <span m="2567810">it's</span> <span m="2567990">a</span> <span m="2568040">multiple</span> <span m="2568440">of</span> <span m="2568500">1024,</span> <span m="2569790">then</span> <span m="2570730">all</span> <span m="2570870">of</span> <span m="2570930">a</span> <span m="2570980">sudden</span> <span m="2571180">you're</span> <span m="2571280">wasting a</span> <span m="2571650">kilobyte</span> <span m="2572080">of</span> <span m="2572170">memory</span> <span m="2572530">for an indirect</span> <span m="2573150">jump.</span> <span m="2574730">And</span> <span m="2575270">if</span> <span m="2575390">you</span> <span m="2575480">have</span> <span m="2576160">probably</span> <span m="2576940">short</span> <span m="2577300">functions</span> <span m="2577950">or</span> <span m="2578980">lots</span> <span m="2579190">of</span> <span m="2579260">function</span> <span m="2579580">pointers,</span> <span m="2580340">then this</span> <span m="2580870">might</span> <span m="2581030">actually</span> <span m="2581280">be</span> <span m="2581460">a</span> <span m="2581510">memory</span> <span m="2581750">overhead</span> <span m="2582150">all</span> <span m="2582340">of a</span> <span m="2582390">sudden,</span> <span m="2582620">as</span> <span m="2582710">well.</span> </p>
<p><span m="2584240">Does that</span> <span m="2584380">make</span> <span m="2584470">sense</span> <span m="2584940">roughly?</span> <span m="2585930">So yeah, I</span> <span m="2586040">think</span> <span m="2586260">the</span> <span m="2586390">32</span> <span m="2586860">is</span> <span m="2586990">not</span> <span m="2587350">set</span> <span m="2587640">in</span> <span m="2587820">stone.</span> <span m="2588330">Like</span> <span m="2588670">Native</span> <span m="2588960">Client</span> <span m="2589500">has</span> <span m="2589860">to</span> <span m="2589950">have</span> <span m="2590140">32</span> <span m="2590460">byte</span> <span m="2590760">blocks,</span> <span m="2591485">but</span> <span m="2591850">something</span> <span m="2592170">on</span> <span m="2592260">that</span> <span m="2592420">order</span> <span m="2592760">probably</span> <span m="2593040">works.</span> <span m="2593310">16</span> <span m="2593720">is</span> <span m="2593810">probably</span> <span m="2594060">a</span> <span m="2594110">little</span> <span m="2594410">short.</span> <span m="2595330">On</span> <span m="2595490">the</span> <span m="2595550">other</span> <span m="2595750">hand,</span> <span m="2596000">like</span> <span m="2596200">64</span> <span m="2596900">could</span> <span m="2597060">work.</span> <span m="2597580">128</span> <span m="2598230">maybe</span> <span m="2598410">is</span> <span m="2598530">getting</span> <span m="2598720">a</span> <span m="2598780">little</span> <span m="2599130">longish.</span> <span m="2601740">But</span> <span m="2602080">I</span> <span m="2602220">don't</span> <span m="2602370">think</span> <span m="2602610">you</span> <span m="2602680">could</span> <span m="2602940">derive</span> <span m="2603390">32</span> <span m="2603750">from</span> <span m="2603930">first</span> <span m="2604150">principles.</span> <span m="2606231">Makes</span> <span m="2606720">sense?</span> <span m="2608880">All</span> <span m="2608940">right.</span> </p>
<p><span m="2610090">So</span> <span m="2610200">let's</span> <span m="2610370">set a</span> <span m="2610530">plan</span> <span m="2610840">for</span> <span m="2611630">reliable</span> <span m="2612090">disassembly.</span> <span m="2613280">And</span> <span m="2614050">as</span> <span m="2614190">a</span> <span m="2614220">result,</span> <span m="2614920">the</span> <span m="2615450">compiler</span> <span m="2616070">has</span> <span m="2616230">to</span> <span m="2616320">be</span> <span m="2617150">a</span> <span m="2617200">little</span> <span m="2617350">bit</span> <span m="2617550">careful</span> <span m="2618030">when</span> <span m="2618210">it's</span> <span m="2619120">compiling</span> <span m="2619780">your</span> <span m="2619970">C or</span> <span m="2620370">C++</span> <span m="2620770">code</span> <span m="2621040">into</span> <span m="2621390">a</span> <span m="2621460">Native</span> <span m="2621750">Client</span> <span m="2622250">binary.</span> <span m="2622720">It has</span> <span m="2623080">to</span> <span m="2623180">basically</span> <span m="2623520">follow</span> <span m="2623800">these</span> <span m="2623990">rules.</span> <span m="2624300">So</span> <span m="2624350">whenever</span> <span m="2625150">it</span> <span m="2625650">has</span> <span m="2625830">a</span> <span m="2625970">jump,</span> <span m="2626340">it</span> <span m="2626470">has</span> <span m="2626660">to</span> <span m="2627200">add</span> <span m="2627590">those</span> <span m="2627760">extra</span> <span m="2628205">instruction</span> <span m="2628650">front.</span> <span m="2629640">And</span> <span m="2630350">whatever</span> <span m="2631390">it's</span> <span m="2632110">creating</span> <span m="2632740">a</span> <span m="2632800">function</span> <span m="2633175">that</span> <span m="2633550">it's</span> <span m="2633760">going</span> <span m="2633870">to</span> <span m="2633930">jump</span> <span m="2634250">to,</span> <span m="2634460">our</span> <span m="2634570">instruction</span> <span m="2634840">is going to</span> <span m="2635110">jump to, as</span> <span m="2635580">we're</span> <span m="2635750">talking</span> <span m="2635990">about,</span> <span m="2636380">it has</span> <span m="2636785">to pad it</span> <span m="2637190">out.</span> <span m="2638000">And</span> <span m="2638255">it</span> <span m="2638510">can't just</span> <span m="2638820">pad it out</span> <span m="2639230">with</span> <span m="2639630">zeros,</span> <span m="2640150">because</span> <span m="2641140">all</span> <span m="2641320">those</span> <span m="2641570">have</span> <span m="2641800">to</span> <span m="2641910">valid</span> <span m="2642180">up</span> <span m="2642450">codes.</span> <span m="2642590">So it</span> <span m="2642780">actually</span> <span m="2643010">has to</span> <span m="2643370">pad it out</span> <span m="2643630">with</span> <span m="2643890">[INAUDIBLE]</span> <span m="2644710">just</span> <span m="2644930">to</span> <span m="2644990">make</span> <span m="2645160">the</span> <span m="2645420">validator</span> <span m="2645730">happy,</span> <span m="2646535">just to make</span> <span m="2646910">sure that</span> <span m="2647200">every</span> <span m="2647570">possible</span> <span m="2647980">instruction</span> <span m="2648540">is</span> <span m="2648720">a valid one.</span> <span m="2649800">And</span> <span m="2649970">luckily</span> <span m="2650120">on</span> <span m="2650250">x86,</span> <span m="2650470">no op</span> <span m="2650950">is a</span> <span m="2651250">single</span> <span m="2651660">byte,</span> <span m="2652390">or</span> <span m="2652830">at least there</span> <span m="2653110">is</span> <span m="2653420">a no op--</span> <span m="2653980">that's</span> <span m="2654265">a</span> <span m="2654550">single</span> <span m="2654730">byte.</span> <span m="2654940">There's</span> <span m="2655060">many</span> <span m="2655390">no ops</span> <span m="2655745">on x86.</span> <span m="2657600">So</span> <span m="2657680">you</span> <span m="2657800">can</span> <span m="2658050">always</span> <span m="2658510">pad things out</span> <span m="2659355">to a</span> <span m="2659810">multiple</span> <span m="2660200">of</span> <span m="2660380">whatever</span> <span m="2660700">this</span> <span m="2661085">constant</span> <span m="2661470">is.</span> <span m="2662670">Make</span> <span m="2663070">sense?</span> </p>
<p><span m="2665040">All</span> <span m="2665120">right.</span> <span m="2666330">So</span> <span m="2667616">what does</span> <span m="2667990">this</span> <span m="2668410">guarantee</span> <span m="2668730">to</span> <span m="2668850">us?</span> <span m="2669030">I</span> <span m="2669070">guess</span> <span m="2670010">let's</span> <span m="2670130">make</span> <span m="2670310">sure</span> <span m="2670760">that</span> <span m="2670930">we</span> <span m="2671090">always</span> <span m="2671490">see</span> <span m="2672370">what</span> <span m="2672560">happens</span> <span m="2673120">in</span> <span m="2673260">terms</span> <span m="2673560">of</span> <span m="2673730">the</span> <span m="2673840">instructions</span> <span m="2674105">that</span> <span m="2674370">will</span> <span m="2674540">be</span> <span m="2674640">executed.</span> <span m="2675220">So</span> <span m="2675600">this</span> <span m="2675730">finally</span> <span m="2676240">gets</span> <span m="2676440">us</span> <span m="2676840">this</span> <span m="2677060">rule.</span> <span m="2677630">So</span> <span m="2678030">we</span> <span m="2678320">can</span> <span m="2678860">be</span> <span m="2678980">sure</span> <span m="2679420">there's</span> <span m="2679730">never</span> <span m="2680050">a</span> <span m="2680110">system</span> <span m="2680430">call being</span> <span m="2680840">issued.</span> <span m="2683280">What</span> <span m="2683420">about--</span> <span m="2684410">So</span> <span m="2684620">this is</span> <span m="2684870">for</span> <span m="2685080">jumps.</span> <span m="2685850">What about</span> <span m="2686290">returns?</span> <span m="2686700">How do</span> <span m="2686880">they deal</span> <span m="2687000">with the</span> <span m="2687270">returns?</span> <span m="2689570">Can</span> <span m="2689730">you</span> <span m="2690030">return</span> <span m="2690450">for a</span> <span m="2690670">function</span> <span m="2691025">in</span> <span m="2691380">Native</span> <span m="2691640">Client?</span> <span m="2692874">What would</span> <span m="2693361">happen if</span> <span m="2693848">you ran</span> <span m="2694335">into a</span> <span m="2694822">red hot</span> <span m="2695309">code?</span> <span m="2696770">Would that</span> <span m="2697257">be good?</span> <span m="2697744">Yeah?</span> </p>
<p><span m="2698231">AUDIENCE: [INAUDIBLE]</span> <span m="2699205">you</span> <span m="2699692">don't want</span> <span m="2700179">the--</span> <span m="2700666">[INAUDIBLE]</span> <span m="2701640">modifying</span> <span m="2702127">your</span> <span m="2702614">overall</span> <span m="2703101">[INAUDIBLE].</span> </p>
<p><span m="2704080">PROFESSOR: Well,</span> <span m="2704520">it's</span> <span m="2704850">true</span> <span m="2705070">that it</span> <span m="2705290">pops the</span> <span m="2705390">stack.</span> <span m="2706030">But</span> <span m="2707510">the</span> <span m="2707840">stack that</span> <span m="2708430">Native</span> <span m="2708740">Client</span> <span m="2709130">modules</span> <span m="2709510">use, it's</span> <span m="2709890">actually</span> <span m="2710250">just</span> <span m="2710780">some</span> <span m="2711020">data</span> <span m="2711340">inside</span> <span m="2711890">of</span> <span m="2712110">their</span> <span m="2712496">section.</span> <span m="2713270">So</span> <span m="2713930">you don't</span> <span m="2714320">actually</span> <span m="2714710">care--</span> <span m="2715600">the</span> <span m="2715700">Native Client</span> <span m="2716100">contact</span> <span m="2716360">doesn't</span> <span m="2716810">care</span> <span m="2717020">whether</span> <span m="2717330">those</span> <span m="2717420">guys</span> <span m="2717780">screws up their</span> <span m="2718240">stacks,</span> <span m="2718600">overflow</span> <span m="2719060">their stack,</span> <span m="2719310">or--</span> </p>
<p><span m="2719767">AUDIENCE: Wait,</span> <span m="2720224">but</span> <span m="2720681">you could put</span> <span m="2721138">anything</span> <span m="2721595">on the</span> <span m="2722052">stack.</span> <span m="2722509">And when you</span> <span m="2722966">[INAUDIBLE]</span> <span m="2723423">you jump</span> <span m="2723880">through that--</span> </p>
<p><span m="2724340">PROFESSOR: That's</span> <span m="2724630">true.</span> <span m="2725090">Yeah, so</span> <span m="2725230">return</span> <span m="2725630">is</span> <span m="2725720">almost</span> <span m="2726070">like</span> <span m="2726240">an indirect</span> <span m="2726680">jump from a</span> <span m="2727220">particular</span> <span m="2728370">weird</span> <span m="2728660">memory</span> <span m="2728900">location</span> <span m="2729160">that's at</span> <span m="2729420">the top of</span> <span m="2729510">the stack.</span> <span m="2730890">So</span> <span m="2731630">I</span> <span m="2731720">guess</span> <span m="2731930">one</span> <span m="2732090">thing</span> <span m="2732260">they</span> <span m="2732380">could</span> <span m="2732660">do</span> <span m="2732800">for</span> <span m="2732940">return</span> <span m="2733580">is</span> <span m="2733710">maybe</span> <span m="2734010">prefix</span> <span m="2734410">it with</span> <span m="2734630">a</span> <span m="2734690">similar</span> <span m="2735150">check,</span> <span m="2735530">where</span> <span m="2735780">maybe</span> <span m="2736000">like</span> <span m="2736270">pop the</span> <span m="2736530">top thing</span> <span m="2737040">of</span> <span m="2737200">the</span> <span m="2737290">stack.</span> <span m="2737800">You</span> <span m="2737950">check</span> <span m="2738190">whether</span> <span m="2738370">it's</span> <span m="2738560">valid,</span> <span m="2738940">and</span> <span m="2739150">then</span> <span m="2739320">you write,</span> <span m="2740080">or</span> <span m="2740460">you</span> <span m="2740640">somehow</span> <span m="2741010">do an</span> <span m="2741370">AND</span> <span m="2741740">to</span> <span m="2742110">a</span> <span m="2742520">memory</span> <span m="2742800">operand,</span> <span m="2743240">and that's</span> <span m="2743470">the top of</span> <span m="2743910">the stack.</span> </p>
<p><span m="2745360">It seems</span> <span m="2745420">a little</span> <span m="2746120">fragile,</span> <span m="2747990">partly</span> <span m="2748360">because</span> <span m="2748640">of</span> <span m="2748740">race</span> <span m="2748960">conditions.</span> <span m="2749440">Because</span> <span m="2749890">for</span> <span m="2749970">example,</span> <span m="2750360">if</span> <span m="2750460">you</span> <span m="2750560">look</span> <span m="2750640">at</span> <span m="2750680">the</span> <span m="2750760">top location</span> <span m="2751045">of the</span> <span m="2751330">stack,</span> <span m="2751550">you check</span> <span m="2751900">that it's</span> <span m="2752120">OK,</span> <span m="2753020">and</span> <span m="2753120">then you</span> <span m="2753190">do</span> <span m="2753460">a</span> <span m="2753550">write</span> <span m="2753770">later,</span> <span m="2755140">another</span> <span m="2755610">threat</span> <span m="2756060">in</span> <span m="2756150">the</span> <span m="2756250">same</span> <span m="2756650">module</span> <span m="2757110">could</span> <span m="2757330">modify</span> <span m="2757810">the thing</span> <span m="2758090">at the</span> <span m="2758470">top of the</span> <span m="2758570">stack.</span> <span m="2759710">And</span> <span m="2760060">then</span> <span m="2760250">you'd</span> <span m="2760440">be</span> <span m="2760630">referring</span> <span m="2761070">to</span> <span m="2761270">that</span> <span m="2761470">address.</span> </p>
<p><span m="2762640">AUDIENCE: Would this</span> <span m="2763030">not be</span> <span m="2763355">the case</span> <span m="2763680">for the</span> <span m="2764090">jumps</span> <span m="2764290">as</span> <span m="2764500">well?</span> </p>
<p><span m="2765100">PROFESSOR: Yeah,</span> <span m="2765290">so</span> <span m="2765420">what happens</span> <span m="2765500">with</span> <span m="2765850">the</span> <span m="2766060">jump?</span> <span m="2766390">Could</span> <span m="2766530">our</span> <span m="2766660">race</span> <span m="2766910">conditions</span> <span m="2767180">somehow</span> <span m="2767710">invalidate</span> <span m="2768460">this</span> <span m="2768760">check?</span> <span m="2771826">Yeah?</span> </p>
<p><span m="2772292">AUDIENCE: The</span> <span m="2772758">code is not</span> <span m="2773224">writable.</span> </p>
<p><span m="2774160">PROFESSOR: Well</span> <span m="2774500">the</span> <span m="2774620">code</span> <span m="2774830">is</span> <span m="2774940">not</span> <span m="2775030">writable,</span> <span m="2775510">that's true. So you</span> <span m="2775780">can't</span> <span m="2775990">modify</span> <span m="2776380">the</span> <span m="2776540">AND.</span> <span m="2777475">But</span> <span m="2777870">could</span> <span m="2778000">another</span> <span m="2778340">thread</span> <span m="2779250">modify</span> <span m="2779770">this</span> <span m="2779990">jump</span> <span m="2780310">target</span> <span m="2781250">in</span> <span m="2781430">between</span> <span m="2781770">these</span> <span m="2781970">two</span> <span m="2782070">instructions?</span> <span m="2783350">Yeah?</span> </p>
<p><span m="2783850">AUDIENCE: It's in a register,</span> <span m="2784350">so--</span> </p>
<p><span m="2785350">PROFESSOR: Yeah,</span> <span m="2785665">that's</span> <span m="2785980">the</span> <span m="2786360">cool thing.</span> <span m="2786850">There</span> <span m="2786930">is</span> <span m="2787410">basically--</span> <span m="2788310">if</span> <span m="2788380">it</span> <span m="2788630">modifies</span> <span m="2789080">it</span> <span m="2789270">in</span> <span m="2789430">memory</span> <span m="2789880">or where ever</span> <span m="2790195">it</span> <span m="2790510">loaded</span> <span m="2790980">into</span> <span m="2791235">EAX</span> <span m="2791490">from,</span> <span m="2792170">sure,</span> <span m="2792520">you do it</span> <span m="2792980">before you</span> <span m="2793275">load,</span> <span m="2793570">in</span> <span m="2793630">which</span> <span m="2793780">case</span> <span m="2793980">this</span> <span m="2794080">EX</span> <span m="2794300">will</span> <span m="2794600">be</span> <span m="2795020">bad,</span> <span m="2795360">but then</span> <span m="2795590">will</span> <span m="2795780">clear</span> <span m="2796040">the bad</span> <span m="2796390">bits.</span> <span m="2796990">Or</span> <span m="2797370">it could</span> <span m="2797770">modify it</span> <span m="2797970">after, at</span> <span m="2798390">which</span> <span m="2798600">point</span> <span m="2798990">it's</span> <span m="2799450">already in the</span> <span m="2799880">EX, so</span> <span m="2800130">it</span> <span m="2800210">doesn't</span> <span m="2800450">matter</span> <span m="2801030">that</span> <span m="2801160">it's</span> <span m="2801690">modifying</span> <span m="2802140">the</span> <span m="2802250">memory</span> <span m="2802950">location</span> <span m="2803460">from</span> <span m="2803720">which</span> <span m="2803920">the</span> <span m="2804170">EX</span> <span m="2804630">register</span> <span m="2805020">was</span> <span m="2805440">loaded.</span> <span m="2807130">And</span> <span m="2808030">threads</span> <span m="2808470">don't</span> <span m="2808670">actually</span> <span m="2808950">share the</span> <span m="2809300">register</span> <span m="2809790">sets.</span> <span m="2810530">So if</span> <span m="2810820">another</span> <span m="2811150">thread</span> <span m="2811500">modifies</span> <span m="2811765">the</span> <span m="2812230">EX</span> <span m="2812570">register,</span> <span m="2812650">it will</span> <span m="2812890">not</span> <span m="2813130">affect</span> <span m="2813550">this</span> <span m="2813680">thread's</span> <span m="2814030">EX</span> <span m="2814370">register.</span> <span m="2815210">So</span> <span m="2815770">this</span> <span m="2816020">instruction</span> <span m="2816530">actually</span> <span m="2817050">is</span> <span m="2817700">sort of</span> <span m="2817860">race-proof</span> <span m="2818440">in</span> <span m="2818560">some</span> <span m="2818730">sense.</span> <span m="2819050">Other</span> <span m="2819280">threads</span> <span m="2819700">can't</span> <span m="2820000">invalidate</span> <span m="2821420">this</span> <span m="2821930">instruction</span> <span m="2822410">sequence.</span> <span m="2823766">Make sense?</span> <span m="2826930">All</span> <span m="2826980">right.</span> </p>
<p><span m="2828490">So</span> <span m="2828590">here's</span> <span m="2828790">another</span> <span m="2829090">interesting</span> <span m="2829300">question.</span> <span m="2831750">Could</span> <span m="2831990">we</span> <span m="2832300">bypass</span> <span m="2832785">this</span> <span m="2833680">AND?</span> <span m="2834370">I can</span> <span m="2834670">jump around</span> <span m="2834960">in</span> <span m="2835190">this</span> <span m="2835290">address</span> <span m="2835560">space</span> <span m="2835830">all</span> <span m="2835990">I want.</span> <span m="2836760">And</span> <span m="2837060">when</span> <span m="2837220">I'm</span> <span m="2837440">disassembling</span> <span m="2838000">this</span> <span m="2838120">instruction,</span> <span m="2839080">this</span> <span m="2839190">seems</span> <span m="2839400">like</span> <span m="2839580">a</span> <span m="2839660">perfectly</span> <span m="2840100">fine</span> <span m="2840470">parallel</span> <span m="2840760">instruction,</span> <span m="2841045">an</span> <span m="2841330">AND</span> <span m="2841990">and</span> <span m="2842360">a</span> <span m="2842460">jump.</span> <span m="2844680">And</span> <span m="2845940">the</span> <span m="2846200">check</span> <span m="2846520">for</span> <span m="2847630">static</span> <span m="2848210">jumps</span> <span m="2849190">is</span> <span m="2849590">that,</span> <span m="2849900">well,</span> <span m="2850155">it</span> <span m="2850410">just</span> <span m="2850530">has</span> <span m="2850710">to</span> <span m="2850820">point</span> <span m="2851370">to</span> <span m="2851510">some</span> <span m="2851740">target</span> <span m="2852010">that</span> <span m="2852080">was</span> <span m="2852170">seen.</span> <span m="2852650">So</span> <span m="2853530">yeah,</span> <span m="2853900">we saw</span> <span m="2854140">an AND. That's</span> <span m="2854230">one</span> <span m="2854430">instruction</span> <span m="2854860">that's valid.</span> <span m="2855360">We</span> <span m="2855560">saw</span> <span m="2855660">a</span> <span m="2855810">jump,</span> <span m="2856070">that's</span> <span m="2856330">another</span> <span m="2856530">valid</span> <span m="2856880">instruction.</span> </p>
<p><span m="2857980">So</span> <span m="2858080">when</span> <span m="2858090">I</span> <span m="2858160">see</span> <span m="2858390">a</span> <span m="2858460">direct</span> <span m="2858840">jump</span> <span m="2859420">up</span> <span m="2859600">here,</span> <span m="2859950">maybe</span> <span m="2860265">I</span> <span m="2861130">jump to</span> <span m="2861580">some</span> <span m="2861700">address.</span> <span m="2862280">I don't</span> <span m="2862730">know,</span> <span m="2863180">one, two,</span> <span m="2863630">three,</span> <span m="2864460">seven.</span> <span m="2866530">That's</span> <span m="2866650">actually</span> <span m="2867110">OK,</span> <span m="2867710">even</span> <span m="2867910">though</span> <span m="2867980">it's not</span> <span m="2868160">a</span> <span m="2868380">multiple</span> <span m="2868730">of</span> <span m="2868850">32.</span> <span m="2869542">Native</span> <span m="2869890">Client</span> <span m="2870590">doesn't</span> <span m="2870960">generally</span> <span m="2871320">allow</span> <span m="2872610">direct</span> <span m="2873010">jumps to</span> <span m="2873350">arbitrary</span> <span m="2873860">addresses,</span> <span m="2874750">as</span> <span m="2874860">long</span> <span m="2875190">as</span> <span m="2875290">that</span> <span m="2875420">address</span> <span m="2876690">is</span> <span m="2876880">a</span> <span m="2877260">instruction</span> <span m="2877740">that</span> <span m="2877850">we</span> <span m="2877950">saw</span> <span m="2878070">during disassembly,</span> <span m="2878420">as we</span> <span m="2878920">were</span> <span m="2879070">just</span> <span m="2879220">talking</span> <span m="2879440">about.</span> <span m="2881370">So</span> <span m="2881470">could</span> <span m="2881710">I</span> <span m="2882780">put in</span> <span m="2883060">this</span> <span m="2883260">very</span> <span m="2883460">nicely</span> <span m="2883890">checked</span> <span m="2884580">indirect</span> <span m="2885040">jump,</span> <span m="2885600">and then</span> <span m="2886040">later</span> <span m="2886390">on in</span> <span m="2886630">the</span> <span m="2886790">code</span> <span m="2887310">jump</span> <span m="2888100">to</span> <span m="2888550">the</span> <span m="2889270">second</span> <span m="2889870">instruction</span> <span m="2890270">in</span> <span m="2890670">that</span> <span m="2890830">sequence?</span> <span m="2892220">So</span> <span m="2892300">then</span> <span m="2892510">I'll</span> <span m="2892960">load</span> <span m="2893290">something into</span> <span m="2893660">EX,</span> <span m="2894210">jump</span> <span m="2894490">here,</span> <span m="2894990">and</span> <span m="2895100">then</span> <span m="2895190">directly</span> <span m="2895580">jump</span> <span m="2895850">into</span> <span m="2896030">this</span> <span m="2896700">unsandboxed</span> <span m="2897430">address.</span> <span m="2900660">That will</span> <span m="2901160">violate</span> <span m="2901330">the</span> <span m="2901690">security,</span> <span m="2901920">right?</span> <span m="2902190">Does</span> <span m="2902400">everyone</span> <span m="2902570">see</span> <span m="2902700">that?</span> <span m="2903100">So</span> <span m="2903210">how</span> <span m="2903480">is this</span> <span m="2903800">avoided?</span> </p>
<p><span m="2904120">AUDIENCE: Well,</span> <span m="2904604">the NaCl</span> <span m="2905088">[INAUDIBLE]</span> <span m="2906056">and the</span> <span m="2906540">jump</span> <span m="2907024">has to</span> <span m="2907508">signal</span> <span m="2907992">instruction.</span> </p>
<p><span m="2908480">PROFESSOR: Yeah,</span> <span m="2908730">so</span> <span m="2908940">this is</span> <span m="2909240">why</span> <span m="2909410">they</span> <span m="2909630">call</span> <span m="2909980">this</span> <span m="2910190">thing a</span> <span m="2910690">single</span> <span m="2911450">pseudo</span> <span m="2911850">instruction.</span> <span m="2914510">And</span> <span m="2915110">even though</span> <span m="2915560">at the</span> <span m="2915890">x86</span> <span m="2916390">level,</span> <span m="2916660">they're</span> <span m="2916800">actually</span> <span m="2917040">distinct</span> <span m="2917460">instruction,</span> <span m="2918350">as</span> <span m="2918470">far</span> <span m="2918620">as</span> <span m="2918730">the</span> <span m="2918850">NaCl</span> <span m="2919180">validator</span> <span m="2919900">thinks</span> <span m="2920280">of</span> <span m="2920400">it,</span> <span m="2920760">it's</span> <span m="2920850">actually</span> <span m="2921150">a</span> <span m="2921210">single</span> <span m="2921710">atomic</span> <span m="2922210">unit.</span> <span m="2922980">So</span> <span m="2923590">as</span> <span m="2923710">far</span> <span m="2923940">as</span> <span m="2924080">this</span> <span m="2924380">check</span> <span m="2924730">for</span> <span m="2925070">whether</span> <span m="2925300">it's</span> <span m="2925440">an</span> <span m="2925810">instruction</span> <span m="2926080">that</span> <span m="2926440">you</span> <span m="2926520">saw</span> <span m="2926740">before,</span> <span m="2927420">they</span> <span m="2927530">think,</span> <span m="2927760">oh,</span> <span m="2927960">this is the</span> <span m="2928350">only</span> <span m="2928620">instruction</span> <span m="2929090">that I</span> <span m="2929220">saw</span> <span m="2929370">before.</span> <span m="2929730">Jumping</span> <span m="2930060">in</span> <span m="2930140">the</span> <span m="2930210">middle</span> <span m="2930650">is</span> <span m="2930910">like</span> <span m="2931080">jumping</span> <span m="2931400">in</span> <span m="2931470">the</span> <span m="2931540">middle</span> <span m="2932090">of</span> <span m="2932710">this</span> <span m="2932950">guy.</span> <span m="2933565">It's</span> <span m="2933880">the</span> <span m="2934000">same</span> <span m="2934320">thing.</span> <span m="2935020">So</span> <span m="2935320">they</span> <span m="2935570">basically</span> <span m="2936450">enforce</span> <span m="2936910">slightly</span> <span m="2937460">different</span> <span m="2937790">semantics</span> <span m="2938360">than</span> <span m="2938610">what</span> <span m="2939240">x86</span> <span m="2939870">enforces</span> <span m="2940345">in</span> <span m="2940690">terms of</span> <span m="2940970">what an instruction</span> <span m="2941360">is.</span> </p>
<p><span m="2942640">And</span> <span m="2943280">this</span> <span m="2943820">might</span> <span m="2944190">actually</span> <span m="2944730">mean</span> <span m="2944850">that</span> <span m="2945320">you</span> <span m="2945590">can</span> <span m="2946060">represent</span> <span m="2946560">certain</span> <span m="2946840">instruction</span> <span m="2947340">sequences</span> <span m="2948280">in</span> <span m="2948500">NaCl.</span> <span m="2949580">So</span> <span m="2950530">if</span> <span m="2950950">you</span> <span m="2951130">actually</span> <span m="2951400">had</span> <span m="2951810">legitimate</span> <span m="2952080">code that</span> <span m="2952430">looked</span> <span m="2952640">like</span> <span m="2952820">this</span> <span m="2952990">before,</span> <span m="2954123">this</span> <span m="2954476">is</span> <span m="2954910">going</span> <span m="2955030">to</span> <span m="2955070">be</span> <span m="2955210">turned</span> <span m="2955550">into</span> <span m="2956180">a</span> <span m="2956270">single</span> <span m="2956640">out code</span> <span m="2956915">in</span> <span m="2957190">NaCl.</span> <span m="2958090">But</span> <span m="2958455">hopefully that's</span> <span m="2959100">not</span> <span m="2959270">a problem.</span> <span m="2959460">Yeah?</span> </p>
<p><span m="2960190">AUDIENCE: Presumably</span> <span m="2960400">they</span> <span m="2960740">can out</span> <span m="2961075">that</span> <span m="2961710">in the</span> <span m="2962010">trusted</span> <span m="2962410">code base</span> <span m="2963050">in the</span> <span m="2963430">start</span> <span m="2964050">of</span> <span m="2964230">the</span> <span m="2964800">text</span> <span m="2965140">segment.</span> <span m="2967040">Because</span> <span m="2967250">that</span> <span m="2967525">way,</span> <span m="2967800">you will</span> <span m="2968095">always</span> <span m="2968970">replace</span> <span m="2969820">those</span> <span m="2970190">two.</span> <span m="2970840">Instead</span> <span m="2971140">of</span> <span m="2971330">putting</span> <span m="2971610">those</span> <span m="2971950">in</span> <span m="2972090">the</span> <span m="2972160">binary</span> <span m="2972540">that you</span> <span m="2972990">produce</span> <span m="2973290">anyway,  you</span> <span m="2973590">just</span> <span m="2973830">jump</span> <span m="2974250">straight</span> <span m="2974500">to that</span> <span m="2974993">jump</span> <span m="2975486">target</span> <span m="2975980">that's</span> <span m="2976290">in the privileged</span> <span m="2976600">section.</span> </p>
<p><span m="2978180">PROFESSOR: In</span> <span m="2978520">the</span> <span m="2978680">trusted</span> <span m="2979030">runtime, you</span> <span m="2979410">mean or something?</span> </p>
<p><span m="2980170">AUDIENCE: No,</span> <span m="2980550">so</span> <span m="2980910">in the</span> <span m="2981270">first</span> <span m="2981480">64</span> <span m="2981785">K--</span> </p>
<p><span m="2982994">PROFESSOR: Yeah, they had</span> <span m="2983446">these</span> <span m="2983898">trampolines</span> <span m="2984350">and yeah--</span> </p>
<p><span m="2984910">AUDIENCE: So</span> <span m="2985100">they</span> <span m="2985260">can make</span> <span m="2985580">that one</span> <span m="2985900">of the</span> <span m="2986090">trampolines.</span> <span m="2986420">Except</span> <span m="2986750">that it</span> <span m="2987160">doesn't</span> <span m="2987570">jump</span> <span m="2987820">out.</span> <span m="2988156">It jumps</span> <span m="2988492">back in.</span> </p>
<p><span m="2989636">PROFESSOR: Right.</span> </p>
<p><span m="2990040">AUDIENCE: So that</span> <span m="2990300">way,</span> <span m="2991540">it wouldn't</span> <span m="2992300">need to be a</span> <span m="2992670">super instruction.</span> <span m="2993152">It would</span> <span m="2993634">just be</span> <span m="2994116">a</span> <span m="2994600">single</span> <span m="2995065">x86</span> <span m="2995530">jump</span> <span m="2996360">into</span> <span m="2996760">there,</span> <span m="2997210">which would</span> <span m="2997620">then</span> <span m="2998030">jump out</span> <span m="2998440">again.</span> </p>
<p><span m="2999000">PROFESSOR: That's true,</span> <span m="2999250">yeah.</span> <span m="2999380">That's</span> <span m="2999730">another</span> <span m="2999960">sort of</span> <span m="3000290">clever</span> <span m="3000720">solution</span> <span m="3001190">that</span> <span m="3001340">you</span> <span m="3001520">could</span> <span m="3001730">do,</span> <span m="3001940">is</span> <span m="3002610">instead</span> <span m="3003120">for the</span> <span m="3003290">deliverance</span> <span m="3003710">of</span> <span m="3003790">[INAUDIBLE]</span> <span m="3004710">so</span> <span m="3005170">suppose</span> <span m="3005500">that</span> <span m="3005730">you</span> <span m="3006130">didn't</span> <span m="3006330">want to</span> <span m="3006788">do this</span> <span m="3007246">pseudo instruction</span> <span m="3007704">trick,</span> <span m="3009080">and</span> <span m="3009440">you</span> <span m="3009540">just</span> <span m="3009740">wanted</span> <span m="3010070">to</span> <span m="3010710">have</span> <span m="3010930">a</span> <span m="3011030">single</span> <span m="3012170">instruction</span> <span m="3012920">replacing</span> <span m="3013560">the</span> <span m="3013670">jump</span> <span m="3014120">EAX.</span> <span m="3014950">Well,</span> <span m="3015140">what you can</span> <span m="3015380">basically</span> <span m="3015730">come</span> <span m="3015930">up</span> <span m="3016090">with</span> <span m="3016400">is</span> <span m="3016520">a</span> <span m="3016610">library</span> <span m="3017230">of</span> <span m="3017360">all</span> <span m="3017650">possible indirect</span> <span m="3018430">jumps</span> <span m="3018630">you can</span> <span m="3018880">ever</span> <span m="3019100">do.</span> <span m="3019710">So like</span> <span m="3019980">well,</span> <span m="3020300">there is</span> <span m="3020420">jump</span> <span m="3020872">EAX,</span> <span m="3022350">there's</span> <span m="3023170">jump</span> <span m="3023240">EBX,</span> <span m="3024720">and</span> <span m="3025220">so</span> <span m="3025530">on.</span> <span m="3026410">And you</span> <span m="3026830">would</span> <span m="3026970">construct</span> <span m="3027400">a library</span> <span m="3027870">of</span> <span m="3027950">these</span> <span m="3028150">guys</span> <span m="3028460">for</span> <span m="3028620">each</span> <span m="3028760">of</span> <span m="3028870">them,</span> <span m="3029250">you would</span> <span m="3029510">construct</span> <span m="3030150">the</span> <span m="3030360">safe</span> <span m="3030900">check</span> <span m="3031220">that you'd</span> <span m="3031310">want to</span> <span m="3031460">replace</span> <span m="3031970">them</span> <span m="3032150">with.</span> <span m="3032750">So</span> <span m="3033010">for</span> <span m="3033270">this one,</span> <span m="3034140">you'd</span> <span m="3034410">put</span> <span m="3034685">an</span> <span m="3034960">AND in front of it,</span> <span m="3035420">and</span> <span m="3035680">so</span> <span m="3035790">on.</span> <span m="3036040">And for this one,</span> <span m="3037010">you'll also put</span> <span m="3037495">an</span> <span m="3037980">AND in front</span> <span m="3038400">of it, and</span> <span m="3038480">so on.</span> </p>
<p><span m="3039262">And then</span> <span m="3039704">in the</span> <span m="3041030">compiled</span> <span m="3041790">binary,</span> <span m="3043040">every</span> <span m="3043280">time</span> <span m="3043470">you</span> <span m="3043570">want</span> <span m="3043770">to</span> <span m="3043890">jump</span> <span m="3044140">to</span> <span m="3044220">EAX,</span> <span m="3044870">what  you</span> <span m="3045080">actually</span> <span m="3045470">do,</span> <span m="3045830">is</span> <span m="3045940">actually</span> <span m="3046560">jump</span> <span m="3047200">to</span> <span m="3047470">a</span> <span m="3047520">fixed</span> <span m="3048020">address</span> <span m="3048690">that</span> <span m="3049060">corresponds</span> <span m="3050050">to</span> <span m="3050180">this</span> <span m="3050830">helpful</span> <span m="3051310">piece</span> <span m="3051450">of</span> <span m="3051560">code</span> <span m="3051870">stored</span> <span m="3052190">somewhere</span> <span m="3052670">in that low</span> <span m="3053120">64</span> <span m="3053650">k</span> <span m="3053900">of the</span> <span m="3054285">program.</span> <span m="3055490">And</span> <span m="3055620">then</span> <span m="3056420">this guy</span> <span m="3056650">will</span> <span m="3056935">do</span> <span m="3057220">the AND</span> <span m="3057620">and</span> <span m="3058020">jump</span> <span m="3058220">again.</span> <span m="3059660">The</span> <span m="3059760">reason</span> <span m="3060040">that</span> <span m="3060390">they</span> <span m="3060530">probably</span> <span m="3060840">don't</span> <span m="3061080">do</span> <span m="3061160">this</span> <span m="3061460">is</span> <span m="3061970">performance</span> <span m="3062660">for</span> <span m="3062800">this</span> <span m="3063370">sort</span> <span m="3063460">of</span> <span m="3063530">interesting</span> <span m="3063830">reason.</span> </p>
<p><span m="3064450">So</span> <span m="3064550">that</span> <span m="3065640">Intel</span> <span m="3066140">processor,</span> <span m="3067010">actually</span> <span m="3067160">most</span> <span m="3067390">processors</span> <span m="3067675">these</span> <span m="3067960">days,</span> <span m="3069380">have</span> <span m="3071100">to</span> <span m="3071230">predict</span> <span m="3071620">where</span> <span m="3071720">the</span> <span m="3071850">branch</span> <span m="3072240">goes</span> <span m="3072680">to</span> <span m="3073320">keep</span> <span m="3073530">the</span> <span m="3073700">pipeline</span> <span m="3074170">of</span> <span m="3074240">the</span> <span m="3074330">processor</span> <span m="3074830">full at</span> <span m="3075330">all</span> <span m="3075580">times.</span> <span m="3076170">It's one of the</span> <span m="3076600">really</span> <span m="3076900">complicated</span> <span m="3077400">branch</span> <span m="3077660">predictor</span> <span m="3078150">that  not</span> <span m="3078370">only</span> <span m="3078690">decides</span> <span m="3079110">whether</span> <span m="3079460">you're going to</span> <span m="3079610">branch</span> <span m="3079865">or</span> <span m="3080120">not,</span> <span m="3080395">like</span> <span m="3080670">if</span> <span m="3080890">statements.</span> <span m="3081740">But</span> <span m="3081840">also</span> <span m="3082020">actually</span> <span m="3082710">guesses</span> <span m="3083060">where</span> <span m="3083410">you're</span> <span m="3083570">going</span> <span m="3083690">to</span> <span m="3083770">jump.</span> <span m="3084160">So if</span> <span m="3084300">you see</span> <span m="3084730">an indirect</span> <span m="3085170">jump, it</span> <span m="3085230">actually is</span> <span m="3085610">going</span> <span m="3085770">to</span> <span m="3085820">guess</span> <span m="3086510">what</span> <span m="3086650">the</span> <span m="3086900">address is</span> <span m="3087120">going</span> <span m="3087220">to</span> <span m="3087290">be.</span> <span m="3087880">And</span> <span m="3088170">this is</span> <span m="3088350">actually</span> <span m="3088710">a guess that's</span> <span m="3089110">stored</span> <span m="3089830">per cache</span> <span m="3090150">line</span> <span m="3090690">stored</span> <span m="3091100">in</span> <span m="3091230">the</span> <span m="3091400">jump</span> <span m="3091680">instruction.</span> </p>
<p><span m="3092720">So if</span> <span m="3093160">you</span> <span m="3093390">have</span> <span m="3093620">a</span> <span m="3093680">single</span> <span m="3094120">place</span> <span m="3094380">where</span> <span m="3094540">all</span> <span m="3094630">the</span> <span m="3094750">jump</span> <span m="3094980">EAXs</span> <span m="3095240">come from,</span> <span m="3096130">then the</span> <span m="3096390">CPU is</span> <span m="3096840">always going</span> <span m="3097320">to</span> <span m="3097370">be</span> <span m="3097450">very</span> <span m="3097650">confused.</span> <span m="3098120">Because</span> <span m="3098290">these</span> <span m="3098430">jump</span> <span m="3098790">EAXs</span> <span m="3099060">seem to</span> <span m="3099210">be going</span> <span m="3099520">all</span> <span m="3099830">over</span> <span m="3099950">the</span> <span m="3100060">place,</span> <span m="3100250">everywhere.</span> <span m="3101080">Where as if </span> <span m="3101400">we</span> <span m="3101670">are</span> <span m="3101690">really</span> <span m="3102070">tied</span> <span m="3102380">to a</span> <span m="3102490">particular</span> <span m="3103020">jump</span> <span m="3103170">instruction,</span> <span m="3103475">it</span> <span m="3103780">would</span> <span m="3103890">be</span> <span m="3104070">a</span> <span m="3104130">better</span> <span m="3104450">prediction.</span> <span m="3105215">That's just</span> <span m="3105480">a</span> <span m="3106160">performance</span> <span m="3106750">trick</span> <span m="3107143">that they</span> <span m="3107536">play.</span> <span m="3108680">Make sense?</span> <span m="3111760">All</span> <span m="3111850">right.</span> </p>
<p><span m="3112860">So</span> <span m="3113660">I</span> <span m="3114030">guess</span> <span m="3114770">we</span> <span m="3115160">roughly</span> <span m="3115610">understand</span> <span m="3116060">how</span> <span m="3116280">it's</span> <span m="3116610">going to</span> <span m="3116940">disassemble</span> <span m="3117220">all of these</span> <span m="3117710">instructions</span> <span m="3118095">how</span> <span m="3118480">it's going</span> <span m="3118830">to</span> <span m="3119180">prevent these</span> <span m="3119700">instructions.</span> <span m="3120830">So now</span> <span m="3120950">let's</span> <span m="3121310">look</span> <span m="3121490">at</span> <span m="3122190">the</span> <span m="3122600">set</span> <span m="3122890">of</span> <span m="3123040">rules</span> <span m="3123440">they</span> <span m="3123940">are going</span> <span m="3124293">to enforce</span> <span m="3125000">through</span> <span m="3125270">this</span> <span m="3125510">table in</span> <span m="3125825">the</span> <span m="3126140">paper,</span> <span m="3127040">table</span> <span m="3127490">one.</span> <span m="3128560">And it</span> <span m="3128600">has</span> <span m="3128880">all these</span> <span m="3129245">different</span> <span m="3129610">rules</span> <span m="3130570">for</span> <span m="3130750">the</span> <span m="3131340">validator</span> <span m="3132880">to</span> <span m="3133420">follow,</span> <span m="3133695">or</span> <span m="3133970">that</span> <span m="3134430">the binaries</span> <span m="3134580">have to</span> <span m="3135290">follow and the</span> <span m="3135610">validator</span> <span m="3135910">checks.</span> <span m="3137010">So I'll</span> <span m="3137410">go through these rules and just</span> <span m="3137780">double</span> <span m="3138280">check</span> <span m="3138540">that we</span> <span m="3139015">understand</span> <span m="3139490">why</span> <span m="3140190">all</span> <span m="3140410">these</span> <span m="3140610">rules</span> <span m="3140830">are</span> <span m="3140920">there.</span> <span m="3141350">So</span> <span m="3141920">we</span> <span m="3142120">have</span> <span m="3142270">these</span> <span m="3142530">things,</span> <span m="3143070">C1,</span> <span m="3143980">all the</span> <span m="3144450">way</span> <span m="3144830">to</span> <span m="3147240">C7.</span> <span m="3148510">So</span> <span m="3148720">C1</span> <span m="3149480">basically</span> <span m="3149850">says</span> <span m="3150180">that</span> <span m="3150770">once</span> <span m="3151090">you</span> <span m="3151560">load the</span> <span m="3152020">binary</span> <span m="3152360">memory,</span> <span m="3152700">then the</span> <span m="3153040">binary</span> <span m="3153940">is</span> <span m="3154320">actually</span> <span m="3154600">not</span> <span m="3155380">writable</span> <span m="3157800">at the</span> <span m="3158260">page table</span> <span m="3158720">level.</span> <span m="3160100">So they</span> <span m="3160790">set</span> <span m="3160980">the</span> <span m="3161100">permission</span> <span m="3161480">bits</span> <span m="3161710">for</span> <span m="3162060">the</span> <span m="3162410">binary</span> <span m="3162630">can be non-writable.</span> <span m="3163650">So</span> <span m="3164000">why?</span> <span m="3165640">It should be</span> <span m="3166110">fairly obvious</span> <span m="3166580">hopefully.</span> </p>
<p><span m="3169870">The</span> <span m="3170220">reason</span> <span m="3170460">is</span> <span m="3170560">that</span> <span m="3171020">their</span> <span m="3171140">whole</span> <span m="3171560">security</span> <span m="3172020">plan</span> <span m="3172370">relies</span> <span m="3173000">on</span> <span m="3173250">them</span> <span m="3173930">checking</span> <span m="3174410">that</span> <span m="3174520">your binary</span> <span m="3175080">is</span> <span m="3175230">correct.</span> <span m="3176170">So</span> <span m="3176260">once they've</span> <span m="3176740">checked it,</span> <span m="3177080">they</span> <span m="3177160">want</span> <span m="3177290">to</span> <span m="3177330">make</span> <span m="3177510">sure</span> <span m="3177720">you</span> <span m="3177840">can't</span> <span m="3178410">modify</span> <span m="3178780">the</span> <span m="3178890">binary</span> <span m="3179300">and</span> <span m="3179450">have it</span> <span m="3179740">do</span> <span m="3179870">something</span> <span m="3180260">illegal</span> <span m="3180600">that</span> <span m="3180940">they</span> <span m="3181610">prohibited.</span> <span m="3182680">So</span> <span m="3183040">this is</span> <span m="3183400">I think</span> <span m="3184040">reasonably</span> <span m="3184630">clear</span> <span m="3184900">then.</span> </p>
<p><span m="3185870">So</span> <span m="3186470">C2</span> <span m="3187110">is</span> <span m="3187553">their plan</span> <span m="3187996">that basically</span> <span m="3188882">has to</span> <span m="3189770">linked</span> <span m="3190810">at</span> <span m="3191350">zero</span> <span m="3191830">at</span> <span m="3192310">start</span> <span m="3194020">at</span> <span m="3194340">64 K.</span> <span m="3195840">So</span> <span m="3195890">this</span> <span m="3196270">requirement,</span> <span m="3196890">I</span> <span m="3196970">think</span> <span m="3198120">doesn't actually</span> <span m="3198230">have</span> <span m="3198400">to</span> <span m="3198500">do</span> <span m="3198630">with</span> <span m="3198900">security</span> <span m="3199390">so</span> <span m="3199580">much.</span> <span m="3199880">I</span> <span m="3199930">think</span> <span m="3200070">it's</span> <span m="3200210">just</span> <span m="3200390">for</span> <span m="3200540">convenience,</span> <span m="3201110">because</span> <span m="3201360">they</span> <span m="3201460">just</span> <span m="3201650">want</span> <span m="3201760">to</span> <span m="3201800">have</span> <span m="3201970">a</span> <span m="3202040">standard</span> <span m="3203000">layout</span> <span m="3203570">for</span> <span m="3203720">the</span> <span m="3203840">program.</span> <span m="3205190">In</span> <span m="3205330">some</span> <span m="3205520">sense,</span> <span m="3205820">it's</span> <span m="3206030">for</span> <span m="3206220">simplicity</span> <span m="3207440">so</span> <span m="3207740">that they</span> <span m="3207900">don't</span> <span m="3208110">have</span> <span m="3208300">to</span> <span m="3208655">deal</span> <span m="3209010">with complicated</span> <span m="3209300">relocation</span> <span m="3209950">records,</span> <span m="3210770">which</span> <span m="3211250">means</span> <span m="3211570">that</span> <span m="3211740">there's</span> <span m="3212040">fewer</span> <span m="3212340">things</span> <span m="3212680">that</span> <span m="3212840">the</span> <span m="3212950">validator</span> <span m="3213500">or a</span> <span m="3213730">loader</span> <span m="3214250">might</span> <span m="3214570">screw</span> <span m="3214780">up.</span> <span m="3215630">But</span> <span m="3215870">basically</span> <span m="3216270">this</span> <span m="3216430">is</span> <span m="3217280">sort</span> <span m="3217490">of a</span> <span m="3217600">standardization</span> <span m="3218280">plan</span> <span m="3218540">for</span> <span m="3218710">them,</span> <span m="3219140">in terms</span> <span m="3219290">of how</span> <span m="3219790">to load</span> <span m="3220210">their</span> <span m="3220624">executable.</span> <span m="3222280">Make</span> <span m="3222440">sense?</span> </p>
<p><span m="3224480">All</span> <span m="3224550">right.</span> <span m="3224780">So</span> <span m="3224880">the</span> <span m="3225500">third</span> <span m="3225750">requirement</span> <span m="3226310">is</span> <span m="3226940">that</span> <span m="3227990">I</span> <span m="3228070">guess</span> <span m="3228300">the indirect</span> <span m="3230300">jumps</span> <span m="3231297">use the</span> <span m="3232231">two</span> <span m="3233165">instruction.</span> <span m="3236440">So</span> <span m="3236650">the</span> <span m="3236910">two</span> <span m="3237130">instruction</span> <span m="3237630">is</span> <span m="3237740">this</span> <span m="3237840">thing</span> <span m="3238040">above.</span> <span m="3238860">So</span> <span m="3239210">that,</span> <span m="3239560">we</span> <span m="3239700">just</span> <span m="3239850">talked</span> <span m="3240040">about,</span> <span m="3240380">why</span> <span m="3240890">it</span> <span m="3240980">needs</span> <span m="3241170">to</span> <span m="3241310">ensure</span> <span m="3241710">this,</span> <span m="3241980">so</span> <span m="3242320">that</span> <span m="3242890">you</span> <span m="3243000">don't</span> <span m="3243270">jump</span> <span m="3243520">to</span> <span m="3243580">the</span> <span m="3243660">middle of</span> <span m="3243920">some</span> <span m="3244040">instruction,</span> <span m="3245100">or</span> <span m="3246280">somehow</span> <span m="3246585">invoked</span> <span m="3246890">[INAUDIBLE],</span> <span m="3248230">et cetera.</span> <span m="3249542">Make</span> <span m="3250038">sense?</span> <span m="3251530">All</span> <span m="3251610">right.</span> </p>
<p><span m="3252620">So</span> <span m="3253190">what's</span> <span m="3253340">going</span> <span m="3253520">on</span> <span m="3253610">with</span> <span m="3253870">C4?</span> <span m="3254430">Basically you</span> <span m="3254820">have</span> <span m="3255000">to</span> <span m="3255230">pad</span> <span m="3255610">out</span> <span m="3257760">two page</span> <span m="3258070">boundary</span> <span m="3261879">with</span> <span m="3262330">a</span> <span m="3262390">halt</span> <span m="3262680">instruction.</span> <span m="3264720">Why</span> <span m="3264900">do</span> <span m="3264950">they</span> <span m="3265285">want</span> <span m="3265620">to</span> <span m="3266400">pad</span> <span m="3267030">their</span> <span m="3267260">binary</span> <span m="3267390">out</span> <span m="3267680">with</span> <span m="3267800">halts?</span> <span m="3271000">Any</span> <span m="3271250">ideas?</span> <span m="3272332">Yeah?</span> </p>
<p><span m="3274300">AUDIENCE: [INAUDIBLE].</span> </p>
<p><span m="3281680">PROFESSOR: Yeah,</span> <span m="3282000">I</span> <span m="3282070">think--</span> <span m="3283120">so</span> <span m="3283600">I</span> <span m="3285740">have</span> <span m="3285980">to</span> <span m="3286060">admit,</span> <span m="3286360">I don't have a</span> <span m="3286660">crisp</span> <span m="3286990">answer</span> <span m="3287130">for why</span> <span m="3287490">C4</span> <span m="3287930">exists.</span> <span m="3288300">But</span> <span m="3288390">I</span> <span m="3288460">think</span> <span m="3288620">it's</span> <span m="3288750">roughly</span> <span m="3288990">what</span> <span m="3289130">you are</span> <span m="3289300">saying,</span> <span m="3289590">which</span> <span m="3289750">is</span> <span m="3289880">that</span> <span m="3290610">if</span> <span m="3290810">you--</span> <span m="3291600">the</span> <span m="3291990">code</span> <span m="3292250">naturally</span> <span m="3292650">stops</span> <span m="3293050">at</span> <span m="3293130">some</span> <span m="3293390">point.</span> <span m="3293685">There's</span> <span m="3293980">some end</span> <span m="3294420">to it.</span> <span m="3295240">And the question is,</span> <span m="3295650">what</span> <span m="3295960">happens</span> <span m="3296320">when</span> <span m="3296470">you</span> <span m="3296850">just</span> <span m="3297140">keep</span> <span m="3297380">executing</span> <span m="3297470">it,</span> <span m="3297910">and you</span> <span m="3298350">get to the</span> <span m="3298790">end?</span> <span m="3299670">Then</span> <span m="3300070">the</span> <span m="3300540">processor</span> <span m="3300940">might just</span> <span m="3301260">keep</span> <span m="3301580">executing</span> <span m="3301870">past the</span> <span m="3302360">end,</span> <span m="3302570">and execute</span> <span m="3302660">some</span> <span m="3303110">extra</span> <span m="3303380">instructions.</span> <span m="3304445">Or maybe it wraps</span> <span m="3304800">around</span> <span m="3305280">in</span> <span m="3305440">some weird</span> <span m="3305660">way.</span> <span m="3306450">So</span> <span m="3306630">they</span> <span m="3306750">just</span> <span m="3306900">want</span> <span m="3307040">to</span> <span m="3307080">make</span> <span m="3307280">sure</span> <span m="3307660">that</span> <span m="3308160">there's</span> <span m="3308450">no</span> <span m="3308620">ambiguity</span> <span m="3309330">about</span> <span m="3309630">what</span> <span m="3309930">happens</span> <span m="3310190">if</span> <span m="3310550">you</span> <span m="3311580">keep</span> <span m="3311860">running and</span> <span m="3312310">you</span> <span m="3312420">don't</span> <span m="3312790">jump,</span> <span m="3313080">and you</span> <span m="3313260">just</span> <span m="3313600">run</span> <span m="3313970">off</span> <span m="3314120">the end</span> <span m="3314430">of the</span> <span m="3314500">instruction</span> <span m="3314795">screen.</span> <span m="3315690">So let's</span> <span m="3315890">just</span> <span m="3316090">make</span> <span m="3316250">sure</span> <span m="3316560">that</span> <span m="3317130">the</span> <span m="3317210">only</span> <span m="3317530">answer</span> <span m="3317860">there</span> <span m="3318220">is if</span> <span m="3318563">you</span> <span m="3319250">keep</span> <span m="3319480">executing,</span> <span m="3320090">you'll</span> <span m="3320740">halt, and</span> <span m="3321000">you'll</span> <span m="3321210">trap</span> <span m="3321760">into</span> <span m="3321830">the</span> <span m="3321910">runtime,</span> <span m="3322245">and</span> <span m="3322580">you'll</span> <span m="3322810">terminate</span> <span m="3323160">the</span> <span m="3323230">module.</span> <span m="3324170">So it's</span> <span m="3324280">just</span> <span m="3324570">sort of</span> <span m="3324920">about</span> <span m="3325270">simplicity</span> <span m="3325725">and safety,</span> <span m="3326180">[INAUDIBLE].</span> <span m="3327545">I don't think</span> <span m="3328000">there's</span> <span m="3328270">a</span> <span m="3328660">concrete</span> <span m="3329320">attack</span> <span m="3329750">that</span> <span m="3330030">I</span> <span m="3330320">could</span> <span m="3330570">have</span> <span m="3330780">[INAUDIBLE].</span> </p>
<p><span m="3331746">AUDIENCE: [INAUDIBLE].</span> </p>
<p><span m="3335130">PROFESSOR: Yeah.</span> <span m="3335950">But</span> <span m="3336490">here's the</span> <span m="3336880">thing.</span> <span m="3337120">You</span> <span m="3337270">can't</span> <span m="3337720">jump</span> <span m="3338270">past</span> <span m="3338662">the end.</span> <span m="3339840">So</span> <span m="3339960">the</span> <span m="3340100">last</span> <span m="3340600">thing</span> <span m="3340750">that</span> <span m="3340870">you</span> <span m="3340970">could</span> <span m="3341170">jump</span> <span m="3341480">to</span> <span m="3341990">is</span> <span m="3342280">the</span> <span m="3342390">last</span> <span m="3342870">instruction.</span> <span m="3344140">And by</span> <span m="3344330">this</span> <span m="3344590">rule,</span> <span m="3344690">that</span> <span m="3345020">instruction</span> <span m="3345340">must</span> <span m="3345630">be</span> <span m="3345760">hold.</span> <span m="3346460">So you</span> <span m="3346900">could</span> <span m="3347090">jump to</span> <span m="3347150">the hold,</span> <span m="3348160">but</span> <span m="3348270">then</span> <span m="3348450">would</span> <span m="3348630">be</span> <span m="3348810">at the</span> <span m="3349130">hold.</span> <span m="3349350">And you</span> <span m="3349560">want</span> <span m="3349900">to</span> <span m="3350070">run</span> <span m="3350610">past</span> <span m="3350960">the</span> <span m="3351362">end.</span> <span m="3352570">So</span> <span m="3352720">I</span> <span m="3352990">think it's</span> <span m="3353260">just sort of</span> <span m="3354060">cleanliness,</span> <span m="3354890">as</span> <span m="3355030">far</span> <span m="3355160">as I</span> <span m="3355200">can</span> <span m="3355590">tell,</span> <span m="3356220">a guarantee</span> <span m="3356600">for</span> <span m="3356810">them</span> <span m="3357760">to</span> <span m="3358000">make</span> <span m="3358170">sure</span> <span m="3358380">that</span> <span m="3359130">there's</span> <span m="3359320">no</span> <span m="3359400">weirdness</span> <span m="3360150">in terms of</span> <span m="3360470">wrap</span> <span m="3360740">around</span> <span m="3361840">at the</span> <span m="3362255">engine.</span> <span m="3363870">All</span> <span m="3363970">right?</span> <span m="3364850">So</span> <span m="3366570">C5</span> <span m="3367110">is</span> <span m="3367380">basically</span> <span m="3368150">no</span> <span m="3368350">instructions</span> <span m="3370000">that</span> <span m="3370510">span</span> <span m="3371470">the</span> <span m="3371830">32</span> <span m="3373100">byte</span> <span m="3373440">boundary.</span> <span m="3376160">So</span> <span m="3376170">this</span> <span m="3376780">is</span> <span m="3377140">sort</span> <span m="3377530">of a</span> <span m="3377920">variant</span> <span m="3378215">of</span> <span m="3378510">this</span> <span m="3378650">rule</span> <span m="3378880">that</span> <span m="3378980">we</span> <span m="3379080">talked</span> <span m="3379280">about</span> <span m="3379470">before,</span> <span m="3380130">where</span> <span m="3380380">every</span> <span m="3381500">multiple</span> <span m="3381890">of</span> <span m="3381990">32</span> <span m="3382410">must</span> <span m="3382660">be</span> <span m="3382770">a valid</span> <span m="3383100">instruction</span> <span m="3383445">that</span> <span m="3383790">we solder in</span> <span m="3384110">disassembly.</span> </p>
<p><span m="3385080">So</span> <span m="3385550">otherwise,</span> <span m="3385970">we'll</span> <span m="3386130">jump</span> <span m="3386360">to</span> <span m="3386460">the</span> <span m="3386550">middle of an</span> <span m="3386940">instruction</span> <span m="3387880">and</span> <span m="3388280">have</span> <span m="3388620">the</span> <span m="3388690">problem</span> <span m="3389030">with</span> <span m="3389270">that</span> <span m="3389670">sys</span> <span m="3390070">call that</span> <span m="3390420">might</span> <span m="3390590">be hidden</span> <span m="3391000">there.</span> <span m="3392050">OK.</span> <span m="3392880">And</span> <span m="3393080">then</span> <span m="3393590">we</span> <span m="3393730">have</span> <span m="3394350">C6,</span> <span m="3394660">which</span> <span m="3394820">is</span> <span m="3395080">basically</span> <span m="3395860">all</span> <span m="3396410">instructions</span> <span m="3398580">reachable</span> <span m="3401170">by</span> <span m="3402690">disassembly</span> <span m="3404630">from</span> <span m="3404890">the</span> <span m="3405150">start.</span> <span m="3405810">So</span> <span m="3406240">this</span> <span m="3406490">ensures</span> <span m="3406630">that we</span> <span m="3406750">see</span> <span m="3406990">every</span> <span m="3407230">instruction,</span> <span m="3407500">and we</span> <span m="3407770">can</span> <span m="3408140">check every</span> <span m="3408510">instruction</span> <span m="3408835">that could</span> <span m="3409160">possibly</span> <span m="3409630">be</span> <span m="3409780">run</span> <span m="3410650">at</span> <span m="3410850">runtime.</span> <span m="3411930">And</span> <span m="3412480">I</span> <span m="3412530">guess</span> <span m="3412830">C7</span> <span m="3413530">is</span> <span m="3413785">this</span> <span m="3414040">basically</span> <span m="3414370">all</span> <span m="3414680">direct</span> <span m="3414990">jumps.</span> <span m="3420070">OK.</span> <span m="3420530">So</span> <span m="3420700">this is the</span> <span m="3420990">example</span> <span m="3421450">of that</span> <span m="3422120">jump</span> <span m="3422410">up</span> <span m="3422500">there,</span> <span m="3422760">where</span> <span m="3422920">you</span> <span m="3423020">code</span> <span m="3423290">in</span> <span m="3423430">the</span> <span m="3423650">target</span> <span m="3424390">right</span> <span m="3424580">away.</span> <span m="3424760">So</span> <span m="3424970">it doesn't</span> <span m="3425230">have a</span> <span m="3425430">multiple of</span> <span m="3425810">32,</span> <span m="3426680">but</span> <span m="3427160">it</span> <span m="3427380">still</span> <span m="3427580">has</span> <span m="3427770">to</span> <span m="3427870">be</span> <span m="3428040">a valid</span> <span m="3428440">instruction</span> <span m="3428770">that we</span> <span m="3429100">solder</span> <span m="3429600">in</span> <span m="3429930">the</span> <span m="3430390">left to</span> <span m="3430740">right</span> <span m="3431090">disassembly.</span> <span m="3432032">Question?</span> </p>
<p><span m="3432503">AUDIENCE: So what's</span> <span m="3432974">the difference</span> <span m="3433445">between</span> <span m="3433920">C5</span> <span m="3434470">and</span> <span m="3435763">C3?</span> </p>
<p><span m="3437060">PROFESSOR: Yeah.</span> <span m="3437650">So</span> <span m="3438400">I think</span> <span m="3438755">C5</span> <span m="3440010">says</span> <span m="3440450">that</span> <span m="3441100">if</span> <span m="3441290">I</span> <span m="3441380">have</span> <span m="3442080">an</span> <span m="3442420">instruction</span> <span m="3442830">that's</span> <span m="3443240">multiple</span> <span m="3443700">bytes,</span> <span m="3444870">it</span> <span m="3445120">cannot</span> <span m="3447110">stay</span> <span m="3447465">on</span> <span m="3447820">that</span> <span m="3447970">32</span> <span m="3448300">byte</span> <span m="3448580">boundary.</span> <span m="3449080">So</span> <span m="3449260">suppose that</span> <span m="3449610">I</span> <span m="3449660">have</span> <span m="3450910">my</span> <span m="3451120">instruction</span> <span m="3451810">stream.</span> <span m="3452780">And</span> <span m="3453610">here's</span> <span m="3454690">an</span> <span m="3454760">address,</span> <span m="3455020">32.</span> <span m="3455900">Here's</span> <span m="3456080">address</span> <span m="3456450">64.</span> <span m="3457960">And maybe I</span> <span m="3458430">have some</span> <span m="3458775">sort of an AND</span> <span m="3459120">instruction</span> <span m="3460050">that</span> <span m="3460430">sort of</span> <span m="3460750">spans</span> <span m="3461370">this</span> <span m="3461560">boundary.</span> <span m="3463060">So</span> <span m="3463210">this is</span> <span m="3463400">what</span> <span m="3463655">C5</span> <span m="3464300">prohibits.</span> <span m="3465120">No</span> <span m="3465330">instructions</span> <span m="3466010">can</span> <span m="3466140">span</span> <span m="3466490">this</span> <span m="3466580">boundary.</span> <span m="3466990">Because</span> <span m="3467200">otherwise,</span> <span m="3467910">we</span> <span m="3468040">saw</span> <span m="3468320">this AND</span> <span m="3468450">instruction.</span> <span m="3469470">But</span> <span m="3469820">because</span> <span m="3470060">you can</span> <span m="3470230">always</span> <span m="3470510">jump</span> <span m="3470860">32</span> <span m="3471150">byte</span> <span m="3471430">multiples,</span> <span m="3472020">you could</span> <span m="3472310">jump</span> <span m="3472610">into</span> <span m="3472680">the</span> <span m="3472770">middle</span> <span m="3473030">of that.</span> <span m="3473290">And</span> <span m="3473630">who</span> <span m="3473860">knows</span> <span m="3474090">what will</span> <span m="3474250">happen</span> <span m="3474610">there?</span> <span m="3475380">So</span> <span m="3475785">this is</span> <span m="3476190">what</span> <span m="3476680">C5</span> <span m="3477170">prohibits</span> <span m="3477545">for that.</span> </p>
<p><span m="3477920">And</span> <span m="3478410">C3</span> <span m="3479350">is</span> <span m="3479550">the</span> <span m="3480040">counterpart</span> <span m="3480770">to</span> <span m="3480870">it</span> <span m="3481180">on</span> <span m="3481380">the</span> <span m="3481540">jump</span> <span m="3481800">side.</span> <span m="3482090">So</span> <span m="3482540">C3</span> <span m="3482970">says that</span> <span m="3483240">whenever</span> <span m="3483515">you</span> <span m="3483790">jump,</span> <span m="3484560">you're</span> <span m="3484720">going</span> <span m="3484800">to</span> <span m="3484900">jump</span> <span m="3485140">to a</span> <span m="3485280">multiple of</span> <span m="3485770">32</span> <span m="3486160">bytes.</span> <span m="3487090">And</span> <span m="3487470">C5</span> <span m="3487980">says</span> <span m="3488180">that</span> <span m="3488310">everything</span> <span m="3488620">you</span> <span m="3488710">can</span> <span m="3488850">find</span> <span m="3489300">in a</span> <span m="3489370">multiple</span> <span m="3489840">of</span> <span m="3489980">32</span> <span m="3490450">bytes</span> <span m="3490660">is a</span> <span m="3490920">safe</span> <span m="3491110">instruction.</span> </p>
<p><span m="3493098">AUDIENCE: I wonder</span> <span m="3493544">if there's</span> <span m="3493990">any redundancy</span> <span m="3494882">because</span> <span m="3495328">[INAUDIBLE].</span> </p>
<p><span m="3495780">PROFESSOR: Yeah,</span> <span m="3496360">I</span> <span m="3496725">don't know.</span> <span m="3497090">I'm not sure.</span> <span m="3497550">I</span> <span m="3497910">had</span> <span m="3498130">a</span> <span m="3498200">little</span> <span m="3498420">bit</span> <span m="3498520">of</span> <span m="3498610">that</span> <span m="3498850">feeling</span> <span m="3499280">when reading</span> <span m="3499590">this list.</span> <span m="3499900">It</span> <span m="3500160">seems</span> <span m="3500390">like,</span> <span m="3500530">wow,</span> <span m="3500840">they're all</span> <span m="3501300">good rules.</span> <span m="3501690">But</span> <span m="3501920">I'm not</span> <span m="3502000">sure</span> <span m="3502300">it's the</span> <span m="3502420">minimal,</span> <span m="3502745">non-orthonormal</span> <span m="3503820">set</span> <span m="3504000">of--</span> <span m="3504766">or</span> <span m="3505150">set of</span> <span m="3505290">orthonormal</span> <span m="3505960">rules</span> <span m="3507020">that</span> <span m="3508310">you need</span> <span m="3508650">to enforce</span> <span m="3508890">this.</span> <span m="3511640">But</span> <span m="3511770">any other</span> <span m="3511920">questions</span> <span m="3513100">about</span> <span m="3513460">the set</span> <span m="3513550">of</span> <span m="3513690">restrictions</span> <span m="3514250">they</span> <span m="3514350">have?</span> <span m="3516650">All</span> <span m="3517100">right.</span> </p>
<p><span m="3517680">So I</span> <span m="3517980">guess</span> <span m="3518465">let's</span> <span m="3518950">think</span> <span m="3519180">about</span> <span m="3520180">this</span> <span m="3520310">homework</span> <span m="3520620">question</span> <span m="3520950">that</span> <span m="3521080">we sort</span> <span m="3521340">of</span> <span m="3521600">assigned.</span> <span m="3521910">It turns</span> <span m="3522220">out--</span> <span m="3522280">I think</span> <span m="3522600">there</span> <span m="3522800">was</span> <span m="3522890">actually</span> <span m="3523100">a bug</span> <span m="3523500">that</span> <span m="3523690">Native</span> <span m="3524150">Client</span> <span m="3524790">had</span> <span m="3525070">and</span> <span m="3525350">that's in</span> <span m="3525470">our</span> <span m="3525680">sandbox</span> <span m="3525970">at some</span> <span m="3526260">point,</span> <span m="3526570">which</span> <span m="3526620">is</span> <span m="3526710">that</span> <span m="3526820">for</span> <span m="3527160">some</span> <span m="3527460">complicated</span> <span m="3527790">instruction,</span> <span m="3528510">I</span> <span m="3528600">believe</span> <span m="3529070">they</span> <span m="3530610">didn't</span> <span m="3530860">have</span> <span m="3531040">the</span> <span m="3531100">length</span> <span m="3531430">encoding</span> <span m="3531880">correctly,</span> <span m="3532320">if I</span> <span m="3532800">remember</span> <span m="3533010">properly,</span> <span m="3534420">in</span> <span m="3534560">which case</span> <span m="3535980">something</span> <span m="3536380">bad</span> <span m="3536680">might happen.</span> <span m="3538090">I</span> <span m="3538490">can't</span> <span m="3538800">remember</span> <span m="3539075">exactly</span> <span m="3539350">what the bug</span> <span m="3539600">was.</span> <span m="3539880">But</span> <span m="3540540">suppose</span> <span m="3540790">that the</span> <span m="3540970">sandbox</span> <span m="3541740">validator</span> <span m="3543100">gets</span> <span m="3543370">the</span> <span m="3543490">length</span> <span m="3543820">of</span> <span m="3543920">some</span> <span m="3544090">instruction</span> <span m="3544570">wrong.</span> <span m="3546792">What bad</span> <span m="3547240">things could</span> <span m="3547688">happen?</span> <span m="3548590">How would</span> <span m="3548720">you</span> <span m="3549140">exploit this?</span> </p>
<p><span m="3549860">AUDIENCE: You can</span> <span m="3550340">hide a sys</span> <span m="3550788">call or a</span> <span m="3551236">[INAUDIBLE]</span> <span m="3552132">potentially.</span> </p>
<p><span m="3553310">PROFESSOR: Yeah.</span> <span m="3553590">So</span> <span m="3553930">suppose</span> <span m="3554385">that</span> <span m="3554840">there's</span> <span m="3555750">some</span> <span m="3556660">fancy</span> <span m="3557120">variant</span> <span m="3557280">of</span> <span m="3557450">some AND</span> <span m="3557600">instruction</span> <span m="3558850">that you</span> <span m="3558950">could</span> <span m="3559030">write</span> <span m="3559310">down.</span> <span m="3559570">And</span> <span m="3559830">maybe</span> <span m="3560140">the</span> <span m="3560250">validator</span> <span m="3560740">gets</span> <span m="3560940">that</span> <span m="3561160">wrong</span> <span m="3561570">and thinks</span> <span m="3561840">that,</span> <span m="3562400">oh, this</span> <span m="3562710">guy is</span> <span m="3563000">actually</span> <span m="3563730">six</span> <span m="3564180">bytes,</span> <span m="3564780">when</span> <span m="3565050">in</span> <span m="3565180">reality,</span> <span m="3565920">it's</span> <span m="3566130">five</span> <span m="3566420">bites</span> <span m="3566630">long.</span> <span m="3567370">So</span> <span m="3567470">you</span> <span m="3567650">could</span> <span m="3567970">plop</span> <span m="3568360">this down,</span> <span m="3569220">pull this</span> <span m="3569710">AND down.</span> <span m="3570200">And</span> <span m="3570390">then</span> <span m="3571060">the</span> <span m="3571230">validator</span> <span m="3571630">thinks,</span> <span m="3571870">oh, it's</span> <span m="3572150">six</span> <span m="3572320">bites.</span> <span m="3572660">I'll look</span> <span m="3573040">six</span> <span m="3573360">bites</span> <span m="3573660">further.</span> <span m="3574380">And I'll</span> <span m="3574720">check</span> <span m="3575000">whether</span> <span m="3575190">this</span> <span m="3575460">is a</span> <span m="3575540">valid</span> <span m="3575890">instruction.</span> <span m="3577065">And we just have to</span> <span m="3577450">make</span> <span m="3577620">sure</span> <span m="3577830">that</span> <span m="3578110">whatever</span> <span m="3578460">is</span> <span m="3578650">six</span> <span m="3578840">bytes</span> <span m="3579260">later</span> <span m="3579360">looks</span> <span m="3579650">like a</span> <span m="3579800">valid</span> <span m="3580100">instruction.</span> <span m="3580920">But</span> <span m="3581010">the</span> <span m="3581130">CPU</span> <span m="3581680">itself,</span> <span m="3582180">when</span> <span m="3582330">it</span> <span m="3582550">runs</span> <span m="3582870">this</span> <span m="3583160">code,</span> <span m="3583450">is</span> <span m="3583560">going</span> <span m="3583680">to</span> <span m="3583730">maybe</span> <span m="3583970">only</span> <span m="3584060">look</span> <span m="3584580">five</span> <span m="3584970">bytes</span> <span m="3585470">from</span> <span m="3585800">the</span> <span m="3586130">AND</span> <span m="3586310">because</span> <span m="3586540">that's</span> <span m="3586820">the real</span> <span m="3586950">length</span> <span m="3587240">of the</span> <span m="3587310">instruction.</span> <span m="3588000">So if</span> <span m="3588380">we can</span> <span m="3588580">use</span> <span m="3588730">this</span> <span m="3588900">extra</span> <span m="3589170">byte</span> <span m="3589515">to</span> <span m="3589860">stick</span> <span m="3590140">a</span> <span m="3590630">sys call</span> <span m="3591050">instruction,</span> <span m="3591470">then</span> <span m="3591620">we could</span> <span m="3591920">be in</span> <span m="3592130">business.</span> </p>
<p><span m="3592480">So</span> <span m="3592680">if we</span> <span m="3593300">stick that--</span> <span m="3594180">remember</span> <span m="3594570">from</span> <span m="3595290">that</span> <span m="3595430">example</span> <span m="3595810">above</span> <span m="3596675">on</span> <span m="3597110">x86,</span> <span m="3598550">OXCD</span> <span m="3598680">is how you</span> <span m="3598900">make an</span> <span m="3599330">AND instruction.</span> <span m="3600190">So</span> <span m="3600590">if</span> <span m="3600740">we</span> <span m="3600850">stick</span> <span m="3601100">a</span> <span m="3601320">CD</span> <span m="3601960">byte</span> <span m="3602830">at</span> <span m="3603000">the</span> <span m="3603060">end</span> <span m="3603320">of</span> <span m="3603470">that</span> <span m="3603950">AND,</span> <span m="3605050">then</span> <span m="3605760">maybe we</span> <span m="3605860">can</span> <span m="3606090">put something</span> <span m="3606450">here</span> <span m="3606870">that</span> <span m="3607170">looks</span> <span m="3607490">like</span> <span m="3607640">an</span> <span m="3607720">instruction</span> <span m="3608310">but actually</span> <span m="3608722">is going to</span> <span m="3609134">be part</span> <span m="3609546">of the</span> <span m="3609958">AND</span> <span m="3610370">instruction</span> <span m="3610725">here.</span> <span m="3611080">And then</span> <span m="3611280">we can</span> <span m="3611545">all</span> <span m="3611810">of</span> <span m="3611930">a sudden</span> <span m="3612030">make a</span> <span m="3612430">sys call</span> <span m="3613310">and</span> <span m="3613730">escape</span> <span m="3614290">the</span> <span m="3614960">inner</span> <span m="3615451">sandbox.</span> <span m="3616433">Makes</span> <span m="3616924">sense?</span> <span m="3617415">Any</span> <span m="3617910">questions?</span> <span m="3620380">So</span> <span m="3620760">the</span> <span m="3620830">validator</span> <span m="3621625">in</span> <span m="3621980">Native Client</span> <span m="3622755">has to be</span> <span m="3623220">really</span> <span m="3623770">in sync</span> <span m="3624110">with what</span> <span m="3624330">the CPU</span> <span m="3624560">is doing</span> <span m="3624980">because</span> <span m="3625400">it's sort</span> <span m="3625530">of</span> <span m="3626090">guessing,</span> <span m="3626530">well,</span> <span m="3627380">here's</span> <span m="3627650">exactly</span> <span m="3627710">how</span> <span m="3627940">the</span> <span m="3628265">CPU</span> <span m="3628590">is going to</span> <span m="3628870">interpret every</span> <span m="3629160">instruction.</span> <span m="3629900">It has to be</span> <span m="3630140">right</span> <span m="3630430">at</span> <span m="3630580">every</span> <span m="3630930">level</span> <span m="3631250">here.</span> </p>
<p><span m="3632746">So that's going</span> <span m="3633140">to</span> <span m="3633190">be</span> <span m="3633530">a little</span> <span m="3633880">bit</span> <span m="3634230">tricky to do right.</span> <span m="3636230">But there are</span> <span m="3636420">actually</span> <span m="3636570">some</span> <span m="3636760">other</span> <span m="3637030">interesting</span> <span m="3637350">bugs</span> <span m="3637560">in</span> <span m="3637950">Native Client</span> <span m="3638685">that people</span> <span m="3639020">have found.</span> <span m="3639300">One,</span> <span m="3639615">I think,</span> <span m="3640265">has</span> <span m="3640600">to do</span> <span m="3640850">with not</span> <span m="3641350">properly</span> <span m="3641695">sanitizing</span> <span m="3642040">the</span> <span m="3642320">environment</span> <span m="3643230">of the</span> <span m="3643440">CPU</span> <span m="3643890">when</span> <span m="3644100">you're</span> <span m="3644250">jumping</span> <span m="3644690">into the</span> <span m="3645040">trusted</span> <span m="3645390">service</span> <span m="3645690">runtime.</span> <span m="3646740">I guess</span> <span m="3646930">we'll</span> <span m="3647390">talk about</span> <span m="3647530">this in</span> <span m="3647600">a</span> <span m="3647660">second.</span> <span m="3648020">But</span> <span m="3648858">the</span> <span m="3649266">trusted</span> <span m="3649674">service</span> <span m="3650082">runtime</span> <span m="3650490">is</span> <span m="3650650">going to</span> <span m="3650690">basically</span> <span m="3651090">run with the</span> <span m="3651160">same</span> <span m="3651480">sort</span> <span m="3651800">of</span> <span m="3652075">set of</span> <span m="3652350">CPU</span> <span m="3652550">registers</span> <span m="3652975">initially</span> <span m="3653660">that</span> <span m="3654060">the</span> <span m="3654660">untrusted</span> <span m="3655110">module was</span> <span m="3655400">running</span> <span m="3655670">with.</span> <span m="3656500">So</span> <span m="3656890">if</span> <span m="3657090">there's</span> <span m="3657310">something</span> <span m="3657680">that it</span> <span m="3657750">forgets</span> <span m="3658120">to clear</span> <span m="3658541">or reset</span> <span m="3658962">or whatnot,</span> <span m="3660650">then</span> <span m="3661330">the</span> <span m="3661820">trusted</span> <span m="3662070">service</span> <span m="3662230">runtime</span> <span m="3662290">might</span> <span m="3662565">be</span> <span m="3662840">tricked into</span> <span m="3663000">doing</span> <span m="3663280">something</span> <span m="3665070">that</span> <span m="3666130">it</span> <span m="3666270">wasn't</span> <span m="3666400">meant</span> <span m="3666580">to do,</span> <span m="3666950">or the</span> <span m="3667475">developers</span> <span m="3667980">didn't want</span> <span m="3668200">to do it</span> <span m="3668830">initially.</span> </p>
<p><span m="3671330">OK.</span> <span m="3672570">So</span> <span m="3672700">let's</span> <span m="3672880">see.</span> <span m="3673030">Where</span> <span m="3673350">are we</span> <span m="3673490">now?</span> <span m="3673910">So</span> <span m="3674480">what</span> <span m="3674610">we</span> <span m="3674710">understand</span> <span m="3675060">now is</span> <span m="3675410">roughly</span> <span m="3675780">how</span> <span m="3676060">we</span> <span m="3676210">can</span> <span m="3676450">disassemble</span> <span m="3676780">all the</span> <span m="3677110">instructions</span> <span m="3677820">and</span> <span m="3677950">how</span> <span m="3678190">to</span> <span m="3678720">prevent</span> <span m="3679260">disallowed</span> <span m="3679770">instructions.</span> <span m="3679860">So</span> <span m="3680190">now</span> <span m="3680310">let's</span> <span m="3680590">look</span> <span m="3680740">at,</span> <span m="3681090">how</span> <span m="3681310">do we</span> <span m="3681740">keep</span> <span m="3682700">the</span> <span m="3683040">memory</span> <span m="3683786">and</span> <span m="3684160">references</span> <span m="3684860">for both</span> <span m="3685210">code</span> <span m="3685440">and</span> <span m="3685640">data</span> <span m="3686230">within</span> <span m="3686590">the</span> <span m="3686690">bounds</span> <span m="3687450">of</span> <span m="3687610">the</span> <span m="3687690">module?</span> <span m="3689550">So</span> <span m="3690140">for</span> <span m="3690240">performance</span> <span m="3690690">reasons,</span> <span m="3691440">the</span> <span m="3691550">Native Client</span> <span m="3692255">guys</span> <span m="3692590">actually</span> <span m="3693030">start using</span> <span m="3693280">some</span> <span m="3693420">hardware</span> <span m="3693810">support</span> <span m="3694230">at this</span> <span m="3694400">point</span> <span m="3694770">to</span> <span m="3694870">make</span> <span m="3695130">sure</span> <span m="3695450">this</span> <span m="3696090">actually</span> <span m="3696810">doesn't</span> <span m="3697030">impose</span> <span m="3697370">much</span> <span m="3697560">overhead.</span> <span m="3698430">But</span> <span m="3699200">before</span> <span m="3699410">we look at the</span> <span m="3699740">hardware</span> <span m="3700090">support</span> <span m="3700480">they use,</span> <span m="3701160">does</span> <span m="3701380">anyone</span> <span m="3701580">have</span> <span m="3701740">any</span> <span m="3701960">suggestions</span> <span m="3702290">for how</span> <span m="3702710">we could do</span> <span m="3702890">it</span> <span m="3703110">actually without</span> <span m="3703550">any</span> <span m="3703810">hardware</span> <span m="3704070">support?</span> <span m="3704510">Could</span> <span m="3704825">we</span> <span m="3705750">just</span> <span m="3706340">enforce</span> <span m="3707340">all</span> <span m="3707600">the</span> <span m="3707860">memory</span> <span m="3708210">accesses</span> <span m="3708430">going</span> <span m="3708560">in bounds</span> <span m="3709480">with the</span> <span m="3709960">machine we have</span> <span m="3710130">so far?</span> <span m="3712085">Yeah.</span> </p>
<p><span m="3713015">AUDIENCE: You can</span> <span m="3713480">instrument</span> <span m="3714410">the</span> <span m="3715340">instructions</span> <span m="3716070">to</span> <span m="3716450">clear</span> <span m="3716735">all the</span> <span m="3717020">higher</span> <span m="3717810">bits.</span> </p>
<p><span m="3717930">PROFESSOR: That's right.</span> <span m="3718370">Yeah.</span> <span m="3718500">So actually</span> <span m="3718940">we see</span> <span m="3719440">that we</span> <span m="3719520">have this</span> <span m="3719940">instruction</span> <span m="3720260">over</span> <span m="3720430">here,</span> <span m="3721080">which</span> <span m="3721530">every</span> <span m="3721950">time</span> <span m="3722160">we,</span> <span m="3722520">for</span> <span m="3722620">example,</span> <span m="3722980">jump</span> <span m="3723210">somewhere,</span> <span m="3724770">right now,</span> <span m="3725165">we clear the</span> <span m="3725560">low bits.</span> <span m="3725770">But if we want</span> <span m="3725970">to</span> <span m="3726050">keep</span> <span m="3726800">all</span> <span m="3727240">the</span> <span m="3727370">possible</span> <span m="3727850">code</span> <span m="3728210">that you're</span> <span m="3728310">executing</span> <span m="3729220">within</span> <span m="3729400">the</span> <span m="3729720">low</span> <span m="3730090">256</span> <span m="3730500">Megs,</span> <span m="3731610">then you could</span> <span m="3731770">just replace</span> <span m="3732140">this</span> <span m="3732410">with a</span> <span m="3732680">0.</span> <span m="3733330">So</span> <span m="3733785">we</span> <span m="3734240">end with</span> <span m="3734695">0ffffe0.</span> <span m="3736830">So</span> <span m="3737160">this</span> <span m="3737590">clears</span> <span m="3737910">the</span> <span m="3738090">low</span> <span m="3738310">bits and</span> <span m="3738640">also</span> <span m="3739450">caps</span> <span m="3740800">to at</span> <span m="3741260">most</span> <span m="3741580">256</span> <span m="3741900">Megs.</span> <span m="3741980">So this does</span> <span m="3742170">exactly</span> <span m="3742580">what</span> <span m="3742750">you're</span> <span m="3742940">sort of</span> <span m="3743270">suggesting</span> <span m="3743645">and</span> <span m="3744300">would</span> <span m="3744540">make</span> <span m="3744730">sure</span> <span m="3744920">that</span> <span m="3745400">whenever</span> <span m="3745620">you're</span> <span m="3745760">jumping,</span> <span m="3746720">you're</span> <span m="3747260">saying</span> <span m="3747700">within</span> <span m="3747950">the low</span> <span m="3748286">256</span> <span m="3748960">Megs.</span> <span m="3749940">And</span> <span m="3750430">the</span> <span m="3750920">fact that</span> <span m="3753300">we're</span> <span m="3753640">doing disassembly,</span> <span m="3754420">you</span> <span m="3754750">can</span> <span m="3754850">also</span> <span m="3755110">check</span> <span m="3755560">for</span> <span m="3755910">all</span> <span m="3756100">the</span> <span m="3756270">direct</span> <span m="3756580">jumps,</span> <span m="3756890">that</span> <span m="3756980">they're</span> <span m="3757130">all</span> <span m="3757440">in bounds.</span> </p>
<p><span m="3759030">And</span> <span m="3759660">that's</span> <span m="3759760">actually</span> <span m="3760030">not</span> <span m="3760210">so</span> <span m="3760360">bad.</span> <span m="3760770">The</span> <span m="3760850">reason</span> <span m="3761060">I think they</span> <span m="3761550">don't</span> <span m="3761740">do</span> <span m="3761810">this</span> <span m="3761990">for</span> <span m="3762160">code is</span> <span m="3762500">because</span> <span m="3763140">in</span> <span m="3763440">x86</span> <span m="3764060">you can very</span> <span m="3764360">efficiently</span> <span m="3764930">encode</span> <span m="3765245">an</span> <span m="3765560">AND</span> <span m="3766140">where</span> <span m="3766340">all</span> <span m="3766550">the</span> <span m="3766660">top</span> <span m="3766900">bits</span> <span m="3767090">are</span> <span m="3767140">1.</span> <span m="3767820">So</span> <span m="3767950">this</span> <span m="3768070">turns</span> <span m="3768320">out</span> <span m="3768510">to</span> <span m="3768590">be,</span> <span m="3769010">I</span> <span m="3769130">think,</span> <span m="3770490">basically</span> <span m="3771120">a</span> <span m="3771700">3</span> <span m="3772090">byte</span> <span m="3772300">instruction</span> <span m="3772615">for the</span> <span m="3772930">AND,</span> <span m="3773185">and</span> <span m="3773440">a</span> <span m="3773810">2 byte</span> <span m="3774030">instruction</span> <span m="3774430">for</span> <span m="3774530">the</span> <span m="3774650">jump.</span> <span m="3775410">So</span> <span m="3775530">the</span> <span m="3775700">overhead</span> <span m="3775800">is,</span> <span m="3775900">like,</span> <span m="3776190">3</span> <span m="3776390">more</span> <span m="3776590">bytes.</span> <span m="3777270">But</span> <span m="3777380">if</span> <span m="3777460">you</span> <span m="3777550">want</span> <span m="3777680">to</span> <span m="3777720">have</span> <span m="3778200">non-1</span> <span m="3779140">high</span> <span m="3779490">bits,</span> <span m="3780260">then</span> <span m="3780550">this</span> <span m="3780710">is</span> <span m="3780780">actually</span> <span m="3781070">now a</span> <span m="3781470">5</span> <span m="3781660">byte</span> <span m="3781870">instruction</span> <span m="3782215">all of  sudden.</span> <span m="3782830">So I</span> <span m="3782970">think they're</span> <span m="3783280">worried</span> <span m="3783450">a</span> <span m="3783530">little</span> <span m="3783750">bit</span> <span m="3783850">about the</span> <span m="3783920">overhead</span> <span m="3784240">here.</span> <span m="3785500">Question?</span> </p>
<p><span m="3786704">AUDIENCE: Isn't there</span> <span m="3787106">also the</span> <span m="3787510">problem</span> <span m="3787870">that you might have</span> <span m="3788301">some</span> <span m="3788732">instructions which</span> <span m="3789594">increment</span> <span m="3790456">what</span> <span m="3790890">version that you're</span> <span m="3791260">trying to get?</span> <span m="3791840">So you</span> <span m="3792150">might</span> <span m="3792527">say--</span> <span m="3793660">your instruction</span> <span m="3794020">might</span> <span m="3794380">have</span> <span m="3794740">a constant</span> <span m="3795020">offset or</span> <span m="3795300">something like that.</span> </p>
<p><span m="3796430">PROFESSOR: Well,</span> <span m="3796860">I</span> <span m="3796940">think,</span> <span m="3797210">yeah.</span> <span m="3797390">You would</span> <span m="3797540">probably</span> <span m="3797880">prohibit</span> <span m="3798590">instructions</span> <span m="3799240">that</span> <span m="3799400">jump</span> <span m="3799680">to</span> <span m="3799780">some</span> <span m="3799940">complicated</span> <span m="3800520">formula</span> <span m="3800820">of</span> <span m="3801120">an</span> <span m="3801280">address.</span> <span m="3801990">So</span> <span m="3802090">you</span> <span m="3802270">will</span> <span m="3802430">only</span> <span m="3802890">support an</span> <span m="3803280">instruction that</span> <span m="3803770">jumps</span> <span m="3804100">directly</span> <span m="3804520">to</span> <span m="3804610">this</span> <span m="3804850">value.</span> <span m="3805540">And</span> <span m="3805680">this</span> <span m="3805740">value</span> <span m="3806330">always</span> <span m="3806830">gets</span> <span m="3807050">ANDed</span> <span m="3807360">and--</span> </p>
<p><span m="3809004">AUDIENCE: It's more</span> <span m="3809492">for memory</span> <span m="3809980">accesses rather than--</span> </p>
<p><span m="3810470">PROFESSOR: Yeah.</span> <span m="3811090">So</span> <span m="3811190">that's</span> <span m="3811500">a good</span> <span m="3811810">point</span> <span m="3812060">because</span> <span m="3812530">this</span> <span m="3812760">is</span> <span m="3812960">just</span> <span m="3813240">code.</span> <span m="3813600">And for</span> <span m="3813980">memory</span> <span m="3814300">access,</span> <span m="3814490">there's</span> <span m="3814920">lots</span> <span m="3815410">of</span> <span m="3815650">weird</span> <span m="3816090">ways</span> <span m="3816380">on</span> <span m="3816480">x86</span> <span m="3817060">to</span> <span m="3817810">refer</span> <span m="3818250">to</span> <span m="3818320">a</span> <span m="3818370">particular</span> <span m="3818730">memory</span> <span m="3819000">location.</span> <span m="3820330">In that</span> <span m="3820670">case,</span> <span m="3820840">you</span> <span m="3820920">basically</span> <span m="3821280">have</span> <span m="3821470">to</span> <span m="3821950">first</span> <span m="3822260">compute</span> <span m="3822710">the</span> <span m="3822780">memory</span> <span m="3823070">location,</span> <span m="3823920">then</span> <span m="3824280">insert</span> <span m="3824725">an</span> <span m="3825170">extra and,</span> <span m="3826130">and</span> <span m="3826290">then</span> <span m="3826510">do the</span> <span m="3826690">access.</span> <span m="3827560">And</span> <span m="3827650">I</span> <span m="3827700">think</span> <span m="3828010">that's</span> <span m="3828420">the</span> <span m="3828590">real</span> <span m="3828830">reason</span> <span m="3829130">why</span> <span m="3829360">they're</span> <span m="3829900">actually</span> <span m="3830210">very</span> <span m="3830700">worried</span> <span m="3831090">about</span> <span m="3831350">the</span> <span m="3831480">performance</span> <span m="3831845">overheads</span> <span m="3832210">of</span> <span m="3832300">this</span> <span m="3832460">instrumentation.</span> <span m="3834020">So</span> <span m="3834510">on</span> <span m="3834690">x86,</span> <span m="3835443">at least</span> <span m="3835826">on the</span> <span m="3836210">32-bit,</span> <span m="3836290">which</span> <span m="3836595">is what this paper</span> <span m="3836900">talks</span> <span m="3837120">about,</span> <span m="3837520">they</span> <span m="3837820">actually</span> <span m="3838240">use</span> <span m="3838370">some</span> <span m="3838630">hardware</span> <span m="3839050">support</span> <span m="3839380">instead</span> <span m="3840090">to</span> <span m="3840630">limit</span> <span m="3841740">the</span> <span m="3842360">code</span> <span m="3842690">and</span> <span m="3842850">data</span> <span m="3843060">addresses</span> <span m="3843690">that</span> <span m="3843860">the</span> <span m="3844360">untrusted</span> <span m="3844820">module</span> <span m="3845220">can</span> <span m="3845320">refer to.</span> </p>
<p><span m="3847330">So</span> <span m="3847530">this</span> <span m="3847720">actually</span> <span m="3848060">leverages</span> <span m="3848736">some</span> <span m="3849410">somewhat</span> <span m="3850230">esoteric</span> <span m="3851280">hardware</span> <span m="3851810">in</span> <span m="3851980">x86.</span> <span m="3852980">So</span> <span m="3853110">let's</span> <span m="3853460">see</span> <span m="3853600">what</span> <span m="3853770">it</span> <span m="3853890">looks</span> <span m="3854100">like</span> <span m="3854430">first</span> <span m="3855210">before</span> <span m="3855460">we</span> <span m="3855600">start</span> <span m="3856320">figuring</span> <span m="3856650">out</span> <span m="3856810">how</span> <span m="3856960">we're going</span> <span m="3857460">to use</span> <span m="3857932">it</span> <span m="3858404">to sandbox</span> <span m="3858876">the next</span> <span m="3859348">module.</span> <span m="3861240">So</span> <span m="3862010">this</span> <span m="3862270">hardware</span> <span m="3863010">is</span> <span m="3863180">called</span> <span m="3863510">segmentation.</span> <span m="3864650">It's</span> <span m="3864810">sort of</span> <span m="3864980">left</span> <span m="3865230">over</span> <span m="3865500">from</span> <span m="3866290">the</span> <span m="3866390">days</span> <span m="3866800">before</span> <span m="3867750">x86</span> <span m="3868220">actually</span> <span m="3868460">even</span> <span m="3868610">had</span> <span m="3869735">paging.</span> <span m="3870650">So</span> <span m="3871110">the</span> <span m="3871200">way</span> <span m="3871350">it</span> <span m="3871520">works</span> <span m="3871970">is</span> <span m="3872170">actually</span> <span m="3873910">there's</span> <span m="3874210">a</span> <span m="3877210">segmentation</span> <span m="3879210">on</span> <span m="3879420">x86.</span> <span m="3880080">They</span> <span m="3880310">way it</span> <span m="3880560">works</span> <span m="3880830">is</span> <span m="3880940">that</span> <span m="3881230">whenever</span> <span m="3881550">a</span> <span m="3881620">process</span> <span m="3882190">is</span> <span m="3882470">running,</span> <span m="3884170">there's</span> <span m="3884470">actually</span> <span m="3886090">a</span> <span m="3886760">table</span> <span m="3887350">maintained</span> <span m="3887960">by</span> <span m="3888130">the</span> <span m="3888230">hardware.</span> <span m="3889830">Let's</span> <span m="3890220">call</span> <span m="3890580">it the</span> <span m="3891120">segment</span> <span m="3891650">descriptor</span> <span m="3892170">table.</span> </p>
<p><span m="3899324">And what</span> <span m="3899800">this table</span> <span m="3900060">has</span> <span m="3900320">is</span> <span m="3900500">just</span> <span m="3900710">a</span> <span m="3900760">bunch</span> <span m="3901010">of</span> <span m="3901410">segments,</span> <span m="3902610">numbered</span> <span m="3903280">from</span> <span m="3903555">0</span> <span m="3903830">up</span> <span m="3904470">to</span> <span m="3904650">whatever</span> <span m="3904930">the</span> <span m="3905060">size of</span> <span m="3905260">the</span> <span m="3905350">table</span> <span m="3905670">is,</span> <span m="3906116">kind of</span> <span m="3906562">like</span> <span m="3907008">file descriptor</span> <span m="3907454">in Unix.</span> <span m="3908350">Except</span> <span m="3908650">every</span> <span m="3908990">entry</span> <span m="3909330">has</span> <span m="3910290">two</span> <span m="3910580">values</span> <span m="3911100">in</span> <span m="3911240">it,</span> <span m="3911870">some sort</span> <span m="3912030">of a</span> <span m="3912440">base</span> <span m="3914200">and</span> <span m="3914550">a</span> <span m="3914680">length.</span> <span m="3916050">And</span> <span m="3916420">the same</span> <span m="3916550">for every entry,</span> <span m="3918320">base</span> <span m="3918660">and length.</span> <span m="3921810">OK.</span> <span m="3922220">So</span> <span m="3922340">what</span> <span m="3922480">this</span> <span m="3922670">table</span> <span m="3922930">does</span> <span m="3923260">is</span> <span m="3923590">it tells</span> <span m="3924040">us</span> <span m="3924790">that</span> <span m="3925430">we</span> <span m="3925530">have</span> <span m="3926050">a</span> <span m="3926170">couple of</span> <span m="3926480">segments.</span> <span m="3927040">And whenever</span> <span m="3927110">we</span> <span m="3927420">refer</span> <span m="3927680">to</span> <span m="3927940">a</span> <span m="3928050">particular</span> <span m="3928500">segment,</span> <span m="3929640">what</span> <span m="3930070">this</span> <span m="3930690">in</span> <span m="3930860">some</span> <span m="3931040">sense</span> <span m="3932130">means</span> <span m="3932530">is</span> <span m="3932690">that</span> <span m="3932930">we're</span> <span m="3933140">talking</span> <span m="3933560">about</span> <span m="3933950">a</span> <span m="3934380">chunk</span> <span m="3934810">of memory</span> <span m="3935670">that starts at</span> <span m="3936100">address</span> <span m="3936620">base</span> <span m="3937380">and</span> <span m="3937580">goes</span> <span m="3938000">for</span> <span m="3938470">this</span> <span m="3938740">length</span> <span m="3939150">from</span> <span m="3939460">that</span> <span m="3939890">base</span> <span m="3940520">upwards.</span> <span m="3942190">And</span> <span m="3942370">the</span> <span m="3942510">way that this</span> <span m="3942930">actually</span> <span m="3943230">helps</span> <span m="3943640">us</span> <span m="3943980">to</span> <span m="3944140">enforce</span> <span m="3944770">memory</span> <span m="3945170">bounds</span> <span m="3945850">is</span> <span m="3946265">that</span> <span m="3946680">on</span> <span m="3946830">x86,</span> <span m="3947190">every</span> <span m="3947540">single</span> <span m="3947990">instruction</span> <span m="3949330">in</span> <span m="3949480">one</span> <span m="3949700">way</span> <span m="3949800">or</span> <span m="3949920">another,</span> <span m="3951530">whenever it's</span> <span m="3951950">talking</span> <span m="3952230">about</span> <span m="3952480">memory,</span> <span m="3953050">actually</span> <span m="3953410">talks</span> <span m="3954110">about</span> <span m="3954310">memory</span> <span m="3954600">with</span> <span m="3954690">respect</span> <span m="3955150">to</span> <span m="3955210">a</span> <span m="3955270">particular</span> <span m="3956180">segment</span> <span m="3957140">in</span> <span m="3957320">this</span> <span m="3957480">table.</span> </p>
<p><span m="3958820">So for</span> <span m="3958900">example,</span> <span m="3959300">when</span> <span m="3959450">you</span> <span m="3959500">actually</span> <span m="3960430">do</span> <span m="3960510">something</span> <span m="3960830">like</span> <span m="3962132">move a</span> <span m="3962600">memory</span> <span m="3963080">value</span> <span m="3963940">from</span> <span m="3966170">a</span> <span m="3966450">pointer</span> <span m="3967250">stored</span> <span m="3967570">in the</span> <span m="3967650">EAX</span> <span m="3968185">register</span> <span m="3969130">into</span> <span m="3970080">maybe</span> <span m="3970300">another</span> <span m="3970640">pointer</span> <span m="3971330">stored</span> <span m="3971580">in the</span> <span m="3971940">EBX</span> <span m="3972400">register,</span> <span m="3973780">what</span> <span m="3974170">you</span> <span m="3974400">think</span> <span m="3974580">it</span> <span m="3974670">does is</span> <span m="3975120">it</span> <span m="3975290">figures</span> <span m="3975790">out,</span> <span m="3976150">well,</span> <span m="3976290">what's this</span> <span m="3976510">address?</span> <span m="3976960">It knows the memory</span> <span m="3977280">at this address.</span> <span m="3978050">And then</span> <span m="3978450">it figures</span> <span m="3978850">out, OK,</span> <span m="3979120">what's this</span> <span m="3979320">address?</span> <span m="3979580">And it</span> <span m="3979840">stores</span> <span m="3980090">the value</span> <span m="3980340">there.</span> <span m="3981700">But</span> <span m="3982070">in fact</span> <span m="3982420">on</span> <span m="3982770">x86,</span> <span m="3984540">whenever</span> <span m="3984620">you're</span> <span m="3984875">talking</span> <span m="3985130">about</span> <span m="3985250">memory,</span> <span m="3985680">there's an</span> <span m="3985900">implicit--</span> <span m="3986940">what's</span> <span m="3987280">called a</span> <span m="3987620">segment</span> <span m="3987900">descriptor,</span> <span m="3988874">which is</span> <span m="3989361">kind of like a</span> <span m="3989848">file descriptor</span> <span m="3990335">in Unix.</span> <span m="3990822">It's</span> <span m="3991309">just an</span> <span m="3991796">index into</span> <span m="3992283">this descriptor</span> <span m="3992770">table.</span> <span m="3993744">And</span> <span m="3994240">unless</span> <span m="3994920">specified</span> <span m="3995340">otherwise,</span> <span m="3995660">every</span> <span m="3995980">opcode</span> <span m="3996450">has</span> <span m="3996690">a</span> <span m="3996840">default</span> <span m="3997380">segment</span> <span m="3997830">in</span> <span m="3998160">it.</span> </p>
<p><span m="3998490">So</span> <span m="3999670">when</span> <span m="3999970">you're</span> <span m="4000345">doing a</span> <span m="4000720">move, this is</span> <span m="4001060">actually</span> <span m="4001420">relative</span> <span m="4002210">to</span> <span m="4002380">the</span> <span m="4002960">DS</span> <span m="4003310">or the</span> <span m="4003660">data</span> <span m="4004100">segment</span> <span m="4004810">register.</span> <span m="4005470">So it's</span> <span m="4005630">like a</span> <span m="4005690">special</span> <span m="4006080">register</span> <span m="4006455">in</span> <span m="4006830">your</span> <span m="4007120">CPU</span> <span m="4007790">that's</span> <span m="4008010">a</span> <span m="4008730">16-bit</span> <span m="4009770">integer,</span> <span m="4010163">if I</span> <span m="4010556">remember</span> <span m="4010950">correctly.</span> <span m="4011250">And that</span> <span m="4011450">16-bit</span> <span m="4012360">integer</span> <span m="4012665">points</span> <span m="4012970">into</span> <span m="4013840">the</span> <span m="4013920">descriptor</span> <span m="4014290">table.</span> <span m="4015020">And the</span> <span m="4015470">same here.</span> <span m="4015810">This is</span> <span m="4015920">actually the</span> <span m="4016230">relative</span> <span m="4016605">to that</span> <span m="4016980">DS</span> <span m="4017750">segment</span> <span m="4018400">selector.</span> <span m="4019370">Actually,</span> <span m="4019530">a</span> <span m="4019590">bunch</span> <span m="4019910">of</span> <span m="4020010">these</span> <span m="4020200">guys</span> <span m="4020510">are</span> <span m="4020610">6</span> <span m="4021040">segment</span> <span m="4021410">selectors</span> <span m="4021650">on</span> <span m="4022110">x86.</span> <span m="4022690">There's</span> <span m="4022840">a</span> <span m="4023280">code</span> <span m="4023610">selector</span> <span m="4024320">CS,</span> <span m="4024880">DS,</span> <span m="4025970">ES,</span> <span m="4026960">FS,</span> <span m="4027970">GS,</span> <span m="4028830">and</span> <span m="4029510">SS.</span> <span m="4030740">And</span> <span m="4033080">the</span> <span m="4033480">code</span> <span m="4033710">selector</span> <span m="4034030">is sort</span> <span m="4034270">of</span> <span m="4034650">implicitly</span> <span m="4035000">used to fetch the</span> <span m="4035320">instructions.</span> <span m="4036000">So if</span> <span m="4036210">your</span> <span m="4036550">instruction</span> <span m="4037070">pointer</span> <span m="4037410">points</span> <span m="4037720">somewhere,</span> <span m="4038360">it's</span> <span m="4038610">actually</span> <span m="4038950">relative</span> <span m="4039310">to</span> <span m="4039500">what</span> <span m="4039710">the</span> <span m="4040010">CS</span> <span m="4040390">segment</span> <span m="4040750">selector</span> <span m="4041030">says.</span> </p>
<p><span m="4042300">And</span> <span m="4043150">most</span> <span m="4043520">data</span> <span m="4043690">references</span> <span m="4044250">implicitly</span> <span m="4044760">use</span> <span m="4045210">either</span> <span m="4045500">DS or ES.</span> <span m="4046620">And</span> <span m="4046945">then</span> <span m="4047270">FS</span> <span m="4047430">and GS</span> <span m="4047570">are</span> <span m="4047840">some</span> <span m="4048490">special</span> <span m="4048560">things.</span> <span m="4048890">And</span> <span m="4049180">SS is</span> <span m="4049680">always</span> <span m="4049740">used</span> <span m="4050040">for the</span> <span m="4050230">stack</span> <span m="4050610">operations.</span> <span m="4050920">If you</span> <span m="4051230">push</span> <span m="4051480">and</span> <span m="4051600">pop,</span> <span m="4052260">they</span> <span m="4052610">implicitly</span> <span m="4053020">come</span> <span m="4053310">off</span> <span m="4053760">of this</span> <span m="4053880">segment</span> <span m="4054520">selector.</span> <span m="4055625">It's a</span> <span m="4055880">fairly</span> <span m="4056770">baroque</span> <span m="4057160">machinery,</span> <span m="4057870">but it</span> <span m="4058250">turns out to be</span> <span m="4058550">hugely</span> <span m="4059000">useful</span> <span m="4059400">for</span> <span m="4059540">this</span> <span m="4059740">particular</span> <span m="4060060">use case</span> <span m="4061270">because</span> <span m="4061750">what</span> <span m="4061950">happens</span> <span m="4062440">is</span> <span m="4063130">if</span> <span m="4063620">you</span> <span m="4064600">access</span> <span m="4065090">some</span> <span m="4065580">address</span> <span m="4065895">at</span> <span m="4066210">maybe</span> <span m="4066630">some</span> <span m="4067060">selector</span> <span m="4067830">DS:</span> <span m="4069890">some</span> <span m="4070370">offset</span> <span m="4071342">or some</span> <span m="4071834">address</span> <span m="4072326">here,</span> <span m="4073105">what</span> <span m="4073390">the</span> <span m="4073500">hardware</span> <span m="4074000">will</span> <span m="4074470">actually do is</span> <span m="4074520">translate</span> <span m="4074910">it</span> <span m="4075540">into--</span> <span m="4076640">well,</span> <span m="4077250">it'll</span> <span m="4077770">put</span> <span m="4078240">this</span> <span m="4078390">address,</span> <span m="4079250">and</span> <span m="4079460">it'll</span> <span m="4079680">add</span> <span m="4080740">the</span> <span m="4081210">table</span> <span m="4082230">of</span> <span m="4082560">DS,</span> <span m="4083994">the</span> <span m="4084472">base</span> <span m="4085335">to</span> <span m="4085720">this guy.</span> <span m="4087140">And</span> <span m="4087420">it'll</span> <span m="4087700">actually</span> <span m="4088120">take</span> <span m="4088350">the</span> <span m="4088430">address</span> <span m="4089330">modulo</span> <span m="4090730">the</span> <span m="4091140">length</span> <span m="4091820">from</span> <span m="4092120">the</span> <span m="4092230">same</span> <span m="4092510">table.</span> </p>
<p><span m="4093880">So</span> <span m="4094170">whenever</span> <span m="4094410">you're</span> <span m="4095212">doing a</span> <span m="4095604">memory</span> <span m="4095996">access,</span> <span m="4096390">it's actually</span> <span m="4096520">going to</span> <span m="4096785">have the</span> <span m="4097050">base</span> <span m="4097490">of</span> <span m="4097600">your</span> <span m="4098140">segment</span> <span m="4098470">selectors,</span> <span m="4100002">sort of</span> <span m="4100359">descriptor</span> <span m="4100859">table</span> <span m="4101244">entry,</span> <span m="4101630">and</span> <span m="4102069">take</span> <span m="4102340">your</span> <span m="4102740">address</span> <span m="4103200">that you're</span> <span m="4103529">actually</span> <span m="4103789">specifying</span> <span m="4104470">and</span> <span m="4104740">mod</span> <span m="4104990">it</span> <span m="4105250">with the</span> <span m="4105319">length</span> <span m="4105640">of the</span> <span m="4106569">corresponding</span> <span m="4106700">segment.</span> <span m="4108390">Does this</span> <span m="4108540">make</span> <span m="4108935">sense?</span> <span m="4109689">It's a</span> <span m="4110100">little</span> <span m="4110189">baroque,</span> <span m="4110970">but that's</span> <span m="4111130">what</span> <span m="4111535">[INAUDIBLE].</span> </p>
<p><span m="4112750">AUDIENCE: So</span> <span m="4113220">why</span> <span m="4113430">isn't this</span> <span m="4113870">used,</span> <span m="4114300">for example,</span> <span m="4114730">for</span> <span m="4115590">buffer</span> <span m="4116020">protection?</span> </p>
<p><span m="4116880">PROFESSOR: Yeah.</span> <span m="4117000">It's a</span> <span m="4117255">good</span> <span m="4117510">question.</span> <span m="4117775">So</span> <span m="4118180">could</span> <span m="4118500">you</span> <span m="4118670">use this</span> <span m="4118920">for</span> <span m="4119340">protecting</span> <span m="4119790">against</span> <span m="4120065">buffer</span> <span m="4120340">overflows?</span> <span m="4123729">What's</span> <span m="4124540">the plan?</span> <span m="4124910">You could</span> <span m="4125279">basically</span> <span m="4125680">set</span> <span m="4125870">up--</span> <span m="4127430">for</span> <span m="4127560">every</span> <span m="4127830">buffer</span> <span m="4128240">that you</span> <span m="4128340">have,</span> <span m="4128760">you</span> <span m="4128830">could</span> <span m="4129040">put</span> <span m="4129250">the</span> <span m="4129319">buffer's</span> <span m="4130040">base</span> <span m="4130399">here.</span> <span m="4131080">You</span> <span m="4131550">can put</span> <span m="4131680">the</span> <span m="4131910">size of the</span> <span m="4132109">buffer there.</span> </p>
<p><span m="4133896">AUDIENCE: What if</span> <span m="4134395">you don't</span> <span m="4134894">need to put</span> <span m="4135393">it there</span> <span m="4135892">before you want to</span> <span m="4136391">write to it?</span> <span m="4136890">You</span> <span m="4137389">wouldn't need</span> <span m="4137888">it there</span> <span m="4138387">constantly.</span> </p>
<p><span m="4138890">PROFESSOR: Yeah.</span> <span m="4139569">So</span> <span m="4139660">I</span> <span m="4139760">think</span> <span m="4139970">the</span> <span m="4140069">reason</span> <span m="4140439">that this</span> <span m="4140640">isn't</span> <span m="4141250">used so</span> <span m="4141510">much</span> <span m="4141819">for</span> <span m="4142490">protecting</span> <span m="4142800">against</span> <span m="4143250">buffer</span> <span m="4143550">overflows</span> <span m="4143910">is</span> <span m="4144300">that this</span> <span m="4144620">table</span> <span m="4145420">has</span> <span m="4145880">at</span> <span m="4146200">most</span> <span m="4146979">2</span> <span m="4147069">to</span> <span m="4147484">the</span> <span m="4147899">16</span> <span m="4148779">entries</span> <span m="4149140">because</span> <span m="4149319">these</span> <span m="4149649">descriptors</span> <span m="4150140">are actually</span> <span m="4150560">16</span> <span m="4150880">bits long.</span> <span m="4151605">And in fact,</span> <span m="4151870">a couple</span> <span m="4152310">of the</span> <span m="4152520">bits</span> <span m="4152670">are used</span> <span m="4152939">for</span> <span m="4153149">other</span> <span m="4153450">stuff.</span> <span m="4154380">So in</span> <span m="4154600">fact,</span> <span m="4154920">I think</span> <span m="4155029">you can only</span> <span m="4155290">stick</span> <span m="4155770">2</span> <span m="4155910">to the</span> <span m="4156060">13</span> <span m="4156419">entries</span> <span m="4157010">here.</span> <span m="4158010">So</span> <span m="4158189">if you</span> <span m="4158350">have</span> <span m="4158729">more</span> <span m="4158880">than</span> <span m="4159250">2</span> <span m="4159560">to the</span> <span m="4159870">13</span> <span m="4160550">variable</span> <span m="4161100">size</span> <span m="4161310">array</span> <span m="4161584">things</span> <span m="4161859">in</span> <span m="4162050">your</span> <span m="4162260">code,</span> <span m="4163120">then it's</span> <span m="4163560">probably</span> <span m="4164450">going to</span> <span m="4164680">overflow this</span> <span m="4165160">table.</span> <span m="4166220">That was</span> <span m="4166310">actually</span> <span m="4166930">a little</span> <span m="4167300">bit</span> <span m="4167470">weird</span> <span m="4167630">for the</span> <span m="4167910">compiler</span> <span m="4168180">to</span> <span m="4168450">manipulate</span> <span m="4168939">this table</span> <span m="4169479">because</span> <span m="4169920">the way</span> <span m="4170130">you</span> <span m="4170229">actually</span> <span m="4170439">manipulate</span> <span m="4170939">it</span> <span m="4171050">is</span> <span m="4171520">through system</span> <span m="4171990">calls.</span> </p>
<p><span m="4172140">So you</span> <span m="4172240">can't</span> <span m="4172430">actually</span> <span m="4172620">directly</span> <span m="4173029">write to</span> <span m="4173319">this</span> <span m="4173609">table.</span> <span m="4173899">You</span> <span m="4174189">have to</span> <span m="4174660">issue a</span> <span m="4174729">system</span> <span m="4175040">call to the</span> <span m="4175330">operating</span> <span m="4175729">system.</span> <span m="4176060">And the operating</span> <span m="4176390">system</span> <span m="4176649">will</span> <span m="4177240">pull this</span> <span m="4177560">table</span> <span m="4177880">into the</span> <span m="4178270">hardware</span> <span m="4178630">for</span> <span m="4178899">you.</span> <span m="4179800">So</span> <span m="4180130">I</span> <span m="4180229">think</span> <span m="4180410">most</span> <span m="4180640">compilers</span> <span m="4181390">just</span> <span m="4181680">don't</span> <span m="4182040">bother</span> <span m="4182750">having</span> <span m="4183065">this</span> <span m="4183380">complicated</span> <span m="4183680">story</span> <span m="4184689">for</span> <span m="4185279">managing</span> <span m="4185689">buffers.</span> <span m="4186550">Multex</span> <span m="4186750">actually</span> <span m="4186990">did this</span> <span m="4187430">though.</span> <span m="4187890">So</span> <span m="4188069">on</span> <span m="4188474">Multex,</span> <span m="4188880">you</span> <span m="4188979">actually</span> <span m="4189330">kind</span> <span m="4189819">of have</span> <span m="4190290">2</span> <span m="4190673">to</span> <span m="4191056">the</span> <span m="4191439">18</span> <span m="4192090">distinct</span> <span m="4192479">segments</span> <span m="4192979">and</span> <span m="4193140">2</span> <span m="4193479">to the</span> <span m="4193819">18</span> <span m="4194560">possible</span> <span m="4195030">offsets</span> <span m="4195100">within</span> <span m="4195150">a segment.</span> <span m="4195610">And</span> <span m="4196060">every</span> <span m="4197060">possible</span> <span m="4197670">shared</span> <span m="4197880">library</span> <span m="4198390">chunk or</span> <span m="4198560">chunk of</span> <span m="4199030">memory</span> <span m="4199330">was a</span> <span m="4199560">distinct segment.</span> <span m="4200020">And</span> <span m="4200500">then</span> <span m="4200930">they</span> <span m="4201210">would</span> <span m="4201360">all be</span> <span m="4201460">range checked,</span> <span m="4202240">not</span> <span m="4202630">maybe</span> <span m="4203140">at</span> <span m="4203250">the</span> <span m="4203410">variable</span> <span m="4203640">level.</span> <span m="4204137">But still.</span> <span m="4204634">Yeah.</span> </p>
<p><span m="4205628">AUDIENCE: Presumably,</span> <span m="4206125">it's also</span> <span m="4206622">a bit slower</span> <span m="4207119">if you have to tap</span> <span m="4207616">into the kernel</span> <span m="4208113">all the time</span> <span m="4208610">to--</span> </p>
<p><span m="4209110">PROFESSOR: That's</span> <span m="4209210">right. Yeah.</span> <span m="4209700">So there's</span> <span m="4210190">also the</span> <span m="4210545">overhead.</span> <span m="4211330">I</span> <span m="4211460">guess</span> <span m="4211995">to</span> <span m="4212290">set this</span> <span m="4212380">up,</span> <span m="4212740">there would</span> <span m="4213100">be some</span> <span m="4213355">overhead.</span> <span m="4213610">Or</span> <span m="4213900">if you</span> <span m="4214190">create a</span> <span m="4214660">new buffer</span> <span m="4215100">on the</span> <span m="4215180">stack,</span> <span m="4215740">all</span> <span m="4216030">of</span> <span m="4216320">a sudden,</span> <span m="4216390">you have to</span> <span m="4216670">call</span> <span m="4216920">in</span> <span m="4217090">to this</span> <span m="4217360">guy</span> <span m="4217600">and</span> <span m="4219980">add an</span> <span m="4220150">extra.</span> <span m="4220510">So yeah,</span> <span m="4220870">it</span> <span m="4221310">is nice</span> <span m="4221450">machinery.</span> <span m="4222150">But</span> <span m="4222790">it's</span> <span m="4222900">mostly</span> <span m="4223400">used</span> <span m="4223620">for</span> <span m="4223850">coarser</span> <span m="4224240">grain</span> <span m="4224790">things</span> <span m="4225287">because of</span> <span m="4225784">the overhead</span> <span m="4226281">of changing</span> <span m="4226778">it a bit.</span> <span m="4228269">Makes</span> <span m="4228766">sense?</span> <span m="4230760">All</span> <span m="4230970">right.</span> <span m="4231250">So</span> <span m="4231530">how many</span> <span m="4231890">of these</span> <span m="4232210">guys</span> <span m="4232390">actually</span> <span m="4232600">use</span> <span m="4232680">now</span> <span m="4232880">the</span> <span m="4232980">segmentation</span> <span m="4233550">machinery?</span> <span m="4233960">Well,</span> <span m="4234440">you</span> <span m="4234700">can sort of</span> <span m="4234960">guess</span> <span m="4235550">how it</span> <span m="4235820">works.</span> <span m="4236633">I</span> <span m="4237026">guess</span> <span m="4237420">by default</span> <span m="4237710">all these segments in</span> <span m="4238000">x86</span> <span m="4238910">have</span> <span m="4239190">a base</span> <span m="4239420">of</span> <span m="4239910">0</span> <span m="4240400">and a</span> <span m="4240550">length of</span> <span m="4240900">2 to the 32.</span> <span m="4241430">So you</span> <span m="4241850">can</span> <span m="4241910">access</span> <span m="4242150">the</span> <span m="4242230">entire range</span> <span m="4242580">of memory</span> <span m="4243100">you</span> <span m="4243420">could</span> <span m="4243540">possibly</span> <span m="4243900">want.</span> </p>
<p><span m="4244730">So</span> <span m="4244910">for</span> <span m="4245240">Native Client,</span> <span m="4246020">what they</span> <span m="4246410">do is</span> <span m="4246800">code in a</span> <span m="4247110">base of</span> <span m="4247440">0</span> <span m="4248120">and</span> <span m="4248405">a length</span> <span m="4248940">of</span> <span m="4249540">256</span> <span m="4250036">Megs.</span> <span m="4252520">And</span> <span m="4253750">then</span> <span m="4254050">they</span> <span m="4254180">point</span> <span m="4254990">all</span> <span m="4255480">these</span> <span m="4255800">six</span> <span m="4256300">segment</span> <span m="4256680">selector</span> <span m="4257255">registers</span> <span m="4257835">to</span> <span m="4258090">this</span> <span m="4258480">entry</span> <span m="4258850">for a</span> <span m="4259110">256</span> <span m="4259660">Meg</span> <span m="4260400">region.</span> <span m="4261070">So then</span> <span m="4261530">whenever</span> <span m="4261900">the</span> <span m="4262340">hardware</span> <span m="4262510">does a memory</span> <span m="4262790">access,</span> <span m="4263700">it's</span> <span m="4264060">going to</span> <span m="4264420">mod it.</span> <span m="4264700">The</span> <span m="4265130">offset</span> <span m="4265415">was</span> <span m="4265700">256</span> <span m="4266055">Megs.</span> <span m="4266410">So</span> <span m="4266610">it'll</span> <span m="4266880">be</span> <span m="4266990">restricted</span> <span m="4267570">to the</span> <span m="4268350">256</span> <span m="4268985">Meg</span> <span m="4269240">range of</span> <span m="4269690">memory</span> <span m="4270500">that's</span> <span m="4270850">allowed</span> <span m="4271590">for</span> <span m="4271880">the module to</span> <span m="4272190">[INAUDIBLE]</span> <span m="4272652">modify.</span> <span m="4274040">Makes</span> <span m="4274140">sense?</span> <span m="4276360">All</span> <span m="4276440">right.</span> <span m="4277850">So</span> <span m="4279290">I</span> <span m="4279710">guess</span> <span m="4280060">we sort</span> <span m="4280320">of</span> <span m="4280580">roughly</span> <span m="4280810">understand now this</span> <span m="4281050">hardware</span> <span m="4281370">support</span> <span m="4281800">and</span> <span m="4281930">how</span> <span m="4282190">this</span> <span m="4282320">works</span> <span m="4283370">and</span> <span m="4284290">how</span> <span m="4284925">you</span> <span m="4285260">could</span> <span m="4285400">eventually</span> <span m="4285630">do the</span> <span m="4285860">wealth</span> <span m="4286220">segment</span> <span m="4286530">selectors.</span> </p>
<p><span m="4288070">So if</span> <span m="4288280">we</span> <span m="4288390">just</span> <span m="4288590">implement</span> <span m="4288905">this</span> <span m="4289220">plan,</span> <span m="4291590">is there</span> <span m="4291730">anything</span> <span m="4291995">that could go</span> <span m="4292260">wrong?</span> <span m="4293380">Could we</span> <span m="4293860">escape</span> <span m="4294140">out</span> <span m="4294270">of</span> <span m="4294410">the</span> <span m="4294540">segment</span> <span m="4295140">selector</span> <span m="4297160">in the</span> <span m="4297530">untrusted</span> <span m="4297985">module?</span> <span m="4301170">I</span> <span m="4301625">guess</span> <span m="4302080">one</span> <span m="4302500">thing</span> <span m="4302700">you</span> <span m="4303010">have to</span> <span m="4303170">watch out</span> <span m="4303640">for</span> <span m="4303770">is that</span> <span m="4304460">these</span> <span m="4304710">registers</span> <span m="4305660">are</span> <span m="4305740">just</span> <span m="4305960">like</span> <span m="4306120">regular</span> <span m="4306590">registers.</span> <span m="4307010">And you can</span> <span m="4307080">actually</span> <span m="4307290">move</span> <span m="4307630">values</span> <span m="4307830">in and</span> <span m="4307950">out of them.</span> <span m="4308700">So you</span> <span m="4309160">have to</span> <span m="4309445">make sure</span> <span m="4309730">that the</span> <span m="4309810">untrusted</span> <span m="4309900">module</span> <span m="4311190">doesn't</span> <span m="4311630">tamper</span> <span m="4312040">with</span> <span m="4312210">these</span> <span m="4312370">registers,</span> <span m="4313310">the</span> <span m="4313410">segment</span> <span m="4313790">selectors,</span> <span m="4314220">because</span> <span m="4314730">somewhere</span> <span m="4315220">in</span> <span m="4315340">your</span> <span m="4315560">descriptor</span> <span m="4316470">table is</span> <span m="4316600">also</span> <span m="4316980">the</span> <span m="4317170">original</span> <span m="4317930">segment</span> <span m="4318830">descriptor</span> <span m="4319830">for</span> <span m="4320250">your</span> <span m="4320520">entire</span> <span m="4320790">process,</span> <span m="4321350">which</span> <span m="4321480">has a</span> <span m="4321540">base of</span> <span m="4321960">0</span> <span m="4322295">and a</span> <span m="4322630">length</span> <span m="4322870">of</span> <span m="4323000">2 to the</span> <span m="4323320">32.</span> </p>
<p><span m="4324560">So if</span> <span m="4324710">the untrusted</span> <span m="4325210">module</span> <span m="4325460">could</span> <span m="4325830">somehow</span> <span m="4326520">change</span> <span m="4327560">the</span> <span m="4327670">CS</span> <span m="4328170">or DS</span> <span m="4328400">or</span> <span m="4328740">ES</span> <span m="4329080">or</span> <span m="4329240">any</span> <span m="4329370">of these</span> <span m="4329590">guys</span> <span m="4330120">to</span> <span m="4330450">point</span> <span m="4331280">to</span> <span m="4331410">this</span> <span m="4331750">original</span> <span m="4332150">operating</span> <span m="4332560">system</span> <span m="4334460">that</span> <span m="4334890">covers</span> <span m="4335160">your</span> <span m="4335400">entire</span> <span m="4335660">address</span> <span m="4336120">space,</span> <span m="4336370">then</span> <span m="4336845">you could</span> <span m="4337320">then do memory</span> <span m="4337795">references</span> <span m="4338270">with respect</span> <span m="4338420">to this segment</span> <span m="4338750">and get</span> <span m="4339080">out</span> <span m="4339415">of</span> <span m="4339750">this</span> <span m="4340190">sandbox.</span> <span m="4342070">So</span> <span m="4343240">as a</span> <span m="4343660">result,</span> <span m="4344570">Native Client</span> <span m="4345100">has to add some</span> <span m="4345250">more</span> <span m="4345560">instructions</span> <span m="4346040">to this</span> <span m="4346520">prohibited</span> <span m="4347000">list.</span> <span m="4347930">So</span> <span m="4348040">I</span> <span m="4348130">think</span> <span m="4348380">they basically</span> <span m="4348870">prohibit</span> <span m="4349610">all</span> <span m="4349890">instructions</span> <span m="4350550">that</span> <span m="4351380">move</span> <span m="4351990">into</span> <span m="4352110">a</span> <span m="4352550">segment</span> <span m="4352830">selector</span> <span m="4353110">DS,</span> <span m="4353580">ES,</span> <span m="4354490">et</span> <span m="4354610">cetera,</span> <span m="4355590">so</span> <span m="4355760">that</span> <span m="4356530">once</span> <span m="4356810">you're</span> <span m="4357030">in</span> <span m="4357140">the</span> <span m="4357240">sandbox,</span> <span m="4357810">you</span> <span m="4358000">cannot</span> <span m="4359050">change</span> <span m="4360160">the</span> <span m="4360260">segment</span> <span m="4360790">that you</span> <span m="4360910">are</span> <span m="4361150">referencing</span> <span m="4361495">things</span> <span m="4361840">with</span> <span m="4362010">respect to.</span> <span m="4363472">Makes</span> <span m="4363958">sense?</span> <span m="4364444">Yeah.</span> </p>
<p><span m="4364930">AUDIENCE: The</span> <span m="4365416">segmentation such and such</span> <span m="4365902">provides</span> <span m="4366388">[INAUDIBLE].</span> </p>
<p><span m="4367135">PROFESSOR: Yeah.</span> <span m="4367390">So</span> <span m="4367600">it</span> <span m="4367920">turns</span> <span m="4368150">out</span> <span m="4368310">that on</span> <span m="4368640">x86,</span> <span m="4369678">the</span> <span m="4370086">instructions</span> <span m="4370494">to change</span> <span m="4370902">the</span> <span m="4371310">segment</span> <span m="4371650">descriptor table</span> <span m="4372040">are</span> <span m="4372200">privileged.</span> <span m="4373040">But</span> <span m="4373660">changing</span> <span m="4374140">these</span> <span m="4375040">indices</span> <span m="4375780">into the</span> <span m="4375900">table</span> <span m="4376210">are</span> <span m="4376550">completely unprivileged.</span> <span m="4378934">Yeah.</span> <span m="4380355">Other</span> <span m="4380840">questions?</span> <span m="4381220">Yeah.</span> </p>
<p><span m="4382120">AUDIENCE: Can you</span> <span m="4382380">initialize</span> <span m="4382610">the</span> <span m="4383090">table</span> <span m="4383430">to put</span> <span m="4383670">all</span> <span m="4384060">0</span> <span m="4384450">lengths</span> <span m="4385230">in</span> <span m="4385600">the</span> <span m="4385970">unused</span> <span m="4386430">slots?</span> </p>
<p><span m="4387380">PROFESSOR: Well,</span> <span m="4387870">yeah.</span> <span m="4388520">So the</span> <span m="4388780">unused</span> <span m="4389030">slots--</span> <span m="4389700">you could--</span> <span m="4390275">yeah.</span> <span m="4390960">You can</span> <span m="4391080">set the</span> <span m="4391410">length</span> <span m="4391760">of the</span> <span m="4391880">table to something</span> <span m="4392210">so</span> <span m="4392660">there</span> <span m="4392960">are</span> <span m="4393070">no</span> <span m="4393510">unused slots.</span> <span m="4394390">It</span> <span m="4394520">turns</span> <span m="4394790">out</span> <span m="4395120">that</span> <span m="4395620">you</span> <span m="4395730">actually</span> <span m="4396040">need</span> <span m="4396360">this</span> <span m="4396550">extra</span> <span m="4396950">slot</span> <span m="4397750">containing</span> <span m="4398460">0</span> <span m="4398870">and</span> <span m="4399190">2 to the</span> <span m="4399410">32</span> <span m="4400320">because</span> <span m="4400740">the</span> <span m="4400920">trusted</span> <span m="4401560">run time</span> <span m="4402120">is going to</span> <span m="4402330">need</span> <span m="4402620">to</span> <span m="4402950">run</span> <span m="4403235">in</span> <span m="4403520">this</span> <span m="4403670">segment</span> <span m="4404085">and</span> <span m="4404500">access</span> <span m="4404940">the</span> <span m="4405050">entire</span> <span m="4405365">memory</span> <span m="4405680">range.</span> <span m="4406230">So you</span> <span m="4406540">need</span> <span m="4407000">this</span> <span m="4407150">entry in</span> <span m="4407590">there</span> <span m="4408390">for the</span> <span m="4408690">trusted</span> <span m="4408990">runtime</span> <span m="4409470">to work.</span> <span m="4410390">Question?</span> </p>
<p><span m="4411150">AUDIENCE: [INAUDIBLE]</span> <span m="4411620">set list?</span> <span m="4412090">In order to</span> <span m="4412560">set the table</span> <span m="4413030">output</span> <span m="4413500">to</span> <span m="4413970">some</span> <span m="4414440">length,</span> <span m="4414920">do</span> <span m="4415250">you need to--</span> </p>
<p><span m="4415970">PROFESSOR: No,</span> <span m="4416330">actually.</span> <span m="4416615">It's</span> <span m="4416900">pretty cool.</span> <span m="4417420">It</span> <span m="4417690">was like</span> <span m="4417850">something</span> <span m="4418170">that you</span> <span m="4418330">don't have</span> <span m="4418670">any root</span> <span m="4418850">for.</span> <span m="4419470">On</span> <span m="4419730">Linux,</span> <span m="4420270">there's</span> <span m="4420470">actually a</span> <span m="4420560">system called--</span> <span m="4421050">I think</span> <span m="4421540">it's called</span> <span m="4422040">modify_ldt</span> <span m="4424550">for</span> <span m="4424900">local descriptor</span> <span m="4425560">table.</span> <span m="4426370">And</span> <span m="4426830">it</span> <span m="4427040">lets any</span> <span m="4427160">process</span> <span m="4427770">modify</span> <span m="4428150">its own</span> <span m="4428460">table.</span> <span m="4428780">These</span> <span m="4428960">tables</span> <span m="4429270">are</span> <span m="4429330">actually</span> <span m="4429710">per</span> <span m="4429920">process.</span> <span m="4431050">Well,</span> <span m="4431986">as everything in</span> <span m="4432442">x86,</span> <span m="4432900">it's actually more complicated.</span> <span m="4433250">There's a</span> <span m="4433600">global</span> <span m="4433860">table,</span> <span m="4434115">and there's a</span> <span m="4434370">local table.</span> <span m="4435296">But the</span> <span m="4435759">local table</span> <span m="4436222">is for a</span> <span m="4436685">process</span> <span m="4437148">you can modify</span> <span m="4437611">[INAUDIBLE].</span> <span m="4439930">Makes</span> <span m="4440040">sense?</span> <span m="4441416">All right.</span> <span m="4443760">OK.</span> </p>
<p><span m="4444100">So</span> <span m="4444410">I</span> <span m="4444510">guess</span> <span m="4444760">one</span> <span m="4444910">thing</span> <span m="4445100">we</span> <span m="4445475">could</span> <span m="4446140">now</span> <span m="4446380">try to</span> <span m="4446745">figure out is,</span> <span m="4447110">how</span> <span m="4447300">do</span> <span m="4447430">we</span> <span m="4448080">jump</span> <span m="4448410">in and</span> <span m="4448610">out</span> <span m="4449120">of</span> <span m="4449710">the</span> <span m="4450080">Native</span> <span m="4450370">Client</span> <span m="4451230">runtime</span> <span m="4451780">or</span> <span m="4452170">out</span> <span m="4452450">of</span> <span m="4452610">the</span> <span m="4452720">sandbox?</span> <span m="4454010">So what</span> <span m="4454310">does it</span> <span m="4454610">mean for us to</span> <span m="4454880">jump</span> <span m="4455180">out?</span> <span m="4455440">So</span> <span m="4455510">we</span> <span m="4455720">need to</span> <span m="4455850">run</span> <span m="4456040">that</span> <span m="4456260">trusted</span> <span m="4456450">code.</span> <span m="4457510">And</span> <span m="4457590">the trusted</span> <span m="4457690">code</span> <span m="4458000">lives</span> <span m="4458350">somewhere</span> <span m="4459170">up</span> <span m="4459540">above</span> <span m="4460180">the</span> <span m="4460370">256</span> <span m="4460900">Meg</span> <span m="4461330">limit.</span> <span m="4462190">And</span> <span m="4462630">in</span> <span m="4462720">order</span> <span m="4462970">to jump</span> <span m="4463240">there,</span> <span m="4463930">we</span> <span m="4464190">basically</span> <span m="4464470">have</span> <span m="4464750">to undo</span> <span m="4465210">all</span> <span m="4465400">these</span> <span m="4465620">protections</span> <span m="4466280">that</span> <span m="4466440">Native Client</span> <span m="4466960">sets in</span> <span m="4467280">place.</span> <span m="4468220">And</span> <span m="4468420">they</span> <span m="4468530">basically</span> <span m="4468840">boil</span> <span m="4469160">down</span> <span m="4469490">to</span> <span m="4470020">changing</span> <span m="4470530">these</span> <span m="4471180">selectors.</span> <span m="4472520">So</span> <span m="4472620">we</span> <span m="4472710">already--</span> <span m="4473100">I guess</span> <span m="4473300">our</span> <span m="4473480">validator</span> <span m="4473745">isn't</span> <span m="4474010">going to</span> <span m="4474380">enforce</span> <span m="4474880">the</span> <span m="4474960">same</span> <span m="4475160">rules</span> <span m="4475520">for</span> <span m="4475670">the</span> <span m="4475790">stuff</span> <span m="4476050">above</span> <span m="4476810">256 Megs.</span> <span m="4477880">So that's easy</span> <span m="4478340">enough.</span> <span m="4478800">But then</span> <span m="4479300">we</span> <span m="4479530">need to</span> <span m="4479720">somehow</span> <span m="4480240">jump</span> <span m="4480720">into</span> <span m="4481150">the</span> <span m="4481300">trusted</span> <span m="4481600">runtime</span> <span m="4482280">and</span> <span m="4482930">reset</span> <span m="4483500">these</span> <span m="4483630">segment</span> <span m="4484310">selectors</span> <span m="4484460">to the</span> <span m="4484620">right</span> <span m="4484960">values,</span> <span m="4485710">to</span> <span m="4485820">this</span> <span m="4487050">giant</span> <span m="4487490">segment</span> <span m="4487970">that</span> <span m="4488464">covers</span> <span m="4488958">the entire</span> <span m="4489946">process</span> <span m="4490440">address</span> <span m="4490934">space.</span> </p>
<p><span m="4491640">So the way</span> <span m="4491830">that works</span> <span m="4492130">on</span> <span m="4493340">Native Client</span> <span m="4494490">is</span> <span m="4494710">through this</span> <span m="4495040">mechanism</span> <span m="4495640">they call</span> <span m="4496220">trampolines</span> <span m="4496710">and</span> <span m="4498100">springboards.</span> <span m="4503730">So</span> <span m="4504210">all</span> <span m="4504390">these</span> <span m="4504570">guys</span> <span m="4504900">are</span> <span m="4505200">things</span> <span m="4505590">that</span> <span m="4506360">live</span> <span m="4506820">in</span> <span m="4507040">the</span> <span m="4507400">low</span> <span m="4507700">64k</span> <span m="4509110">of the</span> <span m="4510460">module.</span> <span m="4512020">And</span> <span m="4512470">the</span> <span m="4512770">cool thing</span> <span m="4512920">about</span> <span m="4513150">that</span> <span m="4513380">is</span> <span m="4513550">that</span> <span m="4514736">these are</span> <span m="4515120">going to</span> <span m="4515440">be</span> <span m="4515680">sort of</span> <span m="4516020">chunks of</span> <span m="4516230">code</span> <span m="4516420">laying at the lower</span> <span m="4516910">64k</span> <span m="4517750">of</span> <span m="4517980">that</span> <span m="4518130">process</span> <span m="4518405">space.</span> <span m="4518910">So</span> <span m="4519090">that</span> <span m="4519290">means</span> <span m="4519410">that</span> <span m="4520010">this</span> <span m="4520380">untrusted</span> <span m="4520750">module can</span> <span m="4521220">actually</span> <span m="4521460">jump</span> <span m="4521920">there</span> <span m="4522150">because</span> <span m="4522410">it's</span> <span m="4522570">a</span> <span m="4523010">valid</span> <span m="4523680">code</span> <span m="4523970">address.</span> <span m="4524850">It's going to</span> <span m="4525195">be on the</span> <span m="4525540">32</span> <span m="4525870">byte</span> <span m="4526100">boundary</span> <span m="4526440">potentially.</span> <span m="4527300">And</span> <span m="4527930">it's</span> <span m="4528050">going</span> <span m="4528160">to</span> <span m="4528210">be</span> <span m="4528340">within</span> <span m="4528600">the</span> <span m="4528760">256 Meg</span> <span m="4529160">limit.</span> <span m="4529630">So you can</span> <span m="4529890">jump</span> <span m="4530210">to</span> <span m="4530280">these</span> <span m="4530720">trampolines.</span> <span m="4531675">But</span> <span m="4531970">the</span> <span m="4532470">Native Client</span> <span m="4533010">runtime</span> <span m="4533540">is</span> <span m="4533690">going to</span> <span m="4534150">actually</span> <span m="4535070">copy</span> <span m="4535530">these</span> <span m="4535860">trampolines</span> <span m="4536370">from</span> <span m="4536540">somewhere</span> <span m="4536900">outside.</span> <span m="4537560">So</span> <span m="4537670">the</span> <span m="4538160">Native</span> <span m="4538450">Client</span> <span m="4538800">module</span> <span m="4539220">isn't</span> <span m="4539430">allowed</span> <span m="4539730">to</span> <span m="4540030">supply</span> <span m="4540430">its</span> <span m="4540700">own</span> <span m="4540970">trampoline</span> <span m="4541390">code.</span> <span m="4541730">The trampoline code</span> <span m="4542070">comes</span> <span m="4542290">from</span> <span m="4542400">the</span> <span m="4542500">trusted</span> <span m="4542800">runtime.</span> </p>
<p><span m="4543905">So as a result, it</span> <span m="4544390">actually</span> <span m="4544710">contains</span> <span m="4545220">all</span> <span m="4545340">these</span> <span m="4545800">sensitive</span> <span m="4545870">instructions,</span> <span m="4546800">like</span> <span m="4547040">moving</span> <span m="4547620">DS</span> <span m="4547770">and</span> <span m="4548025">CS,</span> <span m="4548510">et</span> <span m="4548980">cetera,</span> <span m="4550390">that</span> <span m="4551440">the</span> <span m="4551830">untrusted</span> <span m="4552220">code</span> <span m="4552400">itself</span> <span m="4552900">is</span> <span m="4553000">not</span> <span m="4553130">allowed</span> <span m="4553475">to have.</span> <span m="4555240">So</span> <span m="4555360">the way</span> <span m="4555610">you</span> <span m="4555710">actually</span> <span m="4556010">jump</span> <span m="4556270">out of</span> <span m="4556920">the</span> <span m="4557730">sandbox</span> <span m="4558320">and</span> <span m="4558650">into</span> <span m="4559060">the trusted</span> <span m="4559330">runtime</span> <span m="4559550">to</span> <span m="4559620">do</span> <span m="4559790">something</span> <span m="4560080">like</span> <span m="4560360">malop</span> <span m="4561010">or</span> <span m="4561420">create a</span> <span m="4561695">threat</span> <span m="4561970">is you</span> <span m="4562200">jump</span> <span m="4562690">to a trampoline,</span> <span m="4563170">which</span> <span m="4564790">lives</span> <span m="4565410">at a</span> <span m="4565650">32</span> <span m="4565950">byte</span> <span m="4566140">offset.</span> <span m="4566600">So</span> <span m="4566680">maybe</span> <span m="4566880">it's</span> <span m="4567020">an</span> <span m="4567130">address.</span> <span m="4568150">Well,</span> <span m="4568520">who knows?</span> <span m="4568970">Maybe</span> <span m="4569420">it's</span> <span m="4569830">4,096</span> <span m="4571060">plus</span> <span m="4571440">32.</span> <span m="4572430">And it's</span> <span m="4572890">going to have some</span> <span m="4573350">instructions</span> <span m="4574200">to</span> <span m="4574860">basically</span> <span m="4575200">undo</span> <span m="4575790">these</span> <span m="4576230">segment</span> <span m="4576580">selectors.</span> <span m="4576820">So what</span> <span m="4576960">it's probably</span> <span m="4577245">going to do</span> <span m="4577530">is</span> <span m="4577840">it's</span> <span m="4578290">going to</span> <span m="4579220">move</span> <span m="4579310">some</span> <span m="4580340">value--</span> <span m="4581080">I</span> <span m="4581200">don't</span> <span m="4581300">know,</span> <span m="4581490">maybe</span> <span m="4582150">7--</span> <span m="4582820">into</span> <span m="4583030">the</span> <span m="4583180">DS</span> <span m="4583560">register</span> <span m="4584370">and maybe</span> <span m="4584800">some</span> <span m="4584930">points</span> <span m="4585270">to this</span> <span m="4585550">entry here</span> <span m="4586420">that's</span> <span m="4586770">allowed</span> <span m="4587070">for</span> <span m="4587880">the</span> <span m="4587990">entire</span> <span m="4588940">2</span> <span m="4589430">to the 32</span> <span m="4589700">address</span> <span m="4589790">space.</span> </p>
<p><span m="4590670">And</span> <span m="4590820">then</span> <span m="4591390">you're going</span> <span m="4591645">to</span> <span m="4592190">effectively</span> <span m="4592650">move</span> <span m="4593140">CS</span> <span m="4593830">and</span> <span m="4593960">then</span> <span m="4594860">jump</span> <span m="4595200">somewhere</span> <span m="4595800">up</span> <span m="4596130">into</span> <span m="4596440">the</span> <span m="4596850">service</span> <span m="4597210">runtime.</span> <span m="4599140">And</span> <span m="4599400">this</span> <span m="4599510">is</span> <span m="4599650">basically</span> <span m="4600604">going to</span> <span m="4601078">be</span> <span m="4601552">past</span> <span m="4602026">256</span> <span m="4602974">Megs.</span> <span m="4604400">So</span> <span m="4604550">there's</span> <span m="4604750">going</span> <span m="4604930">to</span> <span m="4605010">be this</span> <span m="4605430">jump</span> <span m="4605700">in</span> <span m="4605850">here</span> <span m="4606190">that's</span> <span m="4606340">not</span> <span m="4606580">regularly</span> <span m="4607050">allowed.</span> <span m="4608140">But</span> <span m="4608640">we're</span> <span m="4608770">going</span> <span m="4608870">to</span> <span m="4609100">be</span> <span m="4609290">OK</span> <span m="4609690">with</span> <span m="4609890">it</span> <span m="4610010">because</span> <span m="4610280">it's</span> <span m="4610390">going</span> <span m="4610510">to</span> <span m="4610620">be</span> <span m="4611400">into</span> <span m="4611690">a</span> <span m="4611860">point</span> <span m="4612480">in the</span> <span m="4612922">trusted</span> <span m="4613364">service</span> <span m="4613806">runtime</span> <span m="4614248">that is</span> <span m="4614690">expecting these</span> <span m="4615132">jumps.</span> <span m="4615574">And it's</span> <span m="4616020">going to</span> <span m="4616360">perform proper</span> <span m="4616620">checks</span> <span m="4616930">afterwards</span> <span m="4618440">on</span> <span m="4618740">the</span> <span m="4620280">arguments</span> <span m="4620890">and</span> <span m="4620990">whatever</span> <span m="4621290">else</span> <span m="4621600">that is being</span> <span m="4621970">passed</span> <span m="4622220">around.</span> <span m="4623240">And</span> <span m="4623550">we can</span> <span m="4623860">actually do</span> <span m="4624180">this,</span> <span m="4624500">move DS</span> <span m="4624740">here,</span> <span m="4625060">because</span> <span m="4625310">we</span> <span m="4625480">know</span> <span m="4625550">that</span> <span m="4626280">it's</span> <span m="4626390">actually</span> <span m="4626510">safe.</span> <span m="4626840">The</span> <span m="4627190">code</span> <span m="4627360">we're</span> <span m="4627580">going to</span> <span m="4627690">jump</span> <span m="4627980">to</span> <span m="4628340">isn't going to</span> <span m="4628750">do</span> <span m="4629010">anything</span> <span m="4629350">arbitrary</span> <span m="4629480">or</span> <span m="4629785">funny</span> <span m="4630090">with our</span> <span m="4631946">untrusted</span> <span m="4632410">module.</span> <span m="4633340">Makes sense</span> <span m="4634340">roughly, what's</span> <span m="4634570">going</span> <span m="4634750">on?</span> </p>
<p><span m="4636930">So why</span> <span m="4637080">do</span> <span m="4637190">these</span> <span m="4637290">guys</span> <span m="4637790">bother</span> <span m="4637930">jumping</span> <span m="4638400">out</span> <span m="4638680">of</span> <span m="4638840">the</span> <span m="4638950">segments?</span> <span m="4639400">Like,</span> <span m="4640140">why not</span> <span m="4640250">just put the</span> <span m="4640360">whole</span> <span m="4640640">thing</span> <span m="4640890">in</span> <span m="4641530">the</span> <span m="4641740">trampoline?</span> <span m="4645310">It seems like</span> <span m="4645670">more</span> <span m="4646160">work</span> <span m="4646630">on</span> <span m="4647020">some level.</span> <span m="4647885">Yeah.</span> </p>
<p><span m="4648835">AUDIENCE: We only</span> <span m="4649310">have</span> <span m="4649785">64.</span> </p>
<p><span m="4650740">PROFESSOR: Yeah,</span> <span m="4651100">you</span> <span m="4651140">don't actually</span> <span m="4651440">have a</span> <span m="4651470">lot of</span> <span m="4651660">space.</span> <span m="4652270">Well,</span> <span m="4652920">I guess</span> <span m="4653180">you have</span> <span m="4653670">64k.</span> <span m="4654270">So that's</span> <span m="4654570">potentially</span> <span m="4655110">maybe</span> <span m="4655400">enough</span> <span m="4655500">for--</span> <span m="4656390">maybe</span> <span m="4656470">you can</span> <span m="4656720">move a</span> <span m="4657270">malop</span> <span m="4657390">in there.</span> <span m="4658140">But</span> <span m="4658250">the</span> <span m="4658370">problem</span> <span m="4658720">is</span> <span m="4658830">not</span> <span m="4659040">so</span> <span m="4659140">much</span> <span m="4659340">the</span> <span m="4659460">64k</span> <span m="4660240">thing</span> <span m="4660820">but</span> <span m="4661170">this</span> <span m="4661290">32</span> <span m="4661850">byte</span> <span m="4662040">restriction.</span> <span m="4663090">And</span> <span m="4663985">it's actually</span> <span m="4664290">not</span> <span m="4664590">a</span> <span m="4664860">restriction</span> <span m="4665380">on</span> <span m="4665670">the</span> <span m="4665760">trusted</span> <span m="4666085">code,</span> <span m="4666410">because</span> <span m="4666630">the</span> <span m="4666900">trusted code</span> <span m="4667290">can do</span> <span m="4667420">whatever</span> <span m="4667850">it wants</span> <span m="4668230">here.</span> <span m="4668490">It's not</span> <span m="4668630">going to</span> <span m="4668690">be</span> <span m="4668910">checked.</span> <span m="4669790">The</span> <span m="4669910">problem</span> <span m="4670390">is</span> <span m="4670630">that the</span> <span m="4671080">untrusted</span> <span m="4671660">code</span> <span m="4672290">can</span> <span m="4672520">jump</span> <span m="4672780">to</span> <span m="4672950">every</span> <span m="4673440">32</span> <span m="4673800">byte</span> <span m="4674110">offset.</span> <span m="4674890">So</span> <span m="4675070">every</span> <span m="4675405">32</span> <span m="4675740">byte</span> <span m="4675890">offset</span> <span m="4676160">has to</span> <span m="4676370">be</span> <span m="4676550">prepared</span> <span m="4677170">to</span> <span m="4677250">be</span> <span m="4677790">very</span> <span m="4677960">special</span> <span m="4678230">in its</span> <span m="4678500">arguments.</span> <span m="4679390">So</span> <span m="4679670">you</span> <span m="4679800">probably</span> <span m="4681180">are</span> <span m="4681290">going</span> <span m="4681410">to</span> <span m="4682180">have a</span> <span m="4682300">hard</span> <span m="4682610">time</span> <span m="4682810">writing</span> <span m="4683080">this</span> <span m="4683200">code</span> <span m="4683580">here</span> <span m="4684180">with</span> <span m="4684510">every</span> <span m="4684760">32</span> <span m="4685110">bytes</span> <span m="4685500">rechecking</span> <span m="4686030">the</span> <span m="4686120">arguments</span> <span m="4686440">and</span> <span m="4686730">values</span> <span m="4687035">and so</span> <span m="4687340">on.</span> </p>
<p><span m="4687970">So</span> <span m="4688250">basically,</span> <span m="4688580">you</span> <span m="4688660">have</span> <span m="4688850">to</span> <span m="4689020">jump</span> <span m="4689480">out</span> <span m="4689790">of</span> <span m="4689990">the</span> <span m="4690420">trampoline</span> <span m="4690980">and</span> <span m="4691150">into</span> <span m="4691900">the</span> <span m="4691960">runtime</span> <span m="4692290">up</span> <span m="4692620">here</span> <span m="4693210">within</span> <span m="4693790">32</span> <span m="4694250">bytes</span> <span m="4694740">of</span> <span m="4694860">code.</span> <span m="4697750">So</span> <span m="4697900">then</span> <span m="4698300">if you</span> <span m="4698520">jump</span> <span m="4698770">to</span> <span m="4698860">the</span> <span m="4698960">next</span> <span m="4699250">thing,</span> <span m="4699520">then,</span> <span m="4699840">well,</span> <span m="4700110">something</span> <span m="4700280">else is</span> <span m="4700740">going</span> <span m="4700840">to</span> <span m="4700880">happen</span> <span m="4701130">here.</span> <span m="4701500">But it's</span> <span m="4701680">not</span> <span m="4702620">part</span> <span m="4702820">of</span> <span m="4702920">this</span> <span m="4703620">same</span> <span m="4704100">trusted</span> <span m="4704550">routine</span> <span m="4705015">here.</span> <span m="4706410">Makes sense?</span> <span m="4708270">OK.</span> <span m="4708850">So this</span> <span m="4709210">is how you</span> <span m="4709710">sort of jump</span> <span m="4709980">out</span> <span m="4710260">of</span> <span m="4710420">the</span> <span m="4711320">sandbox.</span> <span m="4712060">To</span> <span m="4712170">jump</span> <span m="4712480">back</span> <span m="4712780">in,</span> <span m="4714004">you</span> <span m="4714496">also need</span> <span m="4714990">to--</span> <span m="4715110">you</span> <span m="4715600">basically</span> <span m="4716090">need to</span> <span m="4716450">invert</span> <span m="4716810">these</span> <span m="4717220">transformations.</span> <span m="4717850">You need to</span> <span m="4718342">sort of</span> <span m="4718834">set</span> <span m="4719326">the</span> <span m="4719820">DS</span> <span m="4720030">back</span> <span m="4720420">and CS back and</span> <span m="4720685">so on.</span> <span m="4721280">And the</span> <span m="4721420">tricky</span> <span m="4721725">thing is</span> <span m="4722030">that</span> <span m="4722590">if</span> <span m="4722710">you're</span> <span m="4722940">running</span> <span m="4723480">outside</span> <span m="4724320">of</span> <span m="4724660">this</span> <span m="4725450">256</span> <span m="4726280">Meg</span> <span m="4726540">limit,</span> <span m="4727770">if</span> <span m="4727850">you're</span> <span m="4727990">running</span> <span m="4728250">inside</span> <span m="4728580">of</span> <span m="4728640">the</span> <span m="4728750">trusted</span> <span m="4729040">run</span> <span m="4729300">time,</span> <span m="4729660">then</span> <span m="4730100">you</span> <span m="4730320">can't</span> <span m="4730690">really</span> <span m="4731120">reset</span> <span m="4731380">these</span> <span m="4731590">registers</span> <span m="4732240">yet,</span> <span m="4733060">because</span> <span m="4733340">otherwise,</span> <span m="4733730">you</span> <span m="4733810">won't</span> <span m="4734010">then</span> <span m="4734550">be able</span> <span m="4734710">to access</span> <span m="4734960">any of</span> <span m="4735320">the memory in</span> <span m="4735680">your</span> <span m="4737370">space</span> <span m="4737690">outside.</span> </p>
<p><span m="4738690">So</span> <span m="4738950">what</span> <span m="4739180">they</span> <span m="4739640">actually do is</span> <span m="4739800">they have this</span> <span m="4739970">thing</span> <span m="4740120">called</span> <span m="4740310">a</span> <span m="4740370">springboard,</span> <span m="4741050">which</span> <span m="4741230">is</span> <span m="4741870">how</span> <span m="4742420">the</span> <span m="4742750">trusted</span> <span m="4743211">runtime</span> <span m="4744133">from outside</span> <span m="4744594">the</span> <span m="4745055">256 Meg</span> <span m="4745516">limit</span> <span m="4745980">is</span> <span m="4746270">actually going to</span> <span m="4746700">jump back into</span> <span m="4746970">the</span> <span m="4747090">Native</span> <span m="4747360">Client</span> <span m="4747710">module.</span> <span m="4748310">So</span> <span m="4748570">here</span> <span m="4748910">it's</span> <span m="4749180">going to</span> <span m="4749450">reload</span> <span m="4750240">the</span> <span m="4750790">DS</span> <span m="4751510">register</span> <span m="4752370">with</span> <span m="4752690">maybe</span> <span m="4753250">whatever</span> <span m="4753707">that</span> <span m="4754164">limit</span> <span m="4754621">in</span> <span m="4755080">the</span> <span m="4755200">segment</span> <span m="4755330">descriptor</span> <span m="4755695">is.</span> <span m="4756060">Maybe let's say</span> <span m="4756260">it's 1.</span> <span m="4757180">And</span> <span m="4757670">then</span> <span m="4758160">it's going to</span> <span m="4758570">reset</span> <span m="4758875">other things,</span> <span m="4759180">and</span> <span m="4759450">then</span> <span m="4759640">it'll</span> <span m="4759860">jump</span> <span m="4760840">to</span> <span m="4762080">whatever</span> <span m="4762670">address</span> <span m="4764190">the</span> <span m="4764500">trusted</span> <span m="4764810">runtime</span> <span m="4765430">wants to</span> <span m="4765730">return</span> <span m="4766280">to</span> <span m="4767460">in the</span> <span m="4768560">untrusted</span> <span m="4768896">module.</span> <span m="4770640">Makes</span> <span m="4770960">sense?</span> <span m="4771230">So this is</span> <span m="4771530">how you sort of</span> <span m="4771830">jump back</span> <span m="4772100">in.</span> <span m="4772650">And the only</span> <span m="4772990">sort</span> <span m="4773430">of</span> <span m="4773610">tricky</span> <span m="4773860">piece here</span> <span m="4774400">is that</span> <span m="4774650">you</span> <span m="4774890">don't</span> <span m="4775130">want</span> <span m="4775830">the</span> <span m="4776300">untrusted</span> <span m="4777210">code</span> <span m="4777670">to</span> <span m="4777820">jump</span> <span m="4778120">into</span> <span m="4778320">the</span> <span m="4778600">springboard</span> <span m="4779020">itself.</span> <span m="4779840">Maybe</span> <span m="4780100">something weird</span> <span m="4780380">will happen.</span> <span m="4780660">Who</span> <span m="4781080">knows?</span> </p>
<p><span m="4781920">So</span> <span m="4782120">what they</span> <span m="4782250">do</span> <span m="4782540">is they</span> <span m="4782680">actually</span> <span m="4783290">put</span> <span m="4783520">a</span> <span m="4783560">halt</span> <span m="4783890">instruction</span> <span m="4784940">as</span> <span m="4785060">the</span> <span m="4785150">first</span> <span m="4785750">byte</span> <span m="4786580">of this</span> <span m="4787210">32</span> <span m="4787320">byte</span> <span m="4787550">multiple</span> <span m="4787950">sequence.</span> <span m="4789330">So</span> <span m="4789830">if you</span> <span m="4790130">jump</span> <span m="4791990">to</span> <span m="4792300">the</span> <span m="4792610">beginning of</span> <span m="4792650">this guy, you'll</span> <span m="4793020">immediately</span> <span m="4793580">halt.</span> <span m="4794300">The</span> <span m="4794590">trusted</span> <span m="4795070">runtime</span> <span m="4795750">is</span> <span m="4795880">going</span> <span m="4795980">to</span> <span m="4796070">jump</span> <span m="4796320">to</span> <span m="4796410">one</span> <span m="4796790">past</span> <span m="4797850">this</span> <span m="4798120">byte</span> <span m="4799070">and</span> <span m="4799350">be</span> <span m="4799470">able</span> <span m="4800060">to</span> <span m="4800150">execute the</span> <span m="4800500">springboard.</span> <span m="4801165">But</span> <span m="4801430">this is</span> <span m="4801910">something</span> <span m="4802190">that only</span> <span m="4802650">the trusted</span> <span m="4803110">runtime</span> <span m="4803570">can do</span> <span m="4804030">because</span> <span m="4804490">regularly</span> <span m="4804846">checked,</span> <span m="4805202">this is not</span> <span m="4805560">going to be allowed.</span> <span m="4805950">Question?</span> </p>
<p><span m="4806340">AUDIENCE: Wait.</span> <span m="4806746">Is it a</span> <span m="4807152">springboard</span> <span m="4807710">in</span> <span m="4807980">the</span> <span m="4808420">untrusted</span> <span m="4808630">module?</span> </p>
<p><span m="4809570">PROFESSOR: So</span> <span m="4809900">the</span> <span m="4810100">springboard</span> <span m="4810360">is</span> <span m="4810620">within</span> <span m="4811040">the</span> <span m="4811920">0 to</span> <span m="4812360">256 Meg</span> <span m="4813240">part</span> <span m="4813600">of the</span> <span m="4813960">untrusted module.</span> <span m="4814500">But</span> <span m="4814785">it</span> <span m="4815070">actually</span> <span m="4815965">lives</span> <span m="4816360">in that</span> <span m="4816755">64 bit</span> <span m="4817150">chunk at</span> <span m="4817270">the</span> <span m="4817350">very</span> <span m="4817560">beginning</span> <span m="4818240">that</span> <span m="4818370">doesn't</span> <span m="4818850">actually come</span> <span m="4819250">from the</span> <span m="4819540">binary</span> <span m="4819830">you download</span> <span m="4820270">from</span> <span m="4820400">some</span> <span m="4820560">website.</span> <span m="4821300">But</span> <span m="4821580">it's</span> <span m="4821990">actually</span> <span m="4822340">patched into</span> <span m="4822460">it</span> <span m="4822690">by</span> <span m="4823120">the</span> <span m="4823220">Native</span> <span m="4823480">Client</span> <span m="4823830">runtime</span> <span m="4824630">when it</span> <span m="4824950">first</span> <span m="4825315">loads</span> <span m="4825680">this module</span> <span m="4826161">into memory.</span> </p>
<p><span m="4827123">AUDIENCE: Why</span> <span m="4827604">not just have</span> <span m="4828085">it in</span> <span m="4828566">the</span> <span m="4829047">runtime?</span> </p>
<p><span m="4829530">PROFESSOR: Yeah.</span> <span m="4829880">So</span> <span m="4830020">why not</span> <span m="4830110">have it in</span> <span m="4830610">the runtime?</span> <span m="4830780">So</span> <span m="4831020">what</span> <span m="4831150">happens</span> <span m="4831420">if</span> <span m="4831840">the</span> <span m="4831970">runtime</span> <span m="4832400">was</span> <span m="4832470">allowed</span> <span m="4832890">to</span> <span m="4833310">supply</span> <span m="4833480">the springboard?</span> <span m="4838269">Is this</span> <span m="4838720">bad?</span> <span m="4843094">Yeah.</span> </p>
<p><span m="4844528">AUDIENCE: How</span> <span m="4845006">would it</span> <span m="4845484">know--</span> <span m="4846918">how would</span> <span m="4847396">it know</span> <span m="4847874">where</span> <span m="4848352">to jump</span> <span m="4848830">back to?</span> </p>
<p><span m="4849320">PROFESSOR: Well,</span> <span m="4849740">I</span> <span m="4849940">think</span> <span m="4850390">what this</span> <span m="4850690">actually</span> <span m="4851140">is  is it</span> <span m="4851590">actually</span> <span m="4851930">jumps</span> <span m="4852540">to</span> <span m="4852870">something</span> <span m="4853150">like</span> <span m="4853370">EAX.</span> <span m="4854290">So</span> <span m="4854460">the</span> <span m="4854620">trusted</span> <span m="4855010">runtime</span> <span m="4855360">says,</span> <span m="4855650">oh, I</span> <span m="4855780">want</span> <span m="4855950">to</span> <span m="4855990">return</span> <span m="4856390">to this</span> <span m="4856866">address.</span> <span m="4857342">It puts it on the</span> <span m="4857820">EAX</span> <span m="4858170">register,</span> <span m="4858520">jumps</span> <span m="4858830">here.</span> <span m="4859580">The</span> <span m="4859770">springboard</span> <span m="4860040">does</span> <span m="4860310">this,</span> <span m="4860655">this, this</span> <span m="4861000">and then</span> <span m="4861458">jumps to</span> <span m="4861916">EAX,</span> <span m="4862374">wherever the</span> <span m="4862832">trusted runtime's</span> <span m="4863290">set up to jump.</span> <span m="4865130">So what</span> <span m="4865490">if the</span> <span m="4866080">module</span> <span m="4866380">came</span> <span m="4866780">with its</span> <span m="4867060">own</span> <span m="4867280">springboard?</span> </p>
<p><span m="4868960">AUDIENCE: Well,</span> <span m="4870620">you could</span> <span m="4871000">do it</span> <span m="4871380">as</span> <span m="4871760">a</span> <span m="4872170">natural</span> <span m="4872300">jump</span> <span m="4872740">type</span> <span m="4873170">thing.</span> <span m="4873550">But it</span> <span m="4873930">shouldn't</span> <span m="4874393">know anything</span> <span m="4874856">about the</span> <span m="4875319">descriptor table.</span> <span m="4875782">That's a</span> <span m="4876245">hardware--</span> </p>
<p><span m="4876710">PROFESSOR: Yeah.</span> <span m="4877180">So</span> <span m="4877560">actually,</span> <span m="4877840">this</span> <span m="4878140">is</span> <span m="4878610">a</span> <span m="4878790">really</span> <span m="4879060">important</span> <span m="4879320">instruction</span> <span m="4879780">for</span> <span m="4879920">sandboxing,</span> <span m="4880500">the</span> <span m="4880690">fact</span> <span m="4880960">that we</span> <span m="4881230">reload</span> <span m="4881660">that</span> <span m="4881760">descriptor</span> <span m="4882025">to</span> <span m="4882290">point</span> <span m="4882780">at</span> <span m="4883110">one of</span> <span m="4883290">those</span> <span m="4883460">limited</span> <span m="4883530">descriptors</span> <span m="4883950">up</span> <span m="4884100">there.</span> <span m="4885130">It's</span> <span m="4885260">really</span> <span m="4885430">important.</span> <span m="4886220">And</span> <span m="4886600">if</span> <span m="4886980">the</span> <span m="4888190">module</span> <span m="4888540">was</span> <span m="4888740">allowed to</span> <span m="4889110">supply</span> <span m="4889480">its own</span> <span m="4889850">springboard,</span> <span m="4890360">maybe</span> <span m="4890450">it'll</span> <span m="4890770">just</span> <span m="4890890">skip</span> <span m="4891250">this</span> <span m="4891430">part</span> <span m="4892640">and</span> <span m="4892730">then</span> <span m="4893060">not</span> <span m="4893550">restrict</span> <span m="4893910">itself</span> <span m="4894205">back to</span> <span m="4894500">256</span> <span m="4894860">Megs.</span> <span m="4895750">So</span> <span m="4895990">once</span> <span m="4896330">you</span> <span m="4896460">jump</span> <span m="4896760">through</span> <span m="4896960">the</span> <span m="4897020">springboard,</span> <span m="4897640">you'll</span> <span m="4897750">be</span> <span m="4897880">able</span> <span m="4898100">to</span> <span m="4898190">still</span> <span m="4898510">access</span> <span m="4898810">the</span> <span m="4898910">entire</span> <span m="4899400">process</span> <span m="4899850">address space.</span> <span m="4901050">So</span> <span m="4902040">the</span> <span m="4902150">springboard</span> <span m="4902455">is</span> <span m="4902900">part</span> <span m="4903100">of</span> <span m="4903170">the</span> <span m="4903260">enforcement</span> <span m="4903790">mechanism.</span> <span m="4904075">It sort</span> <span m="4904360">of sets</span> <span m="4904790">up</span> <span m="4904970">the</span> <span m="4905060">boundaries.</span> <span m="4906050">So</span> <span m="4906340">this is the</span> <span m="4906740">reason</span> <span m="4907110">why</span> <span m="4907490">I think they</span> <span m="4907720">don't</span> <span m="4908070">want</span> <span m="4908270">the</span> <span m="4908330">springboard</span> <span m="4908920">to</span> <span m="4909030">come</span> <span m="4909660">from</span> <span m="4910060">the</span> <span m="4910440">developer.</span> <span m="4911914">Now--</span> <span m="4912336">yeah,</span> <span m="4912760">question?</span> </p>
<p><span m="4913440">AUDIENCE: Can you</span> <span m="4913580">put the</span> <span m="4913730">springboard</span> <span m="4914200">past</span> <span m="4914980">256</span> <span m="4915880">megabytes?</span> </p>
<p><span m="4916750">PROFESSOR: So</span> <span m="4916910">I</span> <span m="4917000">think</span> <span m="4917550">they</span> <span m="4918050">don't</span> <span m="4918270">want</span> <span m="4918650">to</span> <span m="4918740">put the</span> <span m="4919070">springboard</span> <span m="4919400">past the</span> <span m="4919821">256</span> <span m="4920663">Megs</span> <span m="4921505">because</span> <span m="4922330">then you</span> <span m="4922500">might</span> <span m="4922730">have</span> <span m="4923000">trouble</span> <span m="4923470">jumping</span> <span m="4924050">down.</span> <span m="4924450">So</span> <span m="4924775">you</span> <span m="4925100">want to</span> <span m="4926010">jump</span> <span m="4926380">to a</span> <span m="4926560">particular</span> <span m="4926840">address,</span> <span m="4927720">but you</span> <span m="4927880">also</span> <span m="4928190">want</span> <span m="4928350">to</span> <span m="4929250">set up extra</span> <span m="4929400">registers</span> <span m="4929800">here.</span> <span m="4930780">So</span> <span m="4931210">if</span> <span m="4931390">you're--</span> <span m="4933290">I</span> <span m="4933350">think</span> <span m="4933570">this basically</span> <span m="4933820">has</span> <span m="4933980">to--</span> <span m="4934110">sorry.</span> <span m="4934660">This</span> <span m="4934910">has to</span> <span m="4935040">do</span> <span m="4935240">with</span> <span m="4935560">setting</span> <span m="4935900">that</span> <span m="4936130">CS</span> <span m="4936770">code</span> <span m="4937000">descriptor</span> <span m="4937500">segment</span> <span m="4938305">because</span> <span m="4938610">you want</span> <span m="4938790">to</span> <span m="4939020">set</span> <span m="4939330">the</span> <span m="4939640">code</span> <span m="4939910">descriptor</span> <span m="4940645">segment</span> <span m="4940930">to</span> <span m="4941440">this</span> <span m="4941590">bounded</span> <span m="4942030">segment,</span> <span m="4942850">and you</span> <span m="4943060">want to</span> <span m="4943430">jump</span> <span m="4943790">to some</span> <span m="4944070">particular</span> <span m="4944345">address at</span> <span m="4944620">the</span> <span m="4944720">same</span> <span m="4944980">time.</span> <span m="4945850">So</span> <span m="4946060">I</span> <span m="4946110">think</span> <span m="4946410">it's</span> <span m="4946870">easier for these</span> <span m="4947050">guys</span> <span m="4947330">to do</span> <span m="4947680">it through</span> <span m="4947840">a springboard</span> <span m="4948340">because</span> <span m="4948600">you</span> <span m="4949200">first</span> <span m="4949500">sort of</span> <span m="4949740">jump</span> <span m="4950010">to</span> <span m="4950050">here.</span> </p>
<p><span m="4950640">Then you</span> <span m="4950720">can set</span> <span m="4951090">your CS</span> <span m="4951970">value.</span> <span m="4952690">But</span> <span m="4952900">you can</span> <span m="4953100">still</span> <span m="4953450">execute</span> <span m="4953680">the same</span> <span m="4953830">code</span> <span m="4954060">you're</span> <span m="4954220">still</span> <span m="4954410">running</span> <span m="4956540">because</span> <span m="4956670">you're</span> <span m="4957100">within the</span> <span m="4957565">256</span> <span m="4958495">bound.</span> <span m="4960355">Makes sense?</span> <span m="4962215">I think</span> <span m="4962690">basically</span> <span m="4962980">it</span> <span m="4963270">has</span> <span m="4963440">to</span> <span m="4963540">do</span> <span m="4963710">with</span> <span m="4964100">what</span> <span m="4964500">atomic</span> <span m="4965100">primitives</span> <span m="4965700">the</span> <span m="4965970">hardware</span> <span m="4966300">provides</span> <span m="4966630">to</span> <span m="4966910">you.</span> <span m="4967510">So</span> <span m="4967820">basically,</span> <span m="4968030">you want</span> <span m="4968090">to</span> <span m="4968450">set a</span> <span m="4968860">whole</span> <span m="4968970">bunch</span> <span m="4969395">of these</span> <span m="4969820">DS</span> <span m="4970040">segment selector</span> <span m="4970250">registers</span> <span m="4970830">and</span> <span m="4971170">the</span> <span m="4971390">CS</span> <span m="4971440">register</span> <span m="4972090">and jump</span> <span m="4972190">to somewhere</span> <span m="4972475">at the</span> <span m="4972760">same</span> <span m="4972980">time.</span> <span m="4973870">So</span> <span m="4974985">this</span> <span m="4975480">is</span> <span m="4975660">one</span> <span m="4975760">way</span> <span m="4976877">for them</span> <span m="4977324">to do it.</span> <span m="4979560">I think that's</span> <span m="4979890">maybe</span> <span m="4980080">not</span> <span m="4980900">as</span> <span m="4981470">[INAUDIBLE].</span> <span m="4982330">Probably,</span> <span m="4983140">if you</span> <span m="4983370">tried</span> <span m="4983820">hard,</span> <span m="4984100">you could</span> <span m="4984240">probably</span> <span m="4984550">come</span> <span m="4984700">up</span> <span m="4984840">with</span> <span m="4984960">some</span> <span m="4985100">x86</span> <span m="4985410">instruction</span> <span m="4986020">sequence</span> <span m="4986250">that could</span> <span m="4986730">do it</span> <span m="4987210">from</span> <span m="4987546">outside</span> <span m="4988220">the</span> <span m="4989230">bound</span> <span m="4989490">of the</span> <span m="4989810">address space</span> <span m="4990268">in the module.</span> <span m="4992558">Makes sense?</span> <span m="4993474">All right.</span> <span m="4993932">So I</span> <span m="4994390">guess</span> <span m="4994550">that's</span> <span m="4994800">it</span> <span m="4994920">for</span> <span m="4995750">Native Client.</span> <span m="4997212">And</span> <span m="4997640">I'll see you</span> <span m="4997820">guys</span> <span m="4998050">next</span> <span m="4998280">week.</span> <span m="4998580">We'll</span> <span m="4998880">talk about</span> <span m="4999180">web</span> <span m="4999480">security</span> <span m="4999780">as far as</span> <span m="5000080">I know.</span> </p>
</div>
        <div id="vid_related" itemprop="description" class="tabContent hide">
<h2 class="subhead">Free Downloads</h2>
<h3 class="subsubhead">Video</h3>
<ul>
<li>iTunes U (<a href="https://itunes.apple.com/us/itunes-u/id1017908130">MP4 - 185MB</a>)</li>
<li>Internet Archive (<a href="https://archive.org/download/MIT6.858F14/MIT6_858F14_lec07_300k.mp4">MP4 - 185MB</a>)</li>
</ul>
<br>
<h3 class="subsubhead">Caption</h3>
<ul>
<li>English-US (<a href="../../../contents/video-lectures/lecture-7-sandboxing-native-code/I0Psvvky-44.srt">SRT</a>)</li>
</ul>
</div>
    
   </div>  




      					 
        <div class="" id="parent-fieldname-bottom_html_area">
            
            
        </div>
    
               </main><!--Course_inner_media tag close -->
           		</div>
<!--Course_wrapper tag close -->
            </div>
<!--left tag close -->
            <aside id="right">
                <!--Begin Right Portion -->
                    <div>
    



</div>

                	<div>
    



</div>


        <div class="" id="parent-fieldname-rsi_top_html_area">
            
            
        </div>
    

<!-- RSI google ad space-->



<div id="google_ads">    
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script type="text/javascript">var googletag = googletag || {}; googletag.cmd = googletag.cmd || [];</script>
    <script type="text/javascript">
googletag.cmd.push(function() {googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_A_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_A_DL').addService(googletag.pubads());googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_B_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_B_DL').addService(googletag.pubads());googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_C_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_C_DL').addService(googletag.pubads());
googletag.pubads().enableSingleRequest();
 googletag.enableServices();
});</script>
    <script language="javascript" type="text/javascript">
googletag.cmd.push(function() {googletag.pubads().set("TYPE","HOUSE");googletag.pubads().set("DEPARTMENT","6");googletag.pubads().set("CRS_BEG2","85");googletag.pubads().set("CRS_END","8");googletag.pubads().set("SESSION","F");googletag.pubads().set("YEAR","14");})
</script>
    
    <div id="VIDEO_INDIVIDUAL_SLOT_A_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_A_DL'); });</script>
    </div>
    <div id="VIDEO_INDIVIDUAL_SLOT_B_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_B_DL'); });</script>
    </div>
    <div id="VIDEO_INDIVIDUAL_SLOT_C_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_C_DL'); });</script>
    </div>
</div>

<!-- End RSI ads--> 


<div>
    



</div>

            </aside><!--Right div close -->
            <div class="clear"></div>
        </div>
<!--grid tag close -->
      </div>
		
		<footer id="bottom">
			<div id="grid">
				
<div id="portletwrapper-6f63772e626f74746f6d706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d666f6f746572" class="portletWrapper kssattr-portlethash-6f63772e626f74746f6d706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d666f6f746572">
<div class="portletStaticText portlet-static-site-footer"><div id="footer">
<nav aria-label="Footer">     <nav id="foot-c1" class="grid_2 alpha" aria-labelledby="f-find-courses">       <span class="footer" id="f-find-courses" aria-hidden="true">Find Courses</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/courses/find-by-topic/">Find by Topic</a></li>
    <li><a href="https://ocw.mit.edu/courses/find-by-number/">Find by Course Number</a></li>
    <li><a href="https://ocw.mit.edu/courses/find-by-department/">Find by Department</a></li>
    <li><a href="https://ocw.mit.edu/courses/new-courses/">New Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/most-visited-courses/">Most Visited Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/ocw-scholar/">OCW Scholar Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/audio-video-courses/">Audio/Video Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/online-textbooks/">Online Textbooks</a></li>
    <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights</a></li>
    <li><a href="https://ocw.mit.edu/resources/">Supplemental Resources</a></li>
    <li><a href="https://ocw.mit.edu/courses/mitx-related-courseware/">MITx &amp; Related OCW Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/mit-open-learning-library/">MIT Open Learning Library</a></li>
    <li><a href="https://ocw.mit.edu/courses/translated-courses/">Translated Courses</a></li>
</ul>
</nav>
<div id="foot-c2" class="grid_2"><nav aria-labelledby="f-for-educators">         <span id="f-for-educators" class="footer" aria-hidden="true">For Educators</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://chalk-radio.simplecast.com/">Chalk Radio Podcast</a></li>
    <li><a href="https://ocw.mit.edu/educator/">OCW Educator Portal </a></li>
    <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights by Department</a></li>
    <li><a href="https://openlearning.mit.edu/campus/digital-innovations/" aria-label="External Link: Residential Digital Innovations">Residential Digital Innovations </a></li>
    <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
    <li><a href="https://ocw.mit.edu/educator/additional-resources/">Additional Resources</a></li>
</ul>
</nav></div>
<nav class="grid_2" id="foot-c3" aria-labelledby="f-donate">       <span id="f-donate" class="footer" aria-hidden="true">Give Now</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/give/">Make a Donation</a></li>
    <li><a href="https://ocw.mit.edu/give/why-give/">Why Give?</a></li>
    <li><a href="https://ocw.mit.edu/give/our-supporters/">Our Supporters</a></li>
    <li><a href="https://ocw.mit.edu/give/other-ways-to-contribute/">Other Ways to Contribute</a></li>
    <li><a href="https://ocw.mit.edu/support/">Become a Corporate Sponsor</a></li>
</ul>
</nav>
<div class="grid_2" id="foot-c4">
<nav aria-labelledby="f-about">         <span id="f-about" class="footer" aria-hidden="true">About</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/about/">About OpenCourseWare</a></li>
    <li><a href="https://ocw.mit.edu/about/site-statistics/">Site Statistics</a></li>
    <li><a href="https://ocw.mit.edu/about/ocw-stories/">OCW Stories</a></li>
    <li><a href="https://ocw.mit.edu/about/newsletter/">Newsletter</a></li>
    <li><a href="https://www.ocw-openmatters.org/">Open Matters Blog</a></li>
</ul>
</nav><!--about-->       <nav aria-labelledby="f-tools">         <span id="f-tools" class="footer" aria-hidden="true">Tools</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/help/">Help &amp; FAQs</a></li>
    <li><a href="https://ocw.mit.edu/about/contactus">Contact Us</a></li>
    <li><a href="https://accessibility.mit.edu/" target="_blank">Accessibility</a></li>
    <li><a href="https://ocw.mit.edu/help/site-map/">Site Map</a></li>
    <li><a href="../../../common/terms/index.htm">Privacy &amp; Terms of Use</a></li>
    <li><a href="https://ocw.mit.edu/help/rss/">RSS Feeds</a></li>
</ul>
</nav><!--tools-->
</div>
</nav> <aside style="min-height: 289px;" aria-labelledby="f-our-corporate-supporters" class="grid_4 omega" id="foot-c5">           <span aria-hidden="true" class="footer" id="f-our-corporate-supporters">Our Corporate Supporters</span>           <!-- HOME_CORP_LOGO_1 -->
<div id="div-gpt-ad-1388181177156-0" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-0'); });
            </script></div>
<!-- HOME_CORP_LOGO_2 -->
<div id="div-gpt-ad-1388181177156-1" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-1'); });
            </script></div>
<!-- HOME_CORP_LOGO_3 -->
<div id="div-gpt-ad-1388181177156-2" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-2'); });
            </script></div>
<!-- HOME_CORP_LOGO_4 -->
<div id="div-gpt-ad-1388181177156-3" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-3'); });
            </script></div>
<!-- HOME_CORP_LOGO_5 -->
<div id="div-gpt-ad-1388181177156-4" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-4'); });
              </script></div>
<!-- HOME_CORP_LOGO_6 -->
<div id="div-gpt-ad-1388181177156-5" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-5'); });
              </script></div>
</aside>
<div class="grid_12 alpha omega" itemprop="publisher" itemscope="" itemtype="http://schema.org/CollegeOrUniversity">
<h4 class="footer" style="border-top: thin solid #d5c9ba; padding-top: 10px; margin-bottom: 10px;">About <span itemprop="name">MIT OpenCourseWare</span>
</h4>
<p style="color: #999; font-size: 1em; line-height: 1.5em; margin-top: 10px;" itemprop="description">MIT OpenCourseWare is an online publication of materials from over 2,500 MIT courses, freely sharing knowledge with learners and educators around the world. <a href="https://ocw.mit.edu/about/">Learn more »</a></p>
</div>
<div id="foot-copy" class="grid_12 alpha omega" style="border-top: none;">
<a href="http://web.mit.edu"><img src="../../../common/images/logo_mit.png" alt="Massachusetts Institute of Technology logo and name." style="width: 195; height: 44;"></a><a href="https://openlearning.mit.edu/"><img src="https://ocw.mit.edu/images/mitol_logo.png" alt="MIT Open Learning logo and name." style="width: 265; height: 50; vertical-align: top; padding-left:30px;"></a><a href="https://www.oeglobal.org/"><img src="https://ocw.mit.edu/images/oeg_logo.gif" alt="Open Education Consortium logo." style="width: 219px; height: 59px; vertical-align: top; padding-left:20px;"></a><a rel="license" itemprop="useRightsUrl" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="../../../common/images/cc_by-nc-sa.png" alt="Creative Commons logo with terms BY-NC-SA." style="width: 126px; height: 44px; margin-right: 0; padding-left: 20px;"></a>
<p class="copyright">© 2001–2018<br>
Massachusetts Institute of Technology</p>
<p style="font-size: 0.9em; margin-bottom: 15px;">Your use of the MIT OpenCourseWare site and materials is subject to our <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license">Creative Commons License</a> and other <a href="../../../common/terms/index.htm" rel="cc:morePermissions">terms of use</a>.</p>
</div>
</div></div>

</div>





                
			</div> <!-- bottom grid end -->
		</footer><!-- footer bottom end -->


   </body>
 </html>
