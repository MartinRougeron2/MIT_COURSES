<!DOCTYPE html><html lang="en">
      
      
        
    
    
    
    

      
      
      <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">  
        
        <title>Lecture 3: Buffer Overflow Exploits and Defenses | Lecture Videos | Computer Systems Security | Electrical Engineering and Computer Science | MIT OpenCourseWare</title>
    <!-- Begin Automatic Metadata Insertion -->
    <meta content="6-858-computer-systems-security-fall-2014" name="WT.cg_n">
    <meta content="Lecture 3: Buffer Overflow Exploits and Defenses" name="WT.cg_s">
    <meta content="In this lecture, Professor Mickens discusses topics related to buffer overflow exploits, including baggy bounds handling, mitigation approaches, and return-oriented programming." name="Description">
    <meta content="Zeldovich, Nickolai" name="Author">
    <meta content="6.858,buffer overflow,baggy bounds,mitigation,return-oriented programming,Computer Design and Engineering,Software Design and Engineering" name="keywords">
    <meta content="6.858 Computer Systems Security | Lecture 3: Buffer Overflow Exploits and Defenses" name="Search_Display">
    <meta content="Computer Design and Engineering" itemprop="about">
    <meta content="Software Design and Engineering" itemprop="about">
    <!-- End Automatic Metadata Insertion -->

	<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/grid.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/base.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/menu.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/jquery.bubblepopup.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/search.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/courses.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/courses_new.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/jquery.jscrollpane.css">
<link title="default" rel="stylesheet" type="text/css" href="../../../common/styles/media_tabs.css">
	<link href="../../../common/xml/ocwcc.rdf" type="application/rdf+xml" rel="metadata">
	<link rel="canonical" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/">
	<link rel="apple-touch-icon" href="../../../common/images/apple-touch-icon.png">
	
	
      
	
	<script type="text/javascript" src="../../../common/scripts/jquery.js"></script>
	<script type="text/javascript" src="../../../common/scripts/ocw-media-utils-offline.js"></script>
	<script type="text/javascript" src="../../../common/scripts/ocw-offline.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery.bubblepopup.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/jquery.jscrollpane.min.js"></script>
	<script type="text/javascript" src="../../../common/scripts/expandy.js"></script>
	<script type="text/javascript" src="../../../common/scripts/bubble-popup-offline.js"></script>
	
	
	
    <script type="text/javascript">
      $(document).ready(function() {
        $("#tabs").tabs();
        IpadScroller();
      });
    </script>
    
    
    
    
    
    
      
       
		 

        
        
        

        
        
        
        
        
        
        
        
        
      </head>
    <body itemscope itemtype="http://schema.org/WebPage">
        
	

        <header id="top">
			<div id="grid">
				
				
					
<div id="portletwrapper-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d686561646572" class="portletWrapper kssattr-portlethash-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d686561646572">
<div class="portletStaticText portlet-static-site-header">
<!--googleoff: index-->
<div class="grid_6 alpha" id="banner"><a href="https://ocw.mit.edu/"><img src="../../../common/images/ocw_mast.png" class="logo" alt="MIT OpenCourseWare, Massachusetts Institute of Technology"></a></div>
<div class="grid_6 omega" id="subscribe">
<aside class="module" aria-label="Connect with OCW">
<table class="social">
    <tbody>
        <tr>
            <td class="socialbutton"><a aria-label="Subscribe to the OCW Newsletter" href="https://ocw.mit.edu/subscribe/index.htm?utm_source=header"><img src="../../../common/images/trans.gif" alt="An icon depicting an envelope.">Subscribe to the OCW Newsletter</a></td>
            <td>
<a aria-label="Facebook" href="https://facebook.com/mitocw"><img src="../../../common/images/icon_fb.png" alt="Click to visit our Facebook page."></a>  <a aria-label="Instagram" href="https://www.instagram.com/mitocw/"><img src="https://ocw.mit.edu/images/icon_ig.png" alt="Click to visit our Instagram page."></a> <a aria-label="Twitter" href="https://twitter.com/mitocw"><img src="https://ocw.mit.edu/images/icon_twitter.png" alt="Click to visit our Twitter feed."></a><a aria-label="YouTube" href="https://www.youtube.com/mitocw" style="font-size: 12.208px;"><img src="https://ocw.mit.edu/images/icon_yt.png" alt="Click to visit our YouTube page."></a><span style="font-size: 12.208px;">   </span><a aria-label="Open Matters blog on WordPress" href="https://www.ocw-openmatters.org/" style="font-size: 12.208px;"><img src="https://ocw.mit.edu/images/icon_wp.png" alt="Click to visit our blog on WordPress."></a>
</td>
        </tr>
    </tbody>
</table>
</aside><nav aria-label="Help Links" class="helplinks">     <a aria-label="OCW Site Help" href="https://ocw.mit.edu/help">Help</a><span aria-hidden="true">|</span>     <a href="../../../common/about/contactus.htm">Contact Us</a>   </nav>
</div>
<div class="clear"> </div>
<!--googleon: index-->
</div>

</div>

<div id="portletwrapper-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a6d6567612d6d656e75" class="portletWrapper kssattr-portlethash-6f63772e746f70706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a6d6567612d6d656e75">
<div class="portletStaticText portlet-static-mega-menu"><div><nav id="mega" class="grid_8 alpha" aria-label="Site">
<ul id="menu" role="presentation">
    <li id="menu_home">
<a href="https://ocw.mit.edu/" aria-label="Homepage"><img src="../../../common/images/top-nav_home.png" class="home_icon" alt="Click for site home page."></a><!-- Begin Home Item -->
</li>
    <!-- End Home Item -->
    <li id="drop_1" aria-label="Find Courses">
<a href="#" aria-hidden="true">FIND COURSES</a><!-- Begin 5 columns Item -->
    <div class="dropdown_5columns-a mega-courses">
    <div class="col_1a">
    <div class="row_1a">
<nav aria-labelledby="mm-find-courses-by">     <span id="mm-find-courses-by" class="nav" aria-hidden="true">Find courses by:</span>
    <ul class="find_by" role="presentation">
        <li><a href="https://ocw.mit.edu/courses/find-by-topic/">Topic</a></li>
        <li><a href="https://ocw.mit.edu/courses/find-by-number/">MIT Course Number</a></li>
        <li><a href="https://ocw.mit.edu/courses/find-by-department/">Department</a></li>
    </ul>
    </nav>     <nav aria-labelledby="mm-collections">     <span id="mm-collections" class="nav" aria-hidden="true">Collections</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/new-courses/">New Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/most-visited-courses/">Most Visited Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/ocw-scholar/">OCW Scholar Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/audio-video-courses/">Audio/Video Lectures</a></li>
        <li><a href="https://ocw.mit.edu/courses/online-textbooks/">Online Textbooks</a></li>
        <li><a href="https://ocw.mit.edu/resources/">Supplemental Resources</a></li>
        <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
        <li><a href="https://ocw.mit.edu/courses/mitx-related-courseware/">MITx &amp; Related OCW Courses</a></li>
        <li><a href="https://ocw.mit.edu/courses/mit-open-learning-library/">MIT Open Learning Library</a></li>
    </ul>
    </nav>     <nav class="col_1b" aria-labelledby="mm-translated-courses">     <span id="mm-translated-courses" class="nav" aria-hidden="true" style="line-height: 1.3;">Cross-Disciplinary Topic Lists</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/energy-courses">Energy</a></li>
        <li><a href="https://ocw.mit.edu/courses/entrepreneurship">Entrepreneurship</a></li>
        <li><a href="https://ocw.mit.edu/courses/environment-courses">Environment</a></li>
        <li><a href="https://ocw.mit.edu/courses/intro-programming">Introductory Programming</a></li>
        <li><a href="https://ocw.mit.edu/courses/life-sciences">Life Sciences</a></li>
        <li><a href="https://ocw.mit.edu/courses/transportation-courses">Transportation</a></li>
    </ul>
    </nav>
</div>
    <div class="row_1b"><nav aria-labelledby="mm-cross-disciplinary-topic-lists">     <span id="mm-cross-disciplinary-topic-lists" class="nav" aria-hidden="true">Translated Courses</span>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/translated-courses/traditional-chinese" aria-label="Traditional Chinese">繁體字 / Traditional Chinese</a></li>
        <li><a href="https://ocw.mit.edu/courses/translated-courses/turkish" aria-label="Turkish">Türkçe / Turkish</a></li>
        <li><a href="https://ocw.mit.edu/courses/translated-courses/korean" aria-label="Korean">(비디오)한국 / Korean</a></li>
    </ul>
    </nav></div>
    </div>
    </div>
    </li>
    <li id="drop_2">
<a href="#" aria-label="For Educators">For Educators</a>
    <div class="dropdown_1column-a" style="width: 270px;"><nav aria-labelledby="mm-find-courses-by">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/educator/chalk-radio-podcast">Chalk Radio Podcast</a></li>
        <li><a href="https://ocw.mit.edu/educator/">OCW Educator Portal</a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights by Department</a></li>
        <li><a href="https://openlearning.mit.edu/campus/digital-innovations/">Residential Digital Innovations </a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
    </ul>
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/educator/additional-resources/">Additional Resources</a></li>
    </ul>
    </nav></div>
    </li>
    <li id="drop_3">
<a href="#" aria-hidden="true">Give Now</a>
    <div class="dropdown_1column-a"><nav class="col_1" aria-label="Donate">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/give/">Make a Donation</a></li>
        <li><a href="https://ocw.mit.edu/give/why-give/">Why Give?</a></li>
        <li><a href="https://ocw.mit.edu/give/our-supporters/">Our Supporters</a></li>
        <li><a href="https://ocw.mit.edu/give/other-ways-to-contribute/">Other Ways to Contribute</a></li>
        <li><a href="https://ocw.mit.edu/support/">Become a Corporate Sponsor</a></li>
    </ul>
    </nav></div>
    </li>
    <li id="drop_4">
<a href="#" aria-hidden="true">About</a>
    <div class="dropdown_1column-a"><nav class="col_1" aria-label="About">
    <ul role="presentation">
        <li><a href="https://ocw.mit.edu/about/">About MIT OpenCourseWare</a></li>
        <li><a href="https://ocw.mit.edu/about/site-statistics/">Site Statistics</a></li>
        <li><a href="https://ocw.mit.edu/about/ocw-stories/">OCW Stories</a></li>
        <li><a href="https://ocw.mit.edu/about/newsletter/">Newsletter</a></li>
        <li><a href="https://chalk-radio.simplecast.com/">Chalk Radio Podcast</a></li>
        <li><a href="https://www.ocw-openmatters.org/">Open Matters Blog</a></li>
    </ul>
    </nav></div>
    </li>
</ul>
</nav></div></div>

</div>





<!--googleoff: index-->
<script>
  (function() {
	var cx = '012626166551961672889:owjdpuboktq';
	var gcse = document.createElement('script');
	gcse.type = 'text/javascript';
	gcse.async = true;
	gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(gcse, s);
  })();
  window.onload = function(){
	document.getElementById('gsc-i-id1').placeholder = 'Search';	
  };

$(document).ready(function(){

$('.advanceSearch a').keydown(function(event){showSearchTips($(this),event);})
$('#searchTipsModal').keydown(function(event){showSearchTips($(this),event);})

function showSearchTips(obj,evt) {
// if pressed enter key
	if ( evt.which == 13 || evt.which == 32) {
		showModal();
		ga('send', 'pageview', "AdvanceSearch");
		$(".advanceSearch a").attr('aria-expanded', 'true');
		$('.searchTipsModal').focus();
		evt.preventDefault();
		}
	if ( evt.which == 27 ) {
		hideModal();
		$(".advanceSearch a").attr('aria-expanded', 'false');
		var modal = document.getElementById('searchTipsModal');
		modal.style.display = "none";
		$(".advanceSearch a").focus();
		evt.preventDefault();
		}
}

});
function showModal(){
	var modal = document.getElementById('searchTipsModal');
	modal.style.display = "block";
	ga('send', 'pageview', "AdvanceSearch");
	document.getElementById("searchTipsBtn").setAttribute("aria-expanded", true);
	window.setTimeout(function () {
    document.getElementById('searchTipsModal').focus(); }, 0);
}

function hideModal(){
	var modal = document.getElementById('searchTipsModal');
	modal.style.display = "none";
	document.getElementById("searchTipsBtn").setAttribute("aria-expanded", false);
}
</script>
<div id="search" role="search" class="grid_4 omega">
    	<table class="search">
				<tbody>
					<tr>
						<td><div class="searchboxheader"><searchbox-only resultsurl="/search/ocwsearch.htm"></searchbox-only></div></td>
						<td>
							<div class="advanceSearch">
								<a id="searchTipsBtn" onclick="showModal();" href="#" role="button" aria-label="search tips" aria-expanded="false" aria-describedby="searchtips">Search Tips</a>

								<!-- The Modal -->
								<div id="searchTipsModal" class="modal" tabindex="-1">
								  <!-- Modal content -->
									<div class="modal-content">
										<div class="modal-body">
											<button class="close" onclick="hideModal();" aria-label="close">X</button>
											<span>
												<b>Exclude words from your search</b>
												<br>Put - in front of a word you want to leave out. For example, jaguar speed -car
												<br><br>
												<b>Search for an exact match</b>
												<br>Put a word or phrase inside quotes. For example, "tallest building".
												<br><br>
												<b>Search for wildcards or unknown words</b>
												<br>Put a * in your word or phrase where you want to leave a placeholder. For example, "largest * in the world".
												<br><br>
												<b>Search within a range of numbers</b>
												<br>Put .. between two numbers. For example, camera $50..$100.
												<br><br>
												<b>Combine searches</b>
												<br>Put "OR" between each search query. For example,  marathon OR race.
												<br><br>
											</span>
										</div>
								  </div>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
		</table>
</div>
<div class="clear"></div>
<!--googleon: index-->
<!-- *end header* -->

				
				
			</div>
<!-- top grid end -->
		</header><!-- top end -->
			
		<div id="center_media">
      	<div id="grid">
      		<div id="left">
        		<nav id="breadcrumb_media" aria-label="Breadcrumb">
                	<p>

    <a href="https://ocw.mit.edu/">Home</a>
    
        »
        
    
    
        
            <a href="https://ocw.mit.edu/courses">Courses</a>
            
                »
                
            
            
         
    
    
        
            <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science">Electrical Engineering and Computer Science</a>
            
                »
                
            
            
         
    
    
        
            <a href="../../../contents/index.htm">Computer Systems Security</a>
            
                »
                
            
            
         
    
    
        
            <a href="../../../contents/video-lectures/index.htm">Lecture Videos</a>
            
                »
                
            
            
         
    
    
        
            
            
            Lecture 3: Buffer Overflow Exploits and Defenses
         
    
</p>

            	</nav>
            	<div class="clear"></div>
        		<div id="media_title">
        		<h1 class="title" itemprop="name" property="dct:title">
        <span class="" id="parent-fieldname-title">
            Lecture 3: Buffer Overflow Exploits and Defenses
        </span>
    </h1>
        		</div>
           		<div class="clear"></div>
           		<div id="course_wrapper_media">
           			<nav id="course_nav" aria-label="Course">
           				<script language="javascript" type="text/javascript">
function toggleMenu(objID) {
  if (!document.getElementById) return;
  var ob = document.getElementById(objID);
  ob.className = (ob.className == 'selected')?'': 'selected';
}
function toggleClass(id)
{
  var divtoggleClass= document.getElementById(id);
  divtoggleClass.className = (divtoggleClass.className == 'mO')?'mC': 'mO';
  return false;
}
function changeAlt(id)
{
  id.alt = (id.alt == 'Expand Menu')?'Collapse Menu' : 'Expand Menu';
  id.title = (id.title == 'Expand Menu')?'Collapse Menu' : 'Expand Menu';
}
</script>
<!--Left Nav Starts -->


	<ul>			  
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/index.htm">
		                  Course Home  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/syllabus/index.htm">
		                  Syllabus  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/calendar/index.htm">
		                  Calendar  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/readings/index.htm">
		                  Readings  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/lecture-notes/index.htm">
		                  Lecture Notes  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="selected">
			   			<a href="../../../contents/video-lectures/index.htm">
		                  Lecture Videos  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/labs/index.htm">
		                  Labs  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/exams/index.htm">
		                  Exams  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/final-project/index.htm">
		                  Final Project  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    <li class="">
			   			<a href="../../../contents/related-resources/index.htm">
		                  Related Resources  			                
	                    </a>
		        </li>
		    
         	
	
	
	    	
	    	    
		    
         	
	<!--second tal block close-->  
	
</ul>


<!--Left Nav Ends -->





           			</nav>
           			<main id="course_inner_media" aria-labelledby="media_title">
      					 
        <div class="" id="parent-fieldname-text">
            
            
        </div>
    
      					     
    
    



<script type="text/javascript">var caption_embed_1 ={'English - US': '/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/xSQxaie_h1o.srt'}</script>     
     <div id="media-embed">
         <div class="attention_message" id="embed_1">
<p>Flash and JavaScript are required for this feature.</p>
<p>Download the video from <a href="https://itunes.apple.com/us/itunes-u/id1017908130">iTunes U</a> or the <a href="https://archive.org/download/MIT6.858F14/MIT6_858F14_lec03_300k.mp4">Internet Archive</a>.</p>
</div>
     </div>
    
     <script type="text/javascript">ocw_embed_chapter_media('embed_1', 'https://www.youtube.com/v/xSQxaie_h1o', 'youtube', '/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses', 'https://img.youtube.com/vi/xSQxaie_h1o/0.jpg',0,0, 'https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/xSQxaie_h1o.srt')</script>
	 
	 
	 		
	 		<div id="transcript1"></div>
				 <script type="text/javascript">createThreePlayParams(2, 662947, "embed_1", 0, 0)</script>
			 
	

     <div id="media_resource_next_prev_nav" style="margin-top: 1em;">
        <p>
        
            <a href="../../../contents/video-lectures/lecture-2-control-hijacking-attacks/index.htm">
                <img src="../../../common/images/btn_previous_resource.png" style="margin: 0 30px 0 50px;" alt="Previous track" title="Previous track"></a>
     	
     	
        
            <a href="../../../contents/video-lectures/lecture-4-privilege-separation/index.htm"> 
                <img src="../../../common/images/btn_next_resource.png" alt="Next track" title="Next track"></a>
       
       </p>
     </div>
 


<script type="text/javascript">
		window.onload=function(){
		init();
		
		}
		var tabLinks = new Array();
		var contentDivs = new Array();
		function init() {
		  // Grab the tab links and content divs from the page
		  var tabListItems = document.getElementById('tabs').childNodes;
		  for ( var i = 0; i < tabListItems.length; i++ ) {
			if ( tabListItems[i].nodeName == "LI" ) {
			  var tabLink = getFirstChildWithTagName( tabListItems[i], 'A' );
			  var id = getHash( tabLink.getAttribute('href') );
			  tabLinks[id] = tabLink;
			  contentDivs[id] = document.getElementById( id );
			}
		  }
		  // Assign onclick events to the tab links, and
		  // highlight the first tab
		  var i = 0;
		  for ( var id in tabLinks ) {
			tabLinks[id].onclick = showTab;
			tabLinks[id].onfocus = function() { this.blur() };
			if ( i == 0 ) tabLinks[id].className = 'selected';
			i++;
		  }
		  // Hide all content divs except the first
		  var i = 0;
		  for ( var id in contentDivs ) {
			if ( i != 0 ) contentDivs[id].className = 'tabContent hide';
			i++;
		  }
		}
		function showTab() {
		  var selectedId = getHash( this.getAttribute('href') );
		  // Highlight the selected tab, and dim all others.
		  // Also show the selected content div, and hide all others.
		  for ( var id in contentDivs ) {
			if ( id == selectedId ) {
			  tabLinks[id].className = 'selected';
			  contentDivs[id].className = 'tabContent';
			} else {
			  tabLinks[id].className = '';
			  contentDivs[id].className = 'tabContent hide';
			}
		  }
		  // Stop the browser following the link
		  return false;
		}
		function getFirstChildWithTagName( element, tagName ) {
		  for ( var i = 0; i < element.childNodes.length; i++ ) {
			if ( element.childNodes[i].nodeName == tagName ) return element.childNodes[i];
		  }
		}
		function getHash( url ) {
		  var hashPos = url.lastIndexOf ( '#' );
		  return url.substring( hashPos + 1 );
		}
 </script>	
 

  <div id="media_tabs">
     
        <ul id="tabs">
            <li class="first">
                <a href="#vid_about" class="selected">About this Video</a>
            </li>
            <li class="">
                <a href="#vid_index" class="">Playlist</a>
            </li>
            <li class="">
                <a href="#vid_playlist" class="">Transcript</a>
            </li>
            <li class="">
                <a href="#vid_related" class="">Download this Video</a>
            </li>
        </ul>
   
        <div id="vid_about" itemprop="description" class="tabContent">
<p><strong>Description:</strong> In this lecture, Professor Mickens discusses topics related to buffer overflow exploits, including baggy bounds handling, mitigation approaches, and return-oriented programming.</p>
<p><strong>Instructor:</strong> James Mickens</p>
</div>
        <div id="vid_index" itemprop="description" class="tabContent hide">
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-1-introduction-threat-models/index.htm">
<img src="https://img.youtube.com/vi/GqmQg-cszw4/default.jpg" title="Lecture 1: Introduction, Threat Models" alt="Lecture 1: Introduction, Threat Models">
<p>Lecture 1: Introduction, Th...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-2-control-hijacking-attacks/index.htm">
<img src="https://img.youtube.com/vi/r4KjHEgg9Wg/default.jpg" title="Lecture 2: Control Hijacking Attacks" alt="Lecture 2: Control Hijacking Attacks">
<p>Lecture 2: Control Hijackin...</p></a>
</div>
<div class="related-media-thumbnail-nolink">
<div class="now-playing-resource">Now Playing</div>
<img src="https://img.youtube.com/vi/xSQxaie_h1o/default.jpg" title="Lecture 3: Buffer Overflow Exploits and Defenses" alt="Lecture 3: Buffer Overflow Exploits and Defenses">
<p>Lecture 3: Buffer Overflow ...</p>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-4-privilege-separation/index.htm">
<img src="https://img.youtube.com/vi/dNl22h1kW1k/default.jpg" title="Lecture 4: Privilege Separation" alt="Lecture 4: Privilege Separation">
<p>Lecture 4: Privilege Separa...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-6-capabilities/index.htm">
<img src="https://img.youtube.com/vi/TQhmua7Z2cY/default.jpg" title="Lecture 6: Capabilities" alt="Lecture 6: Capabilities">
<p>Lecture 6: Capabilities</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-7-sandboxing-native-code/index.htm">
<img src="https://img.youtube.com/vi/I0Psvvky-44/default.jpg" title="Lecture 7: Sandboxing Native Code	" alt="Lecture 7: Sandboxing Native Code	">
<p>Lecture 7: Sandboxing Nativ...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-8-web-security-model/index.htm">
<img src="https://img.youtube.com/vi/eRJ_r8WF1Y0/default.jpg" title="Lecture 8: Web Security Model" alt="Lecture 8: Web Security Model">
<p>Lecture 8: Web Security Model</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-9-securing-web-applications/index.htm">
<img src="https://img.youtube.com/vi/WlmKwIe9z1Q/default.jpg" title="Lecture 9: Securing Web Applications" alt="Lecture 9: Securing Web Applications">
<p>Lecture 9: Securing Web App...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-10-symbolic-execution/index.htm">
<img src="https://img.youtube.com/vi/yRVZPvHYHzw/default.jpg" title="Lecture 10: Symbolic Execution" alt="Lecture 10: Symbolic Execution">
<p>Lecture 10: Symbolic Execution</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-11-ur-web/index.htm">
<img src="https://img.youtube.com/vi/XMEFdofERLI/default.jpg" title="Lecture 11: Ur/Web" alt="Lecture 11: Ur/Web">
<p>Lecture 11: Ur/Web</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-12-network-security/index.htm">
<img src="https://img.youtube.com/vi/BZTWXl9QNK8/default.jpg" title="Lecture 12: Network Security" alt="Lecture 12: Network Security">
<p>Lecture 12: Network Security</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-13-network-protocols/index.htm">
<img src="https://img.youtube.com/vi/QOtA76ga_fY/default.jpg" title="Lecture 13: Network Protocols" alt="Lecture 13: Network Protocols">
<p>Lecture 13: Network Protocols</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-14-ssl-and-https/index.htm">
<img src="https://img.youtube.com/vi/q1OF_0ICt9A/default.jpg" title="Lecture 14: SSL and HTTPS" alt="Lecture 14: SSL and HTTPS">
<p>Lecture 14: SSL and HTTPS</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-15-medical-software/index.htm">
<img src="https://img.youtube.com/vi/bA3xCpYLA34/default.jpg" title="Lecture 15: Medical Software" alt="Lecture 15: Medical Software">
<p>Lecture 15: Medical Software</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-16-side-channel-attacks/index.htm">
<img src="https://img.youtube.com/vi/3v5Von-oNUg/default.jpg" title="Lecture 16: Side-Channel Attacks" alt="Lecture 16: Side-Channel Attacks">
<p>Lecture 16: Side-Channel At...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-17-user-authentication/index.htm">
<img src="https://img.youtube.com/vi/MT7X17ZRo1U/default.jpg" title="Lecture 17: User Authentication" alt="Lecture 17: User Authentication">
<p>Lecture 17: User Authentica...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-18-private-browsing/index.htm">
<img src="https://img.youtube.com/vi/YTWXAFJf8bw/default.jpg" title="Lecture 18: Private Browsing" alt="Lecture 18: Private Browsing">
<p>Lecture 18: Private Browsing</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-19-anonymous-communication/index.htm">
<img src="https://img.youtube.com/vi/OgGTJIgNewE/default.jpg" title="Lecture 19: Anonymous Communication" alt="Lecture 19: Anonymous Communication">
<p>Lecture 19: Anonymous Commu...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-20-mobile-phone-security/index.htm">
<img src="https://img.youtube.com/vi/uT7BXusDgDM/default.jpg" title="Lecture 20: Mobile Phone Security" alt="Lecture 20: Mobile Phone Security">
<p>Lecture 20: Mobile Phone Se...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-21-data-tracking/index.htm">
<img src="https://img.youtube.com/vi/WG5UbMrUiLU/default.jpg" title="Lecture 21: Data Tracking" alt="Lecture 21: Data Tracking">
<p>Lecture 21: Data Tracking</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-22-guest-lecture-by-mit-is-t/index.htm">
<img src="https://img.youtube.com/vi/2PO8h1pVW50/default.jpg" title="Lecture 22: Guest Lecture by MIT IS&amp;T" alt="Lecture 22: Guest Lecture by MIT IS&amp;T">
<p>Lecture 22: Guest Lecture b...</p></a>
</div>
<div class="related-media-thumbnail">
<a href="../../../contents/video-lectures/lecture-23-security-economics/index.htm">
<img src="https://img.youtube.com/vi/8PdnOZI7H5E/default.jpg" title="Lecture 23: Security Economics" alt="Lecture 23: Security Economics">
<p>Lecture 23: Security Economics</p></a>
</div>
</div>
        <div id="vid_playlist" itemprop="description" class="tabContent hide">
<ul><li><a class="transcript-link" title="Open in a new window." alt="Open in a new window." style="text-decoration: none; font-size: 1.0em;" target="_blank" text-decoration: none font-size: href="../../../contents/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/xSQxaie_h1o.pdf"> Download English-US transcript (PDF)</a></li></ul>
<p><span m="80">The</span> <span m="170">following</span> <span m="610">content</span> <span m="1120">is</span> <span m="1230">provided</span> <span m="1670">under</span> <span m="1940">a</span> <span m="1980">Creative</span> <span m="2430">Commons</span> <span m="2830">license.</span> <span m="3820">Your</span> <span m="3920">support</span> <span m="4420">will</span> <span m="4560">help</span> <span m="4830">MIT</span> <span m="5310">OpenCourseWare</span> <span m="6060">continue</span> <span m="6540">to</span> <span m="6680">offer</span> <span m="7000">high</span> <span m="7210">quality</span> <span m="7720">educational</span> <span m="8370">resources</span> <span m="8940">for</span> <span m="9080">free.</span> <span m="10150">To</span> <span m="10250">make</span> <span m="10350">a</span> <span m="10400">donation,</span> <span m="11090">or</span> <span m="11340">to</span> <span m="11450">view</span> <span m="11660">additional</span> <span m="12070">materials</span> <span m="12690">from</span> <span m="12860">hundreds</span> <span m="13190">of</span> <span m="13300">MIT</span> <span m="13680">courses,</span> <span m="15000">visit</span> <span m="15160">MIT</span> <span m="15690">OpenCourseWare</span> <span m="16600">at</span> <span m="16830">ocw.mit.edu.</span> </p>
<p><span m="25998">PROFESSOR:</span> <span m="26470">All</span> <span m="26607">right,</span> <span m="26745">let's</span> <span m="27020">get</span> <span m="27180">started.</span> <span m="27780">So</span> <span m="28560">welcome</span> <span m="29210">to</span> <span m="29500">the</span> <span m="29940">next</span> <span m="30450">lecture</span> <span m="31080">about</span> <span m="32439">exploiting</span> <span m="33090">buffer</span> <span m="33400">overflow.</span> <span m="34120">So</span> <span m="34240">today,</span> <span m="34600">what</span> <span m="34700">we're</span> <span m="34770">going</span> <span m="34880">to</span> <span m="34970">do</span> <span m="35260">is,</span> <span m="35420">we're</span> <span m="35510">going</span> <span m="35810">to</span> <span m="36160">finish</span> <span m="36520">up</span> <span m="36790">our</span> <span m="37050">discussion</span> <span m="38020">about</span> <span m="38590">baggy</span> <span m="38700">bounds</span> <span m="38810">and</span> <span m="39200">then</span> <span m="39510">we're</span> <span m="39800">going</span> <span m="39920">to</span> <span m="39980">move</span> <span m="40270">on</span> <span m="40500">to</span> <span m="40630">a</span> <span m="40700">couple</span> <span m="40990">of</span> <span m="41120">other</span> <span m="41800">different</span> <span m="42260">techniques</span> <span m="43100">for</span> <span m="43620">protecting</span> <span m="44040">its</span> <span m="44160">buffer</span> <span m="44400">overflows.</span> </p>
<p><span m="45180">Then</span> <span m="45330">we're</span> <span m="45440">going</span> <span m="45540">to</span> <span m="45620">talk</span> <span m="45900">about</span> <span m="46430">the</span> <span m="46670">paper</span> <span m="47180">for</span> <span m="47580">today,</span> <span m="48020">which</span> <span m="48210">is</span> <span m="48350">the</span> <span m="48460">blind</span> <span m="49100">return</span> <span m="49710">oriented</span> <span m="50110">programming.</span> <span m="51260">So</span> <span m="51440">if</span> <span m="51523">you</span> <span m="51606">were</span> <span m="51690">like</span> <span m="51860">me</span> <span m="52270">when</span> <span m="52350">you</span> <span m="52430">first</span> <span m="52510">read</span> <span m="52730">that</span> <span m="52900">paper</span> <span m="53240">you</span> <span m="53580">kind</span> <span m="53730">of</span> <span m="53830">felt</span> <span m="54130">like</span> <span m="54196">you</span> <span m="54263">were</span> <span m="54330">watching</span> <span m="54740">like</span> <span m="55010">a</span> <span m="55440">Christopher</span> <span m="55780">Nolan</span> <span m="56200">movie</span> <span m="56273">at</span> <span m="56346">the</span> <span m="56420">beginning.</span> <span m="56665">It</span> <span m="56787">was</span> <span m="56910">kind</span> <span m="57050">of</span> <span m="57100">like</span> <span m="57270">mind</span> <span m="57600">blowing</span> <span m="57870">right.</span> </p>
<p><span m="58350">So</span> <span m="58410">what</span> <span m="58470">we're</span> <span m="58570">going</span> <span m="58670">to</span> <span m="58740">do</span> <span m="58880">is</span> <span m="58950">we're</span> <span m="59030">going</span> <span m="59130">to</span> <span m="59170">actually</span> <span m="59480">step</span> <span m="59790">through</span> <span m="60000">how</span> <span m="60210">some</span> <span m="60420">of</span> <span m="60460">these</span> <span m="60620">gadgets</span> <span m="61020">work</span> <span m="61670">right.</span> <span m="62090">And</span> <span m="62200">so</span> <span m="62310">hopefully</span> <span m="62600">by</span> <span m="62770">the</span> <span m="62945">end,</span> <span m="63120">you'll</span> <span m="63220">be</span> <span m="63300">able</span> <span m="63450">to</span> <span m="63490">understand</span> <span m="64080">all</span> <span m="64319">this</span> <span m="64569">sort</span> <span m="64739">of</span> <span m="65090">high</span> <span m="65260">tech</span> <span m="65640">chicanery</span> <span m="65995">that</span> <span m="66350">they're</span> <span m="66420">doing</span> <span m="66555">in</span> <span m="66690">the</span> <span m="66770">paper.</span> </p>
<p><span m="68110">So</span> <span m="68630">first</span> <span m="68860">of</span> <span m="68930">all,</span> <span m="69350">like</span> <span m="69405">I</span> <span m="69460">said,</span> <span m="69630">let's</span> <span m="69810">just</span> <span m="70000">close</span> <span m="70340">up</span> <span m="70500">with</span> <span m="70680">the</span> <span m="72070">baggy</span> <span m="72370">bounds</span> <span m="72620">discussions.</span> <span m="73210">Let's</span> <span m="73330">go</span> <span m="73550">through</span> <span m="74070">a</span> <span m="74980">very</span> <span m="75270">simple</span> <span m="76230">example</span> <span m="76710">here.</span> <span m="78480">So</span> <span m="78820">let's</span> <span m="79120">say</span> <span m="79500">that</span> <span m="79760">we're</span> <span m="79890">going</span> <span m="80270">to</span> <span m="82670">define</span> <span m="83140">a</span> <span m="83420">pointer</span> <span m="83735">called</span> <span m="84050">P.</span> <span m="86280">And</span> <span m="86490">let's</span> <span m="86760">say</span> <span m="87030">that</span> <span m="87190">we're</span> <span m="87340">going</span> <span m="87570">to</span> <span m="87650">give</span> <span m="87940">it</span> <span m="88400">allocation</span> <span m="89040">size</span> <span m="89400">of</span> <span m="89490">44.</span> <span m="90360">Let's</span> <span m="90670">also</span> <span m="90960">assume</span> <span m="91390">that</span> <span m="91700">the</span> <span m="92940">slot</span> <span m="93540">size</span> <span m="96410">equals</span> <span m="96740">16</span> <span m="97150">bytes</span> <span m="97440">OK.</span> </p>
<p><span m="97960">So</span> <span m="98110">what's</span> <span m="98280">going</span> <span m="98380">to</span> <span m="98440">happen</span> <span m="98700">when</span> <span m="99050">we</span> <span m="99270">do</span> <span m="99410">this</span> <span m="99560">malloc</span> <span m="99880">up</span> <span m="100040">here?</span> <span m="100630">So</span> <span m="100920">as</span> <span m="101060">you</span> <span m="101230">know,</span> <span m="101480">the</span> <span m="101590">baggy</span> <span m="101880">bounds</span> <span m="102180">system</span> <span m="102460">is</span> <span m="102560">going</span> <span m="102770">to</span> <span m="103160">pad</span> <span m="103500">that</span> <span m="103650">allocation</span> <span m="104230">out</span> <span m="104400">to</span> <span m="104480">the</span> <span m="104570">next</span> <span m="105640">power</span> <span m="105930">of</span> <span m="106050">two,</span> <span m="106620">right.</span> <span m="106900">So</span> <span m="106980">even</span> <span m="107230">though</span> <span m="107580">we've</span> <span m="107790">only</span> <span m="108200">allocated</span> <span m="108710">44</span> <span m="109100">bytes</span> <span m="109380">here,</span> <span m="109730">we're</span> <span m="109930">actually</span> <span m="110270">going</span> <span m="110600">to</span> <span m="111050">allocate</span> <span m="112160">64</span> <span m="112780">bytes</span> <span m="113430">for</span> <span m="113590">this</span> <span m="113800">pointer</span> <span m="114130">up</span> <span m="114295">here.</span> <span m="116470">And</span> <span m="116610">so</span> <span m="116740">also</span> <span m="117020">note</span> <span m="117265">too,</span> <span m="117510">this</span> <span m="117575">is</span> <span m="117640">the</span> <span m="117740">slot</span> <span m="118150">size</span> <span m="118470">is</span> <span m="118570">16.</span> </p>
<p><span m="119740">How</span> <span m="119910">many</span> <span m="120070">bounds</span> <span m="120380">tables</span> <span m="120680">entries</span> <span m="120940">are</span> <span m="120980">we</span> <span m="121080">going</span> <span m="121170">to</span> <span m="121240">create?</span> <span m="121920">Well</span> <span m="122060">we're</span> <span m="122170">going</span> <span m="122290">to</span> <span m="122380">create</span> <span m="123320">the</span> <span m="123400">allocation</span> <span m="124050">size,</span> <span m="124760">which</span> <span m="124960">in</span> <span m="125020">this</span> <span m="125180">case</span> <span m="125450">64,</span> <span m="126270">divided</span> <span m="126710">by</span> <span m="126850">the</span> <span m="126960">slot</span> <span m="127360">size,</span> <span m="127890">which</span> <span m="128070">is</span> <span m="128199">16.</span> <span m="128970">So</span> <span m="129000">in</span> <span m="129039">this</span> <span m="129229">case</span> <span m="129470">we'll</span> <span m="129639">create</span> <span m="130370">four</span> <span m="130729">different</span> <span m="131450">bounds</span> <span m="131990">table</span> <span m="132280">entries</span> <span m="133120">for</span> <span m="133310">this</span> <span m="133920">thing</span> <span m="134060">right</span> <span m="134220">here.</span> <span m="134710">Each</span> <span m="135160">one</span> <span m="135330">of</span> <span m="135425">those</span> <span m="135520">entries</span> <span m="135730">is</span> <span m="135870">going</span> <span m="135970">to</span> <span m="136020">be</span> <span m="136120">set</span> <span m="136380">to</span> <span m="136450">the</span> <span m="136540">log</span> <span m="137030">of</span> <span m="137100">the</span> <span m="137200">allocation</span> <span m="137750">size,</span> <span m="138570">which</span> <span m="138820">in</span> <span m="138860">this</span> <span m="139020">case</span> <span m="139220">is</span> <span m="139280">going</span> <span m="139380">to</span> <span m="139420">be</span> <span m="139520">6</span> <span m="139850">right.</span> <span m="140130">Because</span> <span m="140223">the</span> <span m="140316">allocation</span> <span m="140690">size</span> <span m="141210">is</span> <span m="141330">64,</span> <span m="142100">OK?</span> <span m="142800">So,</span> <span m="142910">so</span> <span m="143100">far</span> <span m="143300">so</span> <span m="143480">good.</span> </p>
<p><span m="144070">Then</span> <span m="144290">we're</span> <span m="144440">going</span> <span m="144800">to</span> <span m="145635">define</span> <span m="148270">another</span> <span m="148660">pointer</span> <span m="149020">called</span> <span m="149370">q</span> <span m="151180">and</span> <span m="151300">we're</span> <span m="151450">going</span> <span m="151660">to</span> <span m="151720">set</span> <span m="152010">it</span> <span m="152130">equal</span> <span m="152510">to</span> <span m="152690">p</span> <span m="154830">plus</span> <span m="155110">60.</span> <span m="156770">So</span> <span m="156870">what</span> <span m="157030">happens</span> <span m="157350">when</span> <span m="157420">we</span> <span m="157530">do</span> <span m="157670">this?</span> <span m="158350">Well</span> <span m="158610">note</span> <span m="158930">that</span> <span m="159110">strictly</span> <span m="159540">speaking,</span> <span m="160350">this</span> <span m="160630">access</span> <span m="161580">is</span> <span m="161880">out</span> <span m="162070">of</span> <span m="162160">bounds,</span> <span m="162830">right.</span> <span m="163070">Because</span> <span m="163300">this</span> <span m="163560">was</span> <span m="163720">only</span> <span m="163940">allocated</span> <span m="164330">44</span> <span m="164710">bytes</span> <span m="164910">of</span> <span m="164970">memory,</span> <span m="165470">but</span> <span m="165660">of</span> <span m="165750">course</span> <span m="166020">the</span> <span m="166080">way</span> <span m="166180">that</span> <span m="166290">baggy</span> <span m="166430">bounds</span> <span m="166830">works</span> <span m="166985">is</span> <span m="167140">that</span> <span m="167230">it</span> <span m="167320">will</span> <span m="167500">actually</span> <span m="167830">allow</span> <span m="168320">axises</span> <span m="168970">that</span> <span m="169250">are</span> <span m="169350">out</span> <span m="169480">of</span> <span m="169540">bounds,</span> <span m="170300">if</span> <span m="170480">they</span> <span m="170620">stay</span> <span m="170880">within</span> <span m="171180">that</span> <span m="171360">baggy</span> <span m="171520">bounds.</span> <span m="172290">So</span> <span m="172470">even</span> <span m="172760">though</span> <span m="173050">strictly</span> <span m="173460">speaking,</span> <span m="174300">the</span> <span m="174400">programmer</span> <span m="174790">probably</span> <span m="175080">shouldn't</span> <span m="175310">have</span> <span m="175430">done</span> <span m="175630">this,</span> <span m="175920">this</span> <span m="176210">is</span> <span m="176330">actually</span> <span m="176610">going</span> <span m="176800">to</span> <span m="176850">be</span> <span m="177030">OK,</span> <span m="177550">right.</span> <span m="177720">We're</span> <span m="177830">not</span> <span m="178010">going</span> <span m="178110">to</span> <span m="178210">raise</span> <span m="178520">any</span> <span m="178670">flags</span> <span m="179080">or</span> <span m="179190">anything</span> <span m="179480">like</span> <span m="179690">that.</span> </p>
<p><span m="181170">Now</span> <span m="181620">let's</span> <span m="181870">say</span> <span m="182010">that</span> <span m="182180">the</span> <span m="182270">next</span> <span m="182520">thing</span> <span m="182740">we</span> <span m="182870">do</span> <span m="184230">is</span> <span m="184660">we</span> <span m="184770">need</span> <span m="184860">to</span> <span m="184930">find</span> <span m="185500">another</span> <span m="185910">pointer,</span> <span m="188940">which</span> <span m="189010">is</span> <span m="189120">going</span> <span m="189350">to</span> <span m="189390">be</span> <span m="189430">set</span> <span m="189790">equal</span> <span m="190170">to</span> <span m="190320">q</span> <span m="192660">plus</span> <span m="192970">16</span> <span m="194110">right.</span> <span m="194340">Now</span> <span m="194490">this</span> <span m="194720">is</span> <span m="194840">actually</span> <span m="195190">going</span> <span m="195410">to</span> <span m="195490">cause</span> <span m="199450">an</span> <span m="199630">error,</span> <span m="200970">right.</span> <span m="201290">Because</span> <span m="202020">now</span> <span m="202440">q</span> <span m="203330">is</span> <span m="203560">at</span> <span m="203760">an</span> <span m="203960">offset</span> <span m="204600">of</span> <span m="204820">60</span> <span m="207240">plus</span> <span m="207570">16,</span> <span m="209660">which</span> <span m="209740">equals</span> <span m="209980">76.</span> <span m="211660">So</span> <span m="211920">this</span> <span m="212180">is</span> <span m="212320">actually</span> <span m="212970">12</span> <span m="213450">bytes</span> <span m="213770">away</span> <span m="214100">from</span> <span m="214320">the</span> <span m="214490">end</span> <span m="214720">of</span> <span m="214790">that</span> <span m="215010">baggy</span> <span m="215230">bounds.</span> <span m="216380">OK?</span> <span m="216980">And</span> <span m="217110">that's</span> <span m="217320">actually</span> <span m="217610">greater</span> <span m="218440">than</span> <span m="218590">half</span> <span m="218920">a</span> <span m="218980">slot</span> <span m="219280">away.</span> </p>
<p><span m="220040">All</span> <span m="220080">right,</span> <span m="220120">so</span> <span m="220160">if</span> <span m="220270">you</span> <span m="220360">remember</span> <span m="220990">the</span> <span m="221090">baggy</span> <span m="221400">bounds</span> <span m="221670">system</span> <span m="222025">will</span> <span m="222380">actually</span> <span m="222650">throw</span> <span m="222960">a</span> <span m="223185">hard</span> <span m="223410">synchronous</span> <span m="223900">error</span> <span m="224480">if</span> <span m="224610">you</span> <span m="224690">get</span> <span m="224870">beyond</span> <span m="225210">1/2</span> <span m="225410">a</span> <span m="225530">slot</span> <span m="225680">from</span> <span m="225890">the</span> <span m="226040">edge</span> <span m="226410">of</span> <span m="226690">that</span> <span m="226920">baggy</span> <span m="227102">bounds.</span> <span m="227650">So</span> <span m="227770">this</span> <span m="227860">will</span> <span m="227990">actually</span> <span m="228240">cause</span> <span m="228490">the</span> <span m="228550">program</span> <span m="228890">to</span> <span m="228990">fail.</span> <span m="229630">This</span> <span m="229770">will</span> <span m="229860">actually</span> <span m="230060">make</span> <span m="230230">it</span> <span m="230330">stop.</span> </p>
<p><span m="231210">Now</span> <span m="231610">let's</span> <span m="231820">imagine</span> <span m="232260">that</span> <span m="232370">we</span> <span m="232500">didn't</span> <span m="232830">have</span> <span m="233080">this</span> <span m="233270">line</span> <span m="233520">of</span> <span m="233610">code</span> <span m="234020">in</span> <span m="234100">the</span> <span m="234180">program,</span> <span m="234420">OK.</span> <span m="235140">So</span> <span m="235320">we</span> <span m="235430">had</span> <span m="235660">these</span> <span m="235890">two,</span> <span m="236250">but</span> <span m="236430">we</span> <span m="236550">don't</span> <span m="236800">have</span> <span m="237020">this</span> <span m="237230">one.</span> <span m="237610">So</span> <span m="237810">what</span> <span m="238000">if</span> <span m="238170">we</span> <span m="238480">instead</span> <span m="238790">of</span> <span m="238900">doing</span> <span m="239180">this</span> <span m="239420">line,</span> <span m="240290">did</span> <span m="240530">something</span> <span m="241150">that</span> <span m="241390">looks</span> <span m="241660">like</span> <span m="241900">this.</span> <span m="242230">We</span> <span m="242330">declare</span> <span m="242530">another</span> <span m="242800">pointer,</span> <span m="244270">let's</span> <span m="244470">call</span> <span m="244690">it</span> <span m="244830">s,</span> <span m="246790">and</span> <span m="246960">we</span> <span m="247060">set</span> <span m="247280">it</span> <span m="247390">equal</span> <span m="247780">to</span> <span m="250300">q</span> <span m="250560">plus</span> <span m="250830">8.</span> </p>
<p><span m="251700">Now</span> <span m="252100">in</span> <span m="252230">this</span> <span m="252470">case,</span> <span m="253470">the</span> <span m="253580">pointer</span> <span m="254340">is</span> <span m="254460">going</span> <span m="254580">to</span> <span m="254640">be</span> <span m="255500">at</span> <span m="256230">60</span> <span m="257070">plus</span> <span m="257399">8,</span> <span m="259240">which</span> <span m="259480">equals</span> <span m="260070">68</span> <span m="260709">bytes</span> <span m="261010">away</span> <span m="261200">from</span> <span m="261380">p,</span> <span m="262250">right.</span> <span m="262480">So</span> <span m="262570">this</span> <span m="262720">is</span> <span m="262860">only</span> <span m="263390">four</span> <span m="263760">bytes</span> <span m="264110">beyond</span> <span m="264500">that</span> <span m="264700">baggy</span> <span m="264980">bound.</span> <span m="265680">So</span> <span m="265840">this</span> <span m="266110">will</span> <span m="266410">not</span> <span m="266680">actually</span> <span m="267120">cause</span> <span m="267390">an</span> <span m="267510">error.</span> <span m="268280">Even</span> <span m="268520">though</span> <span m="268680">it</span> <span m="268760">is</span> <span m="269400">strictly</span> <span m="269770">speaking,</span> <span m="270100">out</span> <span m="270180">of</span> <span m="270320">bounds.</span> <span m="270740">What</span> <span m="270980">we</span> <span m="271175">will</span> <span m="271370">do</span> <span m="271490">here</span> <span m="271760">though,</span> <span m="271970">is</span> <span m="272110">set</span> <span m="272420">that</span> <span m="272580">high</span> <span m="272820">order</span> <span m="273060">bit</span> <span m="273320">on</span> <span m="273480">the</span> <span m="273560">pointer,</span> <span m="274550">right.</span> <span m="274950">So</span> <span m="275230">that</span> <span m="275340">if</span> <span m="275450">anyone</span> <span m="275750">subsequently</span> <span m="276360">tries</span> <span m="276610">to</span> <span m="276690">dereference</span> <span m="277035">this</span> <span m="277380">thing,</span> <span m="278080">it's</span> <span m="278280">going</span> <span m="278390">to</span> <span m="278450">cause</span> <span m="278740">a</span> <span m="278790">hard</span> <span m="279080">fault</span> <span m="279330">at</span> <span m="279430">that</span> <span m="279660">point.</span> </p>
<p><span m="281770">And</span> <span m="281875">then</span> <span m="281980">let's</span> <span m="282200">say,</span> <span m="282730">the</span> <span m="282820">final</span> <span m="283200">thing</span> <span m="283410">that</span> <span m="283490">we</span> <span m="283630">do</span> <span m="284350">is</span> <span m="284690">we</span> <span m="284850">declare</span> <span m="285940">another</span> <span m="286300">pointer</span> <span m="288740">t,</span> <span m="290880">which</span> <span m="291250">is</span> <span m="291350">going</span> <span m="291490">to</span> <span m="291530">equal</span> <span m="294650">s</span> <span m="294890">minus</span> <span m="295220">32.</span> <span m="296690">So</span> <span m="296770">what</span> <span m="296900">happens</span> <span m="297310">here</span> <span m="297680">is</span> <span m="297760">that</span> <span m="297870">essentially</span> <span m="298230">we</span> <span m="298390">brought</span> <span m="299110">this</span> <span m="299370">pointer</span> <span m="299710">t,</span> <span m="300000">it</span> <span m="300070">is</span> <span m="300170">now</span> <span m="300430">back</span> <span m="300900">in</span> <span m="301080">bounds,</span> <span m="302020">right.</span> <span m="302280">So</span> <span m="302390">what</span> <span m="302510">that</span> <span m="302670">means</span> <span m="303280">is</span> <span m="303450">that</span> <span m="303870">even</span> <span m="304180">though</span> <span m="304800">this</span> <span m="305140">guy</span> <span m="305750">was</span> <span m="306320">out</span> <span m="306510">of</span> <span m="306570">bounds,</span> <span m="307160">now</span> <span m="307420">we</span> <span m="307550">sort</span> <span m="307760">of</span> <span m="307820">going</span> <span m="308030">back</span> <span m="308270">to</span> <span m="308350">the</span> <span m="308490">original</span> <span m="308800">allocated</span> <span m="309210">region,</span> <span m="309840">that</span> <span m="309950">we</span> <span m="310070">originally</span> <span m="310320">created</span> <span m="310610">up</span> <span m="310760">here.</span> </p>
<p><span m="311290">So</span> <span m="311670">as</span> <span m="311830">a</span> <span m="311870">result,</span> <span m="312230">t</span> <span m="312510">will</span> <span m="312620">not</span> <span m="312920">have</span> <span m="313500">that</span> <span m="313840">high</span> <span m="313960">order</span> <span m="314180">bit</span> <span m="314470">step</span> <span m="314970">and</span> <span m="315070">so</span> <span m="315150">you</span> <span m="315280">can</span> <span m="315400">dereference</span> <span m="315810">T</span> <span m="315960">and</span> <span m="316110">everything</span> <span m="316420">will</span> <span m="316500">be</span> <span m="316620">fine.</span> <span m="317320">So</span> <span m="317462">does</span> <span m="317605">this</span> <span m="317890">all</span> <span m="318010">make</span> <span m="318220">sense?</span> <span m="318490">This</span> <span m="318840">should</span> <span m="319000">be</span> <span m="319180">fairly</span> <span m="319500">straightforward.</span> </p>
<p><span m="319980">AUDIENCE:</span> <span m="320475">[INAUDIBLE]</span> <span m="321465">the</span> <span m="321960">difference</span> <span m="322207">between</span> <span m="322455">r</span> <span m="322620">and</span> <span m="322785">s,</span> <span m="322950">how</span> <span m="323940">would</span> <span m="324105">you</span> <span m="324270">know</span> <span m="324435">that</span> <span m="324682">r</span> <span m="324930">is--</span> <span m="325920">or</span> <span m="326019">how</span> <span m="326118">does</span> <span m="326217">the</span> <span m="326316">program</span> <span m="326910">know</span> <span m="327033">that</span> <span m="327157">r</span> <span m="327281">is</span> <span m="327405">1/2</span> <span m="327900">the</span> <span m="328395">[INAUDIBLE].</span> </p>
<p><span m="331365">PROFESSOR:</span> <span m="331860">So</span> <span m="332025">note</span> <span m="332190">that,</span> <span m="333345">like</span> <span m="333510">up</span> <span m="333675">here,</span> <span m="334830">when</span> <span m="335155">we</span> <span m="335480">create</span> <span m="335870">r</span> <span m="336918">you</span> <span m="337157">can</span> <span m="337396">basically</span> <span m="338352">interpose,</span> <span m="339308">we</span> <span m="339467">get</span> <span m="339626">an</span> <span m="339786">instrumented</span> <span m="340264">code</span> <span m="340742">that's</span> <span m="340861">going</span> <span m="340981">to</span> <span m="341100">be</span> <span m="341220">working</span> <span m="341698">at</span> <span m="342176">all</span> <span m="342335">of</span> <span m="342494">these</span> <span m="342654">pointer</span> <span m="343132">operations.</span> <span m="344570">So</span> <span m="344690">basically</span> <span m="344810">we</span> <span m="344942">can</span> <span m="345075">tell</span> <span m="345800">is</span> <span m="345890">that</span> <span m="345980">we</span> <span m="346122">know</span> <span m="346820">where</span> <span m="347590">P</span> <span m="348070">is</span> <span m="348184">going</span> <span m="348299">to</span> <span m="348413">be.</span> <span m="348528">I'm</span> <span m="348573">sorry,</span> <span m="348619">we</span> <span m="348665">know</span> <span m="348711">where</span> <span m="348757">q</span> <span m="348802">is</span> <span m="348848">going</span> <span m="348894">to</span> <span m="348940">be.</span> <span m="351276">And</span> <span m="351740">we</span> <span m="351940">know</span> <span m="352300">that</span> <span m="354110">q</span> <span m="354760">is</span> <span m="355470">within</span> <span m="355716">those</span> <span m="355963">baggy</span> <span m="356456">bounds.</span> </p>
<p><span m="357935">And</span> <span m="358181">so</span> <span m="358428">when</span> <span m="358551">we</span> <span m="358674">do</span> <span m="358797">this</span> <span m="358921">operation</span> <span m="359414">here,</span> <span m="359907">the</span> <span m="360153">instrumentation</span> <span m="360893">of</span> <span m="361386">baggy</span> <span m="361638">bounds</span> <span m="361890">adds</span> <span m="362285">and</span> <span m="362416">we're</span> <span m="362548">able</span> <span m="362680">to</span> <span m="362820">say,</span> <span m="362960">aha,</span> <span m="363600">well</span> <span m="363700">I</span> <span m="363800">know</span> <span m="363900">where</span> <span m="364240">that</span> <span m="364480">source</span> <span m="364721">formula</span> <span m="364962">is</span> <span m="365122">coming</span> <span m="365283">from.</span> <span m="365444">And</span> <span m="365926">then</span> <span m="366410">if</span> <span m="366520">you</span> <span m="366630">look</span> <span m="366740">at</span> <span m="366880">this</span> <span m="367140">offset</span> <span m="367400">here,</span> <span m="367760">you</span> <span m="368249">determine</span> <span m="368493">it's</span> <span m="368738">more</span> <span m="369227">than</span> <span m="369471">a</span> <span m="369716">1/2</span> <span m="369879">slot</span> <span m="370042">away</span> <span m="370205">from</span> <span m="370694">slot side.</span> </p>
<p><span m="371672">So</span> <span m="371916">basically</span> <span m="372161">what</span> <span m="372283">you</span> <span m="372405">think</span> <span m="372527">about</span> <span m="372650">is</span> <span m="372772">that</span> <span m="372894">as</span> <span m="373016">we're</span> <span m="373139">doing</span> <span m="373628">these</span> <span m="373791">pointer</span> <span m="373954">operations,</span> <span m="374117">and looking</span> <span m="374606">and</span> <span m="375095">saying</span> <span m="375339">is</span> <span m="375584">how</span> <span m="376073">are</span> <span m="376113">you</span> <span m="376154">going</span> <span m="376195">out</span> <span m="376236">of</span> <span m="376276">bounds,</span> <span m="376317">have</span> <span m="376358">you</span> <span m="376399">gone</span> <span m="376439">out</span> <span m="376480">of</span> <span m="376521">bounds,</span> <span m="377051">yes</span> <span m="377214">or</span> <span m="377377">no.</span> <span m="378029">At</span> <span m="378520">some</span> <span m="378690">point</span> <span m="378860">you're</span> <span m="378916">going</span> <span m="378972">to</span> <span m="379028">have</span> <span m="379084">some</span> <span m="379140">operation</span> <span m="379900">that's</span> <span m="380020">going</span> <span m="380085">to</span> <span m="380150">involve</span> <span m="381255">a</span> <span m="381610">pointer</span> <span m="382000">that</span> <span m="382205">is</span> <span m="382640">either</span> <span m="382970">in</span> <span m="383216">bounds</span> <span m="383462">within</span> <span m="383626">the</span> <span m="383790">baggy</span> <span m="383954">bounds</span> <span m="384446">and</span> <span m="384610">then</span> <span m="384774">some</span> <span m="384938">thing</span> <span m="385184">over</span> <span m="385430">here</span> <span m="385594">that</span> <span m="385758">makes</span> <span m="385922">it</span> <span m="386168">go</span> <span m="386414">out</span> <span m="386578">of</span> <span m="386742">bounds.</span> <span m="387398">So</span> <span m="387562">at</span> <span m="387726">that</span> <span m="387890">moment,</span> <span m="388382">right</span> <span m="388546">when</span> <span m="388710">that</span> <span m="388874">happens,</span> <span m="389366">that's</span> <span m="389530">how</span> <span m="389694">we</span> <span m="389858">know</span> <span m="390104">that</span> <span m="390350">something</span> <span m="390596">chicanerous</span> <span m="390678">has</span> <span m="390760">arisen.</span> </p>
<p><span m="396760">All</span> <span m="396840">right</span> <span m="397150">so,</span> <span m="397430">hopefully</span> <span m="397710">that</span> <span m="397980">should</span> <span m="398112">all</span> <span m="398510">make</span> <span m="398730">sense.</span> <span m="399420">And</span> <span m="399830">so</span> <span m="400350">this</span> <span m="400540">is</span> <span m="400620">very</span> <span m="400885">briefly</span> <span m="401150">a</span> <span m="401300">review</span> <span m="401480">of</span> <span m="402380">the</span> <span m="402780">homework</span> <span m="403520">question.</span> <span m="404484">So</span> <span m="404966">hopefully</span> <span m="405448">you</span> <span m="405508">can</span> <span m="405568">understand</span> <span m="405628">this</span> <span m="405689">and</span> <span m="405930">our</span> <span m="406050">homework</span> <span m="406412">question</span> <span m="406894">should</span> <span m="407014">be</span> <span m="407135">pretty</span> <span m="407255">easy</span> <span m="407376">to</span> <span m="407617">understand.</span> <span m="407858">So</span> <span m="408340">we</span> <span m="408581">have</span> <span m="409304">a</span> <span m="409786">character</span> <span m="410268">pointer</span> <span m="410750">the</span> <span m="411232">malloc</span> <span m="412196">had</span> <span m="412678">256</span> <span m="414130">bytes</span> <span m="414570">to</span> <span m="414730">it,</span> <span m="416740">Then</span> <span m="416872">we</span> <span m="417004">declare</span> <span m="417930">a</span> <span m="418429">character</span> <span m="418928">pointer</span> <span m="419427">q,</span> <span m="421922">that</span> <span m="422421">is</span> <span m="422587">equal</span> <span m="422753">to</span> <span m="422920">that</span> <span m="423419">pointer</span> <span m="424417">plus</span> <span m="424916">256</span> <span m="426420">and</span> <span m="426760">then</span> <span m="428251">we</span> <span m="428692">essentially</span> <span m="429133">try</span> <span m="429574">to</span> <span m="430015">dereference</span> <span m="430456">this</span> <span m="430676">pointer.</span> </p>
<p><span m="431340">So</span> <span m="431660">what's</span> <span m="431830">going</span> <span m="431885">to</span> <span m="431940">happen?</span> <span m="432670">Well</span> <span m="432980">note</span> <span m="433140">that</span> <span m="433300">this</span> <span m="433600">is</span> <span m="433720">an</span> <span m="433840">exact</span> <span m="434430">power</span> <span m="434910">too,</span> <span m="435215">right.</span> <span m="435870">So</span> <span m="435990">there's</span> <span m="436110">not</span> <span m="436370">actually</span> <span m="436960">any</span> <span m="437340">bagginess</span> <span m="437630">in</span> <span m="437766">the</span> <span m="437903">bounds,</span> <span m="438460">right.</span> <span m="438790">So</span> <span m="438946">when</span> <span m="439103">we</span> <span m="439260">do</span> <span m="439550">this</span> <span m="439982">right</span> <span m="440198">here,</span> <span m="440846">this</span> <span m="441062">makes</span> <span m="441278">q</span> <span m="441710">point</span> <span m="442260">to</span> <span m="442670">one</span> <span m="443430">pass</span> <span m="444400">the</span> <span m="444471">end</span> <span m="444542">of</span> <span m="444613">those</span> <span m="444970">baggy</span> <span m="445320">bounds.</span> <span m="446070">So</span> <span m="446180">just</span> <span m="446233">like</span> <span m="446286">in</span> <span m="446340">this</span> <span m="446460">example</span> <span m="446930">up</span> <span m="447140">here,</span> <span m="447660">this</span> <span m="447750">line</span> <span m="447910">is</span> <span m="448070">actually</span> <span m="448410">fine,</span> <span m="449390">but</span> <span m="449480">it</span> <span m="449700">will</span> <span m="449910">cause</span> <span m="450570">the</span> <span m="450670">high</span> <span m="450800">bit</span> <span m="450930">to</span> <span m="451152">be</span> <span m="451375">set</span> <span m="451523">in</span> <span m="451671">q,</span> <span m="451820">right.</span> <span m="452265">So</span> <span m="452487">when</span> <span m="452710">you</span> <span m="452858">come</span> <span m="453006">down</span> <span m="453155">here</span> <span m="453377">and</span> <span m="453600">reference</span> <span m="453825">it,</span> <span m="454050">then</span> <span m="454340">everything</span> <span m="454710">blows</span> <span m="454990">up</span> <span m="455315">and</span> <span m="455640">it's</span> <span m="455775">time</span> <span m="455910">to</span> <span m="456046">call</span> <span m="456181">in</span> <span m="456316">your</span> <span m="456452">insurance</span> <span m="456858">agent.</span> <span m="457670">So</span> <span m="457940">pretty</span> <span m="458370">straightforward?</span> </p>
<p><span m="460420">OK</span> <span m="461120">so,</span> <span m="462470">that's</span> <span m="462950">basically</span> <span m="463430">two</span> <span m="463910">examples</span> <span m="464390">that</span> <span m="464630">you</span> <span m="464870">can</span> <span m="464990">flavor</span> <span m="465110">for</span> <span m="465230">how</span> <span m="465350">baggy</span> <span m="465590">bounds</span> <span m="465830">works.</span> <span m="466790">As</span> <span m="467750">I</span> <span m="468230">mentioned</span> <span m="468710">in</span> <span m="468830">the</span> <span m="468950">last</span> <span m="469070">lecture,</span> <span m="469670">you</span> <span m="469830">don't</span> <span m="469990">actually</span> <span m="470150">have</span> <span m="470390">to</span> <span m="470630">instrument</span> <span m="471110">every</span> <span m="471350">pointer</span> <span m="471590">operation,</span> <span m="472550">if</span> <span m="473050">you</span> <span m="473370">can</span> <span m="473520">use</span> <span m="473820">static</span> <span m="474170">code</span> <span m="474290">analysis</span> <span m="474410">to</span> <span m="474910">figure</span> <span m="475410">out</span> <span m="475860">the</span> <span m="476150">particular</span> <span m="476250">set</span> <span m="476515">of</span> <span m="476780">pointer</span> <span m="477290">operations</span> <span m="477575">is safe.</span> <span m="478250">I'll</span> <span m="478347">defer</span> <span m="478445">further</span> <span m="479340">discussion</span> <span m="479660">of</span> <span m="479820">some</span> <span m="479900">of</span> <span m="479940">the</span> <span m="479980">static</span> <span m="480436">analysis</span> <span m="480892">[INAUDIBLE],</span> <span m="481600">but</span> <span m="481950">suffice</span> <span m="482420">it</span> <span m="482455">to</span> <span m="482490">say</span> <span m="482780">that</span> <span m="483190">you</span> <span m="483550">don't</span> <span m="484050">always</span> <span m="484133">have</span> <span m="484217">to</span> <span m="484301">have</span> <span m="484720">all</span> <span m="485050">this</span> <span m="487090">bit</span> <span m="487560">wise</span> <span m="487880">arithmetic</span> <span m="488200">that</span> <span m="488505">you</span> <span m="488657">have</span> <span m="488733">in</span> <span m="488810">some</span> <span m="490510">of</span> <span m="490590">the</span> <span m="490670">cases</span> <span m="491142">that</span> <span m="491299">we've</span> <span m="491456">examined</span> <span m="491614">before.</span> </p>
<p><span m="495870">And</span> <span m="496080">so</span> <span m="496710">another</span> <span m="497524">question</span> <span m="497931">that</span> <span m="498067">came</span> <span m="498203">up</span> <span m="498340">a</span> <span m="498585">lot</span> <span m="498830">in</span> <span m="499070">Piazza</span> <span m="499310">was,</span> <span m="499790">how</span> <span m="500030">does</span> <span m="500270">baggy</span> <span m="500510">bounds</span> <span m="500750">ensure</span> <span m="500990">compatibility</span> <span m="501230">with</span> <span m="501710">these</span> <span m="502670">preexisting,</span> <span m="504110">non-instrumented</span> <span m="504590">libraries,</span> <span m="504830">right.</span> <span m="506510">And</span> <span m="506670">so</span> <span m="506830">the</span> <span m="506990">Piazza</span> <span m="507470">idea</span> <span m="507950">behind</span> <span m="508070">how</span> <span m="508190">baggy</span> <span m="508310">bounds</span> <span m="508920">does</span> <span m="509020">that</span> <span m="509360">is,</span> <span m="509700">that</span> <span m="510230">when</span> <span m="510378">baggy</span> <span m="510526">bounds</span> <span m="511120">initializes</span> <span m="512039">the</span> <span m="512489">bounds</span> <span m="512940">tables,</span> <span m="513200">they</span> <span m="513460">set</span> <span m="513610">all</span> <span m="513760">the</span> <span m="513950">entries</span> <span m="514770">to</span> <span m="514990">be</span> <span m="515429">that</span> <span m="515709">bound</span> <span m="515849">of</span> <span m="515990">31.</span> <span m="516477">So</span> <span m="516574">when</span> <span m="516671">we</span> <span m="516769">read</span> <span m="516866">the</span> <span m="516964">bounds</span> <span m="517451">table,</span> <span m="517938">each</span> <span m="518183">entry</span> <span m="518429">represents</span> <span m="519280">2</span> <span m="519640">to</span> <span m="520000">the</span> <span m="520130">power</span> <span m="520510">of</span> <span m="520643">that</span> <span m="520776">entry,</span> <span m="520909">the</span> <span m="521250">size</span> <span m="521654">of</span> <span m="522059">that</span> <span m="522519">particular</span> <span m="522979">pointer.</span> </p>
<p><span m="523899">So</span> <span m="524052">by</span> <span m="524205">initializing</span> <span m="524359">all</span> <span m="524819">those</span> <span m="525279">bounds</span> <span m="525739">of</span> <span m="525969">31,</span> <span m="526199">what</span> <span m="526659">this</span> <span m="527120">allows</span> <span m="527380">us</span> <span m="527510">to</span> <span m="527640">do</span> <span m="528260">is</span> <span m="529196">automatically</span> <span m="529692">assume</span> <span m="530188">that</span> <span m="530684">each</span> <span m="530932">pointer</span> <span m="531180">from</span> <span m="531676">[INAUDIBLE]</span> <span m="532172">the</span> <span m="532421">code</span> <span m="532670">is</span> <span m="532860">going</span> <span m="532943">to</span> <span m="533026">have</span> <span m="533110">the</span> <span m="533200">largest</span> <span m="533670">bound</span> <span m="533880">possible,</span> <span m="534410">2</span> <span m="534670">raised</span> <span m="534746">to</span> <span m="534823">the</span> <span m="535353">31.</span> <span m="536259">So</span> <span m="536712">let</span> <span m="536825">me</span> <span m="536938">just</span> <span m="536994">give</span> <span m="537051">you</span> <span m="537165">a</span> <span m="537316">very</span> <span m="537467">simple</span> <span m="537618">example</span> <span m="538071">here</span> <span m="538980">that</span> <span m="539340">will</span> <span m="539390">hopefully</span> <span m="539440">make</span> <span m="539610">this</span> <span m="539706">a</span> <span m="539803">little</span> <span m="539900">clearer.</span> </p>
<p><span m="540770">So</span> <span m="541190">let's</span> <span m="541460">say</span> <span m="541740">that</span> <span m="541960">this</span> <span m="542600">over</span> <span m="542860">here</span> <span m="544290">is</span> <span m="544700">the</span> <span m="544880">memory</span> <span m="545060">space</span> <span m="546520">that</span> <span m="546995">we</span> <span m="547232">lose</span> <span m="548895">for</span> <span m="549132">heap.</span> <span m="552220">This</span> <span m="552457">is</span> <span m="553170">simple</span> <span m="553407">example,</span> <span m="554120">let's</span> <span m="554357">suppose</span> <span m="554595">that</span> <span m="555080">basically</span> <span m="555860">what</span> <span m="556160">this</span> <span m="556390">memory</span> <span m="556869">space</span> <span m="557348">[INAUDIBLE]</span> <span m="557827">two</span> <span m="558066">components.</span> <span m="558785">This</span> <span m="559264">is</span> <span m="559503">the</span> <span m="559743">heap,</span> <span m="561660">that</span> <span m="562000">is</span> <span m="562800">out</span> <span m="564570">by</span> <span m="565400">the</span> <span m="565690">unistrumented</span> <span m="566060">code.</span> <span m="571042">And</span> <span m="571256">then</span> <span m="571470">let's</span> <span m="571490">suppose</span> <span m="571910">that</span> <span m="572020">down</span> <span m="572290">here</span> <span m="572990">we</span> <span m="573153">have</span> <span m="573316">the</span> <span m="573480">heat</span> <span m="575040">that</span> <span m="575360">is</span> <span m="575760">allocated</span> <span m="578650">by</span> <span m="579120">the</span> <span m="579601">instrumented</span> <span m="580082">code.</span> </p>
<p><span m="584892">So</span> <span m="585132">what's</span> <span m="585373">baggy</span> <span m="585613">bounds</span> <span m="585854">going</span> <span m="586335">to</span> <span m="586575">do?</span> <span m="586816">So</span> <span m="587056">remember,</span> <span m="587297">baggy</span> <span m="587537">bounds</span> <span m="587778">has</span> <span m="588018">this</span> <span m="588259">notion</span> <span m="589376">of</span> <span m="589722">a</span> <span m="590070">slot</span> <span m="590410">size,</span> <span m="591090">right.</span> <span m="591540">So</span> <span m="591630">basically</span> <span m="592060">the</span> <span m="592220">slot</span> <span m="592480">size</span> <span m="592545">is</span> <span m="592610">16,</span> <span m="593467">you</span> <span m="593592">only</span> <span m="593718">have</span> <span m="593844">entry</span> <span m="594221">for</span> <span m="594600">every</span> <span m="595180">sort</span> <span m="595420">of</span> <span m="595520">slot</span> <span m="595870">of</span> <span m="596115">size</span> <span m="596360">16</span> <span m="596850">over</span> <span m="597040">here.</span> <span m="597620">So</span> <span m="597720">basically</span> <span m="597995">the</span> <span m="598270">bounds</span> <span m="598670">table</span> <span m="599040">in</span> <span m="599163">this</span> <span m="599286">case,</span> <span m="599410">you</span> <span m="599505">can</span> <span m="599600">think</span> <span m="599695">of</span> <span m="599790">being</span> <span m="600170">set</span> <span m="600440">up</span> <span m="601440">into</span> <span m="603475">three</span> <span m="603910">places,</span> <span m="604135">sorry</span> <span m="604360">two</span> <span m="604810">places.</span> <span m="606080">So</span> <span m="608650">initially</span> <span m="610490">all</span> <span m="610900">of</span> <span m="611030">the</span> <span m="611160">bounds</span> <span m="611420">table,</span> <span m="611680">all</span> <span m="611940">the</span> <span m="612065">entries</span> <span m="612190">are</span> <span m="612316">initialized</span> <span m="612692">to</span> <span m="612767">2</span> <span m="612843">to</span> <span m="612918">the</span> <span m="612994">30--</span> <span m="613070">or</span> <span m="613290">sorry,</span> <span m="613511">to</span> <span m="613952">the</span> <span m="614393">31.</span> </p>
<p><span m="616160">But</span> <span m="616245">then</span> <span m="616330">eventually</span> <span m="617850">as</span> <span m="618370">the</span> <span m="618950">instrument</span> <span m="619275">code</span> <span m="619600">runs</span> <span m="620320">it's</span> <span m="620550">actually</span> <span m="621090">going</span> <span m="621275">to</span> <span m="621460">use</span> <span m="622510">the</span> <span m="623310">baggy</span> <span m="623525">bounds</span> <span m="623740">algorithm</span> <span m="627520">to</span> <span m="627850">set</span> <span m="628180">these</span> <span m="628370">values</span> <span m="628665">for</span> <span m="628812">whatever</span> <span m="628960">should</span> <span m="629202">be</span> <span m="629444">appropriate</span> <span m="630412">for</span> <span m="630654">that</span> <span m="630896">particular</span> <span m="632348">[INAUDIBLE],</span> <span m="633316">right.</span> <span m="633800">So</span> <span m="633921">what</span> <span m="634042">ends</span> <span m="634163">happening</span> <span m="634284">is</span> <span m="634526">that</span> <span m="634768">if</span> <span m="635010">you</span> <span m="635252">did--</span> <span m="635736">if</span> <span m="636220">instrumented</span> <span m="636704">code</span> <span m="637188">gets</span> <span m="637430">a</span> <span m="637672">pointer</span> <span m="638156">that</span> <span m="638398">comes</span> <span m="638640">from</span> <span m="638882">here,</span> <span m="639608">then</span> <span m="639850">those</span> <span m="640092">baggy</span> <span m="640590">bounds</span> <span m="640930">with</span> <span m="641340">each</span> <span m="641690">particular</span> <span m="641850">pointer</span> <span m="642010">will</span> <span m="642057">always</span> <span m="642105">be</span> <span m="642152">set</span> <span m="642200">to</span> <span m="642247">the</span> <span m="642580">largest</span> <span m="643010">possible</span> <span m="643320">value,</span> <span m="644070">231.</span> <span m="645110">2</span> <span m="645308">to</span> <span m="645506">the</span> <span m="645902">31,</span> <span m="646101">right.</span> <span m="646300">Which</span> <span m="646510">means</span> <span m="646705">that</span> <span m="646900">it's</span> <span m="647070">going</span> <span m="647153">to</span> <span m="647236">be</span> <span m="647320">impossible</span> <span m="648150">for</span> <span m="648270">baggy</span> <span m="648437">bounds,</span> <span m="648940">entry</span> <span m="649180">of</span> <span m="649420">the</span> <span m="649660">code,</span> <span m="649900">to</span> <span m="650140">think</span> <span m="650380">that</span> <span m="650575">you've</span> <span m="650770">done</span> <span m="650900">an</span> <span m="651030">out</span> <span m="651140">of</span> <span m="651250">bound</span> <span m="651360">operation</span> <span m="652052">with</span> <span m="652400">that</span> <span m="652644">pointer</span> <span m="652888">that's</span> <span m="653376">coming</span> <span m="653620">from</span> <span m="654352">this</span> <span m="654840">uninstrumented</span> <span m="655130">library.</span> </p>
<p><span m="657090">So</span> <span m="657280">does</span> <span m="657470">that</span> <span m="657800">make</span> <span m="657930">sense?</span> <span m="659440">So</span> <span m="659720">the</span> <span m="659802">idea</span> <span m="659885">is</span> <span m="659967">that</span> <span m="660050">in</span> <span m="660490">instrumented</span> <span m="660710">code</span> <span m="660930">we're</span> <span m="661370">always</span> <span m="661800">going</span> <span m="661873">to</span> <span m="661946">be</span> <span m="662020">doing</span> <span m="662250">these</span> <span m="662590">comparisons</span> <span m="663110">with</span> <span m="663273">the</span> <span m="663436">pointers,</span> <span m="664580">but</span> <span m="664710">if</span> <span m="664840">we</span> <span m="665220">always</span> <span m="665680">set</span> <span m="666190">the</span> <span m="666300">bounds</span> <span m="666720">entries</span> <span m="667203">for</span> <span m="667686">uninstrumented</span> <span m="667847">pointer</span> <span m="668008">code</span> <span m="668652">2</span> <span m="668772">to</span> <span m="668893">the</span> <span m="669014">31,</span> <span m="669618">you</span> <span m="669738">can</span> <span m="669859">never</span> <span m="669980">have</span> <span m="670101">a</span> <span m="670584">dereference</span> <span m="671067">error.</span> </p>
<p><span m="673000">OK</span> <span m="673590">so</span> <span m="674830">that's</span> <span m="675250">basically</span> <span m="675670">how</span> <span m="675710">we</span> <span m="675750">have</span> <span m="676070">this</span> <span m="676365">nice</span> <span m="676660">interoperability</span> <span m="677560">between</span> <span m="677808">the</span> <span m="678057">entry</span> <span m="678554">of</span> <span m="678653">the</span> <span m="678752">baggy</span> <span m="678852">bounds</span> <span m="678951">code</span> <span m="679548">in</span> <span m="680045">between</span> <span m="680542">a</span> <span m="681039">noninstrumented</span> <span m="682040">off</span> <span m="682151">the</span> <span m="682263">shelf</span> <span m="682375">legacy</span> <span m="682710">library's.</span> <span m="684320">So</span> <span m="684900">putting</span> <span m="685020">it</span> <span m="685295">all</span> <span m="685432">together,</span> <span m="685570">what</span> <span m="685760">does</span> <span m="685950">this</span> <span m="686240">all</span> <span m="686530">mean?</span> <span m="687010">So,</span> <span m="687970">we</span> <span m="688090">have</span> <span m="688210">this</span> <span m="688330">system</span> <span m="688450">here</span> <span m="688930">which</span> <span m="689050">is</span> <span m="689170">nice</span> <span m="689290">because</span> <span m="689410">it</span> <span m="689650">doesn't</span> <span m="689890">make</span> <span m="690130">the</span> <span m="690370">uninstrumented</span> <span m="690610">libraries</span> <span m="691330">blow</span> <span m="691540">up,</span> <span m="691980">but</span> <span m="692185">one</span> <span m="692390">problem</span> <span m="692770">is</span> <span m="692888">that</span> <span m="693007">we</span> <span m="693126">can't</span> <span m="693245">detect</span> <span m="694670">out</span> <span m="694828">of</span> <span m="694907">bounds</span> <span m="694986">pointers</span> <span m="695620">that</span> <span m="696100">were</span> <span m="696320">generated</span> <span m="697400">in</span> <span m="697810">the</span> <span m="698070">uninstrumented</span> <span m="698520">code,</span> <span m="699380">right.</span> <span m="699830">Because</span> <span m="700460">we're</span> <span m="700710">never</span> <span m="700960">going</span> <span m="700985">to</span> <span m="701010">set</span> <span m="701370">that</span> <span m="701630">high</span> <span m="701900">bit</span> <span m="702333">for</span> <span m="702549">example,</span> <span m="702766">if</span> <span m="702982">that</span> <span m="703199">[INAUDIBLE]</span> <span m="703632">pointer</span> <span m="704065">gets</span> <span m="704500">too</span> <span m="704645">big,</span> <span m="704790">or</span> <span m="704935">gets</span> <span m="705080">too</span> <span m="705225">small</span> <span m="705370">or</span> <span m="705510">anything</span> <span m="705930">like</span> <span m="706110">that.</span> <span m="706590">So</span> <span m="706770">we</span> <span m="706860">actually</span> <span m="707260">can't</span> <span m="707460">provide</span> <span m="707930">memory</span> <span m="708010">safety</span> <span m="708430">for</span> <span m="708800">operations</span> <span m="709070">that</span> <span m="709160">take</span> <span m="709250">place</span> <span m="709340">in</span> <span m="709620">uninstrumented</span> <span m="710110">code.</span> </p>
<p><span m="711730">You</span> <span m="711900">also</span> <span m="712310">can't</span> <span m="712610">detect</span> <span m="712905">when</span> <span m="713052">we</span> <span m="713200">pass</span> <span m="713680">an</span> <span m="714100">out</span> <span m="714225">of</span> <span m="714350">bounds</span> <span m="714770">pointer</span> <span m="715030">from</span> <span m="715400">instrumented</span> <span m="716190">code</span> <span m="716530">to</span> <span m="716935">uninstrumented</span> <span m="717340">code.</span> <span m="718300">Something</span> <span m="718790">insane</span> <span m="718922">could</span> <span m="719055">happen,</span> <span m="719770">right.</span> <span m="719995">Because</span> <span m="720220">remember</span> <span m="720670">if</span> <span m="720782">you</span> <span m="720895">had</span> <span m="721007">this</span> <span m="721120">out</span> <span m="721270">of</span> <span m="721420">bounds</span> <span m="721570">pulled</span> <span m="721720">it</span> <span m="721870">from</span> <span m="721945">the</span> <span m="722020">instrumented</span> <span m="722245">code</span> <span m="723370">it</span> <span m="723503">has</span> <span m="723636">that</span> <span m="723770">high</span> <span m="723930">bit</span> <span m="724090">set</span> <span m="724230">to</span> <span m="724370">1,</span> <span m="724970">right.</span> <span m="725210">So</span> <span m="725380">it</span> <span m="725460">looks</span> <span m="725540">like</span> <span m="725620">it's</span> <span m="725920">super</span> <span m="726020">ginormous.</span> </p>
<p><span m="727484">Now</span> <span m="727972">we</span> <span m="728094">know</span> <span m="728216">if</span> <span m="728338">we</span> <span m="728460">just</span> <span m="728948">kept</span> <span m="729045">that</span> <span m="729143">code</span> <span m="729240">in</span> <span m="729338">instrumented</span> <span m="729436">code,</span> <span m="729924">we</span> <span m="730168">might</span> <span m="730412">clear</span> <span m="730574">that</span> <span m="730737">flag</span> <span m="730900">at</span> <span m="731062">some</span> <span m="731225">point</span> <span m="731388">if</span> <span m="731510">it</span> <span m="731632">comes</span> <span m="731754">back</span> <span m="731876">in</span> <span m="732364">bounds.</span> <span m="733340">But</span> <span m="733462">if</span> <span m="733584">we</span> <span m="733706">just</span> <span m="733828">pass</span> <span m="734316">this</span> <span m="734804">ginormous</span> <span m="735300">address</span> <span m="735391">to</span> <span m="735483">uninstrumented</span> <span m="735575">code,</span> <span m="736920">then</span> <span m="737026">who</span> <span m="737133">knows,</span> <span m="737240">it</span> <span m="737352">may</span> <span m="737465">try</span> <span m="737577">to</span> <span m="737690">dereference</span> <span m="737921">it,</span> <span m="738614">it</span> <span m="739076">may</span> <span m="739230">do</span> <span m="739384">something</span> <span m="739538">crazy.</span> </p>
<p><span m="740000">It</span> <span m="740462">may</span> <span m="740554">even</span> <span m="740646">bring</span> <span m="740739">that</span> <span m="740831">pointer</span> <span m="740924">back</span> <span m="741386">in</span> <span m="741617">bounds,</span> <span m="742310">but</span> <span m="742464">we</span> <span m="742618">would</span> <span m="743240">never</span> <span m="743300">have</span> <span m="743445">an</span> <span m="743590">opportunity</span> <span m="743880">to</span> <span m="744125">clear</span> <span m="744370">that</span> <span m="744740">high</span> <span m="745110">bit,</span> <span m="745580">right.</span> <span m="745990">So</span> <span m="746130">you</span> <span m="746200">can</span> <span m="746290">come</span> <span m="746380">up--</span> <span m="746835">you</span> <span m="747200">still</span> <span m="747370">may</span> <span m="747540">come</span> <span m="747697">up</span> <span m="747854">with</span> <span m="748012">some</span> <span m="748248">inter-op</span> <span m="748484">issues</span> <span m="748720">there,</span> <span m="749428">even</span> <span m="749664">if</span> <span m="749900">we</span> <span m="750040">use</span> <span m="750430">this</span> <span m="750650">scheme</span> <span m="750980">over</span> <span m="751438">here.</span> </p>
<p><span m="754190">OK,</span> <span m="754853">so</span> <span m="755286">that's</span> <span m="755719">essentially</span> <span m="756152">how</span> <span m="756585">baggy</span> <span m="756802">bounds</span> <span m="757020">works</span> <span m="757730">on</span> <span m="758150">a</span> <span m="758350">32--</span> <span m="759220">you</span> <span m="759340">got</span> <span m="759461">a</span> <span m="759581">question?</span> </p>
<p><span m="759702">AUDIENCE:</span> <span m="760184">Yeah,</span> <span m="760666">so</span> <span m="761148">if</span> <span m="761268">you</span> <span m="761389">have</span> <span m="761509">a</span> <span m="761630">instrumented</span> <span m="761790">coding</span> <span m="761951">meets</span> <span m="762112">like</span> <span m="762594">allocated</span> <span m="762835">memory,</span> <span m="763558">is</span> <span m="763678">it</span> <span m="763799">using</span> <span m="763919">the</span> <span m="764040">same</span> <span m="764281">malloc</span> <span m="764522">that</span> <span m="764682">the</span> <span m="764843">attributing</span> <span m="765004">code</span> <span m="765486">is</span> <span m="765727">using,</span> <span m="765968">or?</span> </p>
<p><span m="766460">PROFESSOR: Yeah</span> <span m="766920">so</span> <span m="767002">it's</span> <span m="767085">a</span> <span m="767167">bit</span> <span m="767250">subtle.</span> <span m="767540">So</span> <span m="767636">like</span> <span m="767733">in</span> <span m="767830">this</span> <span m="768739">case</span> <span m="768978">here,</span> <span m="769218">it's</span> <span m="769697">like</span> <span m="769936">very</span> <span m="770176">stark</span> <span m="770295">what's</span> <span m="770415">going</span> <span m="770535">on,</span> <span m="771134">because</span> <span m="771373">there's</span> <span m="771613">just</span> <span m="772571">two</span> <span m="772810">regions,</span> <span m="773050">one</span> <span m="773133">of</span> <span m="773216">which</span> <span m="773300">is</span> <span m="773425">used</span> <span m="773550">by</span> <span m="773675">each</span> <span m="773800">set</span> <span m="773966">of</span> <span m="774132">things.</span> <span m="775294">So</span> <span m="775460">it</span> <span m="775626">actually</span> <span m="775792">depends</span> <span m="776290">on</span> <span m="776539">the</span> <span m="776788">if</span> <span m="776954">they</span> <span m="777120">use</span> <span m="777286">[INAUDIBLE]</span> <span m="777784">and</span> <span m="777908">stuff</span> <span m="778033">like</span> <span m="778157">that.</span> <span m="778282">You</span> <span m="778780">can</span> <span m="779029">also</span> <span m="779278">imagine</span> <span m="779776">that</span> <span m="780274">like</span> <span m="780440">in</span> <span m="780606">C++</span> <span m="780772">[INAUDIBLE]</span> <span m="781270">for</span> <span m="781519">example,</span> <span m="781768">you</span> <span m="782017">can</span> <span m="782266">define</span> <span m="782432">your</span> <span m="782598">own</span> <span m="782764">allocator,</span> <span m="783262">right.</span> <span m="783760">So</span> <span m="784258">it</span> <span m="784382">kind</span> <span m="784507">of</span> <span m="784631">depends</span> <span m="784756">[INAUDIBLE].</span> </p>
<p><span m="786748">AUDIENCE:</span> <span m="787246">[INAUDIBLE]</span> <span m="790234">input</span> <span m="790400">the</span> <span m="790566">same,</span> <span m="790732">how</span> <span m="791230">does the</span> <span m="791728">allocator</span> <span m="792226">know</span> <span m="792724">whether or</span> <span m="793222">not</span> <span m="793720">to</span> <span m="794218">set</span> <span m="794716">31</span> <span m="795214">or</span> <span m="795712">[INAUDIBLE].</span> </p>
<p><span m="796250">PROFESSOR: Yeah</span> <span m="796630">so</span> <span m="796830">at</span> <span m="796900">the</span> <span m="796970">lower</span> <span m="797120">level,</span> <span m="797570">typically</span> <span m="797830">the</span> <span m="797895">way</span> <span m="797960">that</span> <span m="798025">these</span> <span m="798538">allocation</span> <span m="798986">algorithms</span> <span m="799210">work,</span> <span m="799434">is</span> <span m="799882">that</span> <span m="801230">you</span> <span m="801490">call</span> <span m="801790">unknown</span> <span m="801910">system</span> <span m="802210">[INAUDIBLE]</span> <span m="803198">or</span> <span m="803692">something</span> <span m="803856">like</span> <span m="804021">that,</span> <span m="804186">sort</span> <span m="804350">of</span> <span m="804515">move</span> <span m="804556">a</span> <span m="804597">pointer</span> <span m="804638">up.</span> <span m="804680">So</span> <span m="804844">you</span> <span m="805009">can</span> <span m="805174">imagine</span> <span m="805668">if</span> <span m="805832">you</span> <span m="805997">have</span> <span m="806162">multiple</span> <span m="806656">allocators,</span> <span m="807150">all</span> <span m="807273">trying</span> <span m="807397">to</span> <span m="807520">allocate</span> <span m="807644">memory,</span> <span m="808632">they</span> <span m="808879">each</span> <span m="809126">have</span> <span m="809290">their</span> <span m="809455">own</span> <span m="810114">chunk</span> <span m="810278">of</span> <span m="810443">memory</span> <span m="810608">they</span> <span m="810859">reserve</span> <span m="811110">for</span> <span m="811310">themselves</span> <span m="812316">basically,</span> <span m="813130">right.</span> <span m="813460">So</span> <span m="813540">in</span> <span m="813660">real</span> <span m="813945">life</span> <span m="814087">it</span> <span m="814230">may</span> <span m="814280">be</span> <span m="814760">more</span> <span m="815257">fragmented</span> <span m="815754">than</span> <span m="816002">this,</span> <span m="816251">that's</span> <span m="816748">essentially</span> <span m="816913">on</span> <span m="816954">a</span> <span m="816996">high</span> <span m="817037">level,</span> <span m="817079">how</span> <span m="817245">it</span> <span m="817742">works.</span> </p>
<p><span m="819730">OK</span> <span m="820180">so</span> <span m="820300">this</span> <span m="820690">was</span> <span m="820940">a</span> <span m="821095">baggy</span> <span m="821250">bounds</span> <span m="821690">on</span> <span m="821805">a</span> <span m="821920">32-bit</span> <span m="822220">system.</span> <span m="823130">So</span> <span m="823730">as</span> <span m="824110">you</span> <span m="824270">all</span> <span m="824490">know</span> <span m="824630">64-bit</span> <span m="824800">systems</span> <span m="825160">are</span> <span m="825278">the</span> <span m="825397">bees</span> <span m="825516">knees</span> <span m="826230">these</span> <span m="826520">days,</span> <span m="826750">so</span> <span m="827020">how</span> <span m="827105">does</span> <span m="827190">baggy</span> <span m="827435">bounds</span> <span m="827910">work</span> <span m="828510">on</span> <span m="829660">those</span> <span m="829832">systems?</span> <span m="830350">Well,</span> <span m="830630">in</span> <span m="830910">those</span> <span m="831150">systems</span> <span m="831440">you</span> <span m="831593">can</span> <span m="831746">actually</span> <span m="831900">get</span> <span m="832130">rid</span> <span m="832360">of</span> <span m="833186">the</span> <span m="833682">bounds</span> <span m="833930">table,</span> <span m="834674">because</span> <span m="834798">we</span> <span m="834922">can</span> <span m="835046">actually</span> <span m="835170">store</span> <span m="835640">some</span> <span m="836080">information</span> <span m="837111">about</span> <span m="837336">the</span> <span m="837562">bounds,</span> <span m="838464">from</span> <span m="838614">the</span> <span m="838764">pointer</span> <span m="838915">itself.</span> </p>
<p><span m="842032">So</span> <span m="842530">imagine</span> <span m="843028">we're</span> <span m="843526">going</span> <span m="843692">to</span> <span m="843858">look</span> <span m="844024">at</span> <span m="844522">a</span> <span m="844688">regular</span> <span m="844854">pointer</span> <span m="846514">in</span> <span m="846680">a</span> <span m="846846">baggy</span> <span m="847012">bounds</span> <span m="847261">system.</span> <span m="849010">So</span> <span m="849275">we</span> <span m="849407">can</span> <span m="849540">use</span> <span m="849845">it,</span> <span m="850646">like</span> <span m="851142">this.</span> <span m="855110">So</span> <span m="855540">we</span> <span m="855805">can--</span> <span m="857270">if</span> <span m="857390">the</span> <span m="857510">pointer's</span> <span m="857920">in</span> <span m="858130">bounds,</span> <span m="858330">we</span> <span m="858380">can</span> <span m="858430">basically</span> <span m="858800">just</span> <span m="858950">set</span> <span m="859100">the</span> <span m="859350">first</span> <span m="859630">21</span> <span m="859795">bits</span> <span m="859960">to</span> <span m="860200">0.</span> <span m="861690">We</span> <span m="861870">can</span> <span m="862460">put</span> <span m="862640">the</span> <span m="862740">size</span> <span m="863250">in</span> <span m="863470">these</span> <span m="863820">5 bits</span> <span m="864080">here.</span> <span m="864340">And</span> <span m="864770">once</span> <span m="865020">again</span> <span m="865160">this</span> <span m="865320">is</span> <span m="865500">representing</span> <span m="866060">the</span> <span m="866600">log</span> <span m="866920">base</span> <span m="867240">2</span> <span m="867610">at</span> <span m="867732">the</span> <span m="867855">size</span> <span m="867977">here.</span> <span m="868770">And</span> <span m="868850">then</span> <span m="869010">we</span> <span m="869110">have</span> <span m="869440">here,</span> <span m="869900">in</span> <span m="870105">the</span> <span m="870310">remaining</span> <span m="871130">38</span> <span m="871335">bits,</span> <span m="871970">just</span> <span m="872190">the</span> <span m="872260">regular</span> <span m="872760">address</span> <span m="872987">bits.</span> </p>
<p><span m="873670">Now</span> <span m="873840">the</span> <span m="873950">reason</span> <span m="874220">why</span> <span m="874420">this</span> <span m="874530">doesn't</span> <span m="874670">massively</span> <span m="875370">curtail</span> <span m="875645">the</span> <span m="875920">address</span> <span m="876480">size</span> <span m="876840">of</span> <span m="876907">the</span> <span m="876975">program</span> <span m="877042">you</span> <span m="877110">use,</span> <span m="877850">is</span> <span m="877990">that</span> <span m="878010">a</span> <span m="878030">lot</span> <span m="878470">of</span> <span m="878620">these</span> <span m="879040">high</span> <span m="879205">order</span> <span m="879370">bits,</span> <span m="879960">the</span> <span m="880203">operating</span> <span m="880447">system</span> <span m="880934">and-or</span> <span m="881258">the</span> <span m="881421">hardware,</span> <span m="881908">doesn't</span> <span m="882395">let</span> <span m="882638">a</span> <span m="882882">application</span> <span m="883369">use,</span> <span m="883856">for various</span> <span m="884343">reasons,</span> <span m="884586">right.</span> <span m="885317">So</span> <span m="885438">as</span> <span m="885560">it</span> <span m="885682">turns</span> <span m="885804">out,</span> <span m="886300">we're</span> <span m="886545">not</span> <span m="886790">dramatically</span> <span m="887180">shrinking</span> <span m="887760">the</span> <span m="888145">amount</span> <span m="888530">of</span> <span m="888880">[INAUDIBLE]</span> <span m="889230">application</span> <span m="889268">you</span> <span m="889306">use</span> <span m="889344">in</span> <span m="889459">the</span> <span m="889573">system.</span> <span m="891062">This</span> <span m="891153">is</span> <span m="891245">what</span> <span m="891336">a</span> <span m="891428">regular</span> <span m="891520">pointer</span> <span m="891749">looks</span> <span m="891978">like.</span> </p>
<p><span m="892894">Now</span> <span m="893046">what</span> <span m="893199">happens</span> <span m="893352">when</span> <span m="893466">we</span> <span m="893581">only</span> <span m="893695">have</span> <span m="893810">one</span> <span m="893963">of</span> <span m="894116">these</span> <span m="894270">out</span> <span m="894355">of</span> <span m="894440">bounds</span> <span m="894605">pointers?</span> <span m="895280">Well,</span> <span m="895331">in</span> <span m="895382">a</span> <span m="895433">32-bit</span> <span m="895790">system</span> <span m="896290">all</span> <span m="896570">we</span> <span m="896660">can</span> <span m="896750">do</span> <span m="896840">basically</span> <span m="897290">is</span> <span m="897420">just</span> <span m="897485">set</span> <span m="897550">that</span> <span m="897750">high</span> <span m="897842">order</span> <span m="897935">bit</span> <span m="898390">and</span> <span m="898660">you</span> <span m="898990">just</span> <span m="899570">hope</span> <span m="899870">that</span> <span m="900070">thing</span> <span m="900270">never</span> <span m="900470">got</span> <span m="900870">beyond</span> <span m="901270">a</span> <span m="901670">1/2</span> <span m="901815">a</span> <span m="902250">slot</span> <span m="902435">away</span> <span m="902990">from</span> <span m="903780">it's</span> <span m="904100">base.</span> <span m="905119">But</span> <span m="905216">now</span> <span m="905314">that</span> <span m="905412">we</span> <span m="905510">have</span> <span m="905608">all</span> <span m="906097">this</span> <span m="906586">extra</span> <span m="907075">address</span> <span m="907564">space</span> <span m="907808">here,</span> <span m="908053">you</span> <span m="908297">can</span> <span m="908542">actually</span> <span m="909520">put</span> <span m="910180">the</span> <span m="910540">out</span> <span m="910830">of</span> <span m="911010">bounds</span> <span m="911190">offset</span> <span m="912730">directly</span> <span m="913760">in</span> <span m="914160">this</span> <span m="914536">pointer.</span> <span m="918020">So</span> <span m="918240">we</span> <span m="918380">can</span> <span m="918530">do</span> <span m="918750">something</span> <span m="919400">like</span> <span m="919700">this.</span> </p>
<p><span m="925230">So</span> <span m="925560">we</span> <span m="925720">can</span> <span m="925860">have</span> <span m="926970">13</span> <span m="927410">bits</span> <span m="927660">here</span> <span m="928150">for</span> <span m="928225">the</span> <span m="928300">offset,</span> <span m="928432">right,</span> <span m="929300">the</span> <span m="929460">out</span> <span m="929563">of</span> <span m="929666">bound</span> <span m="930080">offset.</span> <span m="930460">How</span> <span m="930750">far</span> <span m="931020">away</span> <span m="931510">is</span> <span m="931550">this</span> <span m="931590">out</span> <span m="931736">of</span> <span m="931883">bounds</span> <span m="932030">pointer,</span> <span m="933100">from</span> <span m="933550">the</span> <span m="933645">place</span> <span m="933740">where</span> <span m="933895">it</span> <span m="934050">should</span> <span m="934300">be?</span> <span m="935050">And</span> <span m="935145">then</span> <span m="935240">once</span> <span m="935420">again</span> <span m="935500">you</span> <span m="935626">can</span> <span m="935753">put</span> <span m="936160">the</span> <span m="937670">actual</span> <span m="938100">size</span> <span m="939280">of</span> <span m="939410">the</span> <span m="940090">referred</span> <span m="940520">object</span> <span m="941300">here.</span> <span m="942240">This</span> <span m="942376">will</span> <span m="942513">be</span> <span m="942650">0</span> <span m="943130">once</span> <span m="943375">again.</span> <span m="944112">And</span> <span m="944275">this</span> <span m="944439">will</span> <span m="944603">be</span> <span m="946570">the</span> <span m="947060">real</span> <span m="947330">address</span> <span m="947465">base</span> <span m="947600">here.</span> <span m="948740">And</span> <span m="949230">so</span> <span m="949740">this</span> <span m="949830">may</span> <span m="949920">be</span> <span m="950460">reminiscent</span> <span m="950945">to</span> <span m="951187">you</span> <span m="951430">of</span> <span m="951672">some</span> <span m="951915">type</span> <span m="952157">of</span> <span m="952400">fact</span> <span m="952525">pointer</span> <span m="952650">representation,</span> <span m="953290">but</span> <span m="953620">there's</span> <span m="953920">a</span> <span m="954180">couple</span> <span m="954600">of</span> <span m="954730">advantages</span> <span m="955190">here,</span> <span m="955870">now</span> <span m="956030">that</span> <span m="956190">we're</span> <span m="956350">moving</span> <span m="956440">in</span> <span m="956592">the</span> <span m="956745">64-bit</span> <span m="957260">world.</span> </p>
<p><span m="957800">So</span> <span m="958000">first</span> <span m="958300">of</span> <span m="958430">all,</span> <span m="958810">you'll</span> <span m="958950">note</span> <span m="959180">that</span> <span m="959670">these</span> <span m="960070">tag</span> <span m="960470">pointers,</span> <span m="960870">these</span> <span m="960905">are</span> <span m="960940">the</span> <span m="961090">regular</span> <span m="961500">size</span> <span m="961850">of</span> <span m="962200">a</span> <span m="962610">regular</span> <span m="963090">pointer,</span> <span m="963570">right.</span> <span m="964000">Pointer's</span> <span m="964260">are</span> <span m="964370">still</span> <span m="964480">just</span> <span m="964740">64-bits</span> <span m="965180">wide</span> <span m="966000">in</span> <span m="966045">both</span> <span m="966090">of</span> <span m="966225">these</span> <span m="966360">setups.</span> <span m="967860">So</span> <span m="968360">that's</span> <span m="968610">nice</span> <span m="968735">because</span> <span m="968860">that</span> <span m="969090">means</span> <span m="969350">for</span> <span m="969500">example,</span> <span m="970180">that</span> <span m="970530">means</span> <span m="970850">and</span> <span m="971020">rights</span> <span m="971190">to</span> <span m="971345">that</span> <span m="971500">pointer</span> <span m="971785">are</span> <span m="972070">time.</span> <span m="973280">Unlike</span> <span m="973570">in</span> <span m="973830">traditional</span> <span m="974180">fat</span> <span m="974520">finger</span> <span m="974860">world,</span> <span m="975060">where</span> <span m="975225">you</span> <span m="975391">actually</span> <span m="975557">have</span> <span m="975681">to</span> <span m="975805">use</span> <span m="975929">multiple</span> <span m="976054">words</span> <span m="976551">represent</span> <span m="976799">that</span> <span m="977048">fat</span> <span m="977296">pointer.</span> <span m="978042">So</span> <span m="978539">that's</span> <span m="979040">nice.</span> </p>
<p><span m="979125">And</span> <span m="979210">also</span> <span m="979740">note</span> <span m="979970">that</span> <span m="980420">we</span> <span m="980560">can</span> <span m="981020">trivially</span> <span m="981500">ask</span> <span m="981856">these</span> <span m="982034">things,</span> <span m="982570">uninstrumented</span> <span m="982820">code,</span> <span m="983760">because</span> <span m="983870">they</span> <span m="984300">work</span> <span m="984790">and</span> <span m="985105">are</span> <span m="985262">the</span> <span m="985420">same</span> <span m="985670">size</span> <span m="986060">as</span> <span m="986480">regular</span> <span m="986945">pointers.</span> <span m="987410">We</span> <span m="987503">can</span> <span m="987596">put</span> <span m="987689">these</span> <span m="987782">things</span> <span m="987875">in</span> <span m="988107">structs</span> <span m="988340">for</span> <span m="988572">example,</span> <span m="989270">and</span> <span m="989740">the size</span> <span m="990570">of</span> <span m="990650">those</span> <span m="990890">structs</span> <span m="991130">won't</span> <span m="991450">change.</span> <span m="992080">So</span> <span m="992260">this</span> <span m="992595">is</span> <span m="992930">very</span> <span m="993372">nice</span> <span m="993814">if</span> <span m="993887">we</span> <span m="993961">can</span> <span m="994035">work</span> <span m="994108">in</span> <span m="994182">that</span> <span m="994256">64-bit</span> <span m="994698">world.</span> <span m="996470">So</span> <span m="996670">does</span> <span m="996835">that</span> <span m="997000">all</span> <span m="997215">make</span> <span m="997430">sense?</span> </p>
<p><span m="999166">AUDIENCE:</span> <span m="999600">So</span> <span m="1000410">why</span> <span m="1000526">are</span> <span m="1000643">there</span> <span m="1001110">eight</span> <span m="1001532">0-bits</span> <span m="1001954">[INAUDIBLE]</span> <span m="1002798">pointer</span> <span m="1003220">there?</span> <span m="1003680">Where</span> <span m="1003833">like</span> <span m="1003986">the</span> <span m="1004140">5</span> <span m="1004310">size</span> <span m="1004750">bits</span> <span m="1005450">previously</span> <span m="1005800">weren't.</span> </p>
<p><span m="1007550">PROFESSOR:</span> <span m="1007900">So</span> <span m="1007995">you're</span> <span m="1008090">talking</span> <span m="1008490">about</span> <span m="1008920">down</span> <span m="1009220">here?</span> </p>
<p><span m="1009590">AUDIENCE:</span> <span m="1009855">Yeah,</span> <span m="1009943">is</span> <span m="1010031">there</span> <span m="1010120">a</span> <span m="1010190">reason</span> <span m="1010260">why</span> <span m="1010380">we</span> <span m="1010500">can't</span> <span m="1010700">just</span> <span m="1010900">store</span> <span m="1011290">a</span> <span m="1011680">[INAUDIBLE]</span> <span m="1013320">if</span> <span m="1013420">we're</span> <span m="1013520">like</span> <span m="1013620">six</span> <span m="1013820">0-bits</span> <span m="1014420">there</span> <span m="1014600">and</span> <span m="1014780">had</span> <span m="1014935">more</span> <span m="1015090">bits</span> <span m="1015176">for</span> <span m="1015263">the</span> <span m="1015350">offset,</span> <span m="1015680">like</span> <span m="1015762">why</span> <span m="1015845">is</span> <span m="1015927">the</span> <span m="1016010">number</span> <span m="1016445">8?</span> </p>
<p><span m="1017720">PROFESSOR:</span> <span m="1018140">So</span> <span m="1018630">I</span> <span m="1018830">think</span> <span m="1019240">so</span> <span m="1019420">in</span> <span m="1019662">some</span> <span m="1019904">cases</span> <span m="1020872">there</span> <span m="1021356">are</span> <span m="1021517">certain</span> <span m="1021678">line</span> <span m="1021732">issues</span> <span m="1021786">that</span> <span m="1021840">we</span> <span m="1021961">have</span> <span m="1022082">to</span> <span m="1022203">work</span> <span m="1022324">with.</span> <span m="1022808">The</span> <span m="1023292">[INAUDIBLE]</span> <span m="1023776">issue</span> <span m="1024260">is</span> <span m="1024421">to</span> <span m="1024582">deal</span> <span m="1024744">with</span> <span m="1025228">if</span> <span m="1025470">the</span> <span m="1025712">bits</span> <span m="1025873">are</span> <span m="1026034">higher.</span> <span m="1026196">I</span> <span m="1026357">don't</span> <span m="1026518">think,</span> <span m="1026680">in principle,</span> <span m="1027164">there's</span> <span m="1027325">any</span> <span m="1027486">reason</span> <span m="1027540">why</span> <span m="1027567">you</span> <span m="1027594">couldn't</span> <span m="1027648">read</span> <span m="1027809">some</span> <span m="1027970">of</span> <span m="1028132">these</span> <span m="1028374">things</span> <span m="1028616">[INAUDIBLE].</span> <span m="1030089">Well</span> <span m="1030164">there</span> <span m="1030239">may</span> <span m="1030314">be</span> <span m="1030390">some</span> <span m="1030665">hard</span> <span m="1030940">versions</span> <span m="1031305">that</span> <span m="1031350">I'm</span> <span m="1031396">not</span> <span m="1031578">thinking</span> <span m="1031913">of</span> <span m="1032156">right</span> <span m="1032642">now,</span> <span m="1033128">but</span> <span m="1033614">[INAUDIBLE]</span> <span m="1033711">some</span> <span m="1033759">of</span> <span m="1033808">these</span> <span m="1033905">would</span> <span m="1034002">have</span> <span m="1034100">to</span> <span m="1034343">0</span> <span m="1034586">or</span> <span m="1034829">otherwise</span> <span m="1035072">the</span> <span m="1035315">hardware's</span> <span m="1035558">going</span> <span m="1035801">to</span> <span m="1037510">cause</span> <span m="1037650">a</span> <span m="1037790">problem.</span> <span m="1041079">Any</span> <span m="1041204">other</span> <span m="1041329">questions?</span> </p>
<p><span m="1043310">OK</span> <span m="1043810">so,</span> <span m="1045160">next</span> <span m="1045365">thing</span> <span m="1045570">are</span> <span m="1045706">you</span> <span m="1045843">wondering</span> <span m="1046380">is,</span> <span m="1046480">can</span> <span m="1046740">you</span> <span m="1047160">still</span> <span m="1047589">launch</span> <span m="1048109">a</span> <span m="1048250">buffer</span> <span m="1048550">overflows</span> <span m="1049610">in</span> <span m="1049790">the</span> <span m="1049860">baggy</span> <span m="1050110">bounds</span> <span m="1050390">system,</span> <span m="1050720">obviously</span> <span m="1051230">because</span> <span m="1051450">I</span> <span m="1051510">gave</span> <span m="1051720">you</span> <span m="1051830">another</span> <span m="1051940">paper</span> <span m="1052200">to</span> <span m="1052340">read,</span> <span m="1052480">so</span> <span m="1052600">clearly</span> <span m="1052840">this</span> <span m="1052990">thing,</span> <span m="1053100">this</span> <span m="1053230">doesn't</span> <span m="1053330">solve</span> <span m="1053700">all</span> <span m="1053740">the</span> <span m="1053780">problems,</span> <span m="1054220">right?</span> <span m="1054970">So</span> <span m="1055220">one</span> <span m="1055440">problem</span> <span m="1055940">you</span> <span m="1055990">might</span> <span m="1056040">run</span> <span m="1056450">into</span> <span m="1056610">is</span> <span m="1056740">that</span> <span m="1056815">if</span> <span m="1056890">you</span> <span m="1056975">have</span> <span m="1057060">uninstrumented</span> <span m="1057650">code</span> <span m="1058010">once</span> <span m="1058230">again,</span> <span m="1058390">we</span> <span m="1058490">can't</span> <span m="1058680">detect</span> <span m="1058930">any</span> <span m="1059180">problems</span> <span m="1059530">in</span> <span m="1059640">uninstrumented</span> <span m="1060250">code.</span> </p>
<p><span m="1061510">You</span> <span m="1061640">could</span> <span m="1061780">also</span> <span m="1062490">encounter</span> <span m="1063730">memory</span> <span m="1064060">vulnerabilities</span> <span m="1064550">that</span> <span m="1064655">come</span> <span m="1064760">about</span> <span m="1065085">from</span> <span m="1065410">the</span> <span m="1065590">dynamic</span> <span m="1066070">memory</span> <span m="1066415">allocation</span> <span m="1066760">system.</span> <span m="1067380">So</span> <span m="1067436">if</span> <span m="1067492">you</span> <span m="1067548">can</span> <span m="1067604">remember</span> <span m="1067660">in</span> <span m="1067740">the</span> <span m="1067850">lecture</span> <span m="1068120">we</span> <span m="1068265">looked</span> <span m="1068410">at</span> <span m="1068860">this</span> <span m="1069020">weird</span> <span m="1070150">free</span> <span m="1070530">malloc</span> <span m="1072330">weird</span> <span m="1072550">pointer</span> <span m="1072990">thing</span> <span m="1073340">that</span> <span m="1073428">took</span> <span m="1073516">place.</span> <span m="1074090">Baggy</span> <span m="1074290">bounds</span> <span m="1074360">won't</span> <span m="1074710">necessarily</span> <span m="1075470">prevent</span> <span m="1075800">you</span> <span m="1075980">from</span> <span m="1076160">some</span> <span m="1076350">of</span> <span m="1076390">that</span> <span m="1076640">stuff.</span> </p>
<p><span m="1077500">We</span> <span m="1077570">also</span> <span m="1077810">discussed</span> <span m="1078230">last</span> <span m="1078500">lecture,</span> <span m="1078750">where</span> <span m="1080130">the</span> <span m="1080210">fact</span> <span m="1080800">that</span> <span m="1081160">code</span> <span m="1081340">pointers</span> <span m="1081520">do</span> <span m="1082006">not</span> <span m="1082249">have</span> <span m="1082492">bounds</span> <span m="1082654">associated</span> <span m="1082816">with</span> <span m="1082978">them,</span> <span m="1083950">right.</span> <span m="1084260">So</span> <span m="1084335">now</span> <span m="1084372">you</span> <span m="1084410">have</span> <span m="1085250">struct</span> <span m="1085390">that</span> <span m="1085820">has</span> <span m="1085990">a</span> <span m="1086160">buffer</span> <span m="1086400">at</span> <span m="1086540">the</span> <span m="1086620">bottom,</span> <span m="1087240">it</span> <span m="1087360">has</span> <span m="1087480">a</span> <span m="1087550">function</span> <span m="1087805">pointer</span> <span m="1088100">up</span> <span m="1088200">top,</span> <span m="1089140">if</span> <span m="1089300">you</span> <span m="1089460">have</span> <span m="1089620">a</span> <span m="1089950">buffer</span> <span m="1090005">overflow</span> <span m="1090375">in</span> <span m="1090532">to</span> <span m="1090690">that</span> <span m="1091050">function</span> <span m="1091410">pointer,</span> <span m="1092300">right.</span> </p>
<p><span m="1092550">Let's</span> <span m="1092720">say</span> <span m="1092810">that</span> <span m="1092960">buffer</span> <span m="1093150">overflow</span> <span m="1093440">is</span> <span m="1093730">still</span> <span m="1094220">within</span> <span m="1094540">the</span> <span m="1094910">baggy</span> <span m="1095095">bounds.</span> <span m="1095280">So</span> <span m="1095460">you've</span> <span m="1095640">overridden</span> <span m="1096040">that</span> <span m="1096110">function</span> <span m="1096425">pointer.</span> <span m="1097910">We</span> <span m="1098040">would</span> <span m="1098170">try</span> <span m="1098360">to</span> <span m="1098500">execute</span> <span m="1098910">that</span> <span m="1099180">function</span> <span m="1099450">pointer,</span> <span m="1100020">it</span> <span m="1100390">could</span> <span m="1100515">be</span> <span m="1100640">pointed</span> <span m="1100707">at</span> <span m="1100775">something</span> <span m="1100842">for,</span> <span m="1102100">attack</span> <span m="1102250">a</span> <span m="1102710">control</span> <span m="1102783">piece</span> <span m="1102856">of</span> <span m="1102930">memory.</span> <span m="1103840">OK,</span> <span m="1103956">and</span> <span m="1104073">bounds</span> <span m="1104190">won't</span> <span m="1104280">help</span> <span m="1104370">with</span> <span m="1104730">that,</span> <span m="1104950">because</span> <span m="1105416">there's</span> <span m="1105649">no</span> <span m="1105882">bounds</span> <span m="1106348">associate</span> <span m="1106503">with</span> <span m="1106658">function</span> <span m="1106814">pointers.</span> </p>
<p><span m="1110076">And</span> <span m="1110550">so</span> <span m="1110865">in</span> <span m="1111180">general,</span> <span m="1111850">what</span> <span m="1112140">are</span> <span m="1112280">the</span> <span m="1112760">cost's</span> <span m="1113610">of</span> <span m="1114102">baggy</span> <span m="1114348">bounds?</span> <span m="1116562">So</span> <span m="1116808">there</span> <span m="1117054">are</span> <span m="1117546">essentially</span> <span m="1118530">four.</span> <span m="1118860">So</span> <span m="1119025">the</span> <span m="1119190">first</span> <span m="1119560">cost</span> <span m="1121600">is</span> <span m="1122500">space,</span> <span m="1123300">right.</span> <span m="1123620">So</span> <span m="1123745">if</span> <span m="1123870">you're</span> <span m="1123995">using</span> <span m="1124120">a</span> <span m="1124245">fat</span> <span m="1124370">pointer,</span> <span m="1124495">obviously</span> <span m="1124620">you've</span> <span m="1124786">got</span> <span m="1124953">to</span> <span m="1125120">make</span> <span m="1125620">pointers</span> <span m="1125870">bigger.</span> <span m="1127120">But</span> <span m="1127465">if</span> <span m="1127580">you're</span> <span m="1127695">using</span> <span m="1127930">the</span> <span m="1128010">baggy</span> <span m="1128167">bounds</span> <span m="1128640">system</span> <span m="1129040">that</span> <span m="1129240">we</span> <span m="1129440">just</span> <span m="1129860">discussed,</span> <span m="1129980">you've</span> <span m="1130093">got</span> <span m="1130206">to</span> <span m="1130320">store</span> <span m="1130630">the</span> <span m="1130820">bounds</span> <span m="1131260">table,</span> <span m="1131473">right.</span> <span m="1132112">And</span> <span m="1132540">so</span> <span m="1133350">the</span> <span m="1133450">bounds</span> <span m="1133740">table</span> <span m="1134730">has</span> <span m="1135010">that</span> <span m="1135290">slot</span> <span m="1135445">size</span> <span m="1135600">which</span> <span m="1135835">allows</span> <span m="1136070">you</span> <span m="1136225">to</span> <span m="1136380">control</span> <span m="1136980">how</span> <span m="1137150">big</span> <span m="1137530">that</span> <span m="1137570">bounds</span> <span m="1137750">table</span> <span m="1137930">is,</span> <span m="1138090">but</span> <span m="1138440">still</span> <span m="1139080">you</span> <span m="1139230">may</span> <span m="1139380">end</span> <span m="1139455">up</span> <span m="1139530">using</span> <span m="1140300">[INAUDIBLE]</span> <span m="1140740">memory</span> <span m="1140873">for</span> <span m="1141006">that.</span> </p>
<p><span m="1142140">You've</span> <span m="1142320">also</span> <span m="1142660">got</span> <span m="1143590">the</span> <span m="1143900">CPU</span> <span m="1144920">overhead</span> <span m="1145325">of</span> <span m="1145730">doing</span> <span m="1146730">all</span> <span m="1147070">of</span> <span m="1147280">the</span> <span m="1147910">pointer</span> <span m="1148370">instrumentation,</span> <span m="1149570">right.</span> <span m="1149800">So</span> <span m="1149900">for</span> <span m="1150160">every,</span> <span m="1150750">or</span> <span m="1150910">close</span> <span m="1151220">to</span> <span m="1151300">every</span> <span m="1151790">pointer</span> <span m="1152310">thing</span> <span m="1152630">that</span> <span m="1152827">you</span> <span m="1153025">do,</span> <span m="1153420">you</span> <span m="1153640">got</span> <span m="1153800">to</span> <span m="1154290">check</span> <span m="1154610">these</span> <span m="1155120">bounds</span> <span m="1155530">using</span> <span m="1156170">those</span> <span m="1156290">shift</span> <span m="1156600">operations</span> <span m="1156880">and</span> <span m="1157160">things</span> <span m="1157360">like</span> <span m="1157530">that.</span> <span m="1158040">So</span> <span m="1158070">that's</span> <span m="1158210">going</span> <span m="1158310">to</span> <span m="1158350">slow</span> <span m="1158540">your</span> <span m="1158670">program</span> <span m="1159060">down.</span> </p>
<p><span m="1161140">There's</span> <span m="1161360">also</span> <span m="1161680">this</span> <span m="1161870">problem</span> <span m="1163280">with</span> <span m="1164090">false</span> <span m="1164490">alarms,</span> <span m="1166610">right.</span> <span m="1166890">So</span> <span m="1167000">as</span> <span m="1167150">we</span> <span m="1167290">discussed,</span> <span m="1169040">it</span> <span m="1169290">may</span> <span m="1169445">be</span> <span m="1169522">the</span> <span m="1169600">case</span> <span m="1169950">that</span> <span m="1169980">a</span> <span m="1170010">program</span> <span m="1170380">generates</span> <span m="1170740">out</span> <span m="1170826">of</span> <span m="1170913">bound</span> <span m="1171000">pointers</span> <span m="1171540">but</span> <span m="1171660">never</span> <span m="1171900">tries</span> <span m="1172110">to</span> <span m="1172200">dereference</span> <span m="1172690">it,</span> <span m="1173000">right.</span> <span m="1173360">Strictly</span> <span m="1173740">speaking</span> <span m="1174070">that's</span> <span m="1174670">not</span> <span m="1174870">an</span> <span m="1174970">issue.</span> <span m="1175520">The</span> <span m="1175640">baggy</span> <span m="1176000">bounds</span> <span m="1176380">will</span> <span m="1176540">flag</span> <span m="1177040">the</span> <span m="1177130">creation</span> <span m="1177560">of</span> <span m="1177660">those</span> <span m="1177870">out</span> <span m="1178020">of</span> <span m="1178090">bounds</span> <span m="1178360">pointers,</span> <span m="1178960">if</span> <span m="1179140">they</span> <span m="1179250">get</span> <span m="1179530">beyond</span> <span m="1180150">a</span> <span m="1180230">1/2</span> <span m="1180435">a</span> <span m="1180537">slot</span> <span m="1180640">size,</span> <span m="1181240">at</span> <span m="1181290">least</span> <span m="1181340">in</span> <span m="1181500">the</span> <span m="1181570">32-bit</span> <span m="1182100">solution,</span> <span m="1182790">right.</span> </p>
<p><span m="1183160">And</span> <span m="1183400">so</span> <span m="1183590">what</span> <span m="1183720">you'll</span> <span m="1183860">see</span> <span m="1184250">with</span> <span m="1184270">a</span> <span m="1184290">lot</span> <span m="1184460">of</span> <span m="1184520">security</span> <span m="1184990">tools,</span> <span m="1185460">is</span> <span m="1185575">that</span> <span m="1185690">false</span> <span m="1185990">alarms</span> <span m="1186700">really</span> <span m="1187140">reduce</span> <span m="1187510">the</span> <span m="1187600">likelihood</span> <span m="1188390">that</span> <span m="1188500">people</span> <span m="1188750">are</span> <span m="1188790">going</span> <span m="1188900">to</span> <span m="1188940">use</span> <span m="1189140">your</span> <span m="1189280">tools,</span> <span m="1190110">right.</span> <span m="1190320">Because</span> <span m="1190730">in</span> <span m="1190860">practice</span> <span m="1191720">we</span> <span m="1191825">would</span> <span m="1191930">all</span> <span m="1192110">hope</span> <span m="1192330">that</span> <span m="1192410">we</span> <span m="1192500">care</span> <span m="1192660">about</span> <span m="1192860">security,</span> <span m="1193320">but</span> <span m="1194260">actually</span> <span m="1194590">what</span> <span m="1194660">do</span> <span m="1194730">people</span> <span m="1194950">care</span> <span m="1195180">about?</span> </p>
<p><span m="1195630">They</span> <span m="1195720">want</span> <span m="1195870">to</span> <span m="1195910">be</span> <span m="1195990">able</span> <span m="1196160">to</span> <span m="1196210">upload</span> <span m="1196640">their</span> <span m="1196760">silly</span> <span m="1197020">Facebook</span> <span m="1197380">photos</span> <span m="1197720">and</span> <span m="1197780">life</span> <span m="1197990">things,</span> <span m="1198370">and</span> <span m="1198415">they</span> <span m="1198460">want</span> <span m="1198620">to</span> <span m="1198660">be</span> <span m="1199070">able</span> <span m="1199300">to</span> <span m="1199340">make</span> <span m="1199510">things</span> <span m="1199680">go</span> <span m="1199800">fast</span> <span m="1200240">and</span> <span m="1200345">stuff</span> <span m="1200450">like</span> <span m="1200630">that.</span> <span m="1201130">So</span> <span m="1201170">you</span> <span m="1201360">really</span> <span m="1201640">want</span> <span m="1201880">your</span> <span m="1202010">security</span> <span m="1202480">tools</span> <span m="1203160">to</span> <span m="1203510">probably</span> <span m="1204030">have</span> <span m="1204550">less</span> <span m="1204950">coverage</span> <span m="1205830">of</span> <span m="1206310">finding</span> <span m="1206800">bugs,</span> <span m="1207240">but</span> <span m="1207350">actually</span> <span m="1207630">have</span> <span m="1208070">0</span> <span m="1208460">false</span> <span m="1208790">alarms.</span> <span m="1209520">As</span> <span m="1209660">opposed</span> <span m="1210060">to</span> <span m="1210270">catching</span> <span m="1210820">all</span> <span m="1211130">types</span> <span m="1211400">of</span> <span m="1211480">security</span> <span m="1211850">vulnerabilities,</span> <span m="1212230">but</span> <span m="1212610">then</span> <span m="1212760">maybe</span> <span m="1212980">having</span> <span m="1213220">some</span> <span m="1213350">false</span> <span m="1213620">alarms</span> <span m="1214020">that</span> <span m="1214075">are</span> <span m="1214130">going</span> <span m="1214185">to</span> <span m="1214240">irritate</span> <span m="1214590">developers,</span> <span m="1214860">or</span> <span m="1215340">irritate</span> <span m="1215860">users.</span> </p>
<p><span m="1216790">And</span> <span m="1217040">the</span> <span m="1217110">other</span> <span m="1217300">costs</span> <span m="1217590">that</span> <span m="1217690">you</span> <span m="1217750">have</span> <span m="1218010">for</span> <span m="1218056">this</span> <span m="1218103">is</span> <span m="1218150">finally,</span> <span m="1218490">is</span> <span m="1218660">that</span> <span m="1218830">you</span> <span m="1218980">need</span> <span m="1220620">compiler</span> <span m="1221260">support,</span> <span m="1225600">right.</span> <span m="1225770">Which</span> <span m="1225960">can</span> <span m="1226080">actually</span> <span m="1226400">end</span> <span m="1226430">up</span> <span m="1226460">being</span> <span m="1226660">nontrivial,</span> <span m="1227640">because</span> <span m="1227860">you</span> <span m="1227930">have</span> <span m="1228040">to</span> <span m="1228120">go</span> <span m="1228340">in</span> <span m="1228400">there,</span> <span m="1228530">you</span> <span m="1228570">have</span> <span m="1228660">to</span> <span m="1228770">add</span> <span m="1229050">all</span> <span m="1229190">the</span> <span m="1229260">instrumentation,</span> <span m="1230360">crawl</span> <span m="1230710">the</span> <span m="1230800">pointer</span> <span m="1231150">checks,</span> <span m="1231600">and</span> <span m="1231736">so</span> <span m="1231873">on</span> <span m="1232010">ans</span> <span m="1232110">so</span> <span m="1232210">forth.</span> <span m="1232610">So</span> <span m="1232706">those</span> <span m="1232803">are</span> <span m="1232900">basically</span> <span m="1233610">the</span> <span m="1233780">cost</span> <span m="1234190">of</span> <span m="1234580">these</span> <span m="1234750">bounds</span> <span m="1235060">checking</span> <span m="1235330">approaches.</span> <span m="1237000">So</span> <span m="1237490">that</span> <span m="1237670">concludes</span> <span m="1238000">the</span> <span m="1238070">discussion</span> <span m="1238710">of</span> <span m="1241070">baggy</span> <span m="1241380">bounds.</span> </p>
<p><span m="1242120">And</span> <span m="1242240">so</span> <span m="1242360">now</span> <span m="1242600">we</span> <span m="1242670">can</span> <span m="1242780">actually</span> <span m="1243080">think</span> <span m="1243320">about</span> <span m="1243710">a</span> <span m="1243820">two</span> <span m="1244130">other</span> <span m="1244450">mitigation</span> <span m="1245010">strategies</span> <span m="1245540">for</span> <span m="1245630">buffer</span> <span m="1245850">overflows.</span> <span m="1246570">They're</span> <span m="1246690">actually</span> <span m="1246990">much</span> <span m="1247270">simpler</span> <span m="1248110">to</span> <span m="1248240">explain</span> <span m="1248505">and</span> <span m="1248770">understand.</span> </p>
<p><span m="1249600">So</span> <span m="1250150">one</span> <span m="1250300">of</span> <span m="1250340">these</span> <span m="1250500">approaches</span> <span m="1251390">is</span> <span m="1251660">called</span> <span m="1253710">a</span> <span m="1253840">non-executable</span> <span m="1254760">memory.</span> <span m="1260570">And</span> <span m="1260780">the</span> <span m="1260840">basic</span> <span m="1261200">idea</span> <span m="1262040">is</span> <span m="1262260">that</span> <span m="1263300">the</span> <span m="1263390">paging</span> <span m="1263820">hardware</span> <span m="1264600">is</span> <span m="1264730">going</span> <span m="1264830">to</span> <span m="1264890">specify</span> <span m="1266300">3-bits</span> <span m="1268100">for</span> <span m="1268305">each</span> <span m="1268510">page</span> <span m="1268830">that</span> <span m="1268885">you</span> <span m="1268940">have</span> <span m="1269045">in</span> <span m="1269150">memory,</span> <span m="1269820">read,</span> <span m="1270390">write</span> <span m="1270800">and</span> <span m="1270910">execute,</span> <span m="1271750">right.</span> <span m="1272100">Can</span> <span m="1272250">the</span> <span m="1272400">program</span> <span m="1272550">read</span> <span m="1272703">that</span> <span m="1272856">memory,</span> <span m="1273270">write</span> <span m="1273580">to</span> <span m="1273740">it,</span> <span m="1273980">execute</span> <span m="1274410">it.</span> <span m="1274720">The</span> <span m="1274820">first</span> <span m="1275140">2-bits</span> <span m="1275420">are</span> <span m="1275500">old,</span> <span m="1276105">they've</span> <span m="1276380">been</span> <span m="1276540">around</span> <span m="1276790">for</span> <span m="1276870">a</span> <span m="1276970">while,</span> <span m="1277490">that</span> <span m="1277720">last</span> <span m="1278060">bit</span> <span m="1278180">is</span> <span m="1278290">actually</span> <span m="1278600">a</span> <span m="1278660">fairly</span> <span m="1279030">new</span> <span m="1279210">construction.</span> </p>
<p><span m="1279820">And</span> <span m="1280190">so</span> <span m="1280300">the</span> <span m="1280410">idea</span> <span m="1280810">is</span> <span m="1280865">that</span> <span m="1280920">you</span> <span m="1280970">can</span> <span m="1281110">actually</span> <span m="1281430">make</span> <span m="1281760">the</span> <span m="1281850">stack</span> <span m="1282620">non-executable,</span> <span m="1284460">right.</span> <span m="1284790">So</span> <span m="1284940">if</span> <span m="1285020">you</span> <span m="1285110">make</span> <span m="1285270">the</span> <span m="1285350">stack</span> <span m="1285710">non-executable</span> <span m="1286960">that</span> <span m="1287170">means</span> <span m="1287305">that</span> <span m="1287440">the</span> <span m="1287540">adversary</span> <span m="1288080">can't</span> <span m="1288560">run</span> <span m="1288770">code</span> <span m="1289110">just</span> <span m="1289280">by</span> <span m="1289410">pointing--</span> <span m="1290300">by</span> <span m="1290460">creating</span> <span m="1290780">that</span> <span m="1290960">shell</span> <span m="1291210">code</span> <span m="1291440">and</span> <span m="1291530">then</span> <span m="1291690">sort</span> <span m="1291860">of</span> <span m="1291950">jumping</span> <span m="1293020">to</span> <span m="1293330">someplace</span> <span m="1294010">in</span> <span m="1294130">that</span> <span m="1294300">buffer.</span> </p>
<p><span m="1294840">And</span> <span m="1295030">so</span> <span m="1295240">what</span> <span m="1295280">a</span> <span m="1295320">lot</span> <span m="1295540">of</span> <span m="1295590">systems</span> <span m="1295930">do,</span> <span m="1296150">is</span> <span m="1296240">they</span> <span m="1296330">actually</span> <span m="1298750">specify</span> <span m="1299470">a</span> <span m="1299550">policy</span> <span m="1301770">like</span> <span m="1302010">this.</span> <span m="1303190">So</span> <span m="1303920">right</span> <span m="1304320">exclusive</span> <span m="1304940">or</span> <span m="1305175">x,</span> <span m="1305880">which</span> <span m="1306090">means</span> <span m="1306360">that</span> <span m="1306403">if</span> <span m="1306446">you</span> <span m="1306490">have</span> <span m="1306690">a</span> <span m="1306740">particular</span> <span m="1307060">page,</span> <span m="1307590">you</span> <span m="1307710">can</span> <span m="1308010">either</span> <span m="1308340">write</span> <span m="1308630">to</span> <span m="1308780">it,</span> <span m="1309730">or</span> <span m="1310050">you</span> <span m="1310160">can</span> <span m="1310770">treat</span> <span m="1310990">it</span> <span m="1311070">as</span> <span m="1311150">executable</span> <span m="1311700">code,</span> <span m="1312070">but</span> <span m="1312190">you</span> <span m="1312300">cannot</span> <span m="1312630">do</span> <span m="1312740">both.</span> <span m="1313840">OK</span> <span m="1314190">and</span> <span m="1314240">so</span> <span m="1314290">that</span> <span m="1314510">once</span> <span m="1314690">again,</span> <span m="1314820">is</span> <span m="1314910">going</span> <span m="1315000">to</span> <span m="1315070">prevent</span> <span m="1315250">the</span> <span m="1315410">attacker</span> <span m="1315790">from</span> <span m="1316260">just</span> <span m="1316450">putting</span> <span m="1316670">executable</span> <span m="1317160">code</span> <span m="1317440">in</span> <span m="1317600">the</span> <span m="1317670">stack</span> <span m="1318250">and</span> <span m="1318365">then</span> <span m="1318480">going</span> <span m="1318690">straight</span> <span m="1318990">to</span> <span m="1319140">it.</span> <span m="1320380">So</span> <span m="1321050">this</span> <span m="1321140">is--</span> <span m="1321230">should</span> <span m="1321740">be</span> <span m="1321850">pretty</span> <span m="1322090">straightforward,</span> <span m="1322650">right.</span> <span m="1322890">So</span> <span m="1323020">we've</span> <span m="1323150">removed,</span> <span m="1324130">at</span> <span m="1324220">the</span> <span m="1324290">hardware</span> <span m="1324660">level,</span> <span m="1326110">this</span> <span m="1326430">attack</span> <span m="1326850">vector</span> <span m="1327280">of</span> <span m="1327400">the</span> <span m="1327790">attacker</span> <span m="1328230">putting</span> <span m="1328500">executable</span> <span m="1328620">code</span> <span m="1328940">in</span> <span m="1329130">the</span> <span m="1329340">stack.</span> <span m="1329920">So</span> <span m="1330080">what's</span> <span m="1330270">nice</span> <span m="1330530">about</span> <span m="1330820">this?</span> </p>
<p><span m="1331210">Well</span> <span m="1331530">potentially</span> <span m="1332110">this</span> <span m="1332310">works</span> <span m="1332950">without</span> <span m="1333550">any</span> <span m="1333840">changes</span> <span m="1334670">to</span> <span m="1334850">the</span> <span m="1334960">application,</span> <span m="1335970">right.</span> <span m="1336190">This</span> <span m="1336320">is</span> <span m="1336380">all</span> <span m="1336560">taken</span> <span m="1336810">place</span> <span m="1337570">at</span> <span m="1337690">the</span> <span m="1337760">hardware</span> <span m="1338090">level</span> <span m="1338610">and</span> <span m="1338950">at</span> <span m="1339020">the</span> <span m="1339090">OS</span> <span m="1339390">level,</span> <span m="1339670">with</span> <span m="1339820">the</span> <span m="1339940">OS</span> <span m="1340340">just</span> <span m="1340660">making</span> <span m="1340910">sure</span> <span m="1341050">the</span> <span m="1341170">pages</span> <span m="1341510">are</span> <span m="1341640">protected</span> <span m="1341940">with</span> <span m="1342240">these</span> <span m="1342620">bits,</span> <span m="1343050">OK.</span> <span m="1343350">So</span> <span m="1343470">that's</span> <span m="1343590">very,</span> <span m="1343930">very</span> <span m="1344060">nuts,</span> <span m="1344660">right.</span> <span m="1344860">Because</span> <span m="1345010">you</span> <span m="1345056">don;t</span> <span m="1345103">have</span> <span m="1345150">to</span> <span m="1345240">worry</span> <span m="1345430">about</span> <span m="1345610">this</span> <span m="1345870">compiler</span> <span m="1346100">support</span> <span m="1346295">issue</span> <span m="1346490">we</span> <span m="1346590">had</span> <span m="1346750">over</span> <span m="1346920">here.</span> </p>
<p><span m="1348210">The</span> <span m="1348310">other</span> <span m="1348380">nice</span> <span m="1348640">thing</span> <span m="1348850">is</span> <span m="1348950">that,</span> <span m="1349140">as</span> <span m="1349300">I</span> <span m="1349370">mentioned</span> <span m="1350250">in</span> <span m="1350360">the</span> <span m="1350430">last</span> <span m="1350720">lecture,</span> <span m="1351500">the</span> <span m="1351670">hardware's</span> <span m="1352210">always</span> <span m="1352560">watching</span> <span m="1352850">you,</span> <span m="1353140">even</span> <span m="1353380">though</span> <span m="1353450">the</span> <span m="1353600">OS</span> <span m="1353900">is</span> <span m="1354030">not,</span> <span m="1354860">right.</span> <span m="1355320">So</span> <span m="1355800">these</span> <span m="1356100">bits</span> <span m="1356390">being</span> <span m="1356600">said</span> <span m="1356810">over</span> <span m="1357020">here,</span> <span m="1357520">you</span> <span m="1357600">know</span> <span m="1357730">they're</span> <span m="1358330">looked</span> <span m="1358370">at</span> <span m="1359290">and</span> <span m="1359480">verified</span> <span m="1360060">for</span> <span m="1360250">correctness</span> <span m="1360700">at</span> <span m="1361020">every</span> <span m="1361430">memory</span> <span m="1362220">reference</span> <span m="1362415">that</span> <span m="1362610">you</span> <span m="1362740">make</span> <span m="1362870">by</span> <span m="1362983">the</span> <span m="1363096">code.</span> <span m="1363850">That's</span> <span m="1364050">a</span> <span m="1364090">very</span> <span m="1364410">nice</span> <span m="1365070">aspect</span> <span m="1365510">of</span> <span m="1365580">this</span> <span m="1365740">too.</span> </p>
<p><span m="1366930">Now</span> <span m="1367830">one</span> <span m="1368110">disadvantage</span> <span m="1368870">of</span> <span m="1368950">this</span> <span m="1369050">system</span> <span m="1369460">though,</span> <span m="1369720">is</span> <span m="1369810">that</span> <span m="1369920">it</span> <span m="1370030">makes</span> <span m="1370320">it</span> <span m="1370440">harder</span> <span m="1371310">for</span> <span m="1371610">an</span> <span m="1371690">application</span> <span m="1372260">to</span> <span m="1372330">dynamically</span> <span m="1372870">generate</span> <span m="1373270">code,</span> <span m="1375010">in</span> <span m="1375180">benign</span> <span m="1375730">or</span> <span m="1375790">benevolent</span> <span m="1376250">cases.</span> <span m="1376990">And</span> <span m="1377150">the</span> <span m="1377220">best</span> <span m="1377470">example</span> <span m="1377890">of</span> <span m="1377970">that</span> <span m="1378340">is,</span> <span m="1378890">the</span> <span m="1379010">just-in-time</span> <span m="1379880">compilers</span> <span m="1380480">that</span> <span m="1380580">we</span> <span m="1380680">discussed</span> <span m="1381180">from</span> <span m="1381345">last</span> <span m="1381510">lecture,</span> <span m="1382150">right.</span> </p>
<p><span m="1382480">So</span> <span m="1382660">how</span> <span m="1382910">is</span> <span m="1382960">it</span> <span m="1383010">that</span> <span m="1383220">you</span> <span m="1383310">can</span> <span m="1383470">go</span> <span m="1383710">to</span> <span m="1383820">a</span> <span m="1383930">web</span> <span m="1384150">page</span> <span m="1384430">and</span> <span m="1384470">your</span> <span m="1384560">JavaScript</span> <span m="1385000">code</span> <span m="1385180">executes</span> <span m="1385560">fast.</span> <span m="1386100">It</span> <span m="1386250">downloads</span> <span m="1386610">that</span> <span m="1386710">JavaScript</span> <span m="1387280">source,</span> <span m="1387650">it</span> <span m="1387880">initially</span> <span m="1388450">probably</span> <span m="1388790">starts</span> <span m="1389110">just</span> <span m="1389330">interpreting</span> <span m="1389950">it,</span> <span m="1390280">but</span> <span m="1390480">then</span> <span m="1390535">at</span> <span m="1390590">some</span> <span m="1390820">point</span> <span m="1391020">it's</span> <span m="1391110">going</span> <span m="1391200">to</span> <span m="1391240">find</span> <span m="1391590">some</span> <span m="1391730">hot</span> <span m="1392030">path,</span> <span m="1392380">some</span> <span m="1392820">hot</span> <span m="1392950">loop</span> <span m="1393080">and</span> <span m="1393340">then</span> <span m="1393480">it's</span> <span m="1393620">going</span> <span m="1393710">to</span> <span m="1393780">dynamically</span> <span m="1394350">generate</span> <span m="1394790">x86</span> <span m="1395390">machine</span> <span m="1395780">code</span> <span m="1396005">and</span> <span m="1396230">execute</span> <span m="1396650">that</span> <span m="1396810">directly,</span> <span m="1397750">right.</span> <span m="1398080">But</span> <span m="1398230">to</span> <span m="1398300">get</span> <span m="1398440">that</span> <span m="1398600">to</span> <span m="1398680">work</span> <span m="1398855">you</span> <span m="1399030">have</span> <span m="1399240">to</span> <span m="1399320">be</span> <span m="1399430">able</span> <span m="1399590">to</span> <span m="1399670">dynamically</span> <span m="1400230">write</span> <span m="1400550">code</span> <span m="1401650">to</span> <span m="1401870">a</span> <span m="1401930">page.</span> </p>
<p><span m="1403400">So</span> <span m="1404270">there's</span> <span m="1404450">some</span> <span m="1404630">ways</span> <span m="1404750">you</span> <span m="1404800">can</span> <span m="1404850">get</span> <span m="1405060">around</span> <span m="1405340">this</span> <span m="1405500">for</span> <span m="1405690">example,</span> <span m="1405990">you</span> <span m="1406070">could</span> <span m="1406180">imagine</span> <span m="1406580">that</span> <span m="1406990">the</span> <span m="1407210">just-in-time</span> <span m="1407730">compiler</span> <span m="1408190">initially</span> <span m="1408620">sets</span> <span m="1409230">the</span> <span m="1409370">write</span> <span m="1409650">bit</span> <span m="1410090">and</span> <span m="1410220">then</span> <span m="1410330">it</span> <span m="1410420">removes</span> <span m="1410860">the</span> <span m="1410960">write</span> <span m="1411220">bit,</span> <span m="1411580">then</span> <span m="1411700">it</span> <span m="1411820">sets</span> <span m="1412080">the</span> <span m="1412160">execute</span> <span m="1412660">bits.</span> <span m="1412950">There</span> <span m="1412995">are</span> <span m="1413040">some</span> <span m="1413190">ways</span> <span m="1413450">that</span> <span m="1413500">you</span> <span m="1413550">can</span> <span m="1413700">get</span> <span m="1413830">around</span> <span m="1414240">that,</span> <span m="1414770">but</span> <span m="1414890">it</span> <span m="1414960">can</span> <span m="1415070">be</span> <span m="1415170">a</span> <span m="1415220">little</span> <span m="1415360">bit</span> <span m="1415500">tricky</span> <span m="1415740">sometimes.</span> <span m="1416550">On</span> <span m="1416632">a</span> <span m="1416715">higher</span> <span m="1416797">level,</span> <span m="1417320">that's</span> <span m="1417540">how</span> <span m="1417675">non-executable</span> <span m="1418550">memory</span> <span m="1418800">works,</span> <span m="1419330">pretty</span> <span m="1419750">easy</span> <span m="1419910">to</span> <span m="1420010">understand.</span> </p>
<p><span m="1420310">AUDIENCE:</span> <span m="1421272">What</span> <span m="1421753">is</span> <span m="1421993">the</span> <span m="1422234">definition</span> <span m="1422394">of</span> <span m="1422554">like</span> <span m="1422715">executable</span> <span m="1424158">instructions?</span> <span m="1425120">So</span> <span m="1425216">if</span> <span m="1425312">you</span> <span m="1425408">change</span> <span m="1425504">the</span> <span m="1425601">attenuator</span> <span m="1426082">[INAUDIBLE]</span> <span m="1426563">it's</span> <span m="1426683">not</span> <span m="1426803">considered</span> <span m="1426923">a</span> <span m="1427044">executable</span> <span m="1427284">instruction.</span> </p>
<p><span m="1427525">PROFESSOR:</span> <span m="1428010">Well</span> <span m="1428320">basically</span> <span m="1428575">no.</span> <span m="1429410">Can</span> <span m="1429680">you</span> <span m="1429810">set</span> <span m="1429940">like</span> <span m="1430150">the</span> <span m="1430360">instruction</span> <span m="1430640">pointer</span> <span m="1430920">register</span> <span m="1431550">to</span> <span m="1431910">that</span> <span m="1432150">value.</span> <span m="1433220">In</span> <span m="1433270">other</span> <span m="1433340">words,</span> <span m="1433780">can</span> <span m="1434020">you--</span> <span m="1434340">if</span> <span m="1434660">you</span> <span m="1434770">have</span> <span m="1434960">a</span> <span m="1435010">bunch</span> <span m="1435200">of</span> <span m="1435270">memory</span> <span m="1435570">pages,</span> <span m="1436240">can</span> <span m="1436325">you</span> <span m="1436410">actually</span> <span m="1436700">set</span> <span m="1436890">EIP</span> <span m="1437420">there</span> <span m="1437780">and</span> <span m="1437900">actually</span> <span m="1438290">start</span> <span m="1438580">executing</span> <span m="1439030">code</span> <span m="1439290">from</span> <span m="1439440">that</span> <span m="1439630">page.</span> </p>
<p><span m="1440020">AUDIENCE: Ah.</span> </p>
<p><span m="1443520">PROFESSOR:</span> <span m="1444020">OK,</span> <span m="1444480">so</span> <span m="1444880">that</span> <span m="1445220">is</span> <span m="1445450">nonexecutable</span> <span m="1446120">memory.</span> </p>
<p><span m="1447480">And</span> <span m="1447800">so</span> <span m="1448640">another</span> <span m="1449060">technique</span> <span m="1449460">you</span> <span m="1449540">might</span> <span m="1449710">imagine</span> <span m="1450570">for</span> <span m="1450730">protecting</span> <span m="1451130">against</span> <span m="1451480">a</span> <span m="1451580">buffer</span> <span m="1451890">overflows</span> <span m="1452990">is</span> <span m="1453900">using</span> <span m="1455110">a</span> <span m="1455360">randomized</span> <span m="1457920">addresses</span> <span m="1459050">or</span> <span m="1459190">address</span> <span m="1459500">spaces.</span> <span m="1466410">And</span> <span m="1466670">so</span> <span m="1466970">the</span> <span m="1467830">observation</span> <span m="1468540">here</span> <span m="1469240">is,</span> <span m="1469480">that</span> <span m="1469830">a</span> <span m="1469900">lot</span> <span m="1470270">of</span> <span m="1470380">the</span> <span m="1470540">attacks</span> <span m="1471770">that</span> <span m="1471880">we've</span> <span m="1472030">discussed</span> <span m="1472480">so</span> <span m="1472650">far</span> <span m="1475080">use</span> <span m="1475320">hard</span> <span m="1475670">coded</span> <span m="1475990">addresses,</span> <span m="1479200">right.</span> </p>
<p><span m="1479590">And</span> <span m="1479730">so</span> <span m="1479870">if</span> <span m="1480050">you</span> <span m="1480190">think</span> <span m="1480430">about</span> <span m="1481280">a</span> <span m="1481390">lot</span> <span m="1481620">of</span> <span m="1481660">the</span> <span m="1481750">attacks</span> <span m="1482140">you've</span> <span m="1482250">been</span> <span m="1482360">working</span> <span m="1482660">on</span> <span m="1482760">in</span> <span m="1482860">your</span> <span m="1483010">lab,</span> <span m="1483690">how</span> <span m="1483840">does</span> <span m="1483960">that</span> <span m="1484150">work?</span> <span m="1484610">You</span> <span m="1484990">open</span> <span m="1485045">up</span> <span m="1485100">the</span> <span m="1485200">program</span> <span m="1485445">in</span> <span m="1485690">GDB,</span> <span m="1486470">you</span> <span m="1486640">find</span> <span m="1487000">out</span> <span m="1487140">the</span> <span m="1487220">location</span> <span m="1487720">of</span> <span m="1487810">some</span> <span m="1487980">things,</span> <span m="1488480">you</span> <span m="1488600">may</span> <span m="1488720">create</span> <span m="1489150">some</span> <span m="1489250">shell</span> <span m="1489590">code</span> <span m="1489840">that</span> <span m="1489930">actually</span> <span m="1490270">has</span> <span m="1490490">some</span> <span m="1490620">hard</span> <span m="1490920">coded</span> <span m="1491550">addresses</span> <span m="1492130">in</span> <span m="1492380">there,</span> <span m="1492830">right.</span> </p>
<p><span m="1493200">So</span> <span m="1493440">the</span> <span m="1493560">idea</span> <span m="1493860">behind</span> <span m="1494160">the</span> <span m="1494230">randomized</span> <span m="1494660">address</span> <span m="1494950">base</span> <span m="1495390">is</span> <span m="1495550">simple.</span> <span m="1495890">Basically</span> <span m="1496160">you</span> <span m="1496430">want</span> <span m="1496590">to</span> <span m="1497150">make</span> <span m="1497390">it</span> <span m="1497510">difficult</span> <span m="1500280">for</span> <span m="1500920">the</span> <span m="1501150">attacker</span> <span m="1503160">to</span> <span m="1503580">guess</span> <span m="1503850">addresses.</span> <span m="1508320">So</span> <span m="1508460">there's</span> <span m="1508620">a</span> <span m="1508680">couple</span> <span m="1508940">different</span> <span m="1509190">ways</span> <span m="1509500">you</span> <span m="1509600">could</span> <span m="1509710">think</span> <span m="1509890">about</span> <span m="1510120">doing</span> <span m="1510390">this,</span> <span m="1510930">right.</span> <span m="1511230">So</span> <span m="1511750">one</span> <span m="1511990">idea</span> <span m="1512320">is</span> <span m="1512355">that</span> <span m="1512390">you</span> <span m="1512520">can</span> <span m="1512670">imagine</span> <span m="1513260">having</span> <span m="1513530">stack</span> <span m="1513940">randomization,</span> <span m="1515000">right.</span> </p>
<p><span m="1515260">So</span> <span m="1515400">imagine</span> <span m="1515860">that</span> <span m="1516590">from</span> <span m="1516850">here</span> <span m="1517170">to</span> <span m="1517230">here,</span> <span m="1517850">this</span> <span m="1518070">is</span> <span m="1518190">the</span> <span m="1518320">entire</span> <span m="1518750">virtual</span> <span m="1519050">memory</span> <span m="1519290">space</span> <span m="1519570">of</span> <span m="1519635">the</span> <span m="1519700">program,</span> <span m="1520370">right.</span> <span m="1520630">As</span> <span m="1520810">we</span> <span m="1520910">described</span> <span m="1521420">this</span> <span m="1521640">stuff</span> <span m="1521790">to</span> <span m="1521940">you</span> <span m="1522090">so</span> <span m="1522210">far,</span> <span m="1522870">basically</span> <span m="1523320">the</span> <span m="1523440">stack</span> <span m="1523890">always</span> <span m="1524380">starts</span> <span m="1524690">with</span> <span m="1524750">this</span> <span m="1524870">particular</span> <span m="1525300">place</span> <span m="1525590">up</span> <span m="1525775">here,</span> <span m="1525960">always</span> <span m="1526310">goes</span> <span m="1526540">down,</span> <span m="1527270">right,</span> <span m="1527670">and</span> <span m="1527830">the</span> <span m="1527920">program</span> <span m="1528300">codes</span> <span m="1528610">down</span> <span m="1528850">here</span> <span m="1529350">and</span> <span m="1529540">the</span> <span m="1529730">heap</span> <span m="1529920">always</span> <span m="1530360">goes</span> <span m="1530600">up</span> <span m="1530760">here.</span> <span m="1531470">And</span> <span m="1531850">all</span> <span m="1532190">these</span> <span m="1532420">seg--</span> <span m="1532740">all</span> <span m="1532990">of</span> <span m="1533080">these</span> <span m="1533260">segments,</span> <span m="1533890">the</span> <span m="1533970">stack,</span> <span m="1534650">the</span> <span m="1534740">heap,</span> <span m="1535030">and</span> <span m="1535320">the</span> <span m="1535460">program</span> <span m="1535790">code,</span> <span m="1536030">they</span> <span m="1536100">all</span> <span m="1536230">start</span> <span m="1536690">at</span> <span m="1536770">a</span> <span m="1536830">well</span> <span m="1537080">known</span> <span m="1537230">location.</span> </p>
<p><span m="1538350">So</span> <span m="1538620">imagine</span> <span m="1539030">for</span> <span m="1539140">example,</span> <span m="1539480">like</span> <span m="1539650">if</span> <span m="1539750">my</span> <span m="1539870">lecture</span> <span m="1540170">notes</span> <span m="1540430">here</span> <span m="1540950">are</span> <span m="1541330">the</span> <span m="1541430">stack.</span> <span m="1541880">You</span> <span m="1541981">can</span> <span m="1542083">imagine</span> <span m="1542490">instead</span> <span m="1542670">of</span> <span m="1542730">the</span> <span m="1542810">stack</span> <span m="1543180">always</span> <span m="1543510">starting</span> <span m="1543880">here</span> <span m="1544070">at</span> <span m="1544165">this</span> <span m="1544260">known</span> <span m="1544320">location,</span> <span m="1545080">maybe</span> <span m="1545210">you</span> <span m="1545340">start</span> <span m="1545525">it</span> <span m="1545710">here,</span> <span m="1546780">maybe</span> <span m="1546990">you</span> <span m="1547100">start</span> <span m="1547210">it</span> <span m="1547320">here.</span> <span m="1548020">Somewhere</span> <span m="1548340">else</span> <span m="1548520">like</span> <span m="1548700">that,</span> <span m="1548930">right.</span> <span m="1549280">Similarly</span> <span m="1549490">you</span> <span m="1549710">can</span> <span m="1549820">imagine</span> <span m="1550230">that</span> <span m="1550580">maybe</span> <span m="1550790">the</span> <span m="1550880">program</span> <span m="1551290">code</span> <span m="1551740">which</span> <span m="1551900">used</span> <span m="1552090">to</span> <span m="1552160">always</span> <span m="1552490">start</span> <span m="1552750">down</span> <span m="1552980">here,</span> <span m="1553480">maybe</span> <span m="1553620">we</span> <span m="1553760">start</span> <span m="1553930">it</span> <span m="1554100">up</span> <span m="1554250">here,</span> <span m="1554530">or</span> <span m="1554730">down</span> <span m="1555020">here,</span> <span m="1555280">or</span> <span m="1555350">something</span> <span m="1555600">like</span> <span m="1555820">that,</span> <span m="1556300">right.</span> </p>
<p><span m="1556710">So</span> <span m="1556820">the</span> <span m="1556880">idea</span> <span m="1557260">now</span> <span m="1557480">is</span> <span m="1557550">that</span> <span m="1557640">if</span> <span m="1557750">you,</span> <span m="1557940">the</span> <span m="1558080">attacker,</span> <span m="1558490">control</span> <span m="1559000">one</span> <span m="1559140">of</span> <span m="1559190">these</span> <span m="1559370">binary's,</span> <span m="1560260">you</span> <span m="1560390">can</span> <span m="1560510">look</span> <span m="1560710">in</span> <span m="1560820">GDB</span> <span m="1561075">and</span> <span m="1561330">figure</span> <span m="1561560">out</span> <span m="1561660">where</span> <span m="1561770">all</span> <span m="1561930">these</span> <span m="1562100">offsets</span> <span m="1562560">are,</span> <span m="1563360">but</span> <span m="1563480">they're</span> <span m="1563560">not</span> <span m="1563780">actually</span> <span m="1564000">going</span> <span m="1564080">to</span> <span m="1564150">help</span> <span m="1564420">you</span> <span m="1564530">figure</span> <span m="1564770">out</span> <span m="1564880">where</span> <span m="1565000">those</span> <span m="1565160">offsets</span> <span m="1565690">are</span> <span m="1566150">in</span> <span m="1566270">the</span> <span m="1566430">real</span> <span m="1566710">code</span> <span m="1567020">that's</span> <span m="1567190">running</span> <span m="1567430">on</span> <span m="1567550">the</span> <span m="1567620">server,</span> <span m="1568770">right.</span> <span m="1569190">So</span> <span m="1569340">that's</span> <span m="1569490">the</span> <span m="1569580">basic</span> <span m="1569920">idea</span> <span m="1570300">behind</span> <span m="1570700">these</span> <span m="1571160">randomized</span> <span m="1571670">address</span> <span m="1571920">spaces</span> <span m="1572320">there.</span> </p>
<p><span m="1573510">And</span> <span m="1573710">so</span> <span m="1574150">this</span> <span m="1574310">takes</span> <span m="1574530">advantage</span> <span m="1574880">of</span> <span m="1574930">the</span> <span m="1575010">fact</span> <span m="1575320">that</span> <span m="1575460">a</span> <span m="1575540">lot</span> <span m="1575900">of</span> <span m="1575935">the</span> <span m="1575970">code</span> <span m="1576260">that</span> <span m="1576360">you</span> <span m="1576440">generate,</span> <span m="1577020">doesn't</span> <span m="1577390">have</span> <span m="1577630">to</span> <span m="1577720">be</span> <span m="1577870">loaded</span> <span m="1578500">into</span> <span m="1578720">a</span> <span m="1578770">specific</span> <span m="1579300">place</span> <span m="1579570">in</span> <span m="1579660">memory,</span> <span m="1579950">right.</span> <span m="1580240">So</span> <span m="1580670">unless</span> <span m="1580900">you're</span> <span m="1581010">writing</span> <span m="1581200">like</span> <span m="1581420">a</span> <span m="1581470">device</span> <span m="1581860">driver,</span> <span m="1582230">or</span> <span m="1582320">something</span> <span m="1582570">like,</span> <span m="1582790">that</span> <span m="1583130">maybe</span> <span m="1583670">is</span> <span m="1583830">interacting</span> <span m="1584340">with</span> <span m="1584450">some</span> <span m="1584600">hardware</span> <span m="1585220">that</span> <span m="1585350">requires</span> <span m="1586320">this</span> <span m="1586580">particular</span> <span m="1587070">address</span> <span m="1587400">to</span> <span m="1587480">be</span> <span m="1589670">belong</span> <span m="1589825">in</span> <span m="1589980">this</span> <span m="1590150">particular</span> <span m="1590580">buffer</span> <span m="1590910">so</span> <span m="1591006">it</span> <span m="1591103">can</span> <span m="1591200">copy</span> <span m="1591480">information</span> <span m="1591980">in.</span> <span m="1592370">If</span> <span m="1592540">you're</span> <span m="1592650">not</span> <span m="1593040">doing</span> <span m="1593280">stuff</span> <span m="1593570">like</span> <span m="1593780">that</span> <span m="1594330">then</span> <span m="1594340">typically</span> <span m="1594660">your</span> <span m="1594770">codes</span> <span m="1595010">going</span> <span m="1595045">to</span> <span m="1595080">be</span> <span m="1595200">relocatable.</span> <span m="1596020">So</span> <span m="1596130">this</span> <span m="1596260">approach</span> <span m="1596550">will</span> <span m="1596630">work</span> <span m="1596820">very</span> <span m="1597000">nicely</span> <span m="1597360">with</span> <span m="1597580">that</span> <span m="1597800">kind</span> <span m="1598020">of</span> <span m="1598240">stuff.</span> </p>
<p><span m="1600000">So</span> <span m="1600590">once</span> <span m="1600840">again</span> <span m="1601140">the</span> <span m="1601220">question</span> <span m="1601590">is,</span> <span m="1601750">can</span> <span m="1602080">you</span> <span m="1602640">exploit</span> <span m="1603170">this?</span> <span m="1603740">Obviously</span> <span m="1604250">the</span> <span m="1604330">answer</span> <span m="1604560">is</span> <span m="1604790">still</span> <span m="1605060">yes.</span> <span m="1605730">There's</span> <span m="1605940">a</span> <span m="1606000">couple</span> <span m="1606240">different</span> <span m="1606440">ways</span> <span m="1606590">you</span> <span m="1606760">can</span> <span m="1606850">do</span> <span m="1606940">it</span> <span m="1607070">as</span> <span m="1607250">we'll</span> <span m="1607380">discuss</span> <span m="1608280">later</span> <span m="1608660">today</span> <span m="1609140">in</span> <span m="1609360">the</span> <span m="1609470">[INAUDIBLE]</span> <span m="1609810">paper,</span> <span m="1610460">the</span> <span m="1610570">attacker</span> <span m="1611010">can</span> <span m="1611170">actually</span> <span m="1611610">extract</span> <span m="1612330">randomness,</span> <span m="1613650">right.</span> <span m="1614100">And</span> <span m="1614220">so</span> <span m="1614350">in</span> <span m="1614420">general</span> <span m="1614730">that's</span> <span m="1614990">how</span> <span m="1615070">you</span> <span m="1615270">defeat</span> <span m="1615420">all</span> <span m="1615570">these</span> <span m="1615710">randomized</span> <span m="1616230">approaches.</span> <span m="1616850">You</span> <span m="1616970">make</span> <span m="1617160">them</span> <span m="1617310">unrandom,</span> <span m="1618010">by</span> <span m="1618160">either</span> <span m="1618410">finding</span> <span m="1618790">out</span> <span m="1618900">the</span> <span m="1618990">random</span> <span m="1619270">seed</span> <span m="1619560">that</span> <span m="1619620">the</span> <span m="1619750">attacker</span> <span m="1620050">was</span> <span m="1620260">doing,</span> <span m="1620690">or</span> <span m="1620920">by</span> <span m="1621040">somehow</span> <span m="1621390">leveraging</span> <span m="1622040">the</span> <span m="1622130">fact</span> <span m="1622500">that</span> <span m="1622560">the</span> <span m="1622680">attacker</span> <span m="1623240">leaks</span> <span m="1623740">information</span> <span m="1624650">about</span> <span m="1624940">the</span> <span m="1625090">randomized</span> <span m="1625730">locations</span> <span m="1626310">of</span> <span m="1626460">these</span> <span m="1626680">things.</span> </p>
<p><span m="1631030">And</span> <span m="1631160">another</span> <span m="1631450">thing</span> <span m="1631570">that's</span> <span m="1631670">interesting</span> <span m="1632020">is</span> <span m="1632130">that</span> <span m="1632440">for</span> <span m="1633210">a</span> <span m="1633260">lot</span> <span m="1633430">of</span> <span m="1633470">the</span> <span m="1633580">attacks</span> <span m="1633795">we've</span> <span m="1634010">discussed</span> <span m="1634440">so</span> <span m="1634600">far,</span> <span m="1635250">we've</span> <span m="1635460">basically</span> <span m="1635860">been</span> <span m="1636100">using</span> <span m="1636340">these</span> <span m="1636540">sort</span> <span m="1636700">of</span> <span m="1636780">hard</span> <span m="1636920">coded</span> <span m="1637340">addresses,</span> <span m="1638060">but</span> <span m="1638330">note</span> <span m="1638650">that</span> <span m="1638810">the</span> <span m="1638940">attacker</span> <span m="1639900">may</span> <span m="1640310">not</span> <span m="1640580">necessarily</span> <span m="1641300">care</span> <span m="1641700">about</span> <span m="1641950">jumping</span> <span m="1642310">to</span> <span m="1642395">a</span> <span m="1642480">specific</span> <span m="1642980">address.</span> <span m="1643740">Or</span> <span m="1643840">there's</span> <span m="1644040">this</span> <span m="1644220">attack</span> <span m="1644280">called</span> <span m="1644700">a</span> <span m="1645120">heap</span> <span m="1645440">attack,</span> <span m="1646010">which</span> <span m="1646160">is</span> <span m="1646240">actually</span> <span m="1646540">pretty</span> <span m="1646770">hilarious</span> <span m="1648000">if</span> <span m="1648130">you're</span> <span m="1648260">a</span> <span m="1648290">bad</span> <span m="1648520">person,</span> <span m="1648840">I</span> <span m="1648910">suppose.</span> </p>
<p><span m="1649260">So</span> <span m="1649933">the</span> <span m="1650316">way</span> <span m="1650508">that</span> <span m="1650700">this</span> <span m="1651050">heap</span> <span m="1651210">attack</span> <span m="1651590">works</span> <span m="1652050">is,</span> <span m="1652250">that</span> <span m="1652510">the</span> <span m="1652770">attacker</span> <span m="1653330">essentially</span> <span m="1654160">just</span> <span m="1654370">starts</span> <span m="1654640">dynamically</span> <span m="1655310">allocating</span> <span m="1655725">a</span> <span m="1656140">ton</span> <span m="1656340">of</span> <span m="1656540">shell</span> <span m="1656910">code</span> <span m="1657280">and</span> <span m="1657600">just</span> <span m="1657770">stuffs</span> <span m="1658150">it</span> <span m="1658400">randomly</span> <span m="1658870">in</span> <span m="1659170">memory,</span> <span m="1659560">right.</span> <span m="1659750">This</span> <span m="1659910">is</span> <span m="1660000">particularly</span> <span m="1660420">effective</span> <span m="1660675">if</span> <span m="1660930">you're</span> <span m="1661007">using</span> <span m="1661085">like</span> <span m="1661162">a</span> <span m="1661310">dynamically</span> <span m="1663100">high</span> <span m="1663780">level</span> <span m="1664000">language</span> <span m="1664250">like</span> <span m="1664380">JavaScript</span> <span m="1664870">let's</span> <span m="1665060">say.</span> </p>
<p><span m="1665490">So</span> <span m="1665660">the</span> <span m="1665780">tag</span> <span m="1666150">reader</span> <span m="1666410">is</span> <span m="1666510">sitting</span> <span m="1666540">in</span> <span m="1666555">a</span> <span m="1666570">tight</span> <span m="1666740">loop</span> <span m="1666910">and</span> <span m="1667250">just</span> <span m="1667460">generate</span> <span m="1667800">a</span> <span m="1667850">bunch</span> <span m="1668100">of</span> <span m="1668160">shell</span> <span m="1668430">code</span> <span m="1668750">strings,</span> <span m="1668810">right.</span> <span m="1668870">And</span> <span m="1669360">you</span> <span m="1669520">just</span> <span m="1669830">fill</span> <span m="1670180">the</span> <span m="1670260">heap</span> <span m="1670670">with</span> <span m="1670960">all</span> <span m="1671280">these</span> <span m="1671440">shell</span> <span m="1671595">code</span> <span m="1671750">strings,</span> <span m="1672680">right.</span> <span m="1673140">Now</span> <span m="1673330">the</span> <span m="1673430">attacker</span> <span m="1673880">maybe</span> <span m="1674170">cannot</span> <span m="1674560">figure</span> <span m="1674860">out</span> <span m="1675150">where</span> <span m="1675290">the</span> <span m="1675400">exact</span> <span m="1675820">location</span> <span m="1676275">is</span> <span m="1676730">of</span> <span m="1676850">each</span> <span m="1677010">of</span> <span m="1677060">the</span> <span m="1677190">shell</span> <span m="1677510">code</span> <span m="1677717">strings,</span> <span m="1678340">but</span> <span m="1678530">if</span> <span m="1678650">you've</span> <span m="1678820">allocated</span> <span m="1679800">10s</span> <span m="1680420">of</span> <span m="1680510">megabytes</span> <span m="1681120">of</span> <span m="1681210">shell</span> <span m="1681520">code</span> <span m="1681662">strings</span> <span m="1682330">and</span> <span m="1682450">then</span> <span m="1682630">just</span> <span m="1682800">do</span> <span m="1682960">a</span> <span m="1683070">random</span> <span m="1683420">jump,</span> <span m="1683940">right.</span> </p>
<p><span m="1684160">If</span> <span m="1684240">you</span> <span m="1684330">could</span> <span m="1684460">somehow</span> <span m="1684780">control</span> <span m="1685360">one</span> <span m="1685500">of</span> <span m="1685580">these</span> <span m="1685800">ret</span> <span m="1686030">pointers,</span> <span m="1686800">then</span> <span m="1687140">hey,</span> <span m="1687410">maybe</span> <span m="1687710">you'll</span> <span m="1687900">land</span> <span m="1688090">in</span> <span m="1688200">shell</span> <span m="1688490">code,</span> <span m="1689140">right.</span> <span m="1690010">And</span> <span m="1690210">one</span> <span m="1690420">trick</span> <span m="1690630">you</span> <span m="1690730">can</span> <span m="1690850">actually</span> <span m="1691200">use</span> <span m="1691330">is</span> <span m="1691460">this</span> <span m="1691670">thing</span> <span m="1691850">called</span> <span m="1692080">NOP</span> <span m="1692175">sleds,</span> <span m="1692605">which</span> <span m="1692940">is</span> <span m="1693060">also</span> <span m="1693330">pretty</span> <span m="1693550">hilarious.</span> <span m="1694200">So</span> <span m="1694410">imagine</span> <span m="1694840">that</span> <span m="1694905">if</span> <span m="1694970">you</span> <span m="1695100">have</span> <span m="1696120">a</span> <span m="1696200">shell</span> <span m="1696550">code</span> <span m="1696890">string,</span> <span m="1698050">then</span> <span m="1698590">it</span> <span m="1698720">may</span> <span m="1699070">not</span> <span m="1699185">work</span> <span m="1699300">out</span> <span m="1699490">if</span> <span m="1699560">you</span> <span m="1699625">jump</span> <span m="1699800">to</span> <span m="1699945">a</span> <span m="1700090">random</span> <span m="1700480">place</span> <span m="1700640">in</span> <span m="1700800">that</span> <span m="1700980">shell</span> <span m="1701210">code</span> <span m="1701500">string,</span> <span m="1701990">because</span> <span m="1702250">it</span> <span m="1702380">may</span> <span m="1702520">not</span> <span m="1702720">set</span> <span m="1702880">the</span> <span m="1702970">attack</span> <span m="1703290">up</span> <span m="1703420">correctly.</span> </p>
<p><span m="1704330">But</span> <span m="1704410">maybe</span> <span m="1705200">this</span> <span m="1705400">stuff</span> <span m="1705690">that</span> <span m="1705780">your</span> <span m="1705910">spewing</span> <span m="1706370">to</span> <span m="1706470">the</span> <span m="1706600">heap,</span> <span m="1707250">is</span> <span m="1707420">basically</span> <span m="1707910">just</span> <span m="1708160">a</span> <span m="1708290">ton</span> <span m="1708670">of</span> <span m="1708810">NOPs</span> <span m="1709190">and</span> <span m="1709570">then</span> <span m="1709740">at</span> <span m="1709890">the</span> <span m="1709980">very,</span> <span m="1710430">very</span> <span m="1710800">end</span> <span m="1710876">you</span> <span m="1710952">have</span> <span m="1711028">the</span> <span m="1711104">shell</span> <span m="1711180">code,</span> <span m="1711920">right.</span> <span m="1712240">This</span> <span m="1712390">is</span> <span m="1712500">actually</span> <span m="1712780">quite</span> <span m="1713040">clever</span> <span m="1713720">right,</span> <span m="1713910">because</span> <span m="1714050">this</span> <span m="1714220">means</span> <span m="1714940">that</span> <span m="1715080">now</span> <span m="1715460">you</span> <span m="1715630">can</span> <span m="1715760">actually</span> <span m="1716100">goof</span> <span m="1716340">up</span> <span m="1716690">the</span> <span m="1716820">exact</span> <span m="1717240">place</span> <span m="1717490">where</span> <span m="1717650">you</span> <span m="1717770">jump.</span> <span m="1718510">If</span> <span m="1718640">you</span> <span m="1718750">jump</span> <span m="1719010">into</span> <span m="1719130">another</span> <span m="1719190">one</span> <span m="1719250">of</span> <span m="1719370">these</span> <span m="1719560">NOP</span> <span m="1719890">things</span> <span m="1720010">just</span> <span m="1720180">go</span> <span m="1720320">boom,</span> <span m="1720471">boom,</span> <span m="1720623">boom,</span> <span m="1720775">boom,</span> <span m="1720888">boom,</span> <span m="1721002">boom,</span> <span m="1721116">boom,</span> <span m="1721685">then</span> <span m="1721836">you</span> <span m="1721988">hit</span> <span m="1722140">the</span> <span m="1722620">shell</span> <span m="1722780">code,</span> <span m="1723570">right.</span> </p>
<p><span m="1723920">So</span> <span m="1724100">it's</span> <span m="1724210">like</span> <span m="1724440">these</span> <span m="1724720">are</span> <span m="1724760">the</span> <span m="1724890">people</span> <span m="1725430">that</span> <span m="1725640">you</span> <span m="1725780">probably</span> <span m="1726110">see</span> <span m="1726400">on</span> <span m="1726510">the</span> <span m="1726610">team.</span> <span m="1727090">They're</span> <span m="1727300">inventing</span> <span m="1727590">these</span> <span m="1727750">types</span> <span m="1727980">of</span> <span m="1728090">things,</span> <span m="1728350">right.</span> <span m="1728530">This</span> <span m="1728690">is</span> <span m="1728820">a</span> <span m="1728880">problem.</span> <span m="1729980">So</span> <span m="1730350">that's</span> <span m="1730590">another</span> <span m="1730840">way</span> <span m="1730980">to</span> <span m="1731040">get</span> <span m="1731200">around</span> <span m="1731790">some</span> <span m="1732010">of</span> <span m="1732070">this</span> <span m="1732230">randomization</span> <span m="1732760">stuff,</span> <span m="1733170">just</span> <span m="1733330">by</span> <span m="1733440">making</span> <span m="1733840">your</span> <span m="1733990">codes</span> <span m="1734610">randomization</span> <span m="1735570">resilient,</span> <span m="1735850">if</span> <span m="1736180">that</span> <span m="1736370">makes</span> <span m="1736550">sense.</span> </p>
<p><span m="1738880">OK</span> <span m="1739350">so</span> <span m="1739590">that's</span> <span m="1740110">basically</span> <span m="1740470">a</span> <span m="1740830">discussion</span> <span m="1741420">of</span> <span m="1741456">some</span> <span m="1741493">of</span> <span m="1741530">the</span> <span m="1741610">types</span> <span m="1741850">of</span> <span m="1741980">randomness</span> <span m="1742300">you</span> <span m="1742440">can</span> <span m="1742620">use.</span> <span m="1743120">There's</span> <span m="1743310">also</span> <span m="1743555">some</span> <span m="1743800">wacky</span> <span m="1744165">ideas</span> <span m="1744347">that</span> <span m="1744530">people</span> <span m="1744780">have</span> <span m="1744883">had</span> <span m="1744986">too.</span> <span m="1745400">So</span> <span m="1745450">now</span> <span m="1745500">you</span> <span m="1745550">know</span> <span m="1745600">that</span> <span m="1746030">when</span> <span m="1746120">you</span> <span m="1746210">want</span> <span m="1746340">to</span> <span m="1746380">make</span> <span m="1746520">a</span> <span m="1746560">system</span> <span m="1746900">call</span> <span m="1747210">for</span> <span m="1747260">example,</span> <span m="1748020">you</span> <span m="1748170">use</span> <span m="1749720">this</span> <span m="1750040">syscall</span> <span m="1750590">libc</span> <span m="1750960">function</span> <span m="1751275">and</span> <span m="1751590">you</span> <span m="1751720">basically</span> <span m="1752080">pass</span> <span m="1752500">any</span> <span m="1752670">unique</span> <span m="1753030">number</span> <span m="1753280">that</span> <span m="1753390">represents</span> <span m="1753780">the</span> <span m="1753830">system</span> <span m="1754120">call</span> <span m="1754246">that</span> <span m="1754373">you</span> <span m="1754500">want</span> <span m="1754600">to</span> <span m="1754700">make,</span> <span m="1755260">right.</span> <span m="1755490">So</span> <span m="1755610">maybe</span> <span m="1756580">four</span> <span m="1757020">is</span> <span m="1757160">seven</span> <span m="1757690">and</span> <span m="1757800">maybe</span> <span m="1758100">sleep</span> <span m="1758470">is</span> <span m="1758610">eight,</span> <span m="1758880">or</span> <span m="1759015">something</span> <span m="1759150">like</span> <span m="1759370">that,</span> <span m="1759900">right.</span> </p>
<p><span m="1760950">So</span> <span m="1761170">what</span> <span m="1761310">that</span> <span m="1761480">means</span> <span m="1761750">is</span> <span m="1761850">that</span> <span m="1761990">if</span> <span m="1762170">the</span> <span m="1762340">attacker</span> <span m="1762770">can</span> <span m="1762900">somehow</span> <span m="1763280">figure</span> <span m="1763710">out</span> <span m="1764180">the</span> <span m="1764340">address</span> <span m="1764910">of</span> <span m="1765020">that</span> <span m="1765230">syscall</span> <span m="1765820">instruction</span> <span m="1766730">and</span> <span m="1766930">jump</span> <span m="1767085">to</span> <span m="1767240">it</span> <span m="1767390">somehow,</span> <span m="1768140">he</span> <span m="1768370">or</span> <span m="1768600">she</span> <span m="1768760">can</span> <span m="1768870">actually</span> <span m="1769070">just</span> <span m="1769190">supply</span> <span m="1769420">the</span> <span m="1769650">system</span> <span m="1770000">call</span> <span m="1770610">number</span> <span m="1771350">that</span> <span m="1771500">they</span> <span m="1771600">want</span> <span m="1771820">to</span> <span m="1771950">invoke</span> <span m="1772190">directly,</span> <span m="1772910">right.</span> <span m="1773060">So</span> <span m="1773125">you</span> <span m="1773190">could</span> <span m="1773290">imagine</span> <span m="1773780">that</span> <span m="1773880">each</span> <span m="1773980">time</span> <span m="1774100">the</span> <span m="1774180">program</span> <span m="1774600">runs,</span> <span m="1775180">you</span> <span m="1775290">actually</span> <span m="1775690">create</span> <span m="1776000">a</span> <span m="1776060">dynamic</span> <span m="1776690">assignment</span> <span m="1777640">of</span> <span m="1778000">syscall</span> <span m="1778520">numbers</span> <span m="1779290">to</span> <span m="1779810">actual</span> <span m="1780200">syscalls,</span> <span m="1780960">right.</span> <span m="1781140">To</span> <span m="1781190">make</span> <span m="1781340">it</span> <span m="1781430">harder</span> <span m="1781700">for</span> <span m="1781800">the</span> <span m="1781870">attacker</span> <span m="1782180">to</span> <span m="1782310">get</span> <span m="1782440">stuff.</span> </p>
<p><span m="1782950">There's</span> <span m="1783120">even</span> <span m="1783380">some</span> <span m="1783660">very</span> <span m="1783970">avant</span> <span m="1784280">garde</span> <span m="1784590">proposals</span> <span m="1785250">to</span> <span m="1785440">change</span> <span m="1785700">the</span> <span m="1785780">hardware</span> <span m="1786600">such</span> <span m="1786960">that</span> <span m="1787370">the</span> <span m="1787460">hardware</span> <span m="1787980">actually</span> <span m="1788300">contains</span> <span m="1788700">an</span> <span m="1788840">xor</span> <span m="1789280">key,</span> <span m="1790020">that</span> <span m="1790200">is</span> <span m="1790320">used</span> <span m="1790660">to</span> <span m="1790720">dynamically</span> <span m="1791350">xor</span> <span m="1791870">instructions,</span> <span m="1792860">right.</span> <span m="1793130">Imagine</span> <span m="1793510">every</span> <span m="1793690">time</span> <span m="1793810">you</span> <span m="1793930">compile</span> <span m="1794470">the</span> <span m="1794590">program,</span> <span m="1795360">all</span> <span m="1795500">of</span> <span m="1795640">the</span> <span m="1795720">instruction</span> <span m="1796200">codes</span> <span m="1796400">that's</span> <span m="1796575">the</span> <span m="1796750">xor</span> <span m="1797160">of</span> <span m="1797250">some</span> <span m="1797500">key,</span> <span m="1798170">right.</span> </p>
<p><span m="1798570">That</span> <span m="1798790">key</span> <span m="1799340">is</span> <span m="1799413">put</span> <span m="1799486">into</span> <span m="1799630">that</span> <span m="1799780">hardware</span> <span m="1800240">register</span> <span m="1800590">when</span> <span m="1800860">you</span> <span m="1801050">initially</span> <span m="1801370">load</span> <span m="1801630">the</span> <span m="1801700">program</span> <span m="1802370">and</span> <span m="1802470">then</span> <span m="1802570">whenever</span> <span m="1802820">you</span> <span m="1802950">execute</span> <span m="1803940">an</span> <span m="1804050">instruction,</span> <span m="1804450">the</span> <span m="1804520">hardware</span> <span m="1804880">automatically</span> <span m="1805490">xor's</span> <span m="1805790">it,</span> <span m="1806620">before</span> <span m="1806890">you</span> <span m="1807020">continue</span> <span m="1807440">executing</span> <span m="1807670">that</span> <span m="1807900">instruction,</span> <span m="1808790">right.</span> <span m="1808980">So</span> <span m="1809060">what's</span> <span m="1809210">nice</span> <span m="1809450">about</span> <span m="1809720">that</span> <span m="1810010">is,</span> <span m="1810100">that</span> <span m="1810290">now</span> <span m="1810580">even</span> <span m="1810660">if</span> <span m="1810840">the</span> <span m="1810950">attacker</span> <span m="1811300">can</span> <span m="1811420">generate</span> <span m="1811750">the</span> <span m="1811810">shell</span> <span m="1812140">code,</span> <span m="1812700">the</span> <span m="1812780">attacker</span> <span m="1813060">doesn't</span> <span m="1813310">know</span> <span m="1813450">that</span> <span m="1813940">key,</span> <span m="1814550">right.</span> <span m="1814860">So</span> <span m="1815020">it's</span> <span m="1815110">very</span> <span m="1815260">difficult</span> <span m="1815530">for</span> <span m="1815600">the</span> <span m="1815670">attacker</span> <span m="1815980">to</span> <span m="1816050">figure</span> <span m="1816350">out</span> <span m="1816520">what</span> <span m="1816670">exactly</span> <span m="1817030">to</span> <span m="1817196">put</span> <span m="1817362">into</span> <span m="1817528">memory.</span> </p>
<p><span m="1818026">AUDIENCE: But</span> <span m="1818524">if</span> <span m="1818623">he</span> <span m="1818723">can</span> <span m="1818822">get</span> <span m="1818872">the</span> <span m="1818922">code</span> <span m="1819520">and</span> <span m="1819686">he</span> <span m="1819852">also</span> <span m="1820516">instructions</span> <span m="1821512">he</span> <span m="1821761">can</span> <span m="1822508">xor</span> <span m="1822757">it</span> <span m="1823006">back</span> <span m="1823504">to</span> <span m="1823670">the</span> <span m="1823836">instruction</span> <span m="1824002">[INAUDIBLE].</span> </p>
<p><span m="1824510">PROFESSOR;Oh</span> <span m="1824670">yeah.</span> <span m="1825140">This</span> <span m="1825280">is</span> <span m="1825370">always</span> <span m="1825720">a</span> <span m="1825990">canonical</span> <span m="1826080">problem,</span> <span m="1826510">right.</span> <span m="1826810">So</span> <span m="1826940">it's</span> <span m="1827030">like</span> <span m="1827220">what</span> <span m="1827320">if</span> <span m="1827410">someone</span> <span m="1827700">does</span> <span m="1827890">this?</span> <span m="1828360">So</span> <span m="1828490">that's</span> <span m="1828630">exactly</span> <span m="1829030">right.</span> <span m="1829410">So</span> <span m="1829750">this</span> <span m="1829930">is</span> <span m="1830040">somewhat</span> <span m="1830390">similar</span> <span m="1830630">to</span> <span m="1830680">what</span> <span m="1830790">happens</span> <span m="1831070">in</span> <span m="1831130">the</span> <span m="1831220">BROP</span> <span m="1831510">attack</span> <span m="1831960">where,</span> <span m="1832720">essentially</span> <span m="1833200">we've</span> <span m="1833390">sort</span> <span m="1833600">of</span> <span m="1833730">randomized</span> <span m="1834045">where</span> <span m="1834360">locations</span> <span m="1834890">are,</span> <span m="1835290">but</span> <span m="1835345">the</span> <span m="1835400">attacker</span> <span m="1835820">can</span> <span m="1836120">do</span> <span m="1836430">probes,</span> <span m="1837010">right.</span> <span m="1837270">And</span> <span m="1837420">figure</span> <span m="1837680">out</span> <span m="1837800">what's</span> <span m="1838020">going</span> <span m="1838260">on.</span> </p>
<p><span m="1838760">So</span> <span m="1839050">you</span> <span m="1839180">can</span> <span m="1839300">imagine</span> <span m="1839750">too</span> <span m="1839880">that</span> <span m="1840010">for</span> <span m="1840180">example,</span> <span m="1840520">if</span> <span m="1840580">the</span> <span m="1840690">attacker</span> <span m="1841180">knows</span> <span m="1841610">some</span> <span m="1841830">sub-sequence</span> <span m="1842410">of</span> <span m="1842520">code</span> <span m="1843320">that</span> <span m="1843870">he's</span> <span m="1844240">expects</span> <span m="1844410">to</span> <span m="1844540">be</span> <span m="1844850">in</span> <span m="1844930">the</span> <span m="1845010">binary,</span> <span m="1845610">you</span> <span m="1845690">could</span> <span m="1845800">imagine</span> <span m="1846220">just</span> <span m="1846390">sort</span> <span m="1846580">of</span> <span m="1846660">trying</span> <span m="1846835">to</span> <span m="1847010">xor</span> <span m="1847410">the</span> <span m="1847500">binary</span> <span m="1847910">with</span> <span m="1848040">that</span> <span m="1848260">known</span> <span m="1848510">code,</span> <span m="1849070">trying</span> <span m="1849290">to</span> <span m="1849430">extract</span> <span m="1849740">the</span> <span m="1849820">key.</span> <span m="1850130">And</span> <span m="1850370">there's</span> <span m="1850570">a</span> <span m="1850655">lot</span> <span m="1850740">evil</span> <span m="1851030">in</span> <span m="1851070">the</span> <span m="1851110">world,</span> <span m="1851123">so</span> <span m="1851136">you're</span> <span m="1851150">exactly</span> <span m="1851520">correct</span> <span m="1851800">about</span> <span m="1852218">that.</span> </p>
<p><span m="1853890">OK</span> <span m="1854300">so</span> <span m="1854740">that's</span> <span m="1854940">essentially</span> <span m="1855100">the</span> <span m="1855260">discussion</span> <span m="1855720">of</span> <span m="1855820">all</span> <span m="1857230">the</span> <span m="1857320">randomization</span> <span m="1858460">attacks</span> <span m="1858790">that</span> <span m="1858950">I</span> <span m="1858990">want</span> <span m="1859030">to</span> <span m="1859070">discuss</span> <span m="1859370">today.</span> <span m="1860310">So</span> <span m="1860420">one</span> <span m="1860650">thing</span> <span m="1861040">to</span> <span m="1861380">talk</span> <span m="1861560">about</span> <span m="1861700">before</span> <span m="1862030">we</span> <span m="1862150">get</span> <span m="1862360">to</span> <span m="1862430">some</span> <span m="1862620">of</span> <span m="1862670">the</span> <span m="1862730">return</span> <span m="1862806">oriented</span> <span m="1863340">programming</span> <span m="1863780">stuff,</span> <span m="1864370">is</span> <span m="1864820">you</span> <span m="1864920">might</span> <span m="1865230">wonder</span> <span m="1865360">which</span> <span m="1865610">ones</span> <span m="1865840">of</span> <span m="1865920">these</span> <span m="1866110">defenses</span> <span m="1866330">are</span> <span m="1866550">actually</span> <span m="1866890">used</span> <span m="1867040">in</span> <span m="1867200">practice.</span> <span m="1868440">And</span> <span m="1868590">so</span> <span m="1868770">as</span> <span m="1868940">it</span> <span m="1869120">turns</span> <span m="1869390">out,</span> <span m="1869830">both</span> <span m="1870220">GCC</span> <span m="1871090">and</span> <span m="1871340">Visual</span> <span m="1871650">Studio,</span> <span m="1872420">they</span> <span m="1872640">both</span> <span m="1873210">enable</span> <span m="1873780">stack</span> <span m="1874070">canaries</span> <span m="1874360">by</span> <span m="1874625">default,</span> <span m="1875360">right.</span> <span m="1875640">So</span> <span m="1875760">that's</span> <span m="1875880">very</span> <span m="1876110">popular,</span> <span m="1876470">that's</span> <span m="1877085">a</span> <span m="1877390">very</span> <span m="1877710">well</span> <span m="1877910">known</span> <span m="1878110">community.</span> </p>
<p><span m="1879900">If</span> <span m="1880010">you</span> <span m="1880220">look</span> <span m="1880350">Linux</span> <span m="1880480">and</span> <span m="1880690">Windows</span> <span m="1881250">they</span> <span m="1881820">can</span> <span m="1881940">also</span> <span m="1882210">do</span> <span m="1882410">things</span> <span m="1882750">like</span> <span m="1882890">non-executable</span> <span m="1883260">memory.</span> <span m="1884160">They</span> <span m="1884250">can</span> <span m="1884360">also</span> <span m="1884570">do</span> <span m="1884670">things</span> <span m="1884870">like</span> <span m="1885000">randomize</span> <span m="1885400">the</span> <span m="1885510">address</span> <span m="1885780">space,</span> <span m="1886280">so</span> <span m="1886570">that's</span> <span m="1886750">also</span> <span m="1886900">[INAUDIBLE].</span> <span m="1887950">The</span> <span m="1888300">baggy</span> <span m="1888465">bounds</span> <span m="1888630">stuff</span> <span m="1888920">however,</span> <span m="1889440">is</span> <span m="1889610">not</span> <span m="1889840">as</span> <span m="1889930">popular.</span> <span m="1890750">And</span> <span m="1890770">that's</span> <span m="1890970">because</span> <span m="1891210">of</span> <span m="1891280">some</span> <span m="1891460">of</span> <span m="1891500">these</span> <span m="1891690">costs</span> <span m="1891955">that</span> <span m="1892087">we</span> <span m="1892220">talked</span> <span m="1892460">about</span> <span m="1892590">over</span> <span m="1892770">here,</span> <span m="1893260">in</span> <span m="1893320">terms</span> <span m="1893380">of</span> <span m="1893440">memory</span> <span m="1893850">overhead,</span> <span m="1894580">CPU,</span> <span m="1895390">the</span> <span m="1895820">false</span> <span m="1896190">alarms,</span> <span m="1896620">and</span> <span m="1896686">so</span> <span m="1896753">on</span> <span m="1896820">ans</span> <span m="1896925">so</span> <span m="1897030">forth.</span> <span m="1898560">So</span> <span m="1898580">that's</span> <span m="1898700">basically</span> <span m="1898990">a</span> <span m="1899040">survey</span> <span m="1900220">of</span> <span m="1900310">the</span> <span m="1900800">state</span> <span m="1901060">of</span> <span m="1901120">the</span> <span m="1901280">art,</span> <span m="1901810">in</span> <span m="1902030">trying</span> <span m="1902400">to</span> <span m="1902740">prevent</span> <span m="1903260">these</span> <span m="1904080">buffer</span> <span m="1904340">overflows.</span> </p>
<p><span m="1905970">So</span> <span m="1906520">now</span> <span m="1906790">we're</span> <span m="1906880">going</span> <span m="1906980">to</span> <span m="1907060">talk</span> <span m="1907530">about</span> <span m="1909400">this</span> <span m="1909540">return</span> <span m="1909800">oriented</span> <span m="1910250">programing</span> <span m="1910530">stuff.</span> <span m="1913900">So</span> <span m="1914070">what</span> <span m="1914180">I'm</span> <span m="1914270">described</span> <span m="1914645">to</span> <span m="1914832">you</span> <span m="1915020">so</span> <span m="1915210">far</span> <span m="1915490">today</span> <span m="1915680">in</span> <span m="1915810">terms</span> <span m="1916050">of</span> <span m="1916120">the</span> <span m="1916260">address</span> <span m="1916570">space</span> <span m="1916800">randomization</span> <span m="1917780">and</span> <span m="1917930">the</span> <span m="1918010">data</span> <span m="1918260">execution</span> <span m="1918790">prevention,</span> <span m="1919580">that's</span> <span m="1919960">the--</span> <span m="1921510">the</span> <span m="1921700">read,</span> <span m="1921880">write</span> <span m="1921960">and</span> <span m="1922040">execute</span> <span m="1922250">that</span> <span m="1922360">I</span> <span m="1922420">just</span> <span m="1922480">described.</span> </p>
<p><span m="1923180">Those</span> <span m="1923375">things</span> <span m="1923570">are</span> <span m="1923940">actually</span> <span m="1924190">very,</span> <span m="1924560">very</span> <span m="1924690">powerful,</span> <span m="1925520">right.</span> <span m="1925880">Because</span> <span m="1926110">the</span> <span m="1926190">randomization</span> <span m="1926880">prevents</span> <span m="1927240">the</span> <span m="1927350">attacker</span> <span m="1927620">from</span> <span m="1927890">actually</span> <span m="1928160">understanding</span> <span m="1928700">where</span> <span m="1928790">our</span> <span m="1928880">hard</span> <span m="1929085">coded</span> <span m="1929290">addresses</span> <span m="1929600">are.</span> <span m="1930580">And</span> <span m="1930720">the</span> <span m="1930790">data</span> <span m="1931040">execution</span> <span m="1931560">prevention</span> <span m="1931980">says,</span> <span m="1932210">even</span> <span m="1932430">if</span> <span m="1932540">you</span> <span m="1932660">can</span> <span m="1932810">put</span> <span m="1933090">shell</span> <span m="1933460">code</span> <span m="1934050">into</span> <span m="1934220">the</span> <span m="1934340">stack,</span> <span m="1935210">then</span> <span m="1935390">the</span> <span m="1935520">attacker</span> <span m="1935910">can't</span> <span m="1936190">just</span> <span m="1936410">jump</span> <span m="1936650">to</span> <span m="1936736">it</span> <span m="1936823">and</span> <span m="1936910">execute</span> <span m="1937350">it,</span> <span m="1937790">right.</span> <span m="1938160">So</span> <span m="1938410">at</span> <span m="1938470">its</span> <span m="1938530">space,</span> <span m="1938940">that</span> <span m="1939140">seems</span> <span m="1939380">like,</span> <span m="1939560">man</span> <span m="1939780">you've</span> <span m="1939960">really</span> <span m="1940190">made</span> <span m="1940350">a</span> <span m="1940420">lot</span> <span m="1940620">of</span> <span m="1940690">progress</span> <span m="1941100">for</span> <span m="1941260">stopping</span> <span m="1941500">these</span> <span m="1941740">attackers,</span> <span m="1943280">but</span> <span m="1943440">of</span> <span m="1943570">course</span> <span m="1945240">there</span> <span m="1945740">are</span> <span m="1945830">these</span> <span m="1945990">hackers</span> <span m="1946360">out</span> <span m="1946530">there</span> <span m="1946680">who</span> <span m="1946800">spend</span> <span m="1947030">all</span> <span m="1947260">their</span> <span m="1947390">time</span> <span m="1947680">thinking</span> <span m="1948010">about</span> <span m="1948230">how</span> <span m="1948340">to</span> <span m="1948410">ruin</span> <span m="1948580">our</span> <span m="1948770">lives.</span> </p>
<p><span m="1949560">So</span> <span m="1950270">what's</span> <span m="1950570">the</span> <span m="1950700">insight</span> <span m="1951130">behind</span> <span m="1951600">return</span> <span m="1951980">oriented</span> <span m="1952320">programming?</span> <span m="1953030">The</span> <span m="1953200">insight</span> <span m="1953840">is</span> <span m="1954020">that,</span> <span m="1954470">what</span> <span m="1954670">if</span> <span m="1954790">instead</span> <span m="1955160">of</span> <span m="1955220">the</span> <span m="1955340">attacker</span> <span m="1955830">being</span> <span m="1956130">able</span> <span m="1956320">to</span> <span m="1956430">generate</span> <span m="1957300">just</span> <span m="1957700">new</span> <span m="1957910">code</span> <span m="1958540">at</span> <span m="1958670">attack</span> <span m="1958930">time,</span> <span m="1959470">what</span> <span m="1959660">if</span> <span m="1959770">the</span> <span m="1959880">attacker</span> <span m="1960360">could</span> <span m="1960530">string</span> <span m="1961070">together</span> <span m="1961590">preexisting</span> <span m="1962430">pieces</span> <span m="1962860">of</span> <span m="1962980">code</span> <span m="1963850">and</span> <span m="1964010">then</span> <span m="1964300">string</span> <span m="1964540">them</span> <span m="1964780">together</span> <span m="1965185">in</span> <span m="1965590">deviant</span> <span m="1966130">ways,</span> <span m="1967060">right?</span> <span m="1967550">And</span> <span m="1967670">we</span> <span m="1967790">know</span> <span m="1967990">that</span> <span m="1968095">the</span> <span m="1968200">program</span> <span m="1968570">contains</span> <span m="1968960">a</span> <span m="1969040">ton</span> <span m="1969310">of</span> <span m="1969360">code</span> <span m="1969660">already,</span> <span m="1970380">right.</span> </p>
<p><span m="1970780">So</span> <span m="1971080">hopefully,</span> <span m="1971740">or</span> <span m="1972170">unhopefully,</span> <span m="1972700">depending</span> <span m="1972980">on</span> <span m="1973093">which</span> <span m="1973206">side</span> <span m="1973320">of</span> <span m="1973414">this</span> <span m="1973508">you're</span> <span m="1973602">on.</span> <span m="1974450">If</span> <span m="1974580">you</span> <span m="1974680">can</span> <span m="1974820">find</span> <span m="1975280">enough</span> <span m="1975610">interesting</span> <span m="1976060">code</span> <span m="1976380">snippets,</span> <span m="1976900">you</span> <span m="1977020">can</span> <span m="1977155">string</span> <span m="1977560">them</span> <span m="1977690">together</span> <span m="1978330">to</span> <span m="1978930">basically</span> <span m="1979450">form</span> <span m="1979800">like</span> <span m="1980020">this</span> <span m="1980190">Turing</span> <span m="1980540">complete</span> <span m="1980940">language,</span> <span m="1981570">where</span> <span m="1981630">the</span> <span m="1981720">attacker</span> <span m="1982060">can</span> <span m="1982200">essentially</span> <span m="1982540">do</span> <span m="1982700">whatever</span> <span m="1982930">the</span> <span m="1983020">attacker</span> <span m="1983230">wants</span> <span m="1983540">to</span> <span m="1983640">do.</span> </p>
<p><span m="1984140">So</span> <span m="1984280">that's</span> <span m="1984540">the</span> <span m="1984890">insight</span> <span m="1985320">behind</span> <span m="1986010">return</span> <span m="1986310">oriented</span> <span m="1986590">programming.</span> <span m="1987240">So</span> <span m="1987400">understand</span> <span m="1987770">how</span> <span m="1987870">this</span> <span m="1988040">works.</span> <span m="1988980">Let's</span> <span m="1989200">look</span> <span m="1989350">at</span> <span m="1989410">a</span> <span m="1989440">very</span> <span m="1989870">simple</span> <span m="1990210">example</span> <span m="1990870">that</span> <span m="1991050">will</span> <span m="1991200">initially</span> <span m="1991600">start</span> <span m="1991890">off</span> <span m="1992570">very</span> <span m="1993470">familiar,</span> <span m="1994290">right.</span> <span m="1994800">But</span> <span m="1994900">then</span> <span m="1995070">it's</span> <span m="1995240">very</span> <span m="1995460">quickly</span> <span m="1995820">going</span> <span m="1996120">to</span> <span m="1996480">descend</span> <span m="1997000">into</span> <span m="1997160">madness.</span> </p>
<p><span m="1999210">So</span> <span m="1999660">let's</span> <span m="1999990">say</span> <span m="2000920">that</span> <span m="2001130">we</span> <span m="2001260">have</span> <span m="2001560">the</span> <span m="2001640">following</span> <span m="2002550">program.</span> <span m="2003560">So</span> <span m="2003830">we</span> <span m="2003970">have</span> <span m="2004990">some</span> <span m="2005320">program--</span> <span m="2006180">sorry,</span> <span m="2006440">some</span> <span m="2006640">function</span> <span m="2008720">and</span> <span m="2009140">conveniently</span> <span m="2009810">for</span> <span m="2010200">the</span> <span m="2010360">attacker,</span> <span m="2011330">it</span> <span m="2011460">has</span> <span m="2011700">this</span> <span m="2011900">nice</span> <span m="2012790">function</span> <span m="2013180">here</span> <span m="2013440">called</span> <span m="2013770">run</span> <span m="2014030">shell.</span> <span m="2016300">So</span> <span m="2016530">this</span> <span m="2016720">is</span> <span m="2016800">just</span> <span m="2017030">going</span> <span m="2017250">to</span> <span m="2017350">call</span> <span m="2017610">system,</span> <span m="2018790">it's</span> <span m="2019000">going</span> <span m="2019320">to</span> <span m="2019610">execute</span> <span m="2021120">bin</span> <span m="2021380">slash</span> <span m="2021720">bash</span> <span m="2024410">and</span> <span m="2024530">then</span> <span m="2024700">be</span> <span m="2024820">done.</span> </p>
<p><span m="2025830">And</span> <span m="2026050">then</span> <span m="2026400">we've</span> <span m="2026670">got</span> <span m="2027770">the</span> <span m="2028150">canonical</span> <span m="2029330">buffer</span> <span m="2029800">overflow</span> <span m="2030380">process</span> <span m="2031280">or</span> <span m="2031410">sorry,</span> <span m="2031660">function</span> <span m="2031980">down</span> <span m="2032180">here,</span> <span m="2033590">basically</span> <span m="2035090">this</span> <span m="2035710">thing</span> <span m="2036040">is</span> <span m="2036210">going</span> <span m="2036530">to</span> <span m="2036770">declare</span> <span m="2037550">a</span> <span m="2037700">buffer,</span> <span m="2041430">and</span> <span m="2041630">then</span> <span m="2041750">it's</span> <span m="2041940">going</span> <span m="2042290">to</span> <span m="2043070">use</span> <span m="2043450">one</span> <span m="2043670">of</span> <span m="2043790">these</span> <span m="2044090">unsafe</span> <span m="2044630">functions</span> <span m="2047370">to</span> <span m="2048020">fill</span> <span m="2048460">in</span> <span m="2049449">bytes</span> <span m="2050719">in</span> <span m="2050870">the</span> <span m="2050960">buffer.</span> </p>
<p><span m="2052870">OK</span> <span m="2053350">so,</span> <span m="2055219">we</span> <span m="2055380">know</span> <span m="2055670">that</span> <span m="2055779">this</span> <span m="2055889">can</span> <span m="2056000">be</span> <span m="2056150">overflowing</span> <span m="2056929">OK,</span> <span m="2057210">this</span> <span m="2057350">is</span> <span m="2057469">old</span> <span m="2057730">news.</span> <span m="2058510">Now</span> <span m="2058679">what's</span> <span m="2058969">interesting</span> <span m="2059124">is</span> <span m="2059280">that</span> <span m="2059449">we</span> <span m="2059610">have</span> <span m="2060610">this</span> <span m="2060850">function</span> <span m="2061239">up</span> <span m="2061409">here,</span> <span m="2062969">run</span> <span m="2063179">shell,</span> <span m="2064850">but</span> <span m="2065100">it</span> <span m="2065210">doesn't</span> <span m="2065540">quite</span> <span m="2065770">seem</span> <span m="2066110">to</span> <span m="2066159">be</span> <span m="2066790">accessed</span> <span m="2067095">in</span> <span m="2067400">some</span> <span m="2067620">direct</span> <span m="2068050">way</span> <span m="2069030">based</span> <span m="2069389">on</span> <span m="2069489">this</span> <span m="2069670">buffer</span> <span m="2069900">overflow.</span> <span m="2070400">So</span> <span m="2070550">how</span> <span m="2070790">can</span> <span m="2070940">the</span> <span m="2071070">attacker</span> <span m="2073170">invoke</span> <span m="2073940">this</span> <span m="2074159">run</span> <span m="2074340">shell</span> <span m="2074739">command</span> <span m="2074929">here?</span> </p>
<p><span m="2075540">Well</span> <span m="2076400">the</span> <span m="2076540">attack</span> <span m="2076680">may</span> <span m="2076960">do</span> <span m="2077100">a</span> <span m="2077170">couple</span> <span m="2077460">things.</span> <span m="2078550">So</span> <span m="2078639">first</span> <span m="2078980">of</span> <span m="2079110">all,</span> <span m="2079580">the</span> <span m="2079690">attacker</span> <span m="2080320">can</span> <span m="2081520">disassemble</span> <span m="2082239">the</span> <span m="2082330">program,</span> <span m="2082920">run</span> <span m="2083170">GDB,</span> <span m="2084139">find</span> <span m="2084400">out</span> <span m="2084540">the</span> <span m="2084659">address</span> <span m="2085010">of</span> <span m="2085100">this</span> <span m="2085300">thing</span> <span m="2085610">in</span> <span m="2085909">the</span> <span m="2085980">executable,</span> <span m="2086980">right.</span> <span m="2087199">So</span> <span m="2087280">you</span> <span m="2087389">all</span> <span m="2087540">should</span> <span m="2087620">be</span> <span m="2087719">very</span> <span m="2087989">familiar</span> <span m="2088300">with</span> <span m="2088389">doing</span> <span m="2088550">those</span> <span m="2088699">kinds</span> <span m="2088900">of</span> <span m="2088980">things</span> <span m="2089219">through</span> <span m="2089310">the</span> <span m="2089409">lab.</span> <span m="2090360">That's</span> <span m="2090420">the</span> <span m="2090480">first</span> <span m="2090660">thing</span> <span m="2090840">the</span> <span m="2090935">attacker</span> <span m="2091030">can</span> <span m="2091290">do.</span> <span m="2092000">And</span> <span m="2092260">then</span> <span m="2092610">during</span> <span m="2092989">the</span> <span m="2093080">buffer</span> <span m="2093440">overflow,</span> <span m="2094480">the</span> <span m="2094610">attacker</span> <span m="2095199">can</span> <span m="2095320">essentially</span> <span m="2095860">take</span> <span m="2096159">that</span> <span m="2096320">address,</span> <span m="2097410">put</span> <span m="2097670">it</span> <span m="2097900">in</span> <span m="2098090">the</span> <span m="2098690">buffer</span> <span m="2099060">overflow</span> <span m="2099500">that's</span> <span m="2099730">generated</span> <span m="2100360">and</span> <span m="2100540">make</span> <span m="2100740">sure</span> <span m="2100930">that</span> <span m="2101040">the</span> <span m="2101150">function</span> <span m="2101580">returns</span> <span m="2102570">to</span> <span m="2102850">run</span> <span m="2103060">shell.</span> </p>
<p><span m="2104450">So</span> <span m="2104630">just</span> <span m="2104800">to</span> <span m="2104860">make</span> <span m="2105040">that</span> <span m="2105240">clear,</span> <span m="2105990">let's</span> <span m="2106480">draw</span> <span m="2107210">that</span> <span m="2108060">over</span> <span m="2108360">here.</span> <span m="2109370">So,</span> <span m="2112500">you</span> <span m="2112573">have</span> <span m="2112646">a</span> <span m="2112720">setup</span> <span m="2112920">that</span> <span m="2113370">looks</span> <span m="2113700">something</span> <span m="2114060">like</span> <span m="2114320">this</span> <span m="2115840">at</span> <span m="2115990">the</span> <span m="2116100">bottom,</span> <span m="2118270">we</span> <span m="2118450">have</span> <span m="2118930">the</span> <span m="2119030">buffer,</span> <span m="2120620">that's</span> <span m="2120850">being</span> <span m="2121140">overflowed.</span> <span m="2126340">And</span> <span m="2126450">then</span> <span m="2126560">up</span> <span m="2126710">here,</span> <span m="2127740">we</span> <span m="2127960">have</span> <span m="2128400">the</span> <span m="2131320">save</span> <span m="2131740">the</span> <span m="2131880">break</span> <span m="2132020">pointer,</span> <span m="2136590">up</span> <span m="2136750">here</span> <span m="2137460">we</span> <span m="2137640">have</span> <span m="2138060">the</span> <span m="2139610">return</span> <span m="2140050">address,</span> <span m="2142560">for</span> <span m="2143610">process</span> <span m="2144060">message.</span> </p>
<p><span m="2148990">So</span> <span m="2149140">remember</span> <span m="2149550">that</span> <span m="2149870">the</span> <span m="2150410">new</span> <span m="2150790">stack</span> <span m="2151260">pointer</span> <span m="2153150">will</span> <span m="2153280">be</span> <span m="2153420">here</span> <span m="2153960">initially,</span> <span m="2154850">when</span> <span m="2154980">we</span> <span m="2155100">start</span> <span m="2155490">executing</span> <span m="2155820">the</span> <span m="2156150">function.</span> <span m="2157350">This</span> <span m="2157530">is</span> <span m="2157820">the</span> <span m="2158660">new</span> <span m="2159270">break</span> <span m="2159560">pointer,</span> <span m="2167400">this</span> <span m="2167710">is</span> <span m="2168340">what</span> <span m="2168590">the</span> <span m="2168680">stack</span> <span m="2169070">pointer</span> <span m="2169930">used</span> <span m="2170240">to</span> <span m="2170320">be.</span> <span m="2173980">And</span> <span m="2174100">then</span> <span m="2174210">we've</span> <span m="2174330">got</span> <span m="2174620">some</span> <span m="2174770">break pointer</span> <span m="2175100">up</span> <span m="2175430">here,</span> <span m="2179390">for</span> <span m="2179470">the</span> <span m="2179590">previous</span> <span m="2180140">frame.</span> <span m="2185390">OK,</span> <span m="2185750">so</span> <span m="2185950">this</span> <span m="2186110">should</span> <span m="2186250">look</span> <span m="2186740">pretty</span> <span m="2187150">familiar.</span> </p>
<p><span m="2187940">So</span> <span m="2188010">basically,</span> <span m="2188550">in</span> <span m="2188710">the</span> <span m="2188870">attack,</span> <span m="2189440">like</span> <span m="2189590">I</span> <span m="2189620">said,</span> <span m="2189790">we've</span> <span m="2189940">used</span> <span m="2190230">GDB</span> <span m="2190860">to</span> <span m="2190940">figure</span> <span m="2191250">out</span> <span m="2191640">what</span> <span m="2191830">the</span> <span m="2191940">address</span> <span m="2192155">is</span> <span m="2192370">of</span> <span m="2192510">run</span> <span m="2192650">shell.</span> <span m="2193220">So</span> <span m="2193380">in</span> <span m="2193430">the</span> <span m="2193510">buffer</span> <span m="2193850">overflow,</span> <span m="2194620">we</span> <span m="2194740">can</span> <span m="2194860">essentially</span> <span m="2196360">just</span> <span m="2197360">put</span> <span m="2197990">the</span> <span m="2198380">address</span> <span m="2199255">of</span> <span m="2199550">run</span> <span m="2199780">shell</span> <span m="2203260">right</span> <span m="2203480">here,</span> <span m="2204530">right.</span> <span m="2204720">So</span> <span m="2204795">this</span> <span m="2204870">is</span> <span m="2204895">a</span> <span m="2204920">actually</span> <span m="2205210">pretty</span> <span m="2205480">straightforward</span> <span m="2206040">extension</span> <span m="2206390">of</span> <span m="2206520">what</span> <span m="2206650">we</span> <span m="2206790">already</span> <span m="2207020">know</span> <span m="2207170">how</span> <span m="2207280">to</span> <span m="2207370">do,</span> <span m="2208020">right.</span> </p>
<p><span m="2208240">So</span> <span m="2208310">basically</span> <span m="2208505">it's</span> <span m="2208700">saying,</span> <span m="2209250">if</span> <span m="2209500">we</span> <span m="2209680">conveniently</span> <span m="2210270">have</span> <span m="2210660">a</span> <span m="2210740">command</span> <span m="2211100">that</span> <span m="2211210">runs</span> <span m="2211440">a</span> <span m="2211490">shell,</span> <span m="2212360">if</span> <span m="2212510">we</span> <span m="2212600">can</span> <span m="2212740">disassemble</span> <span m="2213300">the</span> <span m="2213420">binary,</span> <span m="2213850">figure</span> <span m="2214080">out</span> <span m="2214170">where</span> <span m="2214270">that</span> <span m="2214430">address</span> <span m="2214720">is,</span> <span m="2215230">we</span> <span m="2215300">can</span> <span m="2215370">just</span> <span m="2215560">put</span> <span m="2215790">that</span> <span m="2216040">in</span> <span m="2216100">this</span> <span m="2216290">overflow</span> <span m="2217010">array</span> <span m="2217410">that</span> <span m="2217740">we</span> <span m="2217850">have</span> <span m="2218250">here.</span> <span m="2218990">So</span> <span m="2219080">that</span> <span m="2219170">should</span> <span m="2219260">be</span> <span m="2219330">pretty</span> <span m="2219570">straightforward.</span> <span m="2220130">Does</span> <span m="2220420">that</span> <span m="2220550">make</span> <span m="2220710">sense?</span> </p>
<p><span m="2222700">OK.</span> <span m="2223490">So,</span> <span m="2224420">this</span> <span m="2224690">was</span> <span m="2225190">a</span> <span m="2225270">very</span> <span m="2226270">childish</span> <span m="2226740">example,</span> <span m="2227390">because</span> <span m="2227730">the</span> <span m="2227820">programmer</span> <span m="2228300">for</span> <span m="2228440">some</span> <span m="2228600">crazy</span> <span m="2229000">reason</span> <span m="2229690">has</span> <span m="2229940">put</span> <span m="2230200">this</span> <span m="2230700">low</span> <span m="2230867">hanging</span> <span m="2231370">fruit</span> <span m="2231530">here.</span> <span m="2232030">So</span> <span m="2232113">as</span> <span m="2232196">an</span> <span m="2232280">attacker</span> <span m="2232630">this</span> <span m="2232760">is</span> <span m="2232890">like</span> <span m="2233060">Christmas</span> <span m="2233380">coming</span> <span m="2233660">early,</span> <span m="2234180">right.</span> <span m="2234670">Now</span> <span m="2235490">it</span> <span m="2235630">may</span> <span m="2235790">not</span> <span m="2235950">be</span> <span m="2236060">the</span> <span m="2236170">case</span> <span m="2236510">that</span> <span m="2236620">you</span> <span m="2236700">have</span> <span m="2236920">something</span> <span m="2237620">as</span> <span m="2237840">delightful</span> <span m="2238360">as</span> <span m="2238470">this.</span> <span m="2239420">So</span> <span m="2240160">what</span> <span m="2240310">you</span> <span m="2240440">could</span> <span m="2240710">have</span> <span m="2240980">instead,</span> <span m="2241880">is</span> <span m="2242050">something</span> <span m="2242450">like</span> <span m="2242670">this.</span> </p>
<p><span m="2245400">So</span> <span m="2246890">let's</span> <span m="2247250">say</span> <span m="2247630">that</span> <span m="2247910">instead</span> <span m="2248220">of</span> <span m="2248320">this</span> <span m="2248510">thing</span> <span m="2248740">being</span> <span m="2248960">called</span> <span m="2249840">run</span> <span m="2250490">shell,</span> <span m="2250980">we</span> <span m="2251100">call</span> <span m="2251305">it</span> <span m="2251510">run</span> <span m="2251810">boring</span> <span m="2253580">and</span> <span m="2253650">then</span> <span m="2253810">maybe</span> <span m="2254210">this</span> <span m="2254440">thing</span> <span m="2254710">just</span> <span m="2254940">executes</span> <span m="2257810">bin</span> <span m="2258270">slash</span> <span m="2259930">OS</span> <span m="2260275">let's</span> <span m="2260620">say.</span> <span m="2261880">But</span> <span m="2262880">let's</span> <span m="2263330">say</span> <span m="2263790">that</span> <span m="2265380">everything</span> <span m="2265890">is</span> <span m="2266000">not</span> <span m="2266210">completely</span> <span m="2266720">lost,</span> <span m="2267480">because</span> <span m="2267780">we</span> <span m="2267880">actually</span> <span m="2268970">have</span> <span m="2269400">a</span> <span m="2269450">string</span> <span m="2269860">up</span> <span m="2270010">here</span> <span m="2271730">that</span> <span m="2271940">conveniently</span> <span m="2274270">gives</span> <span m="2274520">us</span> <span m="2274670">the</span> <span m="2274780">path</span> <span m="2275630">of</span> <span m="2275960">that.</span> </p>
<p><span m="2284700">So</span> <span m="2286450">what's</span> <span m="2286620">interesting</span> <span m="2287020">about</span> <span m="2287300">this</span> <span m="2287520">is,</span> <span m="2287650">that</span> <span m="2287830">we</span> <span m="2287940">can</span> <span m="2288290">disassemble</span> <span m="2288810">the</span> <span m="2289230">program,</span> <span m="2289990">find</span> <span m="2290200">the</span> <span m="2290280">location</span> <span m="2290700">of</span> <span m="2290820">run</span> <span m="2290950">boring,</span> <span m="2291570">but</span> <span m="2291680">as</span> <span m="2291770">an</span> <span m="2291850">attacker,</span> <span m="2292230">who</span> <span m="2292320">wants</span> <span m="2292520">to</span> <span m="2292580">run</span> <span m="2292800">an</span> <span m="2292850">OS?</span> <span m="2293380">Right,</span> <span m="2293570">that's</span> <span m="2293676">no</span> <span m="2293783">fun</span> <span m="2294690">But</span> <span m="2294860">we</span> <span m="2294980">do</span> <span m="2295420">actually</span> <span m="2295860">have</span> <span m="2297230">a</span> <span m="2297330">string</span> <span m="2298060">in</span> <span m="2298210">memory</span> <span m="2298470">that</span> <span m="2298650">points</span> <span m="2299070">to</span> <span m="2299660">the</span> <span m="2299750">path</span> <span m="2299871">of</span> <span m="2299993">the</span> <span m="2300115">shell</span> <span m="2301910">and</span> <span m="2302090">actually</span> <span m="2302630">we</span> <span m="2302810">also</span> <span m="2303170">know</span> <span m="2303370">something</span> <span m="2303710">interesting</span> <span m="2304090">too.</span> <span m="2304660">Which</span> <span m="2304790">is</span> <span m="2304910">that</span> <span m="2305340">even</span> <span m="2305670">though</span> <span m="2306110">the</span> <span m="2306200">program</span> <span m="2306590">isn't</span> <span m="2306810">calling</span> <span m="2307080">system</span> <span m="2307440">with</span> <span m="2307560">the</span> <span m="2307670">argument</span> <span m="2308030">that</span> <span m="2308160">we</span> <span m="2308310">want,</span> <span m="2308920">it</span> <span m="2309050">is</span> <span m="2309270">calling</span> <span m="2309640">system</span> <span m="2310000">somehow.</span> </p>
<p><span m="2310830">So</span> <span m="2311070">we</span> <span m="2311210">know</span> <span m="2311440">that</span> <span m="2311630">system</span> <span m="2312040">must</span> <span m="2312300">be</span> <span m="2312400">getting</span> <span m="2312700">linked</span> <span m="2313490">into</span> <span m="2313860">this</span> <span m="2314070">program</span> <span m="2314550">somehow,</span> <span m="2315500">right.</span> <span m="2315860">So</span> <span m="2315970">we</span> <span m="2316420">can</span> <span m="2316540">actually</span> <span m="2316840">leverage</span> <span m="2317340">those</span> <span m="2317600">two</span> <span m="2317760">things,</span> <span m="2318630">to</span> <span m="2318750">actually</span> <span m="2319130">call</span> <span m="2319480">system</span> <span m="2320270">with</span> <span m="2320450">this</span> <span m="2320620">argument</span> <span m="2321060">here.</span> <span m="2322700">So</span> <span m="2322830">the</span> <span m="2322930">first</span> <span m="2323260">thing</span> <span m="2323390">that</span> <span m="2323510">we</span> <span m="2323640">do,</span> <span m="2324160">is</span> <span m="2324320">we</span> <span m="2324410">can</span> <span m="2324580">go</span> <span m="2325060">into</span> <span m="2325360">GDB</span> <span m="2325610">and</span> <span m="2325780">we</span> <span m="2325950">can</span> <span m="2326040">actually</span> <span m="2326460">figure</span> <span m="2326950">out</span> <span m="2328060">where</span> <span m="2328460">this</span> <span m="2328720">thing</span> <span m="2328890">is</span> <span m="2328980">located</span> <span m="2329890">in</span> <span m="2330150">the</span> <span m="2330590">process</span> <span m="2331180">binary</span> <span m="2331580">image,</span> <span m="2332310">right.</span> </p>
<p><span m="2332690">So</span> <span m="2332810">you</span> <span m="2332900">just</span> <span m="2332991">go</span> <span m="2333082">to</span> <span m="2333173">GDB,</span> <span m="2333900">just</span> <span m="2334040">type</span> <span m="2334230">in</span> <span m="2334330">basically</span> <span m="2334660">print</span> <span m="2334855">system</span> <span m="2335050">and</span> <span m="2335185">I'll</span> <span m="2335320">give</span> <span m="2335480">you</span> <span m="2335525">some</span> <span m="2335570">information</span> <span m="2336070">about</span> <span m="2336300">the</span> <span m="2336370">offset</span> <span m="2336555">of</span> <span m="2336740">that</span> <span m="2337030">OK.</span> <span m="2337510">So</span> <span m="2337630">that's</span> <span m="2337770">pretty</span> <span m="2337940">straightforward.</span> <span m="2338710">You</span> <span m="2338720">can</span> <span m="2338840">also</span> <span m="2339240">do</span> <span m="2339340">the</span> <span m="2339450">same</span> <span m="2339720">thing</span> <span m="2339880">with</span> <span m="2340040">bash</span> <span m="2340335">path.</span> <span m="2341090">Right,</span> <span m="2341510">you</span> <span m="2341583">just</span> <span m="2341656">use</span> <span m="2341730">GDB</span> <span m="2341940">to</span> <span m="2342150">figure</span> <span m="2342360">out</span> <span m="2342530">where</span> <span m="2342650">this</span> <span m="2342870">thing</span> <span m="2343050">lives.</span> <span m="2343500">It's</span> <span m="2343730">statically</span> <span m="2343960">declared</span> <span m="2344050">string,</span> <span m="2344140">right.</span> <span m="2344710">So</span> <span m="2344910">you'd</span> <span m="2344955">be</span> <span m="2345000">able</span> <span m="2345130">to</span> <span m="2345190">find</span> <span m="2345430">out</span> <span m="2345510">where</span> <span m="2345590">that</span> <span m="2345870">lives.</span> </p>
<p><span m="2347140">And</span> <span m="2347280">so</span> <span m="2347850">once</span> <span m="2348100">you've</span> <span m="2348280">done</span> <span m="2348510">that,</span> <span m="2349100">now</span> <span m="2349370">you</span> <span m="2349490">got</span> <span m="2349570">to</span> <span m="2349650">do</span> <span m="2349840">something</span> <span m="2350150">a</span> <span m="2350200">little</span> <span m="2350380">bit</span> <span m="2350520">different,</span> <span m="2351260">right.</span> <span m="2351440">Because</span> <span m="2351750">now</span> <span m="2352340">we</span> <span m="2352460">actually</span> <span m="2352810">have</span> <span m="2352960">to</span> <span m="2353050">figure</span> <span m="2353450">out</span> <span m="2353690">somehow,</span> <span m="2354510">how</span> <span m="2354720">to</span> <span m="2354920">invoke</span> <span m="2355300">system</span> <span m="2356000">with</span> <span m="2356180">an</span> <span m="2356320">argument</span> <span m="2356980">of</span> <span m="2357130">our</span> <span m="2357250">choosing,</span> <span m="2358230">right.</span> <span m="2358660">And</span> <span m="2358790">so</span> <span m="2358890">the</span> <span m="2358980">way</span> <span m="2359160">that</span> <span m="2359280">we</span> <span m="2359400">do</span> <span m="2359570">that</span> <span m="2359910">is</span> <span m="2360020">by</span> <span m="2360210">essentially</span> <span m="2360790">faking</span> <span m="2361750">a</span> <span m="2361890">calling</span> <span m="2362500">frame</span> <span m="2363410">for</span> <span m="2363680">system.</span> </p>
<p><span m="2364730">OK,</span> <span m="2365230">so</span> <span m="2365345">remember</span> <span m="2365460">that</span> <span m="2365530">a</span> <span m="2365670">frame</span> <span m="2366130">is</span> <span m="2366210">the</span> <span m="2366310">thing</span> <span m="2366490">that</span> <span m="2366640">the</span> <span m="2366750">compiler</span> <span m="2367165">and</span> <span m="2367580">the</span> <span m="2367700">hardware</span> <span m="2368240">work</span> <span m="2368430">together</span> <span m="2368950">to</span> <span m="2369700">use</span> <span m="2370010">to</span> <span m="2370090">implement</span> <span m="2370460">the</span> <span m="2370560">call</span> <span m="2370830">stack,</span> <span m="2371470">right.</span> <span m="2371860">So</span> <span m="2373760">here's</span> <span m="2374070">basically</span> <span m="2374510">what</span> <span m="2374710">we</span> <span m="2374810">want</span> <span m="2375030">to</span> <span m="2375150">do.</span> <span m="2378630">We</span> <span m="2378730">want</span> <span m="2378780">to</span> <span m="2378850">set</span> <span m="2379070">up</span> <span m="2379170">something</span> <span m="2380240">like</span> <span m="2380620">this</span> <span m="2384270">on</span> <span m="2384490">the</span> <span m="2384570">stack,</span> <span m="2390500">right.</span> <span m="2390710">So</span> <span m="2390780">basically</span> <span m="2391440">we're</span> <span m="2391630">going</span> <span m="2392020">to</span> <span m="2392360">fake</span> <span m="2393380">what</span> <span m="2393630">system</span> <span m="2394870">would</span> <span m="2395250">expect</span> <span m="2395810">to</span> <span m="2395880">be</span> <span m="2396090">on</span> <span m="2396210">the</span> <span m="2396300">stack,</span> <span m="2398700">but</span> <span m="2398920">right</span> <span m="2399160">before</span> <span m="2399540">it</span> <span m="2399650">actually</span> <span m="2400510">executes</span> <span m="2400910">its</span> <span m="2401100">code.</span> </p>
<p><span m="2405800">So</span> <span m="2406115">up</span> <span m="2406430">here</span> <span m="2406660">we</span> <span m="2406780">had</span> <span m="2406940">the</span> <span m="2407030">argument</span> <span m="2407205">of</span> <span m="2407380">the</span> <span m="2407470">system,</span> <span m="2407860">this</span> <span m="2408050">is</span> <span m="2408180">the</span> <span m="2408530">string</span> <span m="2408890">that</span> <span m="2408970">we</span> <span m="2409050">actually</span> <span m="2409320">want</span> <span m="2409460">to</span> <span m="2409520">execute.</span> <span m="2410580">And</span> <span m="2410610">then</span> <span m="2410740">down</span> <span m="2410870">here,</span> <span m="2411430">this</span> <span m="2411740">is</span> <span m="2413840">where</span> <span m="2414050">system</span> <span m="2417630">should</span> <span m="2417870">return</span> <span m="2418460">to,</span> <span m="2419160">when</span> <span m="2419300">it's</span> <span m="2419450">done.</span> <span m="2423530">Right,</span> <span m="2423800">so</span> <span m="2423920">this</span> <span m="2424190">is</span> <span m="2424340">what</span> <span m="2424860">system</span> <span m="2425510">expects</span> <span m="2426070">the</span> <span m="2426170">stack</span> <span m="2426550">to</span> <span m="2426650">look</span> <span m="2426900">like,</span> <span m="2427690">right</span> <span m="2427910">before</span> <span m="2428075">it</span> <span m="2428240">starts</span> <span m="2428530">execution.</span> <span m="2429690">It's</span> <span m="2430050">going</span> <span m="2430140">to</span> <span m="2430200">say</span> <span m="2430350">this</span> <span m="2430530">is</span> <span m="2430570">where</span> <span m="2430740">I</span> <span m="2430780">should</span> <span m="2430820">go</span> <span m="2430910">when</span> <span m="2431000">I'm</span> <span m="2431070">finished,</span> <span m="2431650">this</span> <span m="2431810">is</span> <span m="2431866">the</span> <span m="2431923">thing</span> <span m="2431980">I</span> <span m="2432120">should</span> <span m="2432260">consume</span> <span m="2432460">as</span> <span m="2432660">my</span> <span m="2432780">argument,</span> <span m="2433570">right.</span> <span m="2434180">In</span> <span m="2434300">the</span> <span m="2434390">past</span> <span m="2434600">we've</span> <span m="2434705">been</span> <span m="2434810">assuming</span> <span m="2435035">that</span> <span m="2435260">there</span> <span m="2435380">were</span> <span m="2435430">no</span> <span m="2435600">arguments</span> <span m="2436070">when</span> <span m="2436130">you</span> <span m="2436190">pass</span> <span m="2436250">the</span> <span m="2436320">functions,</span> <span m="2436670">but now this is</span> <span m="2436980">a</span> <span m="2437290">little</span> <span m="2437350">bit</span> <span m="2437410">different,</span> <span m="2438050">right.</span> </p>
<p><span m="2438420">So</span> <span m="2438600">basically</span> <span m="2439060">we</span> <span m="2439220">just</span> <span m="2439370">have</span> <span m="2439520">to</span> <span m="2439680">ensure</span> <span m="2439815">that</span> <span m="2439950">this</span> <span m="2440510">thing</span> <span m="2441230">is</span> <span m="2441530">in</span> <span m="2441860">that</span> <span m="2442110">overflow</span> <span m="2442650">code</span> <span m="2443290">that</span> <span m="2443410">we</span> <span m="2443530">create,</span> <span m="2444530">right.</span> <span m="2444780">We</span> <span m="2444870">just</span> <span m="2444930">have</span> <span m="2444990">to</span> <span m="2445050">make</span> <span m="2445240">sure</span> <span m="2445410">this</span> <span m="2445800">fake</span> <span m="2447120">calling</span> <span m="2447280">frame</span> <span m="2448270">is</span> <span m="2448550">in</span> <span m="2448670">that</span> <span m="2448790">array.</span> <span m="2450280">So</span> <span m="2450610">basically</span> <span m="2451980">the</span> <span m="2452210">way</span> <span m="2452360">this</span> <span m="2452560">will</span> <span m="2452690">work</span> <span m="2453640">is,</span> <span m="2454550">we</span> <span m="2454680">will</span> <span m="2454880">do</span> <span m="2455220">the</span> <span m="2455320">following.</span> </p>
<p><span m="2459810">So</span> <span m="2460100">once</span> <span m="2460300">again</span> <span m="2460640">remember</span> <span m="2460920">the</span> <span m="2461030">overflow</span> <span m="2461520">goes</span> <span m="2461750">up</span> <span m="2461870">here.</span> <span m="2462640">So</span> <span m="2462920">first,</span> <span m="2463930">we're</span> <span m="2464370">going</span> <span m="2464720">to</span> <span m="2464960">put</span> <span m="2465400">the</span> <span m="2466700">address</span> <span m="2467500">of</span> <span m="2467950">system</span> <span m="2468270">here.</span> <span m="2475370">And</span> <span m="2475570">then</span> <span m="2475860">here,</span> <span m="2477420">we're</span> <span m="2477610">going</span> <span m="2477920">to</span> <span m="2478070">put</span> <span m="2479640">just</span> <span m="2479870">some</span> <span m="2480120">junk</span> <span m="2480440">return</span> <span m="2480820">address.</span> <span m="2485090">Right,</span> <span m="2485280">this</span> <span m="2485430">is</span> <span m="2485500">where</span> <span m="2485650">system's</span> <span m="2485980">going</span> <span m="2486080">to</span> <span m="2486150">return</span> <span m="2486660">after</span> <span m="2486940">it's</span> <span m="2487070">finished.</span> <span m="2487820">For</span> <span m="2487890">the</span> <span m="2487980">purposes</span> <span m="2488400">of</span> <span m="2488430">the</span> <span m="2488460">discussion</span> <span m="2488830">now,</span> <span m="2489070">we</span> <span m="2489150">don't</span> <span m="2489310">care</span> <span m="2489470">what</span> <span m="2489570">this</span> <span m="2489750">does,</span> <span m="2489875">we'll</span> <span m="2490000">just</span> <span m="2490200">make</span> <span m="2490360">this</span> <span m="2490520">be</span> <span m="2490585">just</span> <span m="2490650">some</span> <span m="2490780">random</span> <span m="2491040">set</span> <span m="2491170">of</span> <span m="2491300">bytes.</span> <span m="2493020">And</span> <span m="2493260">then</span> <span m="2493940">up</span> <span m="2494130">here,</span> <span m="2495490">we're</span> <span m="2495640">actually</span> <span m="2495870">going</span> <span m="2496060">to</span> <span m="2496150">put</span> <span m="2497840">the</span> <span m="2498710">address</span> <span m="2501318">of</span> <span m="2501770">bash</span> <span m="2502110">path,</span> <span m="2506480">right.</span> <span m="2506770">So</span> <span m="2506900">what's</span> <span m="2507100">going</span> <span m="2507200">to</span> <span m="2507240">happen</span> <span m="2507570">now</span> <span m="2507940">when</span> <span m="2508090">we</span> <span m="2508140">do</span> <span m="2508190">this</span> <span m="2508240">buffer</span> <span m="2508365">in</span> <span m="2508490">overflow?</span> </p>
<p><span m="2509620">So</span> <span m="2509770">what's</span> <span m="2509870">going</span> <span m="2509970">to</span> <span m="2510020">happen</span> <span m="2510550">is</span> <span m="2510760">that,</span> <span m="2511910">process</span> <span m="2512175">message</span> <span m="2512440">is</span> <span m="2512580">going</span> <span m="2512690">to</span> <span m="2512730">finish,</span> <span m="2513460">it's</span> <span m="2513516">going</span> <span m="2513573">to</span> <span m="2513630">say,</span> <span m="2513950">OK</span> <span m="2514480">hey,</span> <span m="2514740">here's</span> <span m="2514990">where</span> <span m="2515070">I</span> <span m="2515150">should</span> <span m="2515310">return</span> <span m="2515700">to,</span> <span m="2516230">right.</span> <span m="2516750">And</span> <span m="2516870">then</span> <span m="2516975">it's</span> <span m="2517080">going</span> <span m="2517430">to</span> <span m="2518920">pop</span> <span m="2519170">the</span> <span m="2519250">stack,</span> <span m="2519840">right,</span> <span m="2520070">and</span> <span m="2520220">now</span> <span m="2520910">the</span> <span m="2521010">system</span> <span m="2521410">code</span> <span m="2521660">is</span> <span m="2521740">executing,</span> <span m="2522630">right.</span> <span m="2523140">The</span> <span m="2523250">system</span> <span m="2523660">code</span> <span m="2523990">now</span> <span m="2524200">sees</span> <span m="2525060">that</span> <span m="2525330">fake</span> <span m="2525470">call</span> <span m="2525850">frame</span> <span m="2526610">that</span> <span m="2526730">we</span> <span m="2526840">created,</span> <span m="2527690">right.</span> <span m="2528190">As</span> <span m="2528370">far</span> <span m="2528490">as</span> <span m="2528610">system</span> <span m="2528960">is</span> <span m="2529070">concerned,</span> <span m="2529510">nothing</span> <span m="2529770">chicanerous</span> <span m="2530310">has</span> <span m="2530410">taken</span> <span m="2530680">place,</span> <span m="2531390">right.</span> <span m="2531750">System</span> <span m="2532050">will</span> <span m="2532160">say,</span> <span m="2532420">aha</span> <span m="2533070">here's</span> <span m="2533250">the</span> <span m="2533350">argument</span> <span m="2533840">that</span> <span m="2533950">I</span> <span m="2533980">want</span> <span m="2534160">to</span> <span m="2534210">execute,</span> <span m="2535020">it's</span> <span m="2535880">bin</span> <span m="2536090">slash</span> <span m="2536415">bash,</span> <span m="2536950">it's</span> <span m="2537060">going</span> <span m="2537170">to</span> <span m="2537230">execute</span> <span m="2537710">it</span> <span m="2538070">and</span> <span m="2538420">voila,</span> <span m="2539030">the</span> <span m="2539120">attacker</span> <span m="2539460">has</span> <span m="2539630">a</span> <span m="2539680">shell,</span> <span m="2541080">right.</span> </p>
<p><span m="2542550">So</span> <span m="2542730">does</span> <span m="2542870">this</span> <span m="2543030">make</span> <span m="2543240">sense?</span> <span m="2543850">So</span> <span m="2543900">basically</span> <span m="2543950">what</span> <span m="2544050">we've</span> <span m="2544080">done</span> <span m="2544300">is,</span> <span m="2544390">we've</span> <span m="2544560">now</span> <span m="2544800">taken</span> <span m="2545140">advantage</span> <span m="2545850">of</span> <span m="2546010">knowledge</span> <span m="2546470">of</span> <span m="2546550">the</span> <span m="2546660">calling</span> <span m="2547070">convention,</span> <span m="2547610">for</span> <span m="2547900">the</span> <span m="2548070">platform</span> <span m="2548700">to</span> <span m="2548980">create</span> <span m="2549750">fake</span> <span m="2549980">stack</span> <span m="2550360">frames,</span> <span m="2550980">or</span> <span m="2551120">fake</span> <span m="2551550">calling</span> <span m="2551690">frames</span> <span m="2551830">I</span> <span m="2551923">should</span> <span m="2552016">say.</span> <span m="2552110">And</span> <span m="2552590">using</span> <span m="2552910">those</span> <span m="2553510">fake</span> <span m="2553770">calling</span> <span m="2554225">frames,</span> <span m="2554680">we</span> <span m="2554790">can</span> <span m="2554920">actually</span> <span m="2555480">execute</span> <span m="2556110">any</span> <span m="2556340">function</span> <span m="2556780">that</span> <span m="2557020">is</span> <span m="2557610">already</span> <span m="2558390">linked</span> <span m="2558575">and</span> <span m="2558760">defined</span> <span m="2559770">in</span> <span m="2559880">the</span> <span m="2559970">application.</span> <span m="2562330">Does</span> <span m="2562430">that</span> <span m="2562530">make</span> <span m="2562550">sense?</span> </p>
<p><span m="2565150">OK</span> <span m="2566310">so,</span> <span m="2569780">another</span> <span m="2570170">question</span> <span m="2570510">you</span> <span m="2570590">might</span> <span m="2570800">have</span> <span m="2571460">is,</span> <span m="2572050">what</span> <span m="2572550">if</span> <span m="2573640">this</span> <span m="2573980">string</span> <span m="2574610">wasn't</span> <span m="2574950">actually</span> <span m="2575620">in</span> <span m="2575790">the</span> <span m="2575880">program?</span> <span m="2577250">Now</span> <span m="2577380">to</span> <span m="2577403">be</span> <span m="2577426">clear,</span> <span m="2577860">this</span> <span m="2578070">string</span> <span m="2578280">is</span> <span m="2578390">almost</span> <span m="2578770">certainly</span> <span m="2579110">in</span> <span m="2579180">the</span> <span m="2579280">program.</span> <span m="2580290">So</span> <span m="2580440">that's</span> <span m="2580600">one</span> <span m="2580930">funny</span> <span m="2580980">thing</span> <span m="2581090">about</span> <span m="2581220">security,</span> <span m="2581900">there's</span> <span m="2582180">just</span> <span m="2582460">all</span> <span m="2582640">kinds</span> <span m="2582860">of</span> <span m="2582980">fun</span> <span m="2583220">strings</span> <span m="2583610">that</span> <span m="2583743">are</span> <span m="2583876">laying</span> <span m="2584010">around,</span> <span m="2584285">you</span> <span m="2584422">can</span> <span m="2584560">just</span> <span m="2584700">go</span> <span m="2584830">to</span> <span m="2585000">town</span> <span m="2585170">all</span> <span m="2585260">day</span> <span m="2585330">long.</span> <span m="2585400">Well</span> <span m="2585760">let's</span> <span m="2585950">suppose</span> <span m="2586240">we</span> <span m="2586336">live</span> <span m="2586433">in</span> <span m="2586530">bizarro</span> <span m="2587030">world</span> <span m="2587610">and</span> <span m="2587720">like</span> <span m="2587880">this</span> <span m="2588060">string</span> <span m="2588380">is</span> <span m="2588500">not</span> <span m="2588690">in</span> <span m="2588760">the</span> <span m="2588850">program.</span> <span m="2589550">So</span> <span m="2589990">does</span> <span m="2590100">anyone</span> <span m="2590280">have</span> <span m="2590440">any</span> <span m="2590520">ideas</span> <span m="2590860">about</span> <span m="2591090">what</span> <span m="2591220">we</span> <span m="2591320">could</span> <span m="2591460">do</span> <span m="2591670">to</span> <span m="2591990">get</span> <span m="2592170">that</span> <span m="2592320">string</span> <span m="2592443">to</span> <span m="2592566">be</span> <span m="2592690">in</span> <span m="2592800">the</span> <span m="2592880">program?</span> </p>
<p><span m="2593818">AUDIENCE:</span> <span m="2594266">We</span> <span m="2594355">can</span> <span m="2594445">put</span> <span m="2594534">the</span> <span m="2594624">string</span> <span m="2594714">on</span> <span m="2594863">the</span> <span m="2595012">[INAUDIBLE].</span> </p>
<p><span m="2595162">PROFESSOR;</span> <span m="2595610">Yes</span> <span m="2596120">exactly,</span> <span m="2596580">don't</span> <span m="2596760">trust</span> <span m="2596970">that</span> <span m="2597300">man.</span> <span m="2597450">That's</span> <span m="2597510">what</span> <span m="2597570">you</span> <span m="2597680">can</span> <span m="2597770">do,</span> <span m="2597890">exactly.</span> <span m="2598540">So,</span> <span m="2599880">what</span> <span m="2600050">you</span> <span m="2600160">can</span> <span m="2600400">do</span> <span m="2600760">is</span> <span m="2600900">actually</span> <span m="2602190">for</span> <span m="2602340">here,</span> <span m="2603060">have</span> <span m="2603380">the</span> <span m="2603550">address</span> <span m="2604605">of</span> <span m="2604980">bash</span> <span m="2605360">path,</span> <span m="2606550">actually</span> <span m="2608380">point</span> <span m="2608700">here,</span> <span m="2609730">right.</span> <span m="2609990">And</span> <span m="2610380">then</span> <span m="2610536">you'd</span> <span m="2610693">put--</span> <span m="2611170">up</span> <span m="2611340">here</span> <span m="2611550">you</span> <span m="2611800">would</span> <span m="2611980">put</span> <span m="2612430">slash</span> <span m="2612930">B-I-N</span> <span m="2615890">slash</span> <span m="2616630">P-A-T</span> <span m="2619800">slash</span> <span m="2620100">0.</span> <span m="2621860">So</span> <span m="2621920">that's</span> <span m="2622035">how</span> <span m="2622150">you</span> <span m="2622300">can</span> <span m="2622450">get</span> <span m="2622580">around--</span> <span m="2623420">I</span> <span m="2623470">think</span> <span m="2623525">I</span> <span m="2623580">got</span> <span m="2623825">that</span> <span m="2623906">math</span> <span m="2623988">right,</span> <span m="2624070">because</span> <span m="2624350">each</span> <span m="2624490">one</span> <span m="2624620">of</span> <span m="2624670">these</span> <span m="2624890">is</span> <span m="2627150">4</span> <span m="2627360">bytes.</span> <span m="2628360">But</span> <span m="2628450">anyway,</span> <span m="2628640">so</span> <span m="2628950">you</span> <span m="2629290">have</span> <span m="2629460">the</span> <span m="2629630">pointer</span> <span m="2630480">go</span> <span m="2630640">up</span> <span m="2630780">here</span> <span m="2631360">and</span> <span m="2631510">then</span> <span m="2631710">boom,</span> <span m="2632170">you're</span> <span m="2632290">done.</span> </p>
<p><span m="2632730">So</span> <span m="2632820">now</span> <span m="2633340">you</span> <span m="2633440">can</span> <span m="2633570">actually</span> <span m="2634260">conjure</span> <span m="2634870">up</span> <span m="2635180">arguments</span> <span m="2635890">just</span> <span m="2636080">by</span> <span m="2636180">putting</span> <span m="2636510">them</span> <span m="2636740">in</span> <span m="2636960">the</span> <span m="2637830">shell</span> <span m="2637980">code.</span> <span m="2640690">Pretty</span> <span m="2641280">horrifying.</span> <span m="2642370">So</span> <span m="2643780">this</span> <span m="2644220">is</span> <span m="2644500">all</span> <span m="2645100">building</span> <span m="2645500">up</span> <span m="2645750">towards</span> <span m="2646060">the</span> <span m="2646280">full</span> <span m="2646580">BROP</span> <span m="2646880">attack,</span> <span m="2647630">right.</span> <span m="2647800">But</span> <span m="2647890">before</span> <span m="2647980">you</span> <span m="2648070">can</span> <span m="2648160">mention</span> <span m="2648395">the</span> <span m="2648630">full</span> <span m="2648760">BROP</span> <span m="2648990">attack,</span> <span m="2649380">you've</span> <span m="2649480">got</span> <span m="2649580">to</span> <span m="2649680">understand</span> <span m="2650300">how</span> <span m="2650440">you</span> <span m="2650600">just</span> <span m="2650760">chain</span> <span m="2651140">together</span> <span m="2651380">these</span> <span m="2651500">preexisting</span> <span m="2652080">things</span> <span m="2653000">in</span> <span m="2653160">the</span> <span m="2653220">code.</span> </p>
<p><span m="2656950">So</span> <span m="2657600">one</span> <span m="2657830">thing</span> <span m="2658060">to</span> <span m="2658080">note</span> <span m="2658540">is</span> <span m="2658760">that</span> <span m="2659170">when</span> <span m="2659300">I'm</span> <span m="2659430">setting</span> <span m="2659750">up</span> <span m="2659830">this</span> <span m="2659980">return</span> <span m="2660300">address</span> <span m="2660640">here,</span> <span m="2661200">I</span> <span m="2661300">just</span> <span m="2661480">said,</span> <span m="2661860">eh</span> <span m="2662150">just</span> <span m="2662295">put</span> <span m="2662440">some</span> <span m="2662590">junk</span> <span m="2662880">here,</span> <span m="2663170">it</span> <span m="2663500">doesn't</span> <span m="2663770">really</span> <span m="2663930">matter,</span> <span m="2664090">we</span> <span m="2664160">just</span> <span m="2664390">want</span> <span m="2664540">to</span> <span m="2664583">get</span> <span m="2664626">a</span> <span m="2664670">shell.</span> <span m="2665740">But</span> <span m="2666360">if</span> <span m="2666460">you're</span> <span m="2666640">the</span> <span m="2666770">attacker,</span> <span m="2667800">you</span> <span m="2667950">could</span> <span m="2668170">actually</span> <span m="2668770">set</span> <span m="2669100">this</span> <span m="2669270">return</span> <span m="2669730">address</span> <span m="2669880">to</span> <span m="2669990">something</span> <span m="2670420">that's</span> <span m="2670610">actually</span> <span m="2670930">useful,</span> <span m="2672170">right.</span> <span m="2672500">And</span> <span m="2672830">if</span> <span m="2672980">you</span> <span m="2673140">did</span> <span m="2673380">that,</span> <span m="2673970">you</span> <span m="2674140">could</span> <span m="2674270">actually</span> <span m="2674600">string</span> <span m="2675170">together</span> <span m="2675970">several</span> <span m="2676460">functions,</span> <span m="2678000">several</span> <span m="2678180">function</span> <span m="2678530">indications</span> <span m="2679080">in</span> <span m="2679150">a</span> <span m="2679280">row,</span> <span m="2680010">right.</span> <span m="2680310">That's</span> <span m="2680530">actually</span> <span m="2680830">very,</span> <span m="2681320">very</span> <span m="2681520">powerful,</span> <span m="2682400">right.</span> </p>
<p><span m="2682590">Because</span> <span m="2683040">in</span> <span m="2683140">particular,</span> <span m="2683630">if</span> <span m="2683880">we</span> <span m="2684150">literally</span> <span m="2684560">just</span> <span m="2684830">set</span> <span m="2685480">this</span> <span m="2685870">return</span> <span m="2686260">address</span> <span m="2686720">to</span> <span m="2686810">jump,</span> <span m="2687360">I</span> <span m="2687450">mean</span> <span m="2687630">it</span> <span m="2687720">may</span> <span m="2687930">be</span> <span m="2688050">that</span> <span m="2688170">when</span> <span m="2688290">we</span> <span m="2688410">ret</span> <span m="2688720">from</span> <span m="2688875">it,</span> <span m="2689030">like</span> <span m="2689180">the</span> <span m="2689260">program</span> <span m="2689570">crashes</span> <span m="2690050">on</span> <span m="2690150">it,</span> <span m="2690360">maybe</span> <span m="2690530">we</span> <span m="2690630">don't</span> <span m="2690850">want</span> <span m="2691080">that,</span> <span m="2691410">right.</span> <span m="2691740">So</span> <span m="2691870">can</span> <span m="2692005">actually</span> <span m="2692220">start</span> <span m="2692470">chaining</span> <span m="2692950">some</span> <span m="2693140">of</span> <span m="2693180">these</span> <span m="2693390">things</span> <span m="2693700">to</span> <span m="2693980">do</span> <span m="2694090">interesting</span> <span m="2694440">stuff.</span> </p>
<p><span m="2695980">So</span> <span m="2696580">let's</span> <span m="2696930">say</span> <span m="2697250">that</span> <span m="2697550">our</span> <span m="2697730">goal</span> <span m="2698500">is</span> <span m="2698680">that</span> <span m="2698790">we</span> <span m="2699010">want</span> <span m="2699250">to</span> <span m="2699370">call</span> <span m="2700590">system</span> <span m="2701370">an</span> <span m="2701740">arbitrary</span> <span m="2702330">number</span> <span m="2702630">of</span> <span m="2702710">times.</span> <span m="2703700">We</span> <span m="2703890">don't</span> <span m="2704090">just</span> <span m="2704155">want</span> <span m="2704220">to</span> <span m="2704260">do</span> <span m="2704335">it</span> <span m="2704410">one</span> <span m="2704650">time,</span> <span m="2704850">we're</span> <span m="2704980">going</span> <span m="2705090">to</span> <span m="2705200">it</span> <span m="2705275">a</span> <span m="2705350">arbitrary</span> <span m="2705490">number</span> <span m="2705630">of</span> <span m="2705770">times.</span> <span m="2706500">So</span> <span m="2706870">how</span> <span m="2707060">can</span> <span m="2707240">we</span> <span m="2707310">do</span> <span m="2707380">that?</span> <span m="2708180">Well,</span> <span m="2708340">we're</span> <span m="2708460">going</span> <span m="2708570">to</span> <span m="2708610">use</span> <span m="2709030">two</span> <span m="2709280">pieces</span> <span m="2709620">of</span> <span m="2709680">information</span> <span m="2710120">that</span> <span m="2710170">we</span> <span m="2710220">already</span> <span m="2710460">know</span> <span m="2710560">how</span> <span m="2710660">to</span> <span m="2710740">get,</span> <span m="2711030">right.</span> <span m="2711460">We</span> <span m="2711495">already</span> <span m="2711530">know</span> <span m="2711710">how</span> <span m="2711790">to</span> <span m="2711860">get</span> <span m="2712010">the</span> <span m="2712120">address</span> <span m="2712430">of</span> <span m="2712490">system,</span> <span m="2713610">right.</span> <span m="2713820">We</span> <span m="2713946">just</span> <span m="2714010">look</span> <span m="2714105">in</span> <span m="2714200">GDB</span> <span m="2714420">and</span> <span m="2714640">find</span> <span m="2714881">it.</span> <span m="2716090">We</span> <span m="2716270">also</span> <span m="2717080">know</span> <span m="2717670">how</span> <span m="2717780">to</span> <span m="2718010">find</span> <span m="2718290">the</span> <span m="2718410">address</span> <span m="2719305">of</span> <span m="2719610">that</span> <span m="2719810">string,</span> <span m="2720180">bin</span> <span m="2720390">flash</span> <span m="2720695">bash.</span> </p>
<p><span m="2721960">Now</span> <span m="2722770">to</span> <span m="2722890">actually</span> <span m="2723220">make</span> <span m="2723470">this</span> <span m="2723620">attack</span> <span m="2724020">work</span> <span m="2724520">using</span> <span m="2724770">multiple</span> <span m="2725220">calls</span> <span m="2725490">to</span> <span m="2725580">system,</span> <span m="2726220">we're</span> <span m="2726300">going</span> <span m="2726400">to</span> <span m="2726450">have</span> <span m="2726660">to</span> <span m="2726790">use</span> <span m="2727030">gadgets,</span> <span m="2727870">right.</span> <span m="2728310">This</span> <span m="2728345">is</span> <span m="2728380">getting</span> <span m="2728600">us</span> <span m="2728730">closer</span> <span m="2729170">to</span> <span m="2729630">what's</span> <span m="2729820">taking</span> <span m="2730080">place</span> <span m="2730650">in</span> <span m="2730790">the</span> <span m="2730880">BROP</span> <span m="2731175">paper.</span> <span m="2734210">So</span> <span m="2735210">what</span> <span m="2735370">we</span> <span m="2735470">need</span> <span m="2735690">to</span> <span m="2735800">do</span> <span m="2735910">now,</span> <span m="2736320">is</span> <span m="2736520">find</span> <span m="2737010">the</span> <span m="2737140">address</span> <span m="2737660">of</span> <span m="2739830">these</span> <span m="2740710">two</span> <span m="2741090">Op</span> <span m="2741380">codes.</span> </p>
<p><span m="2748070">Right,</span> <span m="2748440">so</span> <span m="2748620">what</span> <span m="2748760">is</span> <span m="2748840">this,</span> <span m="2749330">so</span> <span m="2749460">this</span> <span m="2749600">is</span> <span m="2749740">pop</span> <span m="2750300">in</span> <span m="2750420">EAX,</span> <span m="2751190">so</span> <span m="2751330">what</span> <span m="2751410">does</span> <span m="2751490">this</span> <span m="2751680">do?</span> <span m="2752110">This</span> <span m="2752290">just</span> <span m="2752520">takes</span> <span m="2754460">the</span> <span m="2754580">top</span> <span m="2754865">of</span> <span m="2755007">the</span> <span m="2755150">stack</span> <span m="2758050">and</span> <span m="2758230">then</span> <span m="2758300">it</span> <span m="2758370">puts</span> <span m="2758680">it</span> <span m="2759200">into</span> <span m="2759840">the</span> <span m="2760320">EAX</span> <span m="2760810">register.</span> <span m="2761810">And</span> <span m="2762310">what</span> <span m="2762590">is</span> <span m="2762690">the</span> <span m="2762810">ret</span> <span m="2762980">instruction</span> <span m="2763340">going</span> <span m="2763450">to</span> <span m="2763520">do?</span> <span m="2763910">It</span> <span m="2764260">just</span> <span m="2765060">pops</span> <span m="2766060">the</span> <span m="2766170">top</span> <span m="2766420">of</span> <span m="2766490">the</span> <span m="2766650">stack</span> <span m="2767980">and</span> <span m="2768160">then</span> <span m="2768290">puts</span> <span m="2768650">it</span> <span m="2769230">into</span> <span m="2771760">EIP,</span> <span m="2773800">instruction</span> <span m="2774300">pointer.</span> <span m="2775340">OK,</span> <span m="2776030">so</span> <span m="2776280">this</span> <span m="2776510">is</span> <span m="2776620">what's</span> <span m="2776800">known</span> <span m="2777010">as</span> <span m="2777110">a</span> <span m="2777160">gadget,</span> <span m="2777830">right.</span> <span m="2778060">This</span> <span m="2778190">is</span> <span m="2778280">like</span> <span m="2778430">a</span> <span m="2778500">small</span> <span m="2779010">set</span> <span m="2779470">of</span> <span m="2780260">assembly</span> <span m="2780720">instructions</span> <span m="2781030">that</span> <span m="2781340">the</span> <span m="2781810">attacker</span> <span m="2782100">can</span> <span m="2782390">use</span> <span m="2782850">to</span> <span m="2783600">build</span> <span m="2784000">these</span> <span m="2784180">larger</span> <span m="2784600">more</span> <span m="2784790">grandiose</span> <span m="2785290">attacks.</span> </p>
<p><span m="2785890">OK,</span> <span m="2786790">So</span> <span m="2788740">how</span> <span m="2788950">can</span> <span m="2789050">we</span> <span m="2789170">find</span> <span m="2789530">this</span> <span m="2789720">gadget,</span> <span m="2790190">right.</span> <span m="2790410">There's</span> <span m="2790570">actually</span> <span m="2790980">like</span> <span m="2791260">some</span> <span m="2791620">off</span> <span m="2791860">the</span> <span m="2791940">shelf</span> <span m="2792220">tools</span> <span m="2793140">that</span> <span m="2793570">hackers</span> <span m="2793900">use</span> <span m="2794150">to</span> <span m="2794190">find</span> <span m="2794390">these</span> <span m="2794590">things,</span> <span m="2795010">it's</span> <span m="2795180">not</span> <span m="2795350">hard</span> <span m="2795590">to</span> <span m="2795640">get</span> <span m="2795810">the</span> <span m="2795880">binary,</span> <span m="2796550">right.</span> <span m="2796890">Essentially</span> <span m="2797350">just</span> <span m="2797483">do</span> <span m="2797616">a</span> <span m="2797750">[INAUDIBLE]</span> <span m="2798150">for</span> <span m="2798233">these</span> <span m="2798316">types</span> <span m="2798400">of</span> <span m="2798510">things,</span> <span m="2798800">right.</span> <span m="2799570">So</span> <span m="2800270">it's</span> <span m="2800770">just</span> <span m="2801080">as</span> <span m="2801240">easy</span> <span m="2801400">to</span> <span m="2801470">find</span> <span m="2801800">one</span> <span m="2801950">of</span> <span m="2801990">these</span> <span m="2802170">gadgets,</span> <span m="2803070">assuming</span> <span m="2803780">that</span> <span m="2803970">you've</span> <span m="2804080">got</span> <span m="2804230">a</span> <span m="2804300">copy</span> <span m="2804610">of</span> <span m="2804760">the</span> <span m="2804910">binary</span> <span m="2805060">and</span> <span m="2805550">we're</span> <span m="2805660">not</span> <span m="2805830">worried</span> <span m="2805990">about</span> <span m="2806170">randomization</span> <span m="2806555">yet.</span> <span m="2806940">It's</span> <span m="2807400">very</span> <span m="2807900">easy</span> <span m="2808075">to</span> <span m="2808250">find</span> <span m="2808366">these</span> <span m="2808483">things.</span> <span m="2808600">Just</span> <span m="2808750">like</span> <span m="2808840">it's</span> <span m="2808960">very</span> <span m="2809270">easy</span> <span m="2809580">to</span> <span m="2809680">find</span> <span m="2809780">the</span> <span m="2809880">address</span> <span m="2809930">of</span> <span m="2809980">system</span> <span m="2810245">and</span> <span m="2810311">stuff</span> <span m="2810377">like</span> <span m="2810443">that.</span> </p>
<p><span m="2811420">So</span> <span m="2812240">if</span> <span m="2812440">we've</span> <span m="2812640">got</span> <span m="2812920">one</span> <span m="2813030">of</span> <span m="2813070">these</span> <span m="2813270">gadgets,</span> <span m="2814220">what</span> <span m="2814500">can</span> <span m="2815000">we</span> <span m="2815095">use</span> <span m="2815190">this</span> <span m="2815500">gadget</span> <span m="2815550">to</span> <span m="2815600">do?</span> <span m="2816020">Well</span> <span m="2816230">of</span> <span m="2816350">course</span> <span m="2816630">the</span> <span m="2816780">answer</span> <span m="2817800">is</span> <span m="2817980">evil.</span> <span m="2818560">So,</span> <span m="2819250">what</span> <span m="2819390">we</span> <span m="2819550">can</span> <span m="2819920">do</span> <span m="2822110">is</span> <span m="2822560">the</span> <span m="2822640">following.</span> </p>
<p><span m="2825480">Let's</span> <span m="2825730">say</span> <span m="2826140">that</span> <span m="2827270">we</span> <span m="2827490">changed</span> <span m="2827930">the</span> <span m="2828030">stack</span> <span m="2829410">so</span> <span m="2830010">that</span> <span m="2830210">it</span> <span m="2830410">looks</span> <span m="2830720">like</span> <span m="2831200">this.</span> <span m="2839500">So</span> <span m="2839640">the</span> <span m="2839750">exploit</span> <span m="2840230">goes</span> <span m="2840350">this</span> <span m="2840690">way.</span> <span m="2842470">And</span> <span m="2842490">so</span> <span m="2842610">let's</span> <span m="2842880">say,</span> <span m="2843780">we</span> <span m="2844010">do</span> <span m="2844280">this.</span> <span m="2846360">So</span> <span m="2846410">the</span> <span m="2846490">first</span> <span m="2846820">thing</span> <span m="2847000">we're</span> <span m="2847120">going</span> <span m="2847230">to</span> <span m="2847300">put</span> <span m="2847510">here</span> <span m="2848310">is</span> <span m="2848460">the</span> <span m="2848610">address</span> <span m="2849370">of</span> <span m="2849830">system.</span> <span m="2852960">And</span> <span m="2853110">the</span> <span m="2853260">thing</span> <span m="2853430">we're</span> <span m="2853550">going</span> <span m="2853660">to</span> <span m="2853760">put</span> <span m="2854070">up</span> <span m="2854250">here,</span> <span m="2855380">is</span> <span m="2855880">the</span> <span m="2856660">address</span> <span m="2859860">of</span> <span m="2860050">the</span> <span m="2860240">pop</span> <span m="2860570">ret</span> <span m="2860820">gadget.</span> <span m="2865750">Then</span> <span m="2865900">up</span> <span m="2866050">here,</span> <span m="2868040">we're</span> <span m="2868170">going</span> <span m="2868440">to</span> <span m="2868540">put</span> <span m="2869240">the</span> <span m="2869630">address</span> <span m="2872424">of</span> <span m="2872910">bash</span> <span m="2873390">path</span> <span m="2878180">and</span> <span m="2878340">then</span> <span m="2878440">we're</span> <span m="2878560">going</span> <span m="2878660">to</span> <span m="2878730">repeat</span> <span m="2879120">this</span> <span m="2879300">pattern.</span> <span m="2880080">So</span> <span m="2880340">we're</span> <span m="2880460">going</span> <span m="2880570">to</span> <span m="2880660">put</span> <span m="2881260">the</span> <span m="2883390">address</span> <span m="2884290">of</span> <span m="2884550">system,</span> <span m="2890620">the</span> <span m="2891050">address</span> <span m="2893890">of</span> <span m="2894105">the</span> <span m="2894320">pop</span> <span m="2894555">ret</span> <span m="2894790">gadget,</span> <span m="2899890">and</span> <span m="2900240">then</span> <span m="2900490">the</span> <span m="2900650">address</span> <span m="2903720">of</span> <span m="2903860">bash</span> <span m="2904075">path.</span> </p>
<p><span m="2909880">OK,</span> <span m="2910360">so</span> <span m="2910580">what's</span> <span m="2910790">going</span> <span m="2910900">to</span> <span m="2910950">happen</span> <span m="2911260">here</span> <span m="2911400">now?</span> <span m="2911960">Now</span> <span m="2912260">this</span> <span m="2912450">is</span> <span m="2912520">going</span> <span m="2912640">to</span> <span m="2912700">be</span> <span m="2913000">a</span> <span m="2913060">bit</span> <span m="2913240">tricky,</span> <span m="2914440">and</span> <span m="2914770">these</span> <span m="2914846">lecture</span> <span m="2914923">notes</span> <span m="2914961">are</span> <span m="2915000">going</span> <span m="2915120">to</span> <span m="2915180">be</span> <span m="2915400">up</span> <span m="2915550">on</span> <span m="2915630">the</span> <span m="2915730">web,</span> <span m="2915945">so</span> <span m="2916160">you</span> <span m="2916230">may</span> <span m="2916300">just</span> <span m="2916490">want</span> <span m="2916750">to</span> <span m="2916960">listen</span> <span m="2917210">to</span> <span m="2917270">what's</span> <span m="2917430">happening,</span> <span m="2918060">but</span> <span m="2918190">this--</span> <span m="2918800">when</span> <span m="2918960">I</span> <span m="2919070">first</span> <span m="2919400">understood</span> <span m="2919830">this,</span> <span m="2920230">this</span> <span m="2920310">was</span> <span m="2920390">like</span> <span m="2920640">understanding</span> <span m="2921120">that</span> <span m="2921180">Santa</span> <span m="2921425">Claus</span> <span m="2921670">wasn't</span> <span m="2921900">real</span> <span m="2922110">right.</span> <span m="2922850">So</span> <span m="2923250">what</span> <span m="2923490">will</span> <span m="2923620">happen</span> <span m="2924300">is--</span> <span m="2924520">and</span> <span m="2924578">by</span> <span m="2924636">the</span> <span m="2924753">way,</span> <span m="2924870">Santa</span> <span m="2925015">Claus</span> <span m="2925160">isn't</span> <span m="2925450">real,</span> <span m="2925800">I</span> <span m="2925890">hope</span> <span m="2925980">I</span> <span m="2926070">didn't</span> <span m="2926300">ruin</span> <span m="2926383">it</span> <span m="2926467">for</span> <span m="2926551">everyone.</span> </p>
<p><span m="2926970">So</span> <span m="2927680">what's</span> <span m="2927870">going</span> <span m="2927960">to</span> <span m="2928000">happen?</span> <span m="2928530">So</span> <span m="2928860">[INAUDIBLE]</span> <span m="2929210">is</span> <span m="2929243">what</span> <span m="2929276">puts</span> <span m="2929310">this</span> <span m="2929620">in</span> <span m="2929850">memory.</span> <span m="2930760">So</span> <span m="2931810">we're</span> <span m="2931900">going</span> <span m="2932000">to</span> <span m="2932060">start</span> <span m="2932510">here,</span> <span m="2933000">OK.</span> <span m="2933250">So</span> <span m="2933310">what's</span> <span m="2933370">going</span> <span m="2933500">to</span> <span m="2933550">happen?</span> <span m="2933920">We're</span> <span m="2934330">going</span> <span m="2934560">to</span> <span m="2934720">return</span> <span m="2935170">to</span> <span m="2935280">system,</span> <span m="2936510">the</span> <span m="2936625">ret</span> <span m="2936740">instruction</span> <span m="2937075">is</span> <span m="2937410">going</span> <span m="2937490">to</span> <span m="2937550">pop</span> <span m="2937925">an</span> <span m="2938112">entry</span> <span m="2938300">off</span> <span m="2938436">the</span> <span m="2938573">stack,</span> <span m="2939350">now</span> <span m="2939530">the</span> <span m="2939630">top</span> <span m="2939890">of</span> <span m="2939940">the</span> <span m="2940030">stack</span> <span m="2940385">pointers</span> <span m="2940740">here.</span> </p>
<p><span m="2942130">OK,</span> <span m="2942510">so</span> <span m="2942970">system</span> <span m="2943540">is</span> <span m="2943670">going</span> <span m="2943850">to</span> <span m="2943910">find</span> <span m="2944560">its</span> <span m="2944740">argument</span> <span m="2945200">here,</span> <span m="2946510">it's</span> <span m="2946660">going</span> <span m="2946770">to</span> <span m="2946820">execute</span> <span m="2947210">the</span> <span m="2947270">shell.</span> <span m="2948110">Then</span> <span m="2948630">it's</span> <span m="2948780">going</span> <span m="2949070">to</span> <span m="2949410">finish</span> <span m="2949850">and</span> <span m="2950030">return</span> <span m="2950850">to</span> <span m="2950990">whatever's</span> <span m="2951490">here,</span> <span m="2951740">which</span> <span m="2951900">is</span> <span m="2952000">the</span> <span m="2952060">pop</span> <span m="2952192">gadget.</span> <span m="2953070">In</span> <span m="2953240">executing</span> <span m="2953710">that</span> <span m="2953890">return,</span> <span m="2955490">we</span> <span m="2955570">change</span> <span m="2955840">the</span> <span m="2955930">top</span> <span m="2956180">of</span> <span m="2956230">the</span> <span m="2956300">stack</span> <span m="2956660">pointer</span> <span m="2956753">to</span> <span m="2956846">be</span> <span m="2956940">here.</span> <span m="2957770">OK,</span> <span m="2958370">now</span> <span m="2958770">we</span> <span m="2958930">are</span> <span m="2959080">in</span> <span m="2959160">the</span> <span m="2959280">pop</span> <span m="2959580">ret</span> <span m="2959620">gadget.</span> </p>
<p><span m="2960770">OK,</span> <span m="2961040">so</span> <span m="2961190">what</span> <span m="2961380">is</span> <span m="2961480">that</span> <span m="2961710">pop</span> <span m="2961930">ret</span> <span m="2962150">gadget</span> <span m="2962313">going</span> <span m="2962476">to</span> <span m="2962640">do?</span> <span m="2963190">It's</span> <span m="2963340">going</span> <span m="2963440">to</span> <span m="2963510">pop</span> <span m="2963930">what's</span> <span m="2964070">on</span> <span m="2964170">the</span> <span m="2964270">stack,</span> <span m="2965080">which</span> <span m="2965300">is</span> <span m="2965460">this,</span> <span m="2966150">OK.</span> <span m="2966700">So</span> <span m="2966830">now</span> <span m="2967090">the</span> <span m="2968280">top</span> <span m="2968500">of</span> <span m="2968560">the</span> <span m="2968630">stack</span> <span m="2968950">is</span> <span m="2969070">here.</span> <span m="2969890">Then</span> <span m="2970310">we're</span> <span m="2970430">now</span> <span m="2970770">in</span> <span m="2970855">the</span> <span m="2970940">ret</span> <span m="2971110">instruction</span> <span m="2971240">from</span> <span m="2971640">the</span> <span m="2971850">pop</span> <span m="2972090">ret</span> <span m="2972330">gadget.</span> <span m="2973100">What's</span> <span m="2973390">this</span> <span m="2973440">going</span> <span m="2973490">to</span> <span m="2973560">do?</span> <span m="2973730">Aha,</span> <span m="2974650">it's</span> <span m="2974770">going</span> <span m="2974880">to</span> <span m="2974960">call</span> <span m="2975340">system</span> <span m="2975700">again,</span> <span m="2976570">right.</span> </p>
<p><span m="2977060">So</span> <span m="2978340">once</span> <span m="2978610">again</span> <span m="2978900">the</span> <span m="2979070">ret</span> <span m="2979360">is</span> <span m="2979490">going</span> <span m="2979590">to</span> <span m="2979660">pop</span> <span m="2980170">this</span> <span m="2980420">off</span> <span m="2980680">this</span> <span m="2980900">stack,</span> <span m="2981400">we</span> <span m="2981470">are</span> <span m="2981540">now</span> <span m="2981610">in</span> <span m="2981680">system.</span> <span m="2982690">Top</span> <span m="2982950">of</span> <span m="2983010">the</span> <span m="2983090">stack</span> <span m="2983450">is</span> <span m="2983637">here,</span> <span m="2984420">system</span> <span m="2984710">is</span> <span m="2984820">going--</span> <span m="2985100">this</span> <span m="2985196">will</span> <span m="2985293">trigger</span> <span m="2985390">calling</span> <span m="2985830">frame,</span> <span m="2986060">the</span> <span m="2986130">system.</span> <span m="2986810">System</span> <span m="2987140">takes</span> <span m="2987440">the</span> <span m="2987740">bash</span> <span m="2988090">path</span> <span m="2988320">argument</span> <span m="2988700">here.</span> <span m="2989466">OK,</span> <span m="2989850">and</span> <span m="2990090">then</span> <span m="2990500">it</span> <span m="2990860">is</span> <span m="2991220">going</span> <span m="2991463">to</span> <span m="2991707">ret,</span> <span m="2992194">right.</span> <span m="2992681">Where's</span> <span m="2992925">it</span> <span m="2993170">going</span> <span m="2993280">to</span> <span m="2993360">ret</span> <span m="2993560">to?</span> <span m="2993980">The</span> <span m="2994100">pop</span> <span m="2994550">ret</span> <span m="2994760">gadget</span> <span m="2995040">again.</span> </p>
<p><span m="2995740">So</span> <span m="2995940">the</span> <span m="2996120">ret</span> <span m="2996470">pops</span> <span m="2996800">the</span> <span m="2996910">stack,</span> <span m="2997730">we</span> <span m="2997890">are</span> <span m="2997977">now</span> <span m="2998065">in</span> <span m="2998152">the</span> <span m="2998300">pop</span> <span m="2998510">ret</span> <span m="2998720">gadget,</span> <span m="2999430">the</span> <span m="2999560">ret</span> <span m="2999767">gadget--</span> <span m="3000390">sorry,</span> <span m="3000850">the</span> <span m="3000972">pop</span> <span m="3001095">ret</span> <span m="3001217">gadget</span> <span m="3001340">is</span> <span m="3001500">going</span> <span m="3001570">to</span> <span m="3001640">pop</span> <span m="3002190">this,</span> <span m="3003590">so</span> <span m="3003890">on</span> <span m="3003995">and</span> <span m="3004100">so</span> <span m="3004550">forth.</span> <span m="3005460">OK?</span> <span m="3006050">So</span> <span m="3006320">clearly</span> <span m="3006720">we</span> <span m="3006850">can</span> <span m="3007260">chain</span> <span m="3007750">this</span> <span m="3007850">sequence</span> <span m="3008760">to</span> <span m="3008920">execute</span> <span m="3009175">an</span> <span m="3009430">arbitrary</span> <span m="3009970">number</span> <span m="3010270">of</span> <span m="3010380">things,</span> <span m="3011850">right.</span> <span m="3012350">And</span> <span m="3012550">so</span> <span m="3013200">this</span> <span m="3013610">in</span> <span m="3013790">essence</span> <span m="3014740">is</span> <span m="3014980">starting</span> <span m="3015380">to</span> <span m="3015426">get</span> <span m="3015473">to</span> <span m="3015520">the</span> <span m="3015620">core</span> <span m="3015950">of</span> <span m="3016115">what</span> <span m="3016280">return</span> <span m="3016700">oriented</span> <span m="3017100">programming</span> <span m="3017570">is.</span> </p>
<p><span m="3018420">Note</span> <span m="3018980">that</span> <span m="3019140">we</span> <span m="3019350">have</span> <span m="3019530">not</span> <span m="3019990">executed</span> <span m="3020720">anything</span> <span m="3021180">in</span> <span m="3021270">the</span> <span m="3021360">stack,</span> <span m="3022590">right.</span> <span m="3023060">This</span> <span m="3023210">is</span> <span m="3023330">what</span> <span m="3023480">has</span> <span m="3023600">allowed</span> <span m="3024150">us</span> <span m="3024510">to</span> <span m="3024670">get</span> <span m="3025140">beyond</span> <span m="3025790">those</span> <span m="3026030">data</span> <span m="3026350">execution</span> <span m="3026890">prevention</span> <span m="3027400">bits,</span> <span m="3027970">right.</span> <span m="3028150">Nothing's</span> <span m="3028260">been</span> <span m="3028360">executed</span> <span m="3028830">here.</span> <span m="3029690">We're</span> <span m="3029840">just</span> <span m="3030030">sort</span> <span m="3030210">of</span> <span m="3030340">jumping</span> <span m="3031060">to</span> <span m="3031280">things</span> <span m="3031605">in</span> <span m="3031930">unexpected</span> <span m="3032570">ways</span> <span m="3033150">to</span> <span m="3033260">do</span> <span m="3033630">what</span> <span m="3033680">we</span> <span m="3033730">want</span> <span m="3033870">to</span> <span m="3033950">do.</span> </p>
<p><span m="3035300">OK</span> <span m="3035740">so</span> <span m="3035850">this</span> <span m="3035960">is</span> <span m="3036080">actually</span> <span m="3036380">very,</span> <span m="3036850">very,</span> <span m="3037110">very,</span> <span m="3037250">clever.</span> <span m="3039350">And</span> <span m="3039540">so</span> <span m="3040040">what's</span> <span m="3040250">interesting</span> <span m="3040670">is</span> <span m="3040760">that</span> <span m="3040860">at</span> <span m="3040960">a</span> <span m="3040990">high</span> <span m="3041300">level</span> <span m="3041620">you</span> <span m="3041680">can</span> <span m="3041830">think</span> <span m="3042040">about</span> <span m="3042310">us,</span> <span m="3042780">we've</span> <span m="3043280">now</span> <span m="3043720">defined</span> <span m="3044230">this</span> <span m="3044400">new</span> <span m="3044630">model</span> <span m="3044990">for</span> <span m="3045070">computation,</span> <span m="3045770">right.</span> <span m="3046180">So</span> <span m="3046410">in</span> <span m="3046495">a</span> <span m="3046580">traditional,</span> <span m="3047120">non-malicious</span> <span m="3047750">program,</span> <span m="3048450">you</span> <span m="3048590">have</span> <span m="3048820">the</span> <span m="3048910">instruction</span> <span m="3049440">pointer</span> <span m="3050020">that</span> <span m="3050390">points</span> <span m="3050680">to</span> <span m="3050770">some</span> <span m="3051000">linear</span> <span m="3051300">sequence</span> <span m="3051640">of</span> <span m="3051740">instructions.</span> <span m="3052030">And</span> <span m="3052320">you</span> <span m="3052710">increment</span> <span m="3052930">the</span> <span m="3053150">instruction</span> <span m="3053450">pointer</span> <span m="3053910">to</span> <span m="3053980">figure</span> <span m="3054180">out</span> <span m="3054240">what's</span> <span m="3054340">the</span> <span m="3054440">next</span> <span m="3054730">thing</span> <span m="3054850">to</span> <span m="3054970">do.</span> <span m="3056030">In</span> <span m="3056280">essence,</span> <span m="3057020">what</span> <span m="3057070">return</span> <span m="3057470">oriented</span> <span m="3057860">programing</span> <span m="3058350">does</span> <span m="3058610">is,</span> <span m="3058720">it</span> <span m="3058890">uses</span> <span m="3059440">the</span> <span m="3059560">stack</span> <span m="3060150">pointer</span> <span m="3061020">as</span> <span m="3061230">the</span> <span m="3061340">instruction</span> <span m="3061615">pointer.</span> </p>
<p><span m="3062720">Right,</span> <span m="3063110">so</span> <span m="3063400">as</span> <span m="3063720">we</span> <span m="3063900">move</span> <span m="3064380">the</span> <span m="3064510">stack</span> <span m="3064990">pointer,</span> <span m="3065540">we're</span> <span m="3066830">pointing</span> <span m="3067470">to</span> <span m="3067690">like</span> <span m="3067970">other</span> <span m="3068220">blocks</span> <span m="3068700">of</span> <span m="3068810">code</span> <span m="3069230">that</span> <span m="3069330">we're</span> <span m="3069460">going</span> <span m="3069560">to</span> <span m="3069610">execute.</span> <span m="3070720">And</span> <span m="3070830">then</span> <span m="3071190">at</span> <span m="3071300">the</span> <span m="3071410">end</span> <span m="3071440">of</span> <span m="3071470">the</span> <span m="3071500">gadget,</span> <span m="3072180">you</span> <span m="3072360">return</span> <span m="3072760">back</span> <span m="3073110">to</span> <span m="3073155">the</span> <span m="3073200">stack</span> <span m="3073580">pointer</span> <span m="3074010">which</span> <span m="3074123">is</span> <span m="3074236">then</span> <span m="3074350">going</span> <span m="3074445">to</span> <span m="3074540">tell</span> <span m="3074635">us</span> <span m="3074730">the</span> <span m="3074860">next</span> <span m="3075220">block</span> <span m="3075450">of</span> <span m="3075530">code</span> <span m="3075760">to</span> <span m="3075830">execute.</span> <span m="3077550">OK</span> <span m="3077840">so</span> <span m="3077960">that</span> <span m="3078390">does</span> <span m="3078480">that</span> <span m="3078650">make</span> <span m="3078860">sense?</span> <span m="3086220">So</span> <span m="3086400">that's</span> <span m="3086740">basically</span> <span m="3087600">how</span> <span m="3087800">you</span> <span m="3087960">can</span> <span m="3088110">avoid</span> <span m="3088590">the</span> <span m="3088900">data</span> <span m="3089510">execution</span> <span m="3089785">prevention</span> <span m="3090060">stuff.</span> </p>
<p><span m="3090570">That's</span> <span m="3090720">how</span> <span m="3090790">you</span> <span m="3090930">can</span> <span m="3091140">get</span> <span m="3091260">around</span> <span m="3091880">having</span> <span m="3092190">this</span> <span m="3092890">no</span> <span m="3093040">execute</span> <span m="3093300">bit</span> <span m="3094080">on</span> <span m="3094570">pages.</span> <span m="3096170">So</span> <span m="3096330">the</span> <span m="3096440">next</span> <span m="3096780">thing</span> <span m="3096940">that</span> <span m="3097055">we</span> <span m="3097170">might</span> <span m="3097390">want</span> <span m="3097520">to</span> <span m="3097610">do</span> <span m="3098120">is</span> <span m="3098430">defeat</span> <span m="3098640">stack</span> <span m="3098985">canaries.</span> <span m="3099710">So</span> <span m="3099796">if</span> <span m="3099883">you</span> <span m="3099970">remember,</span> <span m="3100590">this</span> <span m="3100810">canary</span> <span m="3101710">was</span> <span m="3101990">this</span> <span m="3102220">value</span> <span m="3102740">that</span> <span m="3102910">we</span> <span m="3102985">were</span> <span m="3103060">going</span> <span m="3103170">to</span> <span m="3103240">place</span> <span m="3103600">on</span> <span m="3103720">the</span> <span m="3103800">stack,</span> <span m="3105260">right.</span> <span m="3105510">So</span> <span m="3105590">you</span> <span m="3105660">can</span> <span m="3105780">imagine</span> <span m="3107370">the</span> <span m="3107480">canary</span> <span m="3107890">would</span> <span m="3108620">go</span> <span m="3108820">right</span> <span m="3109040">here</span> <span m="3109320">for</span> <span m="3109450">example,</span> <span m="3109910">or</span> <span m="3109950">right</span> <span m="3110150">here,</span> <span m="3110640">and</span> <span m="3110720">it</span> <span m="3110800">would</span> <span m="3110950">prevent</span> <span m="3111590">someone</span> <span m="3112230">from</span> <span m="3112500">overriding</span> <span m="3113040">the</span> <span m="3113130">return</span> <span m="3113500">address,</span> <span m="3113970">without</span> <span m="3114280">also</span> <span m="3114560">overwriting</span> <span m="3115150">the</span> <span m="3115200">canary.</span> </p>
<p><span m="3116370">With</span> <span m="3116770">the</span> <span m="3116880">intuition</span> <span m="3117400">being</span> <span m="3118030">that</span> <span m="3118600">before</span> <span m="3119300">the</span> <span m="3119440">system</span> <span m="3119870">actually</span> <span m="3120350">jumps</span> <span m="3120700">to</span> <span m="3120780">the</span> <span m="3120890">ret</span> <span m="3121060">address,</span> <span m="3121680">it</span> <span m="3121770">can</span> <span m="3121950">check</span> <span m="3122330">to</span> <span m="3122410">see</span> <span m="3122710">if</span> <span m="3122795">the</span> <span m="3122880">canary</span> <span m="3123720">has</span> <span m="3124030">been</span> <span m="3124290">changed</span> <span m="3124890">in</span> <span m="3125110">a</span> <span m="3125180">way</span> <span m="3125370">that's</span> <span m="3125840">incorrect.</span> <span m="3127380">So</span> <span m="3127530">that's</span> <span m="3127680">how</span> <span m="3127760">the</span> <span m="3127840">canary</span> <span m="3128160">works,</span> <span m="3129130">but</span> <span m="3129490">can</span> <span m="3129720">we</span> <span m="3129850">get</span> <span m="3129990">around</span> <span m="3130290">the</span> <span m="3130590">canary?</span> <span m="3131060">Can</span> <span m="3131250">we</span> <span m="3131370">guess</span> <span m="3131720">the</span> <span m="3131820">canary</span> <span m="3132170">somehow?</span> <span m="3133250">Well</span> <span m="3133490">we</span> <span m="3133640">can</span> <span m="3134140">actually,</span> <span m="3135220">if</span> <span m="3135370">we</span> <span m="3135480">make</span> <span m="3135950">a</span> <span m="3136450">few</span> <span m="3136750">assumptions</span> <span m="3137950">about</span> <span m="3138670">how</span> <span m="3138940">the</span> <span m="3139040">system</span> <span m="3139540">works.</span> </p>
<p><span m="3142110">So,</span> <span m="3150750">how</span> <span m="3150930">do</span> <span m="3151100">we</span> <span m="3151160">defeat</span> <span m="3151285">those</span> <span m="3151410">canaries?</span> <span m="3156160">So</span> <span m="3156310">the</span> <span m="3156400">first</span> <span m="3156750">thing</span> <span m="3156930">that</span> <span m="3157210">we</span> <span m="3158590">want</span> <span m="3158930">to</span> <span m="3159040">assume</span> <span m="3161700">is,</span> <span m="3162120">that</span> <span m="3163470">the</span> <span m="3163560">server,</span> <span m="3166730">it</span> <span m="3166810">has</span> <span m="3166990">to</span> <span m="3167100">have</span> <span m="3167255">a</span> <span m="3167410">buffer</span> <span m="3167760">overflow</span> <span m="3168250">vulnerability.</span> </p>
<p><span m="3173420">The</span> <span m="3173530">second</span> <span m="3173970">thing</span> <span m="3174270">that</span> <span m="3174420">we're</span> <span m="3174570">going</span> <span m="3174830">to</span> <span m="3174950">assume,</span> <span m="3178140">is</span> <span m="3178360">that</span> <span m="3178850">the</span> <span m="3178980">server</span> <span m="3180390">is</span> <span m="3180590">going</span> <span m="3180930">to</span> <span m="3181780">crash</span> <span m="3184390">and</span> <span m="3184770">respond,</span> <span m="3187170">just</span> <span m="3187300">restart,</span> <span m="3190610">if</span> <span m="3190790">we</span> <span m="3190900">set</span> <span m="3191290">the</span> <span m="3191435">canary</span> <span m="3192650">value</span> <span m="3192960">to</span> <span m="3193070">a</span> <span m="3193165">bad</span> <span m="3193260">one.</span> </p>
<p><span m="3199600">And</span> <span m="3199790">the</span> <span m="3199880">third</span> <span m="3200320">thing</span> <span m="3200490">that</span> <span m="3200610">we're</span> <span m="3200730">going</span> <span m="3200940">to</span> <span m="3201090">assume</span> <span m="3202060">is</span> <span m="3202496">that,</span> <span m="3204910">after</span> <span m="3207890">the</span> <span m="3208120">restart,</span> <span m="3212180">that</span> <span m="3212350">the</span> <span m="3213010">canary</span> <span m="3215950">and</span> <span m="3216330">any</span> <span m="3216830">address</span> <span m="3217600">space</span> <span m="3219280">randomization</span> <span m="3220050">that</span> <span m="3220200">you're</span> <span m="3220300">doing,</span> <span m="3221590">is</span> <span m="3221810">not</span> <span m="3222260">rerandomized.</span> </p>
<p><span m="3229210">Right,</span> <span m="3229480">so</span> <span m="3229580">what</span> <span m="3229750">that</span> <span m="3229950">means</span> <span m="3230230">is</span> <span m="3230360">that,</span> <span m="3230760">we're</span> <span m="3230850">going</span> <span m="3231050">to</span> <span m="3231110">assume</span> <span m="3231450">that</span> <span m="3231610">if</span> <span m="3231790">we</span> <span m="3231880">can</span> <span m="3232010">somehow</span> <span m="3232340">crash</span> <span m="3232550">the</span> <span m="3232760">server,</span> <span m="3233370">then</span> <span m="3233520">when</span> <span m="3233625">the</span> <span m="3233730">server</span> <span m="3234060">restarts,</span> <span m="3234890">it's</span> <span m="3235050">going</span> <span m="3235160">to</span> <span m="3235230">have</span> <span m="3235520">the</span> <span m="3235600">same</span> <span m="3236020">value</span> <span m="3236390">for</span> <span m="3236530">the</span> <span m="3236650">canary.</span> <span m="3237030">And</span> <span m="3237420">it's</span> <span m="3237630">going</span> <span m="3237740">to</span> <span m="3237810">have</span> <span m="3238330">the</span> <span m="3238420">same</span> <span m="3238830">locations</span> <span m="3239840">for</span> <span m="3239990">all</span> <span m="3240180">the</span> <span m="3240280">quote</span> <span m="3240520">unquote</span> <span m="3240695">"randomized"</span> <span m="3242030">stack,</span> <span m="3242780">heap</span> <span m="3242925">and</span> <span m="3243070">code</span> <span m="3243650">information</span> <span m="3244030">that</span> <span m="3244153">it</span> <span m="3244276">has.</span> </p>
<p><span m="3245140">So</span> <span m="3245260">you</span> <span m="3245300">might</span> <span m="3245490">wonder</span> <span m="3246160">why</span> <span m="3247200">would</span> <span m="3247420">this</span> <span m="3247610">be</span> <span m="3247735">the</span> <span m="3247860">case?</span> <span m="3248820">Why</span> <span m="3249030">would</span> <span m="3249330">it</span> <span m="3249410">be</span> <span m="3249490">that</span> <span m="3249616">when</span> <span m="3249743">the</span> <span m="3249870">server</span> <span m="3250140">comes</span> <span m="3250330">back</span> <span m="3250580">it</span> <span m="3250630">doesn't</span> <span m="3250850">have</span> <span m="3251040">new</span> <span m="3251130">locations</span> <span m="3251650">for</span> <span m="3251740">things?</span> <span m="3252390">The</span> <span m="3252420">reason</span> <span m="3252820">is</span> <span m="3252930">because</span> <span m="3253250">a</span> <span m="3253320">lot</span> <span m="3253540">of</span> <span m="3253620">servers</span> <span m="3254020">are</span> <span m="3254110">written</span> <span m="3254365">to</span> <span m="3254492">use</span> <span m="3254620">fork,</span> <span m="3255620">to</span> <span m="3255710">create</span> <span m="3256120">new</span> <span m="3256830">processes.</span> <span m="3257950">And</span> <span m="3258020">if</span> <span m="3258090">you</span> <span m="3258220">remember,</span> <span m="3259220">fork</span> <span m="3259750">actually</span> <span m="3260260">inherits--</span> <span m="3261870">the</span> <span m="3262030">child</span> <span m="3262570">inherits</span> <span m="3263080">the</span> <span m="3263200">address</span> <span m="3263580">space</span> <span m="3264810">of</span> <span m="3264870">the</span> <span m="3264930">address</span> <span m="3265150">space</span> <span m="3265360">layout</span> <span m="3265780">right</span> <span m="3266100">of</span> <span m="3266250">the</span> <span m="3266700">parent,</span> <span m="3267380">right.</span> <span m="3267660">This</span> <span m="3267760">is</span> <span m="3267890">copy</span> <span m="3268095">on</span> <span m="3268300">write</span> <span m="3268800">pages</span> <span m="3268870">that</span> <span m="3268940">change</span> <span m="3269250">stuff</span> <span m="3269985">as</span> <span m="3270560">the</span> <span m="3270640">child</span> <span m="3270890">updates</span> <span m="3271290">things,</span> <span m="3271850">but</span> <span m="3272310">if</span> <span m="3272430">you</span> <span m="3272570">use</span> <span m="3272850">fork</span> <span m="3273180">here,</span> <span m="3273510">instead</span> <span m="3273555">of</span> <span m="3273600">execing</span> <span m="3274310">a</span> <span m="3274360">whole</span> <span m="3274590">new</span> <span m="3274730">process,</span> <span m="3275730">any</span> <span m="3276050">time</span> <span m="3276360">that</span> <span m="3276650">parent</span> <span m="3276970">server</span> <span m="3277290">process</span> <span m="3277870">forms</span> <span m="3278200">new</span> <span m="3278360">children,</span> <span m="3279680">those</span> <span m="3279880">children</span> <span m="3280540">will</span> <span m="3280650">have</span> <span m="3280760">the</span> <span m="3280840">same</span> <span m="3281130">values</span> <span m="3281450">of</span> <span m="3281655">the</span> <span m="3281860">canary</span> <span m="3282090">in</span> <span m="3282265">the</span> <span m="3282440">address</span> <span m="3282770">base,</span> <span m="3282935">OK.</span> <span m="3283370">So</span> <span m="3283470">these</span> <span m="3283530">are</span> <span m="3283590">the</span> <span m="3283650">assumptions</span> <span m="3284200">that</span> <span m="3284310">we're</span> <span m="3284420">going</span> <span m="3284530">to</span> <span m="3284580">make</span> <span m="3285190">to</span> <span m="3285280">try</span> <span m="3285600">to</span> <span m="3286090">defeat</span> <span m="3286600">these</span> <span m="3286760">canaries</span> <span m="3287200">here.</span> </p>
<p><span m="3289000">So</span> <span m="3290120">how</span> <span m="3290320">can</span> <span m="3290480">we</span> <span m="3290640">defeat</span> <span m="3290790">the</span> <span m="3290860">canary?</span> <span m="3291490">Well</span> <span m="3291980">the</span> <span m="3292120">attack</span> <span m="3292520">is</span> <span m="3292640">actually</span> <span m="3293500">fairly</span> <span m="3293800">straightforward.</span> <span m="3294680">So</span> <span m="3295320">imagine</span> <span m="3295830">that</span> <span m="3296050">the</span> <span m="3296120">stack</span> <span m="3296500">is</span> <span m="3296620">going</span> <span m="3297010">up</span> <span m="3297125">this</span> <span m="3297240">way,</span> <span m="3297850">right.</span> <span m="3298270">Imagine</span> <span m="3298610">you</span> <span m="3298770">got</span> <span m="3298810">the</span> <span m="3298850">buffer</span> <span m="3299140">overflow</span> <span m="3300085">here,</span> <span m="3300440">then</span> <span m="3300580">imagine</span> <span m="3301070">that</span> <span m="3301120">the</span> <span m="3301170">canary</span> <span m="3301600">is</span> <span m="3301700">up</span> <span m="3301870">here,</span> <span m="3302420">right.</span> <span m="3302720">And</span> <span m="3302760">the</span> <span m="3302800">canary</span> <span m="3303110">actually</span> <span m="3303460">has</span> <span m="3303650">multiple</span> <span m="3304120">bytes,</span> <span m="3305050">right.</span> <span m="3305860">So</span> <span m="3306050">what</span> <span m="3306100">you</span> <span m="3306150">can</span> <span m="3306360">actually</span> <span m="3306770">do</span> <span m="3307480">is,</span> <span m="3307710">you</span> <span m="3307850">can</span> <span m="3308030">probe</span> <span m="3308560">those</span> <span m="3308780">bytes</span> <span m="3309260">one</span> <span m="3309510">by</span> <span m="3309690">one</span> <span m="3310490">and</span> <span m="3310640">start</span> <span m="3311060">guessing</span> <span m="3311450">values</span> <span m="3312280">of</span> <span m="3312395">what</span> <span m="3312510">those</span> <span m="3312645">bytes</span> <span m="3312780">are,</span> <span m="3313320">right.</span> </p>
<p><span m="3313740">So</span> <span m="3314200">let's</span> <span m="3314470">say</span> <span m="3314780">that--</span> <span m="3317560">so</span> <span m="3317740">the</span> <span m="3317860">canary</span> <span m="3318950">looks</span> <span m="3319190">like</span> <span m="3319440">this.</span> <span m="3320940">Here's</span> <span m="3321250">the</span> <span m="3322370">overflowing</span> <span m="3322910">buffer,</span> <span m="3323890">and</span> <span m="3324290">you</span> <span m="3324500">want</span> <span m="3324640">to</span> <span m="3324700">guess</span> <span m="3324990">what</span> <span m="3325140">these</span> <span m="3325340">bytes</span> <span m="3325650">are.</span> <span m="3326200">So</span> <span m="3326430">the</span> <span m="3326540">first</span> <span m="3326890">thing</span> <span m="3327360">that</span> <span m="3327590">you</span> <span m="3327720">guess</span> <span m="3328290">is</span> <span m="3328510">you</span> <span m="3328850">take</span> <span m="3329233">your</span> <span m="3329424">overflow,</span> <span m="3330000">just</span> <span m="3330380">to</span> <span m="3330475">this</span> <span m="3330570">first</span> <span m="3330950">byte</span> <span m="3331066">of</span> <span m="3331183">the</span> <span m="3331300">canary</span> <span m="3331780">and</span> <span m="3332140">you</span> <span m="3332350">say,</span> <span m="3333546">hey,</span> <span m="3333940">is</span> <span m="3334110">that</span> <span m="3334330">byte</span> <span m="3334550">0?</span> <span m="3334910">You</span> <span m="3335026">write</span> <span m="3335143">a</span> <span m="3335260">0</span> <span m="3335387">there,</span> <span m="3335770">with</span> <span m="3335890">your</span> <span m="3336020">overflow.</span> <span m="3336840">You're</span> <span m="3337000">either</span> <span m="3337180">correct</span> <span m="3337310">or</span> <span m="3337440">you're</span> <span m="3337570">incorrect.</span> </p>
<p><span m="3338556">If</span> <span m="3339050">you</span> <span m="3339430">are</span> <span m="3339830">incorrect,</span> <span m="3340670">then</span> <span m="3340770">the</span> <span m="3340850">server's</span> <span m="3341220">going</span> <span m="3341320">to</span> <span m="3341390">crash,</span> <span m="3342420">right.</span> <span m="3343000">If</span> <span m="3343140">you</span> <span m="3343320">are</span> <span m="3343410">correct</span> <span m="3343980">you</span> <span m="3344090">say,</span> <span m="3344400">aha</span> <span m="3345100">I</span> <span m="3345190">actually</span> <span m="3345560">know</span> <span m="3345760">the</span> <span m="3345850">first</span> <span m="3346130">byte</span> <span m="3346290">of</span> <span m="3346385">the</span> <span m="3346480">canary</span> <span m="3347010">now,</span> <span m="3347550">right.</span> <span m="3348020">Then</span> <span m="3348310">you</span> <span m="3348420">start</span> <span m="3348700">guessing</span> <span m="3349020">here.</span> <span m="3349400">You</span> <span m="3349500">say,</span> <span m="3350660">are</span> <span m="3350830">you</span> <span m="3351150">0?</span> <span m="3351710">Probably</span> <span m="3352010">not,</span> <span m="3352300">it's</span> <span m="3352355">going</span> <span m="3352410">to</span> <span m="3352480">crash.</span> <span m="3353300">Are</span> <span m="3353515">you</span> <span m="3353730">one?</span> <span m="3354180">And</span> <span m="3354610">maybe</span> <span m="3354810">not,</span> <span m="3355010">it's</span> <span m="3355095">going</span> <span m="3355180">to</span> <span m="3355340">crash.</span> <span m="3355930">Are</span> <span m="3356130">you</span> <span m="3356265">two?</span> <span m="3356670">Aha,</span> <span m="3357290">it</span> <span m="3357440">doesn't</span> <span m="3357730">crash,</span> <span m="3358740">right.</span> <span m="3358930">So</span> <span m="3359050">now</span> <span m="3359430">you've</span> <span m="3359570">actually</span> <span m="3359890">found</span> <span m="3360270">the</span> <span m="3360433">value</span> <span m="3360596">of</span> <span m="3360760">that</span> <span m="3360990">second</span> <span m="3361280">canary</span> <span m="3361730">byte,</span> <span m="3362210">right.</span> </p>
<p><span m="3362530">As</span> <span m="3362640">you</span> <span m="3362750">can</span> <span m="3362850">imagine,</span> <span m="3363340">you</span> <span m="3363580">step</span> <span m="3364010">up</span> <span m="3364230">this</span> <span m="3364440">way,</span> <span m="3364770">and</span> <span m="3364920">you</span> <span m="3365070">eventually</span> <span m="3365670">find</span> <span m="3366150">all</span> <span m="3366255">the</span> <span m="3366360">values</span> <span m="3366670">for</span> <span m="3366825">the</span> <span m="3366980">canary.</span> <span m="3368170">So</span> <span m="3368200">once</span> <span m="3368380">again</span> <span m="3368510">we're</span> <span m="3368600">taking</span> <span m="3368870">advantage</span> <span m="3369220">of</span> <span m="3369270">the</span> <span m="3369360">fact,</span> <span m="3369890">that</span> <span m="3370060">crashes</span> <span m="3370700">are</span> <span m="3370800">a</span> <span m="3370900">signal</span> <span m="3371320">to</span> <span m="3371430">you,</span> <span m="3371660">the</span> <span m="3371800">attacker,</span> <span m="3372580">that</span> <span m="3372720">you've</span> <span m="3373060">actually</span> <span m="3374280">done</span> <span m="3374490">something</span> <span m="3374910">wrong,</span> <span m="3375650">right.</span> <span m="3376060">And</span> <span m="3376230">the</span> <span m="3376310">server</span> <span m="3376610">is</span> <span m="3376910">staying</span> <span m="3377250">up,</span> <span m="3377450">in</span> <span m="3377515">other</span> <span m="3377660">words,</span> <span m="3377810">that</span> <span m="3377990">socket</span> <span m="3378290">connection's</span> <span m="3378730">staying</span> <span m="3379100">open,</span> <span m="3379690">is</span> <span m="3379830">a</span> <span m="3379890">signal</span> <span m="3380220">to</span> <span m="3380425">you,</span> <span m="3380630">the</span> <span m="3380830">attacker,</span> <span m="3381030">that</span> <span m="3381125">you've</span> <span m="3381172">done</span> <span m="3381220">something</span> <span m="3381590">right.</span> </p>
<p><span m="3382774">AUDIENCE:</span> <span m="3383206">Maybe</span> <span m="3383350">I</span> <span m="3383494">mentioned</span> <span m="3383638">something</span> <span m="3384070">basic</span> <span m="3384502">here</span> <span m="3384940">like</span> <span m="3385480">why</span> <span m="3385700">do</span> <span m="3386080">you--</span> <span m="3386355">if</span> <span m="3386492">you</span> <span m="3386630">know</span> <span m="3386760">how</span> <span m="3386920">long</span> <span m="3387190">the</span> <span m="3387535">canary</span> <span m="3387707">is,</span> <span m="3387880">can</span> <span m="3388036">you</span> <span m="3388192">just</span> <span m="3388349">infect</span> <span m="3388583">directly?</span> <span m="3388818">Skip</span> <span m="3389287">that</span> <span m="3389756">buffer</span> <span m="3390694">and</span> <span m="3390928">overflow</span> <span m="3391163">those--</span> <span m="3391632">the</span> <span m="3391749">one</span> <span m="3391866">path</span> <span m="3391983">there</span> <span m="3392101">the</span> <span m="3392570">canary?</span> <span m="3393508">So</span> <span m="3393742">like</span> <span m="3393977">[INAUDIBLE]</span> <span m="3394450">say</span> <span m="3394820">you</span> <span m="3394964">can</span> <span m="3395108">like</span> <span m="3395253">[INAUDIBLE]</span> <span m="3397020">the</span> <span m="3397240">canary--</span> </p>
<p><span m="3397460">PROFESSOR:</span> <span m="3397900">Yeah,</span> <span m="3398380">yeah</span> <span m="3398560">you</span> <span m="3398680">can't--</span> <span m="3399020">so</span> <span m="3399180">that's</span> <span m="3399580">right</span> <span m="3399620">if</span> <span m="3399765">you--</span> <span m="3400200">so</span> <span m="3400440">if</span> <span m="3400590">you</span> <span m="3400710">in</span> <span m="3400810">fact</span> <span m="3401130">know</span> <span m="3401280">the</span> <span m="3401370">exact</span> <span m="3401750">location</span> <span m="3401890">of</span> <span m="3402030">the</span> <span m="3402170">canary,</span> <span m="3402780">right.</span> <span m="3402980">That</span> <span m="3403150">can</span> <span m="3403260">sometimes</span> <span m="3403690">allow</span> <span m="3403740">you</span> <span m="3403883">to</span> <span m="3404026">skip</span> <span m="3404300">some</span> <span m="3404420">of</span> <span m="3404460">these</span> <span m="3404610">attacks</span> <span m="3404940">totally.</span> <span m="3405420">Because</span> <span m="3405670">then</span> <span m="3405716">you</span> <span m="3405763">can</span> <span m="3405810">just</span> <span m="3406050">directly</span> <span m="3406480">write</span> <span m="3406610">to</span> <span m="3406740">the</span> <span m="3406850">return</span> <span m="3407160">address,</span> <span m="3407900">let's</span> <span m="3408130">say,</span> <span m="3408340">as</span> <span m="3408490">opposed</span> <span m="3408750">to</span> <span m="3409130">doing</span> <span m="3409350">some</span> <span m="3409453">of</span> <span m="3409556">this</span> <span m="3409660">buffer</span> <span m="3409920">overflow</span> <span m="3410310">nonsense.</span> </p>
<p><span m="3411420">But</span> <span m="3411630">in</span> <span m="3411720">general,</span> <span m="3412200">if</span> <span m="3412250">there's</span> <span m="3412300">some</span> <span m="3412470">level</span> <span m="3412605">of</span> <span m="3412740">randomization</span> <span m="3413430">here,</span> <span m="3413920">if</span> <span m="3414005">you</span> <span m="3414090">don't</span> <span m="3414290">quite</span> <span m="3414530">know</span> <span m="3414650">where</span> <span m="3414750">the</span> <span m="3414860">stack</span> <span m="3415230">is</span> <span m="3415410">for</span> <span m="3415560">example,</span> <span m="3416050">then</span> <span m="3416260">it's</span> <span m="3416460">tricky</span> <span m="3416720">to</span> <span m="3416790">do</span> <span m="3416990">that,</span> <span m="3417540">right.</span> <span m="3417810">So</span> <span m="3417900">basically</span> <span m="3418320">the</span> <span m="3418400">way</span> <span m="3418540">that</span> <span m="3418640">the</span> <span m="3418740">attack</span> <span m="3419040">proceeds</span> <span m="3419300">is</span> <span m="3419560">that</span> <span m="3419950">you</span> <span m="3420050">don't</span> <span m="3420300">quite</span> <span m="3420710">know</span> <span m="3420880">what's</span> <span m="3421090">happening,</span> <span m="3421800">and</span> <span m="3421880">so</span> <span m="3421960">you</span> <span m="3422050">just</span> <span m="3422470">very</span> <span m="3422820">slowly</span> <span m="3423400">creep</span> <span m="3423565">your</span> <span m="3423730">way</span> <span m="3425640">up</span> <span m="3425860">memory,</span> <span m="3426710">down</span> <span m="3426980">the</span> <span m="3427060">stack,</span> <span m="3427340">to</span> <span m="3427410">figure</span> <span m="3427620">out</span> <span m="3427700">where</span> <span m="3427790">these</span> <span m="3427990">things</span> <span m="3428220">are.</span> </p>
<p><span m="3429184">AUDIENCE:</span> <span m="3429666">Can</span> <span m="3429826">the</span> <span m="3429987">server</span> <span m="3430630">instead</span> <span m="3430871">of</span> <span m="3431112">crashing</span> <span m="3431594">when</span> <span m="3431835">it</span> <span m="3432076">finds</span> <span m="3432558">strong</span> <span m="3432799">canaries,</span> <span m="3433522">keep</span> <span m="3433682">the</span> <span m="3433843">socket</span> <span m="3434004">open</span> <span m="3434486">and</span> <span m="3434968">[INAUDIBLE]</span> <span m="3435450">deprocess</span> <span m="3435932">and</span> <span m="3437860">[INAUDIBLE]?</span> </p>
<p><span m="3438342">PROFESSOR:</span> <span m="3438830">Yeah,</span> <span m="3439045">so</span> <span m="3439260">we'll</span> <span m="3439450">discuss</span> <span m="3439870">at</span> <span m="3440030">the</span> <span m="3440063">end</span> <span m="3440096">of</span> <span m="3440130">lecture</span> <span m="3440440">some</span> <span m="3440670">of</span> <span m="3440850">the</span> <span m="3441220">defenses</span> <span m="3441620">you</span> <span m="3441710">can</span> <span m="3441765">have</span> <span m="3441820">against</span> <span m="3442220">this,</span> <span m="3442630">but</span> <span m="3442800">one</span> <span m="3443030">very,</span> <span m="3444180">abstractly</span> <span m="3444700">speaking</span> <span m="3445030">civil</span> <span m="3445340">defense,</span> <span m="3445790">is</span> <span m="3446240">that</span> <span m="3446680">when</span> <span m="3446930">the</span> <span m="3447090">program</span> <span m="3447530">crashes,</span> <span m="3448220">you</span> <span m="3448380">catch</span> <span m="3448710">the</span> <span m="3448800">segfault</span> <span m="3449380">using</span> <span m="3449620">a</span> <span m="3449670">signal</span> <span m="3450020">handler,</span> <span m="3450510">do</span> <span m="3450540">not</span> <span m="3450570">deduce</span> <span m="3450600">you're</span> <span m="3450686">own</span> <span m="3450773">code</span> <span m="3451300">by</span> <span m="3451310">the</span> <span m="3451410">way.</span> <span m="3451930">But</span> <span m="3451950">you</span> <span m="3452060">can</span> <span m="3452200">do</span> <span m="3452350">this,</span> <span m="3452590">right.</span> <span m="3452810">You</span> <span m="3452910">catch</span> <span m="3453230">that</span> <span m="3453420">segfault</span> <span m="3454470">and</span> <span m="3454570">then</span> <span m="3454670">the</span> <span m="3454750">signal</span> <span m="3455060">handler</span> <span m="3455250">just</span> <span m="3455550">keeps</span> <span m="3455760">that</span> <span m="3456030">process</span> <span m="3456440">alive</span> <span m="3456510">for</span> <span m="3456765">a</span> <span m="3457020">bit</span> <span m="3457600">and</span> <span m="3457676">that</span> <span m="3457753">will</span> <span m="3457830">trick</span> <span m="3458040">the</span> <span m="3458250">attack</span> <span m="3458660">into</span> <span m="3458830">thinking</span> <span m="3459000">that,</span> <span m="3459330">oh</span> <span m="3461410">I</span> <span m="3461620">won't</span> <span m="3461840">get</span> <span m="3461940">that</span> <span m="3462090">signal</span> <span m="3462400">back,</span> <span m="3462640">in</span> <span m="3463128">other</span> <span m="3463616">words.</span> </p>
<p><span m="3465570">OK</span> <span m="3465850">so</span> <span m="3465990">that's</span> <span m="3466230">basically</span> <span m="3467000">how</span> <span m="3467230">you</span> <span m="3467490">can</span> <span m="3468000">guess</span> <span m="3468310">the</span> <span m="3468380">value</span> <span m="3468700">for</span> <span m="3468810">the</span> <span m="3468920">canary.</span> <span m="3469710">And</span> <span m="3469890">note</span> <span m="3470050">that</span> <span m="3470160">you</span> <span m="3470240">can</span> <span m="3470350">actually</span> <span m="3470720">use</span> <span m="3470950">this</span> <span m="3471120">attack</span> <span m="3471700">to</span> <span m="3471950">sort</span> <span m="3472150">of</span> <span m="3472240">figure</span> <span m="3472520">out</span> <span m="3472680">arbitrary</span> <span m="3473330">values</span> <span m="3474130">that</span> <span m="3474285">are</span> <span m="3474590">low</span> <span m="3474686">in</span> <span m="3474783">the</span> <span m="3475170">stack,</span> <span m="3475710">right.</span> <span m="3476020">Just</span> <span m="3476210">by</span> <span m="3476590">iteratively</span> <span m="3477040">guessing</span> <span m="3477790">for</span> <span m="3477886">each</span> <span m="3477983">byte</span> <span m="3478080">what</span> <span m="3478250">it</span> <span m="3478340">is,</span> <span m="3478790">and</span> <span m="3478900">then</span> <span m="3479010">using</span> <span m="3479240">that</span> <span m="3479430">crash</span> <span m="3479810">indication</span> <span m="3480490">as</span> <span m="3480680">a</span> <span m="3480740">signal</span> <span m="3481360">of</span> <span m="3481500">whether</span> <span m="3481690">you're</span> <span m="3481850">guess</span> <span m="3482090">was</span> <span m="3482260">correct</span> <span m="3482610">or</span> <span m="3483080">not.</span> <span m="3484960">So</span> <span m="3486560">that's</span> <span m="3486880">basically</span> <span m="3487280">how</span> <span m="3487390">you</span> <span m="3487450">can</span> <span m="3487510">defeat</span> <span m="3487820">these</span> <span m="3488130">randomized</span> <span m="3488620">canaries,</span> <span m="3489050">assuming</span> <span m="3489460">that</span> <span m="3489660">after</span> <span m="3489930">the</span> <span m="3490030">server</span> <span m="3490520">restarts,</span> <span m="3491190">those</span> <span m="3491370">things</span> <span m="3491600">are</span> <span m="3493220">not</span> <span m="3493420">changed.</span> </p>
<p><span m="3494000">And</span> <span m="3494090">so</span> <span m="3494160">we've</span> <span m="3494320">also</span> <span m="3494760">shown</span> <span m="3495260">how</span> <span m="3495365">you</span> <span m="3495470">can</span> <span m="3495575">use</span> <span m="3495732">the</span> <span m="3495890">gadgets</span> <span m="3496690">to</span> <span m="3497030">string</span> <span m="3497430">together</span> <span m="3497800">these</span> <span m="3498000">more</span> <span m="3498220">elaborate</span> <span m="3498720">attacks.</span> <span m="3499460">So</span> <span m="3499710">what</span> <span m="3499860">we're</span> <span m="3499950">going</span> <span m="3500090">to</span> <span m="3500680">look</span> <span m="3500910">at</span> <span m="3501060">next</span> <span m="3501730">is</span> <span m="3501890">a</span> <span m="3502000">way</span> <span m="3502350">that</span> <span m="3502540">you</span> <span m="3502680">can</span> <span m="3503030">use</span> <span m="3503390">all</span> <span m="3503690">these</span> <span m="3503900">techniques</span> <span m="3504730">to</span> <span m="3504930">defeat</span> <span m="3505770">data</span> <span m="3506000">execution</span> <span m="3506520">prevention,</span> <span m="3507880">address-based</span> <span m="3508470">randomization</span> <span m="3509300">and</span> <span m="3509520">canaries</span> <span m="3510310">on</span> <span m="3511620">a</span> <span m="3511660">production</span> <span m="3512050">system.</span> </p>
<p><span m="3512800">Now</span> <span m="3512830">what</span> <span m="3512860">we're</span> <span m="3513000">going</span> <span m="3513120">to</span> <span m="3513210">do</span> <span m="3513270">now</span> <span m="3514000">is,</span> <span m="3514090">we're</span> <span m="3514180">actually</span> <span m="3514460">going</span> <span m="3514500">to</span> <span m="3514540">start</span> <span m="3515470">looking</span> <span m="3515800">at</span> <span m="3515920">64-bit</span> <span m="3516700">architectures</span> <span m="3517300">instead</span> <span m="3517470">of</span> <span m="3517560">32-bit</span> <span m="3518030">architectures.</span> <span m="3518870">As</span> <span m="3519020">it</span> <span m="3519110">turns</span> <span m="3519350">out</span> <span m="3519550">for</span> <span m="3520050">randomization</span> <span m="3520700">purposes,</span> <span m="3521330">64-bit</span> <span m="3523080">architectures</span> <span m="3523320">actually</span> <span m="3523550">give</span> <span m="3523660">you</span> <span m="3523750">a</span> <span m="3523800">lot</span> <span m="3524080">more</span> <span m="3524320">randomness</span> <span m="3525620">to</span> <span m="3525830">protect</span> <span m="3526090">yourself</span> <span m="3526320">against</span> <span m="3526510">the</span> <span m="3526610">attacker.</span> <span m="3527280">So</span> <span m="3527490">looking</span> <span m="3527710">at</span> <span m="3527970">attacks</span> <span m="3528330">is</span> <span m="3528440">much</span> <span m="3528660">more</span> <span m="3528830">interesting</span> <span m="3529260">on</span> <span m="3529390">those</span> <span m="3529520">systems.</span> </p>
<p><span m="3530850">So</span> <span m="3531010">that's</span> <span m="3531280">also</span> <span m="3531690">the</span> <span m="3531790">type</span> <span m="3531990">of</span> <span m="3532090">architecture</span> <span m="3532600">that's</span> <span m="3532800">discussed</span> <span m="3533710">in</span> <span m="3533840">the</span> <span m="3533950">BROP</span> <span m="3534370">paper.</span> <span m="3534690">They</span> <span m="3534770">talk</span> <span m="3534920">about</span> <span m="3535110">64-bit</span> <span m="3535700">machines.</span> <span m="3536390">So</span> <span m="3536450">from</span> <span m="3536600">now</span> <span m="3536890">on,</span> <span m="3537130">assume</span> <span m="3537400">that</span> <span m="3537510">we're</span> <span m="3537620">going</span> <span m="3537730">to</span> <span m="3537810">talk</span> <span m="3538070">about</span> <span m="3538290">the</span> <span m="3538370">64-bit</span> <span m="3538880">architectures.</span> <span m="3539950">For</span> <span m="3540030">the</span> <span m="3540140">purposes</span> <span m="3540610">of</span> <span m="3540680">this</span> <span m="3540830">discussion,</span> <span m="3541640">the</span> <span m="3541810">only</span> <span m="3542140">difference</span> <span m="3542510">between</span> <span m="3542830">a</span> <span m="3542880">32-bit</span> <span m="3543480">machine</span> <span m="3543740">and</span> <span m="3543870">a</span> <span m="3544000">64-bit</span> <span m="3544700">machine,</span> <span m="3545350">is</span> <span m="3545570">that</span> <span m="3546060">on</span> <span m="3546110">a</span> <span m="3546160">32-bit</span> <span m="3546770">machine,</span> <span m="3547360">the</span> <span m="3547500">arguments</span> <span m="3548060">are</span> <span m="3548210">passed</span> <span m="3548620">on</span> <span m="3548760">the</span> <span m="3548840">stack,</span> <span m="3550210">right.</span> </p>
<p><span m="3550500">So</span> <span m="3552360">here</span> <span m="3552640">for</span> <span m="3552680">example,</span> <span m="3553020">this</span> <span m="3553105">is</span> <span m="3553190">like</span> <span m="3553350">a</span> <span m="3553460">32-bit</span> <span m="3553960">machine</span> <span m="3554620">we</span> <span m="3554870">were</span> <span m="3554995">assuming,</span> <span m="3555120">so</span> <span m="3555290">for</span> <span m="3555380">example,</span> <span m="3555660">bash</span> <span m="3556060">path</span> <span m="3556480">will</span> <span m="3556600">pass</span> <span m="3556720">on</span> <span m="3556780">the</span> <span m="3556850">stack.</span> <span m="3557570">On</span> <span m="3557720">a</span> <span m="3557770">64-bit</span> <span m="3558480">machine,</span> <span m="3559050">the</span> <span m="3559410">arguments</span> <span m="3559810">are</span> <span m="3559870">passed</span> <span m="3560310">in</span> <span m="3560460">registers</span> <span m="3561660">instead.</span> <span m="3562350">OK</span> <span m="3562660">so</span> <span m="3562790">like</span> <span m="3562940">when</span> <span m="3563670">a</span> <span m="3563770">function</span> <span m="3564350">starts</span> <span m="3564610">execution,</span> <span m="3565100">it's</span> <span m="3565170">going</span> <span m="3565270">to</span> <span m="3565310">look</span> <span m="3565500">in</span> <span m="3565600">certain</span> <span m="3565930">registers</span> <span m="3566195">to</span> <span m="3566460">find</span> <span m="3566830">where</span> <span m="3566876">the</span> <span m="3566923">arguments</span> <span m="3566970">are.</span> <span m="3568320">OK,</span> <span m="3568550">make</span> <span m="3568710">sense?</span> <span m="3569040">All</span> <span m="3569255">right.</span> </p>
<p><span m="3570250">So</span> <span m="3572900">start</span> <span m="3573430">up</span> <span m="3573580">here.</span> <span m="3581400">All</span> <span m="3581625">right,</span> <span m="3581850">so</span> <span m="3582040">now</span> <span m="3582340">we</span> <span m="3582430">get</span> <span m="3582660">to</span> <span m="3582750">the</span> <span m="3582890">point</span> <span m="3583320">of</span> <span m="3583620">today's</span> <span m="3584100">paper.</span> <span m="3585210">Which</span> <span m="3585390">is</span> <span m="3585540">the</span> <span m="3585640">blind</span> <span m="3586230">return</span> <span m="3586660">oriented</span> <span m="3587090">programming.</span> <span m="3588200">So</span> <span m="3588430">what's</span> <span m="3588670">the</span> <span m="3588760">first</span> <span m="3589080">thing</span> <span m="3589200">you</span> <span m="3589310">want</span> <span m="3589440">to</span> <span m="3589500">do,</span> <span m="3591380">if</span> <span m="3591580">you</span> <span m="3591770">want</span> <span m="3592070">to</span> <span m="3592340">engage</span> <span m="3593430">in</span> <span m="3593610">BROP</span> <span m="3593740">for</span> <span m="3594130">fun</span> <span m="3594350">or</span> <span m="3594430">profit?</span> </p>
<p><span m="3594970">So</span> <span m="3595210">the</span> <span m="3595340">first</span> <span m="3595640">thing</span> <span m="3596080">you</span> <span m="3596170">have</span> <span m="3596270">to</span> <span m="3596370">do</span> <span m="3597080">is,</span> <span m="3597800">you</span> <span m="3597880">have</span> <span m="3598110">to</span> <span m="3598250">find</span> <span m="3599230">what</span> <span m="3599410">they</span> <span m="3599540">call</span> <span m="3600150">a</span> <span m="3600340">stop</span> <span m="3600780">gadget.</span> <span m="3606970">Now</span> <span m="3607330">a</span> <span m="3607470">stop</span> <span m="3607870">gadget--</span> <span m="3608520">and</span> <span m="3608930">remember</span> <span m="3609190">that</span> <span m="3609300">when</span> <span m="3609440">we</span> <span m="3609570">say</span> <span m="3609750">gadget,</span> <span m="3610270">we</span> <span m="3610370">essentially</span> <span m="3610820">mean,</span> <span m="3611830">return</span> <span m="3612310">addresses,</span> <span m="3612970">right.</span> <span m="3613510">A</span> <span m="3613580">gadget</span> <span m="3614070">is</span> <span m="3614170">identified</span> <span m="3614640">by</span> <span m="3614770">the</span> <span m="3614880">return</span> <span m="3615300">address,</span> <span m="3615630">by</span> <span m="3615730">the</span> <span m="3615830">start</span> <span m="3616180">address</span> <span m="3616780">of</span> <span m="3616960">that</span> <span m="3617180">sequence</span> <span m="3617690">of</span> <span m="3617800">instructions</span> <span m="3618280">that</span> <span m="3618410">we</span> <span m="3618450">want</span> <span m="3618660">to</span> <span m="3618740">jump</span> <span m="3618920">to,</span> <span m="3619105">right.</span> <span m="3619660">So</span> <span m="3619840">what</span> <span m="3619980">is</span> <span m="3620100">a</span> <span m="3620170">stop</span> <span m="3620440">gadget?</span> </p>
<p><span m="3621030">So</span> <span m="3621195">a</span> <span m="3621360">stop</span> <span m="3621740">gadget</span> <span m="3622120">is</span> <span m="3622230">essentially</span> <span m="3623020">a</span> <span m="3623140">return</span> <span m="3623610">address</span> <span m="3624350">to</span> <span m="3624580">someplace</span> <span m="3625190">in</span> <span m="3625270">the</span> <span m="3625380">code,</span> <span m="3626080">but</span> <span m="3626090">if</span> <span m="3626190">you</span> <span m="3626300">jump</span> <span m="3626620">to</span> <span m="3626800">it,</span> <span m="3627580">you're</span> <span m="3627720">going</span> <span m="3627950">to</span> <span m="3628030">pause</span> <span m="3628500">the</span> <span m="3628590">program,</span> <span m="3629340">but</span> <span m="3629590">you're</span> <span m="3629640">not</span> <span m="3629950">going</span> <span m="3630140">to</span> <span m="3630230">crash</span> <span m="3630720">it.</span> <span m="3631890">OK,</span> <span m="3632150">so</span> <span m="3632520">that's</span> <span m="3632660">why</span> <span m="3632810">it's</span> <span m="3632920">called</span> <span m="3633030">a</span> <span m="3633100">stop</span> <span m="3633470">gadget.</span> <span m="3635070">Now</span> <span m="3635870">what</span> <span m="3636090">might</span> <span m="3636330">that</span> <span m="3636510">stop</span> <span m="3636800">gadget</span> <span m="3637020">be?</span> </p>
<p><span m="3637510">You</span> <span m="3637690">might</span> <span m="3637870">jump</span> <span m="3638160">to</span> <span m="3638290">someplace</span> <span m="3638750">in</span> <span m="3638800">the</span> <span m="3638870">code</span> <span m="3639130">that</span> <span m="3639390">then</span> <span m="3640170">calls</span> <span m="3640660">via</span> <span m="3640890">the</span> <span m="3641010">sleep</span> <span m="3641390">system</span> <span m="3641750">call</span> <span m="3642060">for</span> <span m="3642310">example,</span> <span m="3642560">or</span> <span m="3643060">does</span> <span m="3643280">pause,</span> <span m="3643870">or</span> <span m="3643960">something</span> <span m="3644230">like</span> <span m="3644400">that.</span> <span m="3644520">Or</span> <span m="3644640">maybe</span> <span m="3645130">somehow</span> <span m="3645410">the</span> <span m="3645480">program</span> <span m="3645780">gets</span> <span m="3646190">stuck</span> <span m="3646253">in</span> <span m="3646316">an</span> <span m="3646380">infinite</span> <span m="3646720">loop</span> <span m="3647120">if</span> <span m="3647180">you</span> <span m="3647350">jump</span> <span m="3647380">to</span> <span m="3647410">that</span> <span m="3647750">place.</span> <span m="3648080">Doesn't</span> <span m="3648290">really</span> <span m="3648470">matter</span> <span m="3648800">why</span> <span m="3649070">the</span> <span m="3649160">stop's</span> <span m="3649530">happening,</span> <span m="3650270">but</span> <span m="3650400">you</span> <span m="3650490">could</span> <span m="3650590">imagine</span> <span m="3650970">several</span> <span m="3651260">scenarios</span> <span m="3651600">which</span> <span m="3652070">would</span> <span m="3652185">cause</span> <span m="3652300">that</span> <span m="3652380">stop</span> <span m="3652460">to</span> <span m="3652530">take</span> <span m="3652690">place.</span> </p>
<p><span m="3653760">So</span> <span m="3654080">why</span> <span m="3654340">is</span> <span m="3654450">this</span> <span m="3654620">useful?</span> <span m="3655330">Well</span> <span m="3655580">once</span> <span m="3655930">the</span> <span m="3656210">attacker</span> <span m="3656930">has</span> <span m="3657120">managed</span> <span m="3657570">to</span> <span m="3657620">defeat</span> <span m="3658010">the</span> <span m="3658120">canaries</span> <span m="3658900">using</span> <span m="3659020">that</span> <span m="3659140">iterative</span> <span m="3659600">guessing</span> <span m="3659720">technique</span> <span m="3660180">I</span> <span m="3660230">showed</span> <span m="3660540">you,</span> <span m="3661175">he</span> <span m="3661610">can</span> <span m="3661720">start</span> <span m="3662080">to</span> <span m="3662250">overwrite</span> <span m="3663410">this</span> <span m="3663700">return</span> <span m="3664140">address</span> <span m="3664920">and</span> <span m="3665050">start</span> <span m="3665360">probing</span> <span m="3665850">for</span> <span m="3665990">these</span> <span m="3666220">stop</span> <span m="3666650">gadgets,</span> <span m="3667570">right.</span> <span m="3667900">And</span> <span m="3668230">so</span> <span m="3668440">note</span> <span m="3668720">that</span> <span m="3668860">most</span> <span m="3669280">of</span> <span m="3669350">the</span> <span m="3669460">random</span> <span m="3669950">addresses</span> <span m="3670400">you</span> <span m="3670535">might</span> <span m="3670670">put</span> <span m="3670950">there,</span> <span m="3671900">they'll</span> <span m="3672110">probably</span> <span m="3672440">crash</span> <span m="3672830">the</span> <span m="3672930">server,</span> <span m="3673440">right.</span> </p>
<p><span m="3673670">Once</span> <span m="3673870">again,</span> <span m="3673990">that's</span> <span m="3674190">the</span> <span m="3674270">message</span> <span m="3674830">to</span> <span m="3675090">you,</span> <span m="3675350">the</span> <span m="3675450">attacker,</span> <span m="3675820">that's</span> <span m="3675960">an</span> <span m="3676143">indication</span> <span m="3677060">that</span> <span m="3677200">what</span> <span m="3677350">you</span> <span m="3677470">found</span> <span m="3677750">is</span> <span m="3677850">not</span> <span m="3678100">a</span> <span m="3678270">stop</span> <span m="3678440">gadget,</span> <span m="3678930">right.</span> <span m="3679100">Because</span> <span m="3679320">when</span> <span m="3679360">the</span> <span m="3679400">server</span> <span m="3679690">crashes</span> <span m="3680240">your</span> <span m="3680380">sockets--</span> <span m="3680990">your</span> <span m="3681170">socket</span> <span m="3681450">connection</span> <span m="3681665">is</span> <span m="3681880">closed.</span> <span m="3682420">You</span> <span m="3682515">as</span> <span m="3682610">an</span> <span m="3682650">attacker</span> <span m="3683140">know,</span> <span m="3683230">OK</span> <span m="3683320">that</span> <span m="3683430">must</span> <span m="3683600">not</span> <span m="3683653">have</span> <span m="3683706">been</span> <span m="3683760">a</span> <span m="3683870">stop</span> <span m="3684210">gadget.</span> <span m="3684660">Where</span> <span m="3684710">if</span> <span m="3684760">you</span> <span m="3684990">guess</span> <span m="3685220">something</span> <span m="3685730">and</span> <span m="3685830">then</span> <span m="3685890">you--</span> <span m="3686350">that</span> <span m="3686530">socket</span> <span m="3686880">still</span> <span m="3687090">stays</span> <span m="3687370">open</span> <span m="3687572">for</span> <span m="3687775">awhile,</span> <span m="3688180">you</span> <span m="3688315">think,</span> <span m="3688720">aha</span> <span m="3689260">I</span> <span m="3689390">found</span> <span m="3689650">that</span> <span m="3689790">stop</span> <span m="3690140">gadget.</span> <span m="3691620">So</span> <span m="3691760">that's</span> <span m="3691900">the</span> <span m="3691970">basic</span> <span m="3692290">idea</span> <span m="3692700">behind</span> <span m="3693340">step</span> <span m="3693700">one.</span> <span m="3693890">You</span> <span m="3694046">got</span> <span m="3694203">to</span> <span m="3694281">find</span> <span m="3694360">that</span> <span m="3694560">stop</span> <span m="3694910">gadget.</span> </p>
<p><span m="3696220">Now</span> <span m="3696520">step</span> <span m="3696920">two,</span> <span m="3700100">is</span> <span m="3700250">that</span> <span m="3700440">you</span> <span m="3700500">want</span> <span m="3700790">to</span> <span m="3700880">find</span> <span m="3702590">gadgets</span> <span m="3705450">that</span> <span m="3705680">pop</span> <span m="3705930">stack</span> <span m="3706280">entries.</span> <span m="3717500">And</span> <span m="3717700">so</span> <span m="3718140">you</span> <span m="3718220">basically</span> <span m="3718630">have</span> <span m="3718763">to</span> <span m="3718896">use</span> <span m="3719430">this</span> <span m="3720470">sequence</span> <span m="3720840">of</span> <span m="3721750">carefully</span> <span m="3722220">crafted</span> <span m="3722620">instructions</span> <span m="3723090">to</span> <span m="3723180">figure</span> <span m="3723500">out</span> <span m="3723910">when</span> <span m="3724125">we've</span> <span m="3724340">got</span> <span m="3725270">one</span> <span m="3725560">of</span> <span m="3725740">these</span> <span m="3726640">stack</span> <span m="3727090">gadgets.</span> <span m="3728040">So</span> <span m="3729100">this</span> <span m="3729280">sequence</span> <span m="3729630">is</span> <span m="3729730">going</span> <span m="3729860">to</span> <span m="3729940">consist</span> <span m="3730530">of</span> <span m="3730850">a</span> <span m="3731015">probe</span> <span m="3733120">address,</span> <span m="3733760">a</span> <span m="3733840">stop</span> <span m="3734240">address,</span> <span m="3736630">and</span> <span m="3736740">a</span> <span m="3736810">crash</span> <span m="3737220">address.</span> </p>
<p><span m="3738450">So</span> <span m="3739250">the</span> <span m="3739350">probe</span> <span m="3739790">address</span> <span m="3740210">is</span> <span m="3740330">the</span> <span m="3740420">thing</span> <span m="3740560">that</span> <span m="3740650">we're</span> <span m="3740740">going</span> <span m="3740840">to</span> <span m="3740910">put</span> <span m="3741190">in</span> <span m="3741240">the</span> <span m="3741290">stack.</span> <span m="3742030">This</span> <span m="3742210">is</span> <span m="3742330">going</span> <span m="3742440">to</span> <span m="3742520">be</span> <span m="3744280">the</span> <span m="3745040">address</span> <span m="3746850">of</span> <span m="3747180">a</span> <span m="3747340">potential</span> <span m="3751390">stack</span> <span m="3751740">popping</span> <span m="3752070">gadget.</span> <span m="3756760">This</span> <span m="3757000">stop</span> <span m="3757390">gadget</span> <span m="3757970">is</span> <span m="3758120">going</span> <span m="3758240">to</span> <span m="3758310">be</span> <span m="3758900">what</span> <span m="3759060">we</span> <span m="3759200">found</span> <span m="3759660">in</span> <span m="3759820">step</span> <span m="3760130">one.</span> <span m="3761410">So</span> <span m="3761670">this</span> <span m="3761950">is</span> <span m="3762475">an</span> <span m="3762870">address</span> <span m="3764084">of</span> <span m="3765506">the</span> <span m="3765980">stop</span> <span m="3766380">gadget.</span> <span m="3769550">And</span> <span m="3769870">then</span> <span m="3770050">the</span> <span m="3770150">crash</span> <span m="3770610">gadget</span> <span m="3771410">is</span> <span m="3771580">just</span> <span m="3771780">going</span> <span m="3771900">to</span> <span m="3772000">be</span> <span m="3772290">the</span> <span m="3772580">address</span> <span m="3774548">of</span> <span m="3775400">nonexecutable</span> <span m="3776190">code.</span> </p>
<p><span m="3782430">So</span> <span m="3782560">for</span> <span m="3782690">example,</span> <span m="3783050">you</span> <span m="3783210">could</span> <span m="3783305">just</span> <span m="3783400">set</span> <span m="3783640">this</span> <span m="3783920">to,</span> <span m="3785850">just</span> <span m="3786010">the</span> <span m="3786120">address</span> <span m="3786430">zero,</span> <span m="3786930">right.</span> <span m="3787150">If</span> <span m="3787190">you</span> <span m="3787230">do</span> <span m="3787340">a</span> <span m="3787450">ret</span> <span m="3787630">to</span> <span m="3787710">this</span> <span m="3787940">and</span> <span m="3788045">then</span> <span m="3788150">try</span> <span m="3788300">to</span> <span m="3788360">execute</span> <span m="3788780">code</span> <span m="3789010">there,</span> <span m="3789415">this</span> <span m="3789460">is</span> <span m="3789550">going</span> <span m="3789640">to</span> <span m="3789730">crash</span> <span m="3789910">your</span> <span m="3790090">program.</span> <span m="3791250">So</span> <span m="3791380">we</span> <span m="3791460">can</span> <span m="3791590">basically</span> <span m="3792130">use</span> <span m="3792500">these</span> <span m="3792850">types</span> <span m="3793590">of</span> <span m="3794010">addresses</span> <span m="3794830">to</span> <span m="3795070">find</span> <span m="3795450">out</span> <span m="3795650">where</span> <span m="3795800">these</span> <span m="3795950">stack</span> <span m="3796290">popping</span> <span m="3796570">gadgets</span> <span m="3796950">are.</span> <span m="3797360">So</span> <span m="3797530">here's</span> <span m="3797960">a</span> <span m="3799460">simple</span> <span m="3799910">example.</span> </p>
<p><span m="3800870">So</span> <span m="3801340">let's</span> <span m="3802580">write</span> <span m="3802710">this</span> <span m="3802870">over</span> <span m="3803040">here.</span> <span m="3804640">So</span> <span m="3804960">let's</span> <span m="3805200">say</span> <span m="3805910">we</span> <span m="3806100">have</span> <span m="3806930">these</span> <span m="3807150">two</span> <span m="3807390">different</span> <span m="3807660">examples</span> <span m="3809190">of</span> <span m="3809340">a</span> <span m="3809480">probe,</span> <span m="3811730">a</span> <span m="3811850">trap,</span> <span m="3814360">and</span> <span m="3814490">then</span> <span m="3814565">a</span> <span m="3814640">stop,</span> <span m="3816340">right.</span> <span m="3816600">So</span> <span m="3816710">let's</span> <span m="3816950">assume</span> <span m="3817530">that</span> <span m="3818520">we</span> <span m="3818760">have</span> <span m="3819610">down</span> <span m="3819930">here,</span> <span m="3820290">we're</span> <span m="3820450">going</span> <span m="3820740">to</span> <span m="3820820">probe</span> <span m="3821115">at</span> <span m="3821410">some</span> <span m="3821670">address,</span> <span m="3824640">doesn't</span> <span m="3824900">really</span> <span m="3825080">matter,</span> <span m="3825420">starts</span> <span m="3825536">with</span> <span m="3825653">a</span> <span m="3825770">four,</span> <span m="3826130">ends</span> <span m="3826212">with</span> <span m="3826295">an</span> <span m="3826377">eight.</span> <span m="3826790">That</span> <span m="3826920">doesn't</span> <span m="3827170">matter.</span> <span m="3827840">Over</span> <span m="3828110">here,</span> <span m="3828450">let's</span> <span m="3828600">say</span> <span m="3828860">that</span> <span m="3829000">we</span> <span m="3829200">look</span> <span m="3829430">at</span> <span m="3829520">the</span> <span m="3829660">address</span> <span m="3830230">that,</span> <span m="3830430">let's</span> <span m="3830640">say</span> <span m="3830840">starts</span> <span m="3831340">in</span> <span m="3831475">a</span> <span m="3831610">four</span> <span m="3833050">ends</span> <span m="3833135">in</span> <span m="3833220">a</span> <span m="3833470">C.</span> </p>
<p><span m="3834220">So</span> <span m="3834530">we're</span> <span m="3834700">saying,</span> <span m="3835420">we're</span> <span m="3835670">hypothesizing,</span> <span m="3836520">that</span> <span m="3836780">maybe</span> <span m="3837120">one</span> <span m="3837560">of</span> <span m="3837810">these</span> <span m="3838140">two</span> <span m="3838350">addresses</span> <span m="3839270">is</span> <span m="3839400">going</span> <span m="3839510">to</span> <span m="3839560">be</span> <span m="3839670">one</span> <span m="3839840">of</span> <span m="3839880">these</span> <span m="3840090">stack</span> <span m="3840330">popping</span> <span m="3840580">gadgets.</span> <span m="3842190">And</span> <span m="3842370">then</span> <span m="3843020">let's</span> <span m="3843310">say</span> <span m="3843560">that</span> <span m="3843780">the</span> <span m="3843880">trap</span> <span m="3844300">up</span> <span m="3844460">here,</span> <span m="3845100">like</span> <span m="3845260">I</span> <span m="3845290">said</span> <span m="3845490">this</span> <span m="3845575">is</span> <span m="3845660">just</span> <span m="3846000">going</span> <span m="3846100">to</span> <span m="3846180">be</span> <span m="3848780">address</span> <span m="3849170">zero,</span> <span m="3850790">and</span> <span m="3850980">then</span> <span m="3851470">let's</span> <span m="3851720">assume</span> <span m="3852100">that</span> <span m="3852230">we</span> <span m="3852360">found</span> <span m="3852800">some</span> <span m="3853040">preexisting</span> <span m="3854130">stop</span> <span m="3854540">gadget,</span> <span m="3858060">some</span> <span m="3858230">addresses</span> <span m="3858555">start</span> <span m="3859090">the</span> <span m="3859155">[INAUDIBLE]</span> <span m="3859220">doesn't</span> <span m="3859300">really</span> <span m="3859380">matter.</span> </p>
<p><span m="3859910">And</span> <span m="3860150">remember</span> <span m="3860430">this</span> <span m="3860690">stop</span> <span m="3860990">gadget,</span> <span m="3862090">like</span> <span m="3862280">maybe</span> <span m="3863090">this</span> <span m="3863860">address,</span> <span m="3864720">points</span> <span m="3865080">to</span> <span m="3865200">code</span> <span m="3865660">that</span> <span m="3865820">does</span> <span m="3868550">something</span> <span m="3868920">like</span> <span m="3869110">sleep</span> <span m="3869245">10,</span> <span m="3869650">or</span> <span m="3869750">something</span> <span m="3870060">like</span> <span m="3870250">that,</span> <span m="3870860">right.</span> <span m="3871370">So</span> <span m="3871530">when</span> <span m="3871640">I</span> <span m="3871730">say</span> <span m="3871980">that</span> <span m="3872080">we're</span> <span m="3872180">going</span> <span m="3872280">to</span> <span m="3872380">test</span> <span m="3872605">these</span> <span m="3872830">sequences,</span> <span m="3873720">this</span> <span m="3873820">is</span> <span m="3873930">the</span> <span m="3874030">stuff</span> <span m="3874270">that</span> <span m="3874370">we're</span> <span m="3874450">going</span> <span m="3874540">to</span> <span m="3874610">push</span> <span m="3874850">onto</span> <span m="3875010">the</span> <span m="3875110">stack,</span> <span m="3875920">right.</span> </p>
<p><span m="3876460">So</span> <span m="3877200">similar</span> <span m="3877550">to</span> <span m="3877600">over</span> <span m="3877900">there,</span> <span m="3878500">when</span> <span m="3878655">we</span> <span m="3878810">were</span> <span m="3879400">pushing</span> <span m="3879800">these</span> <span m="3880000">gadgets</span> <span m="3880420">onto</span> <span m="3880570">the</span> <span m="3880670">stack,</span> <span m="3881210">this</span> <span m="3881360">is</span> <span m="3881430">the</span> <span m="3881520">stuff</span> <span m="3881760">that</span> <span m="3881840">we're</span> <span m="3881920">going</span> <span m="3882010">to</span> <span m="3882070">push</span> <span m="3882280">onto</span> <span m="3882440">the</span> <span m="3882560">stack,</span> <span m="3882885">and</span> <span m="3883210">we're</span> <span m="3883430">going</span> <span m="3883520">to</span> <span m="3883590">see</span> <span m="3883800">what</span> <span m="3883970">happens,</span> <span m="3884640">right.</span> <span m="3885150">Now</span> <span m="3885510">let's</span> <span m="3885870">say</span> <span m="3886300">that,</span> <span m="3889120">this</span> <span m="3889540">code</span> <span m="3889870">here,</span> <span m="3891290">points</span> <span m="3891800">to</span> <span m="3892720">the</span> <span m="3892820">following</span> <span m="3893130">sequence.</span> <span m="3893750">We're</span> <span m="3893870">going</span> <span m="3894140">to</span> <span m="3894320">pop</span> <span m="3896100">some</span> <span m="3896360">register,</span> <span m="3897170">let's</span> <span m="3897340">say</span> <span m="3897470">racks,</span> <span m="3898880">and</span> <span m="3899020">then</span> <span m="3899290">we're</span> <span m="3899420">going</span> <span m="3899740">to</span> <span m="3901360">return.</span> </p>
<p><span m="3903340">So</span> <span m="3903430">what's</span> <span m="3903630">going</span> <span m="3903730">to</span> <span m="3903790">happen</span> <span m="3904263">here?</span> <span m="3905210">Well</span> <span m="3905620">so</span> <span m="3906650">when</span> <span m="3908360">the</span> <span m="3908440">system</span> <span m="3909270">jumps</span> <span m="3909400">this</span> <span m="3909530">address,</span> <span m="3910560">the</span> <span m="3910650">stack</span> <span m="3910945">pointer's</span> <span m="3911360">going</span> <span m="3911470">to</span> <span m="3911520">move</span> <span m="3911760">here,</span> <span m="3912880">OK.</span> <span m="3913440">Now</span> <span m="3913720">we're</span> <span m="3913810">in</span> <span m="3913870">the</span> <span m="3913950">middle</span> <span m="3914170">of</span> <span m="3914250">this</span> <span m="3914460">gadget,</span> <span m="3915160">right.</span> <span m="3915380">What's</span> <span m="3915570">the</span> <span m="3915670">gadget</span> <span m="3916030">going</span> <span m="3916095">to</span> <span m="3916160">do?</span> <span m="3916260">It's</span> <span m="3916360">going</span> <span m="3916460">to</span> <span m="3916540">pop</span> <span m="3917000">racks,</span> <span m="3917860">OK.</span> <span m="3918450">Top</span> <span m="3918880">of</span> <span m="3918930">stack</span> <span m="3919340">pointer's</span> <span m="3919580">now</span> <span m="3919770">here,</span> <span m="3920190">and</span> <span m="3920470">it's</span> <span m="3920700">going</span> <span m="3920820">to</span> <span m="3920900">return</span> <span m="3921680">to</span> <span m="3921940">whatever's</span> <span m="3922200">the</span> <span m="3922350">top</span> <span m="3922457">of</span> <span m="3922565">the</span> <span m="3922672">stack</span> <span m="3922780">which</span> <span m="3922915">is</span> <span m="3923220">the</span> <span m="3923320">stop</span> <span m="3923650">gap,</span> <span m="3924500">right.</span> </p>
<p><span m="3924880">So</span> <span m="3925120">in</span> <span m="3925720">this</span> <span m="3925960">case</span> <span m="3926920">this</span> <span m="3927180">gadget</span> <span m="3928140">gets</span> <span m="3928290">us</span> <span m="3928480">to</span> <span m="3928640">here,</span> <span m="3929240">and</span> <span m="3929340">the</span> <span m="3929430">attacker</span> <span m="3929850">can</span> <span m="3930000">tell</span> <span m="3930670">that</span> <span m="3930950">this</span> <span m="3931358">is--</span> <span m="3931766">this</span> <span m="3932990">probe</span> <span m="3933320">address</span> <span m="3933650">belong</span> <span m="3933805">to</span> <span m="3933960">one</span> <span m="3934070">of</span> <span m="3934180">these</span> <span m="3934360">pop</span> <span m="3934540">stacking</span> <span m="3934720">things,</span> <span m="3935680">right.</span> <span m="3935820">Because</span> <span m="3936070">the</span> <span m="3936160">client</span> <span m="3936480">connection</span> <span m="3936610">stays</span> <span m="3936850">open.</span> <span m="3938400">Now</span> <span m="3938540">let's</span> <span m="3938880">say</span> <span m="3939180">that</span> <span m="3939740">this</span> <span m="3940010">gadget</span> <span m="3940400">here,</span> <span m="3941400">pointed</span> <span m="3941940">to</span> <span m="3945820">something</span> <span m="3946350">like</span> <span m="3948030">the</span> <span m="3948200">following.</span> <span m="3948580">Maybe</span> <span m="3948910">it</span> <span m="3949010">just</span> <span m="3949280">does</span> <span m="3949930">like</span> <span m="3950080">an</span> <span m="3950190">xor,</span> <span m="3950820">for</span> <span m="3950920">example.</span> <span m="3952760">So</span> <span m="3953010">it's</span> <span m="3953120">just</span> <span m="3953230">going</span> <span m="3953340">to</span> <span m="3953500">xor</span> <span m="3956302">some</span> <span m="3956770">registers</span> <span m="3957660">and</span> <span m="3957773">then</span> <span m="3957886">it's</span> <span m="3958000">going</span> <span m="3958070">to</span> <span m="3958140">ret.</span> </p>
<p><span m="3960540">So</span> <span m="3960750">what</span> <span m="3960930">happens</span> <span m="3961240">if</span> <span m="3961350">we</span> <span m="3961440">try</span> <span m="3961650">to</span> <span m="3961750">jump</span> <span m="3961980">to</span> <span m="3962060">this</span> <span m="3962320">gadget?</span> <span m="3962930">Right,</span> <span m="3963220">note</span> <span m="3963321">that</span> <span m="3963423">this</span> <span m="3963830">does</span> <span m="3963950">not</span> <span m="3964210">pop</span> <span m="3964480">anything</span> <span m="3964810">off</span> <span m="3964990">the</span> <span m="3965080">stack,</span> <span m="3966110">OK.</span> <span m="3966450">It</span> <span m="3966555">just</span> <span m="3966660">changes</span> <span m="3966940">the</span> <span m="3967030">contents</span> <span m="3967400">of</span> <span m="3967480">registers.</span> <span m="3967920">So</span> <span m="3968350">what's</span> <span m="3968500">going</span> <span m="3968590">to</span> <span m="3968630">happen?</span> <span m="3969160">So</span> <span m="3970450">we're</span> <span m="3970550">going</span> <span m="3970670">to</span> <span m="3970730">be</span> <span m="3970880">here,</span> <span m="3971400">we're</span> <span m="3971490">going</span> <span m="3971690">to</span> <span m="3971810">jump</span> <span m="3972220">to</span> <span m="3972320">the</span> <span m="3972460">address</span> <span m="3972650">of</span> <span m="3972840">this</span> <span m="3973030">gadget,</span> <span m="3973630">stack</span> <span m="3973880">pointer</span> <span m="3974140">goes</span> <span m="3974420">here,</span> <span m="3975080">OK.</span> <span m="3975830">We're</span> <span m="3975960">going</span> <span m="3976080">to</span> <span m="3976390">xor</span> <span m="3976800">these</span> <span m="3977030">two</span> <span m="3977170">things,</span> <span m="3977770">right.</span> <span m="3978210">Stack</span> <span m="3978465">pointer's</span> <span m="3978910">not</span> <span m="3979190">going</span> <span m="3979290">to</span> <span m="3979370">change.</span> <span m="3980380">Then</span> <span m="3980550">we're</span> <span m="3980660">going</span> <span m="3980780">to</span> <span m="3980870">return</span> <span m="3981540">to</span> <span m="3981590">whatever</span> <span m="3981630">the</span> <span m="3981670">top</span> <span m="3981890">of</span> <span m="3981930">the</span> <span m="3982010">stack</span> <span m="3982390">is,</span> <span m="3982475">which</span> <span m="3982560">is</span> <span m="3982645">0,</span> <span m="3982730">0.</span> </p>
<p><span m="3983550">This</span> <span m="3983740">is</span> <span m="3983800">going</span> <span m="3983900">to</span> <span m="3983960">crash.</span> <span m="3985370">OK,</span> <span m="3986170">the</span> <span m="3986320">client</span> <span m="3986670">connection</span> <span m="3987030">to</span> <span m="3987070">the</span> <span m="3987170">server</span> <span m="3987570">is</span> <span m="3987623">going</span> <span m="3987676">to</span> <span m="3987730">close,</span> <span m="3988420">and</span> <span m="3988770">as</span> <span m="3988890">a</span> <span m="3988920">result,</span> <span m="3989630">the</span> <span m="3989730">attacker</span> <span m="3989970">knows</span> <span m="3990220">that</span> <span m="3990430">this</span> <span m="3990770">is</span> <span m="3990950">not</span> <span m="3991245">a</span> <span m="3991540">stack</span> <span m="3991880">popping</span> <span m="3992210">gadget.</span> <span m="3994210">So</span> <span m="3994360">does</span> <span m="3994490">that</span> <span m="3994610">all</span> <span m="3994730">make</span> <span m="3994970">sense?</span> <span m="3995990">And</span> <span m="3996140">so</span> <span m="3996230">you</span> <span m="3996360">can</span> <span m="3996500">also</span> <span m="3996870">imagine</span> <span m="3997400">that</span> <span m="3997700">you</span> <span m="3997830">can--</span> <span m="3998850">by</span> <span m="3999000">coming</span> <span m="3999320">with</span> <span m="3999440">more</span> <span m="4000120">baroque</span> <span m="4001400">series</span> <span m="4001950">of</span> <span m="4002050">traps</span> <span m="4002660">and</span> <span m="4002740">stop</span> <span m="4003030">gadgets</span> <span m="4003320">and</span> <span m="4003430">stuff</span> <span m="4003620">like</span> <span m="4003780">that,</span> <span m="4004150">you</span> <span m="4004270">can</span> <span m="4004410">find</span> <span m="4004750">things</span> <span m="4005000">that</span> <span m="4005150">for</span> <span m="4005260">example,</span> <span m="4005640">pop</span> <span m="4005970">two</span> <span m="4006210">things</span> <span m="4006510">off</span> <span m="4006685">the</span> <span m="4006860">stack,</span> <span m="4007700">right.</span> <span m="4007970">You</span> <span m="4008070">can</span> <span m="4008165">just</span> <span m="4008260">put</span> <span m="4008660">another</span> <span m="4008820">one</span> <span m="4008980">of</span> <span m="4009030">these</span> <span m="4009260">trap</span> <span m="4009600">instructions</span> <span m="4010170">there,</span> <span m="4010700">right.</span> </p>
<p><span m="4011110">And</span> <span m="4011250">so</span> <span m="4011390">then</span> <span m="4011750">unless</span> <span m="4011970">the--</span> <span m="4012340">unless</span> <span m="4012670">this</span> <span m="4012840">gadget</span> <span m="4013210">pops</span> <span m="4013480">two</span> <span m="4013660">things</span> <span m="4013910">off,</span> <span m="4014200">you're</span> <span m="4014440">going</span> <span m="4014540">to</span> <span m="4014640">end</span> <span m="4014703">up</span> <span m="4014766">in</span> <span m="4014830">one</span> <span m="4014936">of</span> <span m="4015043">these</span> <span m="4015150">traps</span> <span m="4015590">and</span> <span m="4015676">your</span> <span m="4015763">code</span> <span m="4015850">execution</span> <span m="4016310">is</span> <span m="4016410">going</span> <span m="4016510">to</span> <span m="4016550">blow</span> <span m="4016770">up,</span> <span m="4017720">right.</span> <span m="4018250">And</span> <span m="4018480">so</span> <span m="4019550">in</span> <span m="4019680">the</span> <span m="4019780">paper</span> <span m="4020190">they</span> <span m="4020320">discuss</span> <span m="4020860">like</span> <span m="4021120">this</span> <span m="4021290">thing</span> <span m="4021470">called</span> <span m="4021660">the</span> <span m="4021730">BROP</span> <span m="4022090">gadget,</span> <span m="4022700">which</span> <span m="4022870">is</span> <span m="4022960">sort</span> <span m="4023170">of</span> <span m="4023260">like</span> <span m="4023480">hilariously</span> <span m="4023950">complex</span> <span m="4024255">if</span> <span m="4024407">you're</span> <span m="4024560">not</span> <span m="4024673">used</span> <span m="4024786">to</span> <span m="4024900">returning</span> <span m="4025045">to</span> <span m="4025670">programming.</span> </p>
<p><span m="4026300">What</span> <span m="4026470">I'll</span> <span m="4026560">show</span> <span m="4026780">you</span> <span m="4026980">today</span> <span m="4027630">is</span> <span m="4027870">you</span> <span m="4027960">can</span> <span m="4028050">actually</span> <span m="4028360">just</span> <span m="4028425">use</span> <span m="4028490">these</span> <span m="4028740">very</span> <span m="4028950">simple</span> <span m="4029240">pop</span> <span m="4029540">gadgets</span> <span m="4029880">to</span> <span m="4030000">launch</span> <span m="4030120">the</span> <span m="4030200">same</span> <span m="4030480">attack.</span> <span m="4030770">Then</span> <span m="4031160">hopefully</span> <span m="4031560">after</span> <span m="4031790">you</span> <span m="4031850">understand</span> <span m="4032270">this,</span> <span m="4032690">the</span> <span m="4032810">BROP</span> <span m="4033110">gadget</span> <span m="4033510">will</span> <span m="4033595">make</span> <span m="4033680">more</span> <span m="4033850">sense.</span> <span m="4034970">But</span> <span m="4035040">does</span> <span m="4035110">everyone</span> <span m="4035390">understand</span> <span m="4035660">how</span> <span m="4035750">we</span> <span m="4035840">can</span> <span m="4036080">probe</span> <span m="4036570">for</span> <span m="4036650">these</span> <span m="4036820">little</span> <span m="4036970">gadgets</span> <span m="4037380">here?</span> </p>
<p><span m="4039180">OK.</span> <span m="4040120">So,</span> <span m="4043550">once</span> <span m="4043830">you've</span> <span m="4044110">got</span> <span m="4044560">these</span> <span m="4044800">gadgets,</span> <span m="4045340">what</span> <span m="4045530">do</span> <span m="4045875">you</span> <span m="4046047">know?</span> <span m="4046220">Well</span> <span m="4046365">you</span> <span m="4046510">found</span> <span m="4046850">the</span> <span m="4046930">location</span> <span m="4047420">of</span> <span m="4047520">code</span> <span m="4047860">snippets</span> <span m="4048530">that</span> <span m="4048720">allow</span> <span m="4049190">you</span> <span m="4049220">to</span> <span m="4049250">pop</span> <span m="4049383">stuff</span> <span m="4049516">up,</span> <span m="4050050">one</span> <span m="4050220">thing</span> <span m="4050420">off</span> <span m="4050590">the</span> <span m="4050760">stack.</span> <span m="4051080">Precisely</span> <span m="4051600">one</span> <span m="4051990">thing</span> <span m="4052070">off</span> <span m="4052115">the</span> <span m="4052160">stack,</span> <span m="4052820">but</span> <span m="4053540">you</span> <span m="4053670">don't</span> <span m="4054080">actually</span> <span m="4054550">know</span> <span m="4055020">into</span> <span m="4055280">what</span> <span m="4055570">register</span> <span m="4055990">they're</span> <span m="4056090">popping</span> <span m="4056410">it</span> <span m="4056730">into.</span> <span m="4057990">You</span> <span m="4058110">just</span> <span m="4058340">know</span> <span m="4058390">that</span> <span m="4058440">they're</span> <span m="4058670">getting</span> <span m="4058890">popped</span> <span m="4059220">off,</span> <span m="4059930">right.</span> <span m="4060440">And</span> <span m="4060690">you</span> <span m="4060870">actually</span> <span m="4061220">need</span> <span m="4061660">to</span> <span m="4061820">know</span> <span m="4062080">what</span> <span m="4062410">register</span> <span m="4062840">these</span> <span m="4063060">gadgets</span> <span m="4063410">are</span> <span m="4063480">popping</span> <span m="4063830">stuff</span> <span m="4064060">into,</span> <span m="4064610">because</span> <span m="4064940">remember,</span> <span m="4065520">on</span> <span m="4065720">a</span> <span m="4065770">64-bit</span> <span m="4066550">architecture,</span> <span m="4067370">the</span> <span m="4067550">registers</span> <span m="4068320">control</span> <span m="4069220">where</span> <span m="4069380">the</span> <span m="4069540">arguments</span> <span m="4070050">are</span> <span m="4070140">to</span> <span m="4070230">this</span> <span m="4070430">function</span> <span m="4070840">that</span> <span m="4070895">you</span> <span m="4070950">want</span> <span m="4071120">to</span> <span m="4071260">invoke,</span> <span m="4072100">right.</span> </p>
<p><span m="4072480">So</span> <span m="4072600">the</span> <span m="4072750">ultimate</span> <span m="4073220">goal</span> <span m="4073530">to</span> <span m="4073600">keep</span> <span m="4073790">in</span> <span m="4073880">mind,</span> <span m="4074170">is</span> <span m="4074245">that</span> <span m="4074320">we</span> <span m="4074386">want</span> <span m="4074453">to</span> <span m="4074520">be</span> <span m="4074600">able</span> <span m="4074740">to</span> <span m="4074810">create</span> <span m="4075100">some</span> <span m="4075220">gadgets</span> <span m="4075890">that</span> <span m="4076000">allow</span> <span m="4076285">us</span> <span m="4076570">to</span> <span m="4076760">pop</span> <span m="4077430">values</span> <span m="4077870">that</span> <span m="4078000">we</span> <span m="4078180">put</span> <span m="4078380">on</span> <span m="4078570">the</span> <span m="4078745">stack</span> <span m="4078920">into</span> <span m="4079060">certain</span> <span m="4079410">registers,</span> <span m="4080250">and</span> <span m="4080330">eventually</span> <span m="4080810">we're</span> <span m="4080910">going</span> <span m="4081010">to</span> <span m="4081110">call</span> <span m="4081180">a</span> <span m="4081250">system</span> <span m="4081620">call</span> <span m="4082210">that's</span> <span m="4082232">going</span> <span m="4082255">to</span> <span m="4082300">allow</span> <span m="4082485">us</span> <span m="4082670">to</span> <span m="4082770">do</span> <span m="4082880">something</span> <span m="4082990">evil.</span> <span m="4083850">OK,</span> <span m="4084110">so</span> <span m="4084720">the</span> <span m="4084830">next</span> <span m="4085070">thing</span> <span m="4085190">that</span> <span m="4085310">we</span> <span m="4085380">need</span> <span m="4085520">to</span> <span m="4085590">do</span> <span m="4085870">is</span> <span m="4085960">determine</span> <span m="4086490">which</span> <span m="4086710">registers--</span> <span m="4093690">so</span> <span m="4093860">determine</span> <span m="4094340">which</span> <span m="4094670">registers</span> <span m="4097939">the</span> <span m="4098050">pop</span> <span m="4098350">gadgets</span> <span m="4098760">use.</span> </p>
<p><span m="4106319">So</span> <span m="4106660">how</span> <span m="4106850">are</span> <span m="4106920">we</span> <span m="4106990">going</span> <span m="4107086">to</span> <span m="4107182">do</span> <span m="4107279">that?</span> <span m="4108870">Well</span> <span m="4109120">basically</span> <span m="4109649">we</span> <span m="4109770">can</span> <span m="4109899">take</span> <span m="4110149">advantage</span> <span m="4110899">of</span> <span m="4111090">the</span> <span m="4111170">pause</span> <span m="4111700">system</span> <span m="4112160">call.</span> <span m="4112840">OK,</span> <span m="4113300">so</span> <span m="4113479">the</span> <span m="4113600">pause</span> <span m="4114005">system</span> <span m="4114540">call,</span> <span m="4115200">it</span> <span m="4115359">takes</span> <span m="4115649">no</span> <span m="4115880">arguments,</span> <span m="4116830">right.</span> <span m="4117580">And</span> <span m="4117790">that</span> <span m="4117990">means</span> <span m="4118189">that</span> <span m="4118284">it</span> <span m="4118380">ignores</span> <span m="4118979">everything</span> <span m="4119264">in</span> <span m="4119550">the</span> <span m="4119660">registers.</span> <span m="4120970">OK.</span> <span m="4121930">And</span> <span m="4123290">essentially,</span> <span m="4123660">to</span> <span m="4123729">find</span> <span m="4124210">the</span> <span m="4124290">pause</span> <span m="4124640">instruction</span> <span m="4125069">what</span> <span m="4125129">we</span> <span m="4125189">can</span> <span m="4125370">do</span> <span m="4125620">is,</span> <span m="4125710">we</span> <span m="4125790">can</span> <span m="4125960">chain</span> <span m="4126850">all</span> <span m="4127140">of</span> <span m="4127310">these</span> <span m="4128399">pop</span> <span m="4128729">gadgets</span> <span m="4129760">in</span> <span m="4129899">such</span> <span m="4130180">a</span> <span m="4130260">way,</span> <span m="4130790">that</span> <span m="4130880">we</span> <span m="4131010">put</span> <span m="4131220">all</span> <span m="4131385">of</span> <span m="4131550">them</span> <span m="4131710">on</span> <span m="4131840">the</span> <span m="4131930">stack,</span> <span m="4132490">in</span> <span m="4132630">between</span> <span m="4132930">each</span> <span m="4133130">one</span> <span m="4133330">of</span> <span m="4133430">them</span> <span m="4133569">we</span> <span m="4133720">put</span> <span m="4134220">the</span> <span m="4134380">syscall</span> <span m="4134880">number</span> <span m="4135229">for</span> <span m="4135410">pause,</span> <span m="4136569">and</span> <span m="4136680">then</span> <span m="4136810">we</span> <span m="4136950">see</span> <span m="4137290">if</span> <span m="4137399">we</span> <span m="4137479">can</span> <span m="4137609">actually</span> <span m="4137739">get</span> <span m="4137869">the</span> <span m="4138000">program</span> <span m="4138260">to</span> <span m="4138520">hang.</span> <span m="4139600">Let</span> <span m="4139672">me</span> <span m="4139744">give</span> <span m="4139816">you</span> <span m="4139888">a</span> <span m="4139960">concrete</span> <span m="4140340">example</span> <span m="4140729">of</span> <span m="4140800">that.</span> </p>
<p><span m="4141060">So</span> <span m="4142790">we'll</span> <span m="4143220">do</span> <span m="4143540">something</span> <span m="4144189">like</span> <span m="4144580">this.</span> <span m="4149390">So</span> <span m="4149710">here</span> <span m="4149979">for</span> <span m="4150090">the</span> <span m="4150200">return</span> <span m="4150560">address,</span> <span m="4151600">we'll</span> <span m="4151840">put</span> <span m="4153420">the</span> <span m="4153500">following.</span> <span m="4164290">So</span> <span m="4164370">let's</span> <span m="4164609">say</span> <span m="4164729">we</span> <span m="4164880">have</span> <span m="4165100">one</span> <span m="4165529">gadget</span> <span m="4166050">that</span> <span m="4166660">pops</span> <span m="4167100">RDI</span> <span m="4167760">register,</span> <span m="4168750">then</span> <span m="4168870">does</span> <span m="4169015">a</span> <span m="4169160">ret.</span> <span m="4170899">And</span> <span m="4170999">then</span> <span m="4171099">up</span> <span m="4171200">here</span> <span m="4171890">we'll</span> <span m="4172020">put</span> <span m="4172319">the</span> <span m="4173560">syscall</span> <span m="4173979">number</span> <span m="4176911">for</span> <span m="4177370">pause.</span> </p>
<p><span m="4180090">And</span> <span m="4180270">then</span> <span m="4180490">let's</span> <span m="4180790">say</span> <span m="4180950">that</span> <span m="4181160">we</span> <span m="4181370">have</span> <span m="4182500">another</span> <span m="4182939">gadget</span> <span m="4183330">that</span> <span m="4183465">we</span> <span m="4183600">found,</span> <span m="4185810">that</span> <span m="4186080">does</span> <span m="4186300">a</span> <span m="4186390">pop</span> <span m="4187830">into</span> <span m="4188710">a</span> <span m="4189170">different</span> <span m="4189550">register,</span> <span m="4189930">let's</span> <span m="4190149">say</span> <span m="4190310">RSI.</span> <span m="4193960">And</span> <span m="4194080">then</span> <span m="4194229">we'll</span> <span m="4194360">put</span> <span m="4194680">the</span> <span m="4195780">system</span> <span m="4196210">call</span> <span m="4196450">number</span> <span m="4198320">for</span> <span m="4198430">pause</span> <span m="4198670">up</span> <span m="4198910">here</span> <span m="4199100">again.</span> <span m="4202124">And</span> <span m="4202570">we</span> <span m="4202710">do</span> <span m="4202890">this</span> <span m="4203120">for</span> <span m="4203300">all</span> <span m="4203590">the</span> <span m="4203680">gadgets</span> <span m="4204110">that</span> <span m="4204270">we've</span> <span m="4204390">found</span> <span m="4205640">and</span> <span m="4206240">then</span> <span m="4206730">eventually</span> <span m="4207640">we</span> <span m="4207860">put</span> <span m="4208240">the</span> <span m="4208930">guest</span> <span m="4209260">address</span> <span m="4214750">for</span> <span m="4214860">pause,</span> <span m="4216350">or</span> <span m="4216430">sorry</span> <span m="4216660">for</span> <span m="4216800">syscall,</span> <span m="4216920">excuse</span> <span m="4217040">me.</span> </p>
<p><span m="4225370">Once again,</span> <span m="4225750">remember</span> <span m="4226130">how</span> <span m="4226250">you</span> <span m="4226450">invoke</span> <span m="4227030">these</span> <span m="4227450">system</span> <span m="4227810">calls.</span> <span m="4228510">So</span> <span m="4228910">you</span> <span m="4229020">basically</span> <span m="4229810">have</span> <span m="4230060">to</span> <span m="4230300">put</span> <span m="4231350">the</span> <span m="4231440">number</span> <span m="4231870">of</span> <span m="4231950">the</span> <span m="4232030">system</span> <span m="4232410">call</span> <span m="4232990">into</span> <span m="4233220">the</span> <span m="4233380">RAX</span> <span m="4233640">register,</span> <span m="4234550">then</span> <span m="4234670">you</span> <span m="4234840">invoke</span> <span m="4235580">this</span> <span m="4235770">libc</span> <span m="4236170">function</span> <span m="4236560">syscall</span> <span m="4237040">which</span> <span m="4237190">is</span> <span m="4237320">then</span> <span m="4237550">going</span> <span m="4237820">to</span> <span m="4238250">execute</span> <span m="4238720">the</span> <span m="4239180">requested</span> <span m="4239540">system</span> <span m="4239855">call,</span> <span m="4240012">OK.</span> </p>
<p><span m="4240810">So</span> <span m="4240960">what's</span> <span m="4241130">going</span> <span m="4241240">to</span> <span m="4241310">happen</span> <span m="4241660">when</span> <span m="4241715">we</span> <span m="4241770">execute</span> <span m="4242120">this</span> <span m="4242310">code?</span> <span m="4242950">Right,</span> <span m="4243420">so</span> <span m="4244060">we're</span> <span m="4244200">going</span> <span m="4244430">to</span> <span m="4244540">come</span> <span m="4244800">here,</span> <span m="4246120">we're</span> <span m="4246270">going</span> <span m="4246580">to</span> <span m="4247170">jump</span> <span m="4247460">to</span> <span m="4247550">the</span> <span m="4247660">address</span> <span m="4247845">of</span> <span m="4248030">this</span> <span m="4248220">gadget,</span> <span m="4248580">and</span> <span m="4248880">note</span> <span m="4249030">that</span> <span m="4249160">as</span> <span m="4249245">an</span> <span m="4249330">attacker,</span> <span m="4250120">all</span> <span m="4250370">that</span> <span m="4250465">we</span> <span m="4250560">know</span> <span m="4250840">is</span> <span m="4250960">that</span> <span m="4251150">this</span> <span m="4251380">gadget</span> <span m="4251720">here</span> <span m="4251900">pops</span> <span m="4252290">something</span> <span m="4252530">off</span> <span m="4252690">the</span> <span m="4252850">stack.</span> <span m="4253610">We</span> <span m="4253710">don't</span> <span m="4253880">know</span> <span m="4254020">what</span> <span m="4254150">the</span> <span m="4254230">register</span> <span m="4254455">is</span> <span m="4254680">yet,</span> <span m="4255140">right.</span> <span m="4255680">Put</span> <span m="4255785">it</span> <span m="4255890">here</span> <span m="4256210">just</span> <span m="4256360">to</span> <span m="4256420">make</span> <span m="4256900">the</span> <span m="4256990">[INAUDIBLE],</span> <span m="4257080">but</span> <span m="4257243">the</span> <span m="4257406">attacker</span> <span m="4257570">doesn't</span> <span m="4257693">know</span> <span m="4257816">yet,</span> <span m="4258310">right.</span> </p>
<p><span m="4258670">So</span> <span m="4258940">if</span> <span m="4259210">you</span> <span m="4259360">jump--</span> <span m="4259680">or</span> <span m="4260140">sorry</span> <span m="4260430">the--</span> <span m="4261180">we</span> <span m="4261300">jump</span> <span m="4261560">to</span> <span m="4261660">the</span> <span m="4262170">gadget,</span> <span m="4262920">the</span> <span m="4263010">stack</span> <span m="4263330">corners</span> <span m="4263640">now</span> <span m="4263830">here,</span> <span m="4264090">what's</span> <span m="4264240">it</span> <span m="4264303">going</span> <span m="4264366">to</span> <span m="4264430">do?</span> <span m="4264580">It's</span> <span m="4264660">going</span> <span m="4264760">to</span> <span m="4264840">pop</span> <span m="4265470">this</span> <span m="4265680">syscall</span> <span m="4266050">number</span> <span m="4266820">for</span> <span m="4266970">pause,</span> <span m="4267720">into</span> <span m="4267970">some</span> <span m="4268250">register</span> <span m="4268463">the</span> <span m="4268570">attacker</span> <span m="4269000">doesn't</span> <span m="4269230">know,</span> <span m="4269870">and</span> <span m="4270120">then</span> <span m="4270750">we're</span> <span m="4271170">going</span> <span m="4271550">to</span> <span m="4272480">continue</span> <span m="4272870">to</span> <span m="4272960">go</span> <span m="4273230">up</span> <span m="4273295">this</span> <span m="4273360">chain</span> <span m="4273760">and</span> <span m="4273950">so</span> <span m="4274006">on</span> <span m="4274063">and</span> <span m="4274091">so</span> <span m="4274120">forth.</span> <span m="4274700">And</span> <span m="4274800">what</span> <span m="4274900">you'll</span> <span m="4275000">see</span> <span m="4275080">is</span> <span m="4275180">that</span> <span m="4275310">each</span> <span m="4275530">one</span> <span m="4275650">of</span> <span m="4275690">these</span> <span m="4275870">gadgets,</span> <span m="4277110">one</span> <span m="4277470">of</span> <span m="4277600">them</span> <span m="4277770">hopefully</span> <span m="4278750">will</span> <span m="4278950">pop</span> <span m="4279590">the</span> <span m="4279690">system</span> <span m="4280150">call</span> <span m="4280430">number</span> <span m="4281350">into</span> <span m="4281690">the</span> <span m="4281840">appropriate</span> <span m="4282360">RAX</span> <span m="4282660">register.</span> </p>
<p><span m="4283500">So</span> <span m="4283660">that</span> <span m="4283900">by</span> <span m="4284020">the</span> <span m="4284120">time</span> <span m="4284500">we</span> <span m="4284600">get</span> <span m="4284790">up</span> <span m="4284930">to</span> <span m="4285000">here,</span> <span m="4285980">I</span> <span m="4286050">mean</span> <span m="4286220">we</span> <span m="4286360">basically</span> <span m="4286790">polluted</span> <span m="4287320">all</span> <span m="4287490">the</span> <span m="4287580">registers,</span> <span m="4288320">with</span> <span m="4288510">the</span> <span m="4288600">system</span> <span m="4288910">call</span> <span m="4289090">number,</span> <span m="4289590">but</span> <span m="4289730">hopefully</span> <span m="4290280">just</span> <span m="4290520">one</span> <span m="4290860">of</span> <span m="4290970">them</span> <span m="4291090">has</span> <span m="4291350">to</span> <span m="4291420">be</span> <span m="4291550">correct,</span> <span m="4292310">right.</span> <span m="4292460">Because</span> <span m="4292680">if</span> <span m="4292820">one</span> <span m="4293150">of</span> <span m="4293260">our</span> <span m="4293410">gadgets</span> <span m="4293840">does</span> <span m="4294060">this,</span> <span m="4294540">then</span> <span m="4294990">by</span> <span m="4295120">the</span> <span m="4295260">time</span> <span m="4295510">we</span> <span m="4295700">ret</span> <span m="4295825">to</span> <span m="4295950">here,</span> <span m="4296520">we'll</span> <span m="4296700">get</span> <span m="4296840">a</span> <span m="4297070">pause.</span> <span m="4297610">Once</span> <span m="4297930">again,</span> <span m="4298470">that</span> <span m="4298750">pause</span> <span m="4299420">acts</span> <span m="4299505">as</span> <span m="4299590">a</span> <span m="4299930">signal</span> <span m="4300390">to</span> <span m="4300450">the</span> <span m="4300560">attacker,</span> <span m="4301680">OK.</span> <span m="4302310">Because</span> <span m="4302900">if</span> <span m="4303060">this</span> <span m="4303290">guest</span> <span m="4303640">address</span> <span m="4304050">was</span> <span m="4304250">wrong,</span> <span m="4304980">then</span> <span m="4305130">probably</span> <span m="4305480">the</span> <span m="4305580">program's</span> <span m="4305970">going</span> <span m="4306090">to</span> <span m="4306150">crash,</span> <span m="4307210">right.</span> </p>
<p><span m="4307710">So</span> <span m="4307990">what</span> <span m="4308220">does</span> <span m="4308420">this</span> <span m="4308700">phase</span> <span m="4309070">of</span> <span m="4309160">the</span> <span m="4309270">attack</span> <span m="4309620">let</span> <span m="4309760">us</span> <span m="4309900">do?</span> <span m="4311540">Well</span> <span m="4311820">we</span> <span m="4312040">still</span> <span m="4312400">don't</span> <span m="4312640">know</span> <span m="4313410">which</span> <span m="4313810">gadgets</span> <span m="4314300">pop</span> <span m="4314660">into</span> <span m="4314780">which</span> <span m="4315000">registers,</span> <span m="4315730">but</span> <span m="4315860">we</span> <span m="4315970">know</span> <span m="4316120">that</span> <span m="4316280">one</span> <span m="4316650">of</span> <span m="4316760">them</span> <span m="4316860">is</span> <span m="4317040">popped</span> <span m="4317285">into</span> <span m="4317530">RAX,</span> <span m="4318150">which</span> <span m="4318330">is</span> <span m="4318410">the</span> <span m="4318570">one</span> <span m="4318627">we</span> <span m="4318685">want</span> <span m="4318742">to</span> <span m="4318800">control.</span> <span m="4319600">And</span> <span m="4319820">for</span> <span m="4320060">sure</span> <span m="4320770">we</span> <span m="4320900">know</span> <span m="4321250">the</span> <span m="4321660">address</span> <span m="4322050">of</span> <span m="4322130">syscall,</span> <span m="4323510">right.</span> <span m="4323690">Because</span> <span m="4323840">we</span> <span m="4323900">were</span> <span m="4324020">able</span> <span m="4324230">to</span> <span m="4324330">induce</span> <span m="4324690">the</span> <span m="4324780">pause,</span> <span m="4326200">right.</span> </p>
<p><span m="4326790">So</span> <span m="4327410">once</span> <span m="4327780">we've</span> <span m="4328030">done</span> <span m="4328310">that,</span> <span m="4329100">right.</span> <span m="4329330">Once</span> <span m="4329570">we</span> <span m="4329700">know</span> <span m="4329990">for</span> <span m="4330170">sure</span> <span m="4330840">where</span> <span m="4331060">this</span> <span m="4331390">thing</span> <span m="4331600">is,</span> <span m="4332000">the</span> <span m="4332140">address</span> <span m="4332400">for</span> <span m="4332520">syscall,</span> <span m="4333210">then</span> <span m="4333570">we</span> <span m="4333670">can</span> <span m="4333790">actually</span> <span m="4334020">just</span> <span m="4334200">try</span> <span m="4334520">the</span> <span m="4334560">gadgets</span> <span m="4335000">one</span> <span m="4335200">by</span> <span m="4335350">one,</span> <span m="4336250">right.</span> <span m="4336600">And</span> <span m="4336760">see</span> <span m="4337010">which</span> <span m="4337290">one</span> <span m="4337500">of</span> <span m="4337590">them</span> <span m="4337740">is</span> <span m="4337830">actually</span> <span m="4338050">going</span> <span m="4338090">to</span> <span m="4338130">induce</span> <span m="4338355">the</span> <span m="4338580">pause,</span> <span m="4339250">right.</span> </p>
<p><span m="4339620">So</span> <span m="4339717">in</span> <span m="4339815">other</span> <span m="4339912">words,</span> <span m="4340010">cut</span> <span m="4340340">all</span> <span m="4340500">the</span> <span m="4340570">middleman</span> <span m="4340970">here,</span> <span m="4341440">let's</span> <span m="4341640">have</span> <span m="4341800">a</span> <span m="4341850">stack</span> <span m="4342210">it</span> <span m="4342300">looks</span> <span m="4342520">like</span> <span m="4343100">this,</span> <span m="4343690">and</span> <span m="4343890">then</span> <span m="4344010">you</span> <span m="4344110">just</span> <span m="4344370">immediately</span> <span m="4344760">jump</span> <span m="4344960">to</span> <span m="4345040">syscall.</span> <span m="4345590">Did</span> <span m="4345960">that</span> <span m="4346170">cause</span> <span m="4346460">the</span> <span m="4346530">pause</span> <span m="4346850">or</span> <span m="4346956">did</span> <span m="4347063">it</span> <span m="4347170">crash?</span> <span m="4347790">If</span> <span m="4347835">it</span> <span m="4347880">crashed,</span> <span m="4348330">OK</span> <span m="4348460">we</span> <span m="4348930">know</span> <span m="4349055">this</span> <span m="4349180">gadget,</span> <span m="4349680">it</span> <span m="4349810">pops</span> <span m="4350090">to</span> <span m="4350245">RDI</span> <span m="4350540">for</span> <span m="4350710">example.</span> <span m="4351200">OK,</span> <span m="4351530">get</span> <span m="4351650">rid</span> <span m="4351770">of</span> <span m="4351820">that</span> <span m="4352000">one,</span> <span m="4352370">right.</span> <span m="4352700">Try</span> <span m="4352850">the</span> <span m="4352950">next</span> <span m="4353200">gadget,</span> <span m="4353890">right.</span> <span m="4354940">Put</span> <span m="4355120">the</span> <span m="4355230">guest</span> <span m="4355380">address--</span> <span m="4355930">put</span> <span m="4356100">the,</span> <span m="4356320">well</span> <span m="4356420">it's</span> <span m="4356470">not</span> <span m="4356670">guest</span> <span m="4356950">anymore,</span> <span m="4357310">put</span> <span m="4357470">the</span> <span m="4357610">real</span> <span m="4357695">address</span> <span m="4358030">for</span> <span m="4358120">syscall</span> <span m="4358510">up</span> <span m="4358720">here.</span> <span m="4359270">Were</span> <span m="4359305">we</span> <span m="4359430">able</span> <span m="4359570">to</span> <span m="4359640">pause</span> <span m="4359910">the</span> <span m="4359990">program?</span> <span m="4361060">Yes?</span> <span m="4361510">Aha,</span> <span m="4361980">so</span> <span m="4362190">we</span> <span m="4362330">know</span> <span m="4362610">that</span> <span m="4362960">pop</span> <span m="4363250">gadget</span> <span m="4363790">must</span> <span m="4364190">pop</span> <span m="4364860">into</span> <span m="4365110">RAX.</span> <span m="4367420">So</span> <span m="4367550">does</span> <span m="4367650">that</span> <span m="4367820">make</span> <span m="4368000">sense?</span> </p>
<p><span m="4369836">AUDIENCE:</span> <span m="4370328">So</span> <span m="4370820">the</span> <span m="4370984">way</span> <span m="4371148">to</span> <span m="4371312">guess</span> <span m="4371804">the</span> <span m="4372296">address</span> <span m="4372788">for</span> <span m="4372952">system</span> <span m="4373116">call</span> <span m="4373280">is</span> <span m="4373526">just</span> <span m="4373772">blind</span> <span m="4374264">transfer?</span> </p>
<p><span m="4374756">PROFESSOR:</span> <span m="4375260">Yeah,</span> <span m="4375670">so</span> <span m="4375950">there--</span> <span m="4376260">so</span> <span m="4376500">in</span> <span m="4376610">the</span> <span m="4376710">paper,</span> <span m="4377020">they</span> <span m="4377140">go</span> <span m="4377330">into</span> <span m="4377480">some</span> <span m="4377640">optimizations</span> <span m="4378590">about</span> <span m="4378840">how</span> <span m="4378950">you</span> <span m="4379060">can</span> <span m="4379170">work</span> <span m="4379410">in</span> <span m="4379533">a</span> <span m="4379656">PLT</span> <span m="4379780">and</span> <span m="4380010">all</span> <span m="4380115">that</span> <span m="4380220">kind</span> <span m="4380360">of</span> <span m="4380420">stuff.</span> <span m="4380970">Like</span> <span m="4381140">I</span> <span m="4381160">said,</span> <span m="4381350">I</span> <span m="4381470">think</span> <span m="4381620">it's</span> <span m="4381790">easier</span> <span m="4382120">to</span> <span m="4382240">ignore</span> <span m="4382610">that</span> <span m="4382810">for</span> <span m="4382920">a</span> <span m="4383000">second,</span> <span m="4383530">and</span> <span m="4383590">just</span> <span m="4383730">look</span> <span m="4383940">toward</span> <span m="4384070">the</span> <span m="4384210">simpler thing</span> <span m="4384690">first,</span> <span m="4385250">but</span> <span m="4385400">yeah</span> <span m="4385550">in</span> <span m="4385580">a</span> <span m="4385610">simple</span> <span m="4386060">attack</span> <span m="4386200">that</span> <span m="4386340">I'm</span> <span m="4386460">describing,</span> <span m="4387200">yeah</span> <span m="4387450">you</span> <span m="4387540">just</span> <span m="4387740">put</span> <span m="4387940">some</span> <span m="4388110">address</span> <span m="4388420">up</span> <span m="4388530">here</span> <span m="4388790">and</span> <span m="4388915">you</span> <span m="4388977">just</span> <span m="4389040">see</span> <span m="4389305">if</span> <span m="4389570">you</span> <span m="4390806">pause.</span> <span m="4394070">So</span> <span m="4394190">does</span> <span m="4394280">that</span> <span m="4394420">all</span> <span m="4394950">make</span> <span m="4395140">sense?</span> </p>
<p><span m="4397800">OK</span> <span m="4398600">so</span> <span m="4399420">at</span> <span m="4399580">the</span> <span m="4399780">end</span> <span m="4400030">of</span> <span m="4400190">this</span> <span m="4400800">we</span> <span m="4401010">actually</span> <span m="4401670">know</span> <span m="4402370">the</span> <span m="4402440">location</span> <span m="4403240">of</span> <span m="4403380">syscall.</span> <span m="4403810">We</span> <span m="4404180">know</span> <span m="4404380">the</span> <span m="4404480">location</span> <span m="4406780">of</span> <span m="4406880">the</span> <span m="4406980">instruction</span> <span m="4407460">that</span> <span m="4407560">does</span> <span m="4407830">the</span> <span m="4407950">pop</span> <span m="4408250">into</span> <span m="4408550">RAX.</span> <span m="4409730">Now</span> <span m="4409870">you</span> <span m="4409990">can</span> <span m="4410090">imagine</span> <span m="4410500">that</span> <span m="4410610">we</span> <span m="4410730">also</span> <span m="4410990">need</span> <span m="4411180">gadgets</span> <span m="4411530">that</span> <span m="4411910">pop</span> <span m="4412230">into</span> <span m="4412390">some</span> <span m="4412560">other</span> <span m="4412720">registers</span> <span m="4413190">too.</span> <span m="4414300">Suffice</span> <span m="4414630">to</span> <span m="4414780">say,</span> <span m="4415050">you</span> <span m="4415190">can</span> <span m="4415300">do</span> <span m="4415440">similar</span> <span m="4415850">tests,</span> <span m="4416200">right.</span> </p>
<p><span m="4416830">So</span> <span m="4416970">instead</span> <span m="4417330">of</span> <span m="4417460">like</span> <span m="4417790">pushing</span> <span m="4418140">a</span> <span m="4418190">system</span> <span m="4418450">call</span> <span m="4418620">number</span> <span m="4418970">for</span> <span m="4419172">pause,</span> <span m="4419780">push</span> <span m="4419815">it</span> <span m="4419920">for</span> <span m="4420070">some</span> <span m="4420250">other</span> <span m="4420520">command</span> <span m="4421110">that</span> <span m="4421280">now</span> <span m="4421510">takes</span> <span m="4421880">in</span> <span m="4422140">all</span> <span m="4422560">arguments</span> <span m="4422850">in</span> <span m="4423140">RAX</span> <span m="4424020">and</span> <span m="4424800">RDI</span> <span m="4425840">for</span> <span m="4426000">example,</span> <span m="4426640">right.</span> <span m="4426890">Do</span> <span m="4426980">the</span> <span m="4427090">same</span> <span m="4427410">type</span> <span m="4427600">of</span> <span m="4427690">test,</span> <span m="4428020">right.</span> <span m="4428280">So</span> <span m="4428320">basically</span> <span m="4428710">you</span> <span m="4428790">can</span> <span m="4428870">leverage</span> <span m="4429500">the</span> <span m="4429600">fact</span> <span m="4429950">that</span> <span m="4430120">for</span> <span m="4430320">any</span> <span m="4430570">particular</span> <span m="4431370">set</span> <span m="4431600">of</span> <span m="4431720">registers</span> <span m="4432080">that</span> <span m="4432330">you</span> <span m="4432590">want</span> <span m="4432920">to</span> <span m="4433850">be</span> <span m="4433960">able</span> <span m="4434110">to</span> <span m="4434180">control,</span> <span m="4434750">there's</span> <span m="4434930">some</span> <span m="4435090">system</span> <span m="4435530">call</span> <span m="4435840">that</span> <span m="4435980">will</span> <span m="4436370">give</span> <span m="4436550">you</span> <span m="4436690">a</span> <span m="4436750">signal</span> <span m="4437005">as</span> <span m="4437260">an</span> <span m="4437340">attacker,</span> <span m="4437990">that</span> <span m="4438080">allow</span> <span m="4438330">you</span> <span m="4438420">to</span> <span m="4438480">figure</span> <span m="4438810">out</span> <span m="4439070">whether</span> <span m="4439160">you</span> <span m="4439360">successfully</span> <span m="4439860">broke</span> <span m="4440250">it</span> <span m="4440380">or</span> <span m="4440510">not.</span> <span m="4441030">Right,</span> <span m="4441330">so</span> <span m="4441520">at</span> <span m="4441590">the</span> <span m="4441660">end</span> <span m="4441730">of</span> <span m="4441835">this</span> <span m="4441940">phase,</span> <span m="4442400">you</span> <span m="4442510">basically</span> <span m="4443020">have</span> <span m="4444200">the</span> <span m="4444400">address</span> <span m="4444710">of</span> <span m="4444810">syscall</span> <span m="4445580">and</span> <span m="4445980">the</span> <span m="4446120">address</span> <span m="4446490">of</span> <span m="4446630">a</span> <span m="4446670">bunch</span> <span m="4446940">of</span> <span m="4447040">gadgets</span> <span m="4447770">which</span> <span m="4447930">allow</span> <span m="4448073">you</span> <span m="4448216">to</span> <span m="4448460">pop</span> <span m="4448710">into</span> <span m="4448960">arbitrary</span> <span m="4449306">registers.</span> </p>
<p><span m="4451130">OK</span> <span m="4451920">and</span> <span m="4452090">so</span> <span m="4452270">now</span> <span m="4453640">let's</span> <span m="4453960">see</span> <span m="4454240">so,</span> <span m="4456090">step</span> <span m="4456520">4</span> <span m="4456900">is</span> <span m="4457030">going</span> <span m="4457260">to</span> <span m="4457330">be</span> <span m="4458120">to</span> <span m="4458370">invoke</span> <span m="4459630">write.</span> <span m="4468970">Step</span> <span m="4469480">4</span> <span m="4470090">is</span> <span m="4470390">invoke</span> <span m="4473260">the</span> <span m="4473410">write</span> <span m="4475020">system</span> <span m="4475460">call.</span> <span m="4478710">So</span> <span m="4479120">to</span> <span m="4479270">invoke</span> <span m="4479630">write,</span> <span m="4480550">we</span> <span m="4480650">need</span> <span m="4480920">to</span> <span m="4480990">have</span> <span m="4481250">the</span> <span m="4481510">following</span> <span m="4481880">gadgets.</span> <span m="4484200">You</span> <span m="4484300">need</span> <span m="4484450">to</span> <span m="4484670">be</span> <span m="4484770">able</span> <span m="4484960">to</span> <span m="4485040">pop</span> <span m="4486130">RDI.</span> <span m="4488770">We</span> <span m="4488900">need</span> <span m="4489030">to</span> <span m="4489160">be</span> <span m="4489330">able</span> <span m="4489570">to</span> <span m="4489920">pop</span> <span m="4490960">RSI.</span> <span m="4494310">We</span> <span m="4494376">need</span> <span m="4494443">to</span> <span m="4494510">be</span> <span m="4494600">able</span> <span m="4494830">to</span> <span m="4495050">pop</span> <span m="4495920">RDX,</span> <span m="4501050">pop</span> <span m="4502200">racks,</span> <span m="4505430">and</span> <span m="4505630">then</span> <span m="4506010">invoke</span> <span m="4506490">syscall,</span> <span m="4508770">right.</span> </p>
<p><span m="4509140">So</span> <span m="4509280">as</span> <span m="4509380">it</span> <span m="4509480">turns</span> <span m="4509820">out,</span> <span m="4510140">what</span> <span m="4510540">are</span> <span m="4510560">these</span> <span m="4510780">registers</span> <span m="4511000">being</span> <span m="4511500">used</span> <span m="4511870">for</span> <span m="4511950">by</span> <span m="4512030">system</span> <span m="4512420">call?</span> <span m="4512950">So</span> <span m="4513430">this</span> <span m="4513690">is</span> <span m="4513900">the</span> <span m="4514240">socket,</span> <span m="4516340">or</span> <span m="4516810">more</span> <span m="4516980">generally,</span> <span m="4517240">the</span> <span m="4517330">file</span> <span m="4517472">descriptor</span> <span m="4517900">that</span> <span m="4517960">you're</span> <span m="4518020">going</span> <span m="4518235">to</span> <span m="4518450">pass</span> <span m="4518785">into</span> <span m="4519120">write.</span> <span m="4520650">This</span> <span m="4520860">is</span> <span m="4520990">the</span> <span m="4521070">buffer.</span> <span m="4523190">This</span> <span m="4523460">is</span> <span m="4523690">the</span> <span m="4524190">length</span> <span m="4524450">of</span> <span m="4524520">that</span> <span m="4524700">buffer.</span> <span m="4527680">This</span> <span m="4528070">is</span> <span m="4528240">the</span> <span m="4529135">syscall</span> <span m="4529740">number.</span> <span m="4533970">And</span> <span m="4534190">it</span> <span m="4534410">is</span> <span m="4534570">called</span> <span m="4534790">syscall.</span> <span m="4535910">Right,</span> <span m="4536180">so</span> <span m="4536280">if</span> <span m="4536380">we</span> <span m="4536490">found</span> <span m="4537040">all</span> <span m="4537410">these</span> <span m="4537690">gadgets,</span> <span m="4539150">then</span> <span m="4539400">we</span> <span m="4539510">can</span> <span m="4539690">actually</span> <span m="4540740">now</span> <span m="4541060">control</span> <span m="4541770">the</span> <span m="4541850">values</span> <span m="4542480">that</span> <span m="4542580">are</span> <span m="4542650">put</span> <span m="4542960">into</span> <span m="4543130">those</span> <span m="4543410">arguments,</span> <span m="4544055">that</span> <span m="4544310">put</span> <span m="4544550">in</span> <span m="4544610">those</span> <span m="4544670">registers,</span> <span m="4545260">because</span> <span m="4545570">we</span> <span m="4545665">just</span> <span m="4545760">pushed</span> <span m="4545870">them</span> <span m="4545960">on</span> <span m="4546050">the</span> <span m="4546200">stack,</span> <span m="4546920">right.</span> </p>
<p><span m="4547440">And</span> <span m="4547610">so</span> <span m="4547790">for</span> <span m="4547930">example,</span> <span m="4548520">what's</span> <span m="4548750">the</span> <span m="4548960">socket</span> <span m="4549048">going</span> <span m="4549137">to</span> <span m="4549226">be?</span> <span m="4549670">For</span> <span m="4549960">once</span> <span m="4550230">you're</span> <span m="4550290">going</span> <span m="4550433">to</span> <span m="4550576">have</span> <span m="4550720">to</span> <span m="4551040">do</span> <span m="4551130">a</span> <span m="4551237">little</span> <span m="4551345">guessing</span> <span m="4551452">here,</span> <span m="4551560">right.</span> <span m="4551820">can</span> <span m="4551870">take</span> <span m="4552080">advantage</span> <span m="4552440">of</span> <span m="4552490">the</span> <span m="4552570">fact</span> <span m="4553210">that</span> <span m="4553530">Linux</span> <span m="4553870">restricts</span> <span m="4554280">the</span> <span m="4554360">number</span> <span m="4554800">of</span> <span m="4555150">simultaneous</span> <span m="4555780">open</span> <span m="4556020">file</span> <span m="4556330">connections,</span> <span m="4556960">for</span> <span m="4557070">a</span> <span m="4557126">file</span> <span m="4557183">that's</span> <span m="4557240">going</span> <span m="4557296">to</span> <span m="4557353">be</span> <span m="4557630">2024.</span> <span m="4559050">And</span> <span m="4559180">also</span> <span m="4559360">it's</span> <span m="4559540">supposed</span> <span m="4559890">to</span> <span m="4559940">be</span> <span m="4560130">the</span> <span m="4560230">lowest</span> <span m="4560600">one</span> <span m="4560720">available.</span> </p>
<p><span m="4561650">So</span> <span m="4561720">we</span> <span m="4561800">do</span> <span m="4561950">a</span> <span m="4561970">little</span> <span m="4562110">bit</span> <span m="4562210">of</span> <span m="4562300">guessing</span> <span m="4562600">here</span> <span m="4562735">and</span> <span m="4562870">figure</span> <span m="4563060">out</span> <span m="4563160">what</span> <span m="4563310">that</span> <span m="4563500">socket</span> <span m="4563830">is,</span> <span m="4564130">put</span> <span m="4564293">it</span> <span m="4564456">in</span> <span m="4564620">there.</span> <span m="4565960">Now</span> <span m="4566230">interestingly,</span> <span m="4566750">what</span> <span m="4566950">are</span> <span m="4566980">we</span> <span m="4567080">going</span> <span m="4567190">to</span> <span m="4567250">pass</span> <span m="4567640">into</span> <span m="4567730">the</span> <span m="4567820">buff</span> <span m="4568040">pointer?</span> <span m="4568920">Right,</span> <span m="4569120">we're</span> <span m="4569290">actually</span> <span m="4569690">going</span> <span m="4569910">to</span> <span m="4569990">use</span> <span m="4570380">the</span> <span m="4570510">text</span> <span m="4570870">segment</span> <span m="4571280">of</span> <span m="4571370">the</span> <span m="4571450">program.</span> <span m="4572720">We're</span> <span m="4572840">actually</span> <span m="4573050">going</span> <span m="4573260">to</span> <span m="4573390">pass</span> <span m="4573810">in</span> <span m="4574240">that</span> <span m="4574550">the</span> <span m="4574660">pointer</span> <span m="4575220">to</span> <span m="4575340">somewhere</span> <span m="4575800">in</span> <span m="4575950">the</span> <span m="4576040">code</span> <span m="4576580">of</span> <span m="4576760">the</span> <span m="4576840">program.</span> <span m="4577540">So</span> <span m="4577880">what's</span> <span m="4578020">that</span> <span m="4578063">going</span> <span m="4578106">to</span> <span m="4578150">allow</span> <span m="4578620">us</span> <span m="4578740">to</span> <span m="4578850">do?</span> </p>
<p><span m="4579410">That's</span> <span m="4579530">going</span> <span m="4579760">to</span> <span m="4579856">allows</span> <span m="4579953">us</span> <span m="4580050">to</span> <span m="4580250">read</span> <span m="4580390">the</span> <span m="4580530">binary,</span> <span m="4581860">out</span> <span m="4582160">of</span> <span m="4582270">memory,</span> <span m="4583170">using</span> <span m="4583600">the</span> <span m="4583780">right</span> <span m="4584090">call</span> <span m="4584800">to</span> <span m="4585090">the</span> <span m="4585220">client</span> <span m="4585730">socket.</span> <span m="4586750">So</span> <span m="4587070">that</span> <span m="4587165">the</span> <span m="4587260">attacker</span> <span m="4587810">can</span> <span m="4587980">then</span> <span m="4588380">take</span> <span m="4588580">that</span> <span m="4588810">binary,</span> <span m="4589740">analyze</span> <span m="4590250">it</span> <span m="4590330">offline,</span> <span m="4591330">right.</span> <span m="4591820">Just</span> <span m="4592020">use</span> <span m="4592430">GDB,</span> <span m="4592950">or</span> <span m="4592990">whatever,</span> <span m="4593290">to</span> <span m="4593350">figure</span> <span m="4593570">out</span> <span m="4593670">where</span> <span m="4593800">everything</span> <span m="4594050">is</span> <span m="4594150">located.</span> <span m="4595080">The</span> <span m="4595170">attacker</span> <span m="4595570">knows</span> <span m="4596040">that</span> <span m="4596230">now,</span> <span m="4597160">every</span> <span m="4597255">time</span> <span m="4597420">the</span> <span m="4597700">server</span> <span m="4597850">crashes,</span> <span m="4598280">it's</span> <span m="4598410">going</span> <span m="4598520">to</span> <span m="4598560">have</span> <span m="4598750">the</span> <span m="4598820">same</span> <span m="4599340">randomized</span> <span m="4599960">set</span> <span m="4600210">of</span> <span m="4600370">things</span> <span m="4600680">in</span> <span m="4600810">it.</span> <span m="4601300">So</span> <span m="4601460">now,</span> <span m="4601860">once</span> <span m="4602130">the</span> <span m="4602250">attacker</span> <span m="4602710">can</span> <span m="4602823">find</span> <span m="4602936">out</span> <span m="4603050">addresses</span> <span m="4603520">and</span> <span m="4603600">offsets</span> <span m="4603950">for</span> <span m="4604395">stuff,</span> <span m="4604840">now</span> <span m="4605130">the</span> <span m="4605220">attacker</span> <span m="4605465">can</span> <span m="4605710">directly</span> <span m="4606350">attack</span> <span m="4606730">those</span> <span m="4606930">gadgets,</span> <span m="4607420">right.</span> <span m="4607850">Directly</span> <span m="4608360">attack</span> <span m="4608700">other</span> <span m="4609000">vulnerabilities,</span> <span m="4609720">figure</span> <span m="4609930">out</span> <span m="4610360">how</span> <span m="4610412">to</span> <span m="4610465">open</span> <span m="4610517">up</span> <span m="4610570">a</span> <span m="4610640">shell,</span> <span m="4611220">so</span> <span m="4611390">on</span> <span m="4611490">and</span> <span m="4611560">so</span> <span m="4611750">forth.</span> </p>
<p><span m="4612330">So</span> <span m="4612540">in</span> <span m="4612630">other</span> <span m="4612760">words,</span> <span m="4613200">at</span> <span m="4613230">the</span> <span m="4613320">point</span> <span m="4613670">you</span> <span m="4613850">exfiltrated</span> <span m="4614390">the</span> <span m="4614510">binary</span> <span m="4614970">to</span> <span m="4615060">the</span> <span m="4615160">attacker,</span> <span m="4616070">you</span> <span m="4616210">basically</span> <span m="4616610">lost.</span> <span m="4617880">Right,</span> <span m="4618280">so</span> <span m="4618460">this</span> <span m="4618740">is</span> <span m="4618830">essentially</span> <span m="4620330">how</span> <span m="4621600">the</span> <span m="4621740">BROP</span> <span m="4622130">attack</span> <span m="4622380">works.</span> <span m="4622870">Like</span> <span m="4623050">I</span> <span m="4623090">said,</span> <span m="4623560">in</span> <span m="4623606">the</span> <span m="4623653">paper,</span> <span m="4623700">there's</span> <span m="4623870">a</span> <span m="4623910">bunch</span> <span m="4624100">of</span> <span m="4624210">optimization,</span> <span m="4625350">but</span> <span m="4625490">really</span> <span m="4625830">you</span> <span m="4625925">need</span> <span m="4626020">to</span> <span m="4626070">understand</span> <span m="4626590">this</span> <span m="4626800">stuff,</span> <span m="4627070">the</span> <span m="4627140">basic</span> <span m="4627620">stuff,</span> <span m="4627840">before</span> <span m="4628005">that</span> <span m="4628170">optimization</span> <span m="4628530">will</span> <span m="4628890">start</span> <span m="4629040">to</span> <span m="4629190">make</span> <span m="4629460">sense.</span> <span m="4630020">And</span> <span m="4630170">so</span> <span m="4630280">we</span> <span m="4630370">can</span> <span m="4630480">talk</span> <span m="4630700">about</span> <span m="4630910">the</span> <span m="4630980">optimization</span> <span m="4631470">with</span> <span m="4631550">me</span> <span m="4631630">offline</span> <span m="4631670">if</span> <span m="4631710">you</span> <span m="4631750">want,</span> <span m="4632260">or</span> <span m="4632550">after</span> <span m="4632810">class.</span> </p>
<p><span m="4633400">But</span> <span m="4633492">to</span> <span m="4633585">suffice</span> <span m="4633677">it</span> <span m="4633770">to</span> <span m="4633920">say,</span> <span m="4634190">this</span> <span m="4634460">is</span> <span m="4634580">the</span> <span m="4634660">basics</span> <span m="4635480">of</span> <span m="4635590">how</span> <span m="4635720">you</span> <span m="4635850">launch</span> <span m="4636110">that</span> <span m="4636300">BROP</span> <span m="4636600">attack.</span> <span m="4637270">You've</span> <span m="4637470">got</span> <span m="4637740">to</span> <span m="4638490">find</span> <span m="4638750">the</span> <span m="4638820">stop</span> <span m="4639170">gadget,</span> <span m="4640490">find</span> <span m="4640750">those</span> <span m="4640920">gadgets</span> <span m="4641370">that</span> <span m="4641610">pop</span> <span m="4642070">stack</span> <span m="4642340">entries.</span> <span m="4643230">Figure</span> <span m="4643550">out</span> <span m="4643900">which</span> <span m="4644300">of</span> <span m="4644450">those</span> <span m="4644700">registers</span> <span m="4645260">those</span> <span m="4645450">gadgets</span> <span m="4645790">pop</span> <span m="4646280">into,</span> <span m="4646770">and</span> <span m="4647060">find</span> <span m="4647340">out</span> <span m="4647440">how</span> <span m="4647540">to</span> <span m="4647600">figure</span> <span m="4647830">out</span> <span m="4647930">where</span> <span m="4648170">syscall</span> <span m="4648650">is,</span> <span m="4649420">and</span> <span m="4649620">then</span> <span m="4649880">invoke</span> <span m="4650330">write</span> <span m="4651060">by</span> <span m="4651610">accumulating</span> <span m="4651880">all</span> <span m="4652150">that</span> <span m="4652410">knowledge.</span> </p>
<p><span m="4653560">So</span> <span m="4653730">very</span> <span m="4653950">quickly,</span> <span m="4654260">how</span> <span m="4654410">do</span> <span m="4654485">you</span> <span m="4654560">defend</span> <span m="4654940">against</span> <span m="4655290">BROP?</span> <span m="4655940">Well</span> <span m="4656370">the</span> <span m="4656450">most</span> <span m="4656660">obvious</span> <span m="4657000">thing</span> <span m="4657060">is</span> <span m="4657120">you've</span> <span m="4657270">got</span> <span m="4657480">to</span> <span m="4657662">rerandomize,</span> <span m="4658730">right.</span> <span m="4659270">So</span> <span m="4659480">the</span> <span m="4659590">fact</span> <span m="4660070">that</span> <span m="4660500">crashed</span> <span m="4660980">servers</span> <span m="4661460">do</span> <span m="4661635">not</span> <span m="4661810">respawn,</span> <span m="4662460">rerandomize</span> <span m="4663290">versions</span> <span m="4663650">of</span> <span m="4663710">themselves,</span> <span m="4664490">that</span> <span m="4665110">allows</span> <span m="4665610">the</span> <span m="4665700">crash</span> <span m="4665990">to</span> <span m="4666430">act</span> <span m="4666670">as</span> <span m="4666780">a</span> <span m="4666840">signal</span> <span m="4667660">that</span> <span m="4667770">let's</span> <span m="4668000">the</span> <span m="4668190">attacker</span> <span m="4668860">test</span> <span m="4669230">various</span> <span m="4669640">hypotheses</span> <span m="4669990">about</span> <span m="4670210">how</span> <span m="4670745">the</span> <span m="4671020">programs</span> <span m="4671370">working.</span> </p>
<p><span m="4672010">So</span> <span m="4672300">one</span> <span m="4672520">simple</span> <span m="4672790">defense</span> <span m="4673460">is</span> <span m="4673820">to</span> <span m="4674490">make</span> <span m="4674680">sure</span> <span m="4674990">that</span> <span m="4675620">you</span> <span m="4675790">do</span> <span m="4676150">exec</span> <span m="4677010">when</span> <span m="4677075">you</span> <span m="4677140">spawn</span> <span m="4677430">your</span> <span m="4677780">process,</span> <span m="4678230">instead</span> <span m="4678500">of</span> <span m="4678630">fork,</span> <span m="4679240">right.</span> <span m="4679350">Because</span> <span m="4679610">when</span> <span m="4679720">you</span> <span m="4679810">exec</span> <span m="4680320">the</span> <span m="4680420">process,</span> <span m="4681080">you</span> <span m="4681170">create</span> <span m="4681460">totally</span> <span m="4681725">new</span> <span m="4681990">randomized</span> <span m="4682560">layout</span> <span m="4682920">space,</span> <span m="4683330">at</span> <span m="4683430">least</span> <span m="4683640">on</span> <span m="4683780">Linux,</span> <span m="4684420">right.</span> <span m="4684780">So</span> <span m="4684960">on</span> <span m="4685085">Linux,</span> <span m="4685330">when</span> <span m="4685435">you</span> <span m="4685540">compile</span> <span m="4685820">with</span> <span m="4685960">this</span> <span m="4686100">PIE,</span> <span m="4686410">the</span> <span m="4686570">Position</span> <span m="4687050">Independent</span> <span m="4688200">Executable</span> <span m="4688720">flag,</span> <span m="4689560">you</span> <span m="4689710">only</span> <span m="4689970">get</span> <span m="4690100">that</span> <span m="4690310">randomized</span> <span m="4691260">address</span> <span m="4691880">space</span> <span m="4692420">that's</span> <span m="4692730">new</span> <span m="4693040">if</span> <span m="4693185">you</span> <span m="4693330">use</span> <span m="4693740">exec.</span> </p>
<p><span m="4694950">So</span> <span m="4695450">another</span> <span m="4695810">event</span> <span m="4696065">you</span> <span m="4696150">can</span> <span m="4696235">use</span> <span m="4696320">is</span> <span m="4696680">just</span> <span m="4696900">use</span> <span m="4697120">Windows,</span> <span m="4697730">because</span> <span m="4698410">Windows</span> <span m="4698910">basically</span> <span m="4699860">does</span> <span m="4700050">not</span> <span m="4700350">have</span> <span m="4700530">a</span> <span m="4700740">fork</span> <span m="4700950">equivalent,</span> <span m="4701930">right.</span> <span m="4702240">So</span> <span m="4702920">hooray</span> <span m="4703270">for</span> <span m="4703450">us.</span> <span m="4703890">So</span> <span m="4704030">that</span> <span m="4704230">means</span> <span m="4704510">that</span> <span m="4705420">on</span> <span m="4705600">Windows,</span> <span m="4705930">whenever</span> <span m="4706560">you</span> <span m="4706800">spawn</span> <span m="4707110">that</span> <span m="4707360">new</span> <span m="4707430">server,</span> <span m="4708000">it's</span> <span m="4708130">always</span> <span m="4708400">going</span> <span m="4708490">to</span> <span m="4708530">have</span> <span m="4708850">a</span> <span m="4709055">new</span> <span m="4709550">randomized</span> <span m="4709860">address</span> <span m="4710170">space.</span> </p>
<p><span m="4711950">I</span> <span m="4712130">think</span> <span m="4712300">someone</span> <span m="4712510">over</span> <span m="4712700">here</span> <span m="4712930">mentioned</span> <span m="4713260">something</span> <span m="4713690">like,</span> <span m="4714440">what</span> <span m="4714650">would</span> <span m="4714780">happen</span> <span m="4715290">if</span> <span m="4715510">for</span> <span m="4715630">example,</span> <span m="4716020">when</span> <span m="4716300">the</span> <span m="4716540">server</span> <span m="4716870">crashed,</span> <span m="4717680">it</span> <span m="4717860">didn't</span> <span m="4718040">actually</span> <span m="4718340">close</span> <span m="4718505">the</span> <span m="4718670">connection?</span> <span m="4720230">Right,</span> <span m="4720470">so</span> <span m="4720660">you</span> <span m="4720810">can</span> <span m="4720920">imagine</span> <span m="4721450">one</span> <span m="4721590">thing</span> <span m="4721770">that</span> <span m="4721890">when</span> <span m="4722010">a</span> <span m="4722110">crash</span> <span m="4722550">takes</span> <span m="4722820">place,</span> <span m="4723350">we</span> <span m="4723450">somehow</span> <span m="4723850">catch</span> <span m="4724260">that</span> <span m="4724580">fault</span> <span m="4725360">and</span> <span m="4725560">then</span> <span m="4725640">we</span> <span m="4725720">keep</span> <span m="4726060">that</span> <span m="4726280">connection</span> <span m="4726810">open</span> <span m="4727090">for</span> <span m="4727230">a</span> <span m="4727295">little</span> <span m="4727360">while</span> <span m="4728050">to</span> <span m="4728200">confuse</span> <span m="4728840">the</span> <span m="4728970">attacker</span> <span m="4729690">and</span> <span m="4730040">remove</span> <span m="4730380">that</span> <span m="4730600">signal,</span> <span m="4731310">that</span> <span m="4731500">something's</span> <span m="4731950">gone</span> <span m="4732097">amiss.</span> </p>
<p><span m="4732540">So</span> <span m="4732930">that's</span> <span m="4733160">something</span> <span m="4733640">you</span> <span m="4733740">definitely</span> <span m="4734210">do.</span> <span m="4734690">What's</span> <span m="4734890">hilarious</span> <span m="4735390">about</span> <span m="4735650">that</span> <span m="4735980">is,</span> <span m="4736070">that</span> <span m="4736330">now</span> <span m="4736610">your</span> <span m="4736820">BROP</span> <span m="4737220">attack</span> <span m="4737720">turns</span> <span m="4737990">into</span> <span m="4738110">a</span> <span m="4738230">denial</span> <span m="4738620">of</span> <span m="4738700">service</span> <span m="4739040">attack.</span> <span m="4740980">Because</span> <span m="4741350">now</span> <span m="4741630">you</span> <span m="4741690">just</span> <span m="4741930">got</span> <span m="4742100">all</span> <span m="4742350">the</span> <span m="4742500">potential</span> <span m="4742900">zombie</span> <span m="4743280">processes</span> <span m="4743550">that</span> <span m="4743820">are</span> <span m="4743970">sitting</span> <span m="4744270">around,</span> <span m="4744850">they</span> <span m="4744960">segfaulted.</span> <span m="4745660">They're</span> <span m="4745905">useless</span> <span m="4746150">in</span> <span m="4746240">society,</span> <span m="4747140">but</span> <span m="4747280">you</span> <span m="4747380">can't</span> <span m="4747620">let</span> <span m="4747760">them</span> <span m="4747890">go,</span> <span m="4748130">because</span> <span m="4748330">otherwise</span> <span m="4748680">you're</span> <span m="4748770">going</span> <span m="4748880">to</span> <span m="4748960">delete</span> <span m="4749110">this</span> <span m="4749310">information.</span> </p>
<p><span m="4751320">Another</span> <span m="4751570">thing</span> <span m="4751700">you</span> <span m="4751780">might</span> <span m="4751960">think</span> <span m="4752090">about</span> <span m="4752320">to,</span> <span m="4752530">is</span> <span m="4752665">you</span> <span m="4752800">could</span> <span m="4752975">do</span> <span m="4753150">bounds checking,</span> <span m="4753800">right.</span> <span m="4753970">We</span> <span m="4754165">just</span> <span m="4754360">talked</span> <span m="4754620">a</span> <span m="4754740">bunch</span> <span m="4754860">about</span> <span m="4755140">that,</span> <span m="4755720">right.</span> <span m="4756040">But</span> <span m="4756690">in</span> <span m="4756790">the</span> <span m="4756880">paper,</span> <span m="4757250">they</span> <span m="4758140">casually</span> <span m="4758730">dismiss</span> <span m="4759310">this</span> <span m="4759400">as</span> <span m="4759620">saying</span> <span m="4759840">it</span> <span m="4759922">has</span> <span m="4760005">up</span> <span m="4760087">to</span> <span m="4760170">2x</span> <span m="4760570">overhead,</span> <span m="4760770">so</span> <span m="4760905">nobody's</span> <span m="4761040">going</span> <span m="4761275">to</span> <span m="4761510">do</span> <span m="4761630">that,</span> <span m="4763060">but</span> <span m="4763210">you</span> <span m="4763360">could</span> <span m="4763550">in</span> <span m="4763650">fact</span> <span m="4763950">do</span> <span m="4764095">that.</span> <span m="4764870">So</span> <span m="4765010">that's</span> <span m="4765190">basically</span> <span m="4765750">how</span> <span m="4766340">BROP</span> <span m="4766630">works.</span> </p>
<p><span m="4767100">As</span> <span m="4767300">for</span> <span m="4767390">the</span> <span m="4767490">homework</span> <span m="4767910">question,</span> <span m="4769250">the</span> <span m="4769530">homework</span> <span m="4769670">questions</span> <span m="4770020">a</span> <span m="4770100">bit</span> <span m="4770290">subtle,</span> <span m="4770710">because</span> <span m="4770930">the</span> <span m="4771000">homework</span> <span m="4771280">question</span> <span m="4771610">says,</span> <span m="4772140">what</span> <span m="4772350">if</span> <span m="4772500">you</span> <span m="4773120">use</span> <span m="4773970">a</span> <span m="4774130">hash</span> <span m="4775010">of</span> <span m="4775140">the</span> <span m="4775220">current</span> <span m="4775620">time,</span> <span m="4776080">right?</span> <span m="4776610">Get</span> <span m="4776720">time</span> <span m="4776920">of</span> <span m="4777010">day</span> <span m="4777500">when</span> <span m="4777725">you</span> <span m="4777950">restarted</span> <span m="4778310">the</span> <span m="4778390">program.</span> <span m="4779060">Is</span> <span m="4779250">that</span> <span m="4779530">sufficient</span> <span m="4780490">to</span> <span m="4781260">prevent</span> <span m="4781610">this</span> <span m="4781750">type</span> <span m="4781950">of</span> <span m="4782050">attack?</span> <span m="4782950">Well</span> <span m="4783450">note</span> <span m="4783950">that,</span> <span m="4785250">hashing</span> <span m="4785810">does</span> <span m="4785970">not</span> <span m="4786290">magically</span> <span m="4786780">provide</span> <span m="4787085">you</span> <span m="4787390">bits</span> <span m="4787650">of</span> <span m="4787770">entropy</span> <span m="4788810">if</span> <span m="4788990">the</span> <span m="4789190">input</span> <span m="4789580">to</span> <span m="4789660">the</span> <span m="4789740">hash</span> <span m="4790010">is</span> <span m="4790280">easily</span> <span m="4790580">guessable,</span> <span m="4791620">right.</span> </p>
<p><span m="4791890">If</span> <span m="4792060">I</span> <span m="4792170">know</span> <span m="4792440">that</span> <span m="4792530">you're</span> <span m="4792620">only</span> <span m="4792850">going</span> <span m="4793003">to</span> <span m="4793156">hash</span> <span m="4793310">one</span> <span m="4793490">or</span> <span m="4793580">two</span> <span m="4793770">things,</span> <span m="4794860">it</span> <span m="4794980">doesn't</span> <span m="4795250">matter</span> <span m="4795560">if</span> <span m="4795680">I</span> <span m="4795770">have</span> <span m="4795955">like</span> <span m="4796140">some</span> <span m="4796970">a</span> <span m="4797097">jillion</span> <span m="4797480">bit</span> <span m="4797690">hash.</span> <span m="4798160">Doesn't</span> <span m="4798390">matter.</span> <span m="4798930">So</span> <span m="4799010">I</span> <span m="4799110">can</span> <span m="4799210">just</span> <span m="4799310">guess</span> <span m="4799570">one</span> <span m="4799710">of</span> <span m="4799770">those</span> <span m="4799960">two</span> <span m="4800080">values</span> <span m="4800440">and</span> <span m="4800570">see</span> <span m="4800760">what</span> <span m="4800990">is.</span> <span m="4801580">So</span> <span m="4801800">the</span> <span m="4801940">thing</span> <span m="4802080">to</span> <span m="4802160">note</span> <span m="4802490">is</span> <span m="4802590">that</span> <span m="4802800">get</span> <span m="4803000">time</span> <span m="4803220">of</span> <span m="4803330">day,</span> <span m="4803580">actually</span> <span m="4804020">has</span> <span m="4804180">much</span> <span m="4804430">less</span> <span m="4804630">entropy</span> <span m="4805030">than</span> <span m="4805200">you</span> <span m="4805260">might</span> <span m="4805500">think.</span> <span m="4806110">Particularly</span> <span m="4806810">because</span> <span m="4807610">the</span> <span m="4807780">attacker</span> <span m="4808460">can</span> <span m="4808610">actually</span> <span m="4809070">check</span> <span m="4809500">what</span> <span m="4809780">time</span> <span m="4810190">he</span> <span m="4810350">or</span> <span m="4810410">she</span> <span m="4810620">is</span> <span m="4810755">launching</span> <span m="4810890">the</span> <span m="4811160">attack,</span> <span m="4812380">right.</span> <span m="4812690">So</span> <span m="4812760">that's</span> <span m="4812900">going</span> <span m="4812960">to</span> <span m="4813020">actually</span> <span m="4813290">remove</span> <span m="4813780">a</span> <span m="4813840">bunch</span> <span m="4814110">of</span> <span m="4814290">entropy</span> <span m="4815150">from</span> <span m="4815330">that</span> <span m="4815530">calculation,</span> <span m="4816650">right.</span> <span m="4817170">So</span> <span m="4817280">there's</span> <span m="4817810">some</span> <span m="4817940">subtleties</span> <span m="4818340">there.</span> <span m="4818750">What's</span> <span m="4819010">the</span> <span m="4819090">server</span> <span m="4819800">skew</span> <span m="4820060">in</span> <span m="4820430">terms</span> <span m="4820640">of</span> <span m="4820710">clock</span> <span m="4821025">or</span> <span m="4821182">the</span> <span m="4821340">client</span> <span m="4821860">and</span> <span m="4822130">so</span> <span m="4822206">on</span> <span m="4822282">and</span> <span m="4822358">so</span> <span m="4822434">forth.</span> </p>
<p><span m="4822900">The</span> <span m="4822970">long</span> <span m="4823250">story</span> <span m="4823560">short,</span> <span m="4824210">using</span> <span m="4824930">a</span> <span m="4825040">guessable</span> <span m="4825590">base</span> <span m="4825930">value,</span> <span m="4826600">even</span> <span m="4826790">with</span> <span m="4827030">guessable</span> <span m="4827380">just</span> <span m="4827640">inside</span> <span m="4828010">of</span> <span m="4828075">a</span> <span m="4828140">range,</span> <span m="4828830">is</span> <span m="4828900">super</span> <span m="4829340">useful</span> <span m="4829650">for</span> <span m="4829750">the</span> <span m="4829890">attacker,</span> <span m="4830145">right.</span> <span m="4830810">Particularly</span> <span m="4831280">because</span> <span m="4831540">the</span> <span m="4831700">attack--</span> <span m="4832035">we</span> <span m="4832370">can</span> <span m="4832500">start</span> <span m="4832630">subverting</span> <span m="4833290">a</span> <span m="4833360">bunch</span> <span m="4833700">of</span> <span m="4833790">servers</span> <span m="4834520">in</span> <span m="4834660">parallel</span> <span m="4835680">and</span> <span m="4835990">know</span> <span m="4836310">that</span> <span m="4836510">all</span> <span m="4836820">of</span> <span m="4836940">them</span> <span m="4837100">should</span> <span m="4837310">have</span> <span m="4837960">fairly</span> <span m="4838360">similar</span> <span m="4838870">values,</span> <span m="4839095">right.</span> <span m="4839320">This</span> <span m="4839536">is</span> <span m="4839752">a</span> <span m="4839838">high</span> <span m="4839924">order</span> <span m="4840011">of</span> <span m="4840097">bits,</span> <span m="4841050">right.</span> </p>
<p><span m="4841440">So</span> <span m="4841590">long</span> <span m="4841850">story</span> <span m="4842120">short,</span> <span m="4842400">the</span> <span m="4842563">answer</span> <span m="4842726">is</span> <span m="4842890">that,</span> <span m="4844320">it's</span> <span m="4844490">literally</span> <span m="4845010">better</span> <span m="4845280">than</span> <span m="4845480">nothing</span> <span m="4846710">to</span> <span m="4846870">randomize,</span> <span m="4847730">if</span> <span m="4847860">you</span> <span m="4848280">use</span> <span m="4848500">get</span> <span m="4848720">time</span> <span m="4848811">of</span> <span m="4848903">day,</span> <span m="4849270">but</span> <span m="4849380">it</span> <span m="4849450">doesn't</span> <span m="4849690">actually</span> <span m="4849940">provide</span> <span m="4850340">you</span> <span m="4850390">as</span> <span m="4850440">much</span> <span m="4850940">security</span> <span m="4851005">as</span> <span m="4851070">you</span> <span m="4851180">think.</span> <span m="4851870">And</span> <span m="4851952">the</span> <span m="4852035">other</span> <span m="4852117">lesson</span> <span m="4852200">too</span> <span m="4852515">is,</span> <span m="4852830">that</span> <span m="4852915">just</span> <span m="4853000">because</span> <span m="4853220">you</span> <span m="4853320">hash</span> <span m="4853600">something</span> <span m="4854430">right,</span> <span m="4855190">that</span> <span m="4855380">doesn't</span> <span m="4855640">matter</span> <span m="4856260">if</span> <span m="4856400">you're</span> <span m="4856490">not</span> <span m="4856670">actually</span> <span m="4857280">using</span> <span m="4857580">that</span> <span m="4857650">hash</span> <span m="4857935">in</span> <span m="4858077">a</span> <span m="4858220">smart</span> <span m="4858390">way.</span> <span m="4859052">You</span> <span m="4859175">have</span> <span m="4859298">a</span> <span m="4859421">question?</span> </p>
<p><span m="4860036">AUDIENCE:</span> <span m="4860528">Oh,</span> <span m="4861020">still</span> <span m="4861512">when</span> <span m="4861610">I</span> <span m="4861708">did</span> <span m="4861807">the</span> <span m="4861905">calculations</span> <span m="4862004">that</span> <span m="4862496">some</span> <span m="4863480">[INAUDIBLE]</span> <span m="4868860">it</span> <span m="4868984">seems</span> <span m="4869108">like</span> <span m="4869232">maybe</span> <span m="4869356">to</span> <span m="4869480">be</span> <span m="4869604">able</span> <span m="4869728">to</span> <span m="4869852">get</span> <span m="4870350">the</span> <span m="4871385">offset</span> <span m="4872248">that</span> <span m="4872492">the</span> <span m="4872736">[INAUDIBLE]</span> <span m="4873712">your</span> <span m="4874200">[INAUDIBLE]</span> <span m="4877128">start</span> <span m="4877290">the</span> <span m="4877453">process</span> <span m="4877616">to</span> <span m="4878104">within</span> <span m="4878266">like</span> <span m="4878429">48</span> <span m="4879080">milliseconds?</span> </p>
<p><span m="4879580">PROFESSOR: Yes</span> <span m="4879880">and</span> <span m="4879970">getting</span> <span m="4880165">the</span> <span m="4880360">timing</span> <span m="4880740">right</span> <span m="4881040">depends</span> <span m="4881350">on</span> <span m="4881420">a</span> <span m="4881460">bunch</span> <span m="4881740">of</span> <span m="4881820">different</span> <span m="4881900">things,</span> <span m="4882590">right.</span> <span m="4882780">But</span> <span m="4882870">you</span> <span m="4882930">could</span> <span m="4883040">take</span> <span m="4883220">advantage</span> <span m="4883560">of</span> <span m="4883610">the</span> <span m="4883690">fact</span> <span m="4884000">that</span> <span m="4884340">the</span> <span m="4884460">attacker</span> <span m="4884810">can</span> <span m="4884990">open</span> <span m="4885200">up</span> <span m="4885260">a</span> <span m="4885320">bunch</span> <span m="4885530">of</span> <span m="4885610">connections</span> <span m="4885830">in</span> <span m="4886050">parallel,</span> <span m="4886870">and</span> <span m="4887000">leverage</span> <span m="4887290">the</span> <span m="4887380">fact</span> <span m="4887690">that</span> <span m="4887820">even</span> <span m="4888040">if</span> <span m="4888140">the</span> <span m="4888230">initial</span> <span m="4888590">guess</span> <span m="4888810">a</span> <span m="4888930">little</span> <span m="4889050">bit</span> <span m="4889170">off,</span> <span m="4889640">you</span> <span m="4889740">can</span> <span m="4889860">still</span> <span m="4890160">launch</span> <span m="4890410">multiple</span> <span m="4890860">guesses</span> <span m="4891590">on</span> <span m="4891770">what</span> <span m="4891900">should</span> <span m="4892070">be</span> <span m="4892250">very</span> <span m="4892570">similar</span> <span m="4893070">canary</span> <span m="4893450">values,</span> <span m="4894220">and</span> <span m="4894500">do</span> <span m="4894600">that</span> <span m="4894900">attack</span> <span m="4895050">in</span> <span m="4895200">parallel.</span> <span m="4895500">But</span> <span m="4895575">you're</span> <span m="4895650">right,</span> <span m="4895725">there's</span> <span m="4895800">tricky</span> <span m="4895875">time</span> <span m="4896025">and</span> <span m="4896100">issues.</span> </p>
</div>
        <div id="vid_related" itemprop="description" class="tabContent hide">
<h2 class="subhead">Free Downloads</h2>
<h3 class="subsubhead">Video</h3>
<ul>
<li>iTunes U (<a href="https://itunes.apple.com/us/itunes-u/id1017908130">MP4 - 181MB</a>)</li>
<li>Internet Archive (<a href="https://archive.org/download/MIT6.858F14/MIT6_858F14_lec03_300k.mp4">MP4 - 181MB</a>)</li>
</ul>
<br>
<h3 class="subsubhead">Caption</h3>
<ul>
<li>English-US (<a href="../../../contents/video-lectures/lecture-3-buffer-overflow-exploits-and-defenses/xSQxaie_h1o.srt">SRT</a>)</li>
</ul>
</div>
    
   </div>  




      					 
        <div class="" id="parent-fieldname-bottom_html_area">
            
            
        </div>
    
               </main><!--Course_inner_media tag close -->
           		</div>
<!--Course_wrapper tag close -->
            </div>
<!--left tag close -->
            <aside id="right">
                <!--Begin Right Portion -->
                    <div>
    



</div>

                	<div>
    



</div>


        <div class="" id="parent-fieldname-rsi_top_html_area">
            
            
        </div>
    

<!-- RSI google ad space-->



<div id="google_ads">    
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script type="text/javascript">var googletag = googletag || {}; googletag.cmd = googletag.cmd || [];</script>
    <script type="text/javascript">
googletag.cmd.push(function() {googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_A_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_A_DL').addService(googletag.pubads());googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_B_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_B_DL').addService(googletag.pubads());googletag.defineSlot('/1064917/VIDEO_INDIVIDUAL_SLOT_C_DL', [[300, 250], [300, 300], [180, 200], [180, 150], [160, 600]], 'VIDEO_INDIVIDUAL_SLOT_C_DL').addService(googletag.pubads());
googletag.pubads().enableSingleRequest();
 googletag.enableServices();
});</script>
    <script language="javascript" type="text/javascript">
googletag.cmd.push(function() {googletag.pubads().set("TYPE","HOUSE");googletag.pubads().set("DEPARTMENT","6");googletag.pubads().set("CRS_BEG2","85");googletag.pubads().set("CRS_END","8");googletag.pubads().set("SESSION","F");googletag.pubads().set("YEAR","14");})
</script>
    
    <div id="VIDEO_INDIVIDUAL_SLOT_A_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_A_DL'); });</script>
    </div>
    <div id="VIDEO_INDIVIDUAL_SLOT_B_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_B_DL'); });</script>
    </div>
    <div id="VIDEO_INDIVIDUAL_SLOT_C_DL">
    	<script>googletag.cmd.push(function() { googletag.display('VIDEO_INDIVIDUAL_SLOT_C_DL'); });</script>
    </div>
</div>

<!-- End RSI ads--> 


<div>
    



</div>

            </aside><!--Right div close -->
            <div class="clear"></div>
        </div>
<!--grid tag close -->
      </div>
		
		<footer id="bottom">
			<div id="grid">
				
<div id="portletwrapper-6f63772e626f74746f6d706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d666f6f746572" class="portletWrapper kssattr-portlethash-6f63772e626f74746f6d706f72746c65746d616e616765720a636f6e746578740a2f506c6f6e650a736974652d666f6f746572">
<div class="portletStaticText portlet-static-site-footer"><div id="footer">
<nav aria-label="Footer">     <nav id="foot-c1" class="grid_2 alpha" aria-labelledby="f-find-courses">       <span class="footer" id="f-find-courses" aria-hidden="true">Find Courses</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/courses/find-by-topic/">Find by Topic</a></li>
    <li><a href="https://ocw.mit.edu/courses/find-by-number/">Find by Course Number</a></li>
    <li><a href="https://ocw.mit.edu/courses/find-by-department/">Find by Department</a></li>
    <li><a href="https://ocw.mit.edu/courses/new-courses/">New Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/most-visited-courses/">Most Visited Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/ocw-scholar/">OCW Scholar Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/audio-video-courses/">Audio/Video Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/online-textbooks/">Online Textbooks</a></li>
    <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights</a></li>
    <li><a href="https://ocw.mit.edu/resources/">Supplemental Resources</a></li>
    <li><a href="https://ocw.mit.edu/courses/mitx-related-courseware/">MITx &amp; Related OCW Courses</a></li>
    <li><a href="https://ocw.mit.edu/courses/mit-open-learning-library/">MIT Open Learning Library</a></li>
    <li><a href="https://ocw.mit.edu/courses/translated-courses/">Translated Courses</a></li>
</ul>
</nav>
<div id="foot-c2" class="grid_2"><nav aria-labelledby="f-for-educators">         <span id="f-for-educators" class="footer" aria-hidden="true">For Educators</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://chalk-radio.simplecast.com/">Chalk Radio Podcast</a></li>
    <li><a href="https://ocw.mit.edu/educator/">OCW Educator Portal </a></li>
    <li><a href="https://ocw.mit.edu/courses/instructor-insights/">Instructor Insights by Department</a></li>
    <li><a href="https://openlearning.mit.edu/campus/digital-innovations/" aria-label="External Link: Residential Digital Innovations">Residential Digital Innovations </a></li>
    <li><a href="https://ocw.mit.edu/high-school/">OCW Highlights for High School</a></li>
    <li><a href="https://ocw.mit.edu/educator/additional-resources/">Additional Resources</a></li>
</ul>
</nav></div>
<nav class="grid_2" id="foot-c3" aria-labelledby="f-donate">       <span id="f-donate" class="footer" aria-hidden="true">Give Now</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/give/">Make a Donation</a></li>
    <li><a href="https://ocw.mit.edu/give/why-give/">Why Give?</a></li>
    <li><a href="https://ocw.mit.edu/give/our-supporters/">Our Supporters</a></li>
    <li><a href="https://ocw.mit.edu/give/other-ways-to-contribute/">Other Ways to Contribute</a></li>
    <li><a href="https://ocw.mit.edu/support/">Become a Corporate Sponsor</a></li>
</ul>
</nav>
<div class="grid_2" id="foot-c4">
<nav aria-labelledby="f-about">         <span id="f-about" class="footer" aria-hidden="true">About</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/about/">About OpenCourseWare</a></li>
    <li><a href="https://ocw.mit.edu/about/site-statistics/">Site Statistics</a></li>
    <li><a href="https://ocw.mit.edu/about/ocw-stories/">OCW Stories</a></li>
    <li><a href="https://ocw.mit.edu/about/newsletter/">Newsletter</a></li>
    <li><a href="https://www.ocw-openmatters.org/">Open Matters Blog</a></li>
</ul>
</nav><!--about-->       <nav aria-labelledby="f-tools">         <span id="f-tools" class="footer" aria-hidden="true">Tools</span>
<ul class="foot-bullet" role="presentation">
    <li><a href="https://ocw.mit.edu/help/">Help &amp; FAQs</a></li>
    <li><a href="https://ocw.mit.edu/about/contactus">Contact Us</a></li>
    <li><a href="https://accessibility.mit.edu/" target="_blank">Accessibility</a></li>
    <li><a href="https://ocw.mit.edu/help/site-map/">Site Map</a></li>
    <li><a href="../../../common/terms/index.htm">Privacy &amp; Terms of Use</a></li>
    <li><a href="https://ocw.mit.edu/help/rss/">RSS Feeds</a></li>
</ul>
</nav><!--tools-->
</div>
</nav> <aside style="min-height: 289px;" aria-labelledby="f-our-corporate-supporters" class="grid_4 omega" id="foot-c5">           <span aria-hidden="true" class="footer" id="f-our-corporate-supporters">Our Corporate Supporters</span>           <!-- HOME_CORP_LOGO_1 -->
<div id="div-gpt-ad-1388181177156-0" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-0'); });
            </script></div>
<!-- HOME_CORP_LOGO_2 -->
<div id="div-gpt-ad-1388181177156-1" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-1'); });
            </script></div>
<!-- HOME_CORP_LOGO_3 -->
<div id="div-gpt-ad-1388181177156-2" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-2'); });
            </script></div>
<!-- HOME_CORP_LOGO_4 -->
<div id="div-gpt-ad-1388181177156-3" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-3'); });
            </script></div>
<!-- HOME_CORP_LOGO_5 -->
<div id="div-gpt-ad-1388181177156-4" class="sponsors_google_ads_even"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-4'); });
              </script></div>
<!-- HOME_CORP_LOGO_6 -->
<div id="div-gpt-ad-1388181177156-5" class="sponsors_google_ads_odd"><script type="text/javascript">
              googletag.cmd.push(function() { googletag.display('div-gpt-ad-1388181177156-5'); });
              </script></div>
</aside>
<div class="grid_12 alpha omega" itemprop="publisher" itemscope="" itemtype="http://schema.org/CollegeOrUniversity">
<h4 class="footer" style="border-top: thin solid #d5c9ba; padding-top: 10px; margin-bottom: 10px;">About <span itemprop="name">MIT OpenCourseWare</span>
</h4>
<p style="color: #999; font-size: 1em; line-height: 1.5em; margin-top: 10px;" itemprop="description">MIT OpenCourseWare is an online publication of materials from over 2,500 MIT courses, freely sharing knowledge with learners and educators around the world. <a href="https://ocw.mit.edu/about/">Learn more »</a></p>
</div>
<div id="foot-copy" class="grid_12 alpha omega" style="border-top: none;">
<a href="http://web.mit.edu"><img src="../../../common/images/logo_mit.png" alt="Massachusetts Institute of Technology logo and name." style="width: 195; height: 44;"></a><a href="https://openlearning.mit.edu/"><img src="https://ocw.mit.edu/images/mitol_logo.png" alt="MIT Open Learning logo and name." style="width: 265; height: 50; vertical-align: top; padding-left:30px;"></a><a href="https://www.oeglobal.org/"><img src="https://ocw.mit.edu/images/oeg_logo.gif" alt="Open Education Consortium logo." style="width: 219px; height: 59px; vertical-align: top; padding-left:20px;"></a><a rel="license" itemprop="useRightsUrl" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="../../../common/images/cc_by-nc-sa.png" alt="Creative Commons logo with terms BY-NC-SA." style="width: 126px; height: 44px; margin-right: 0; padding-left: 20px;"></a>
<p class="copyright">© 2001–2018<br>
Massachusetts Institute of Technology</p>
<p style="font-size: 0.9em; margin-bottom: 15px;">Your use of the MIT OpenCourseWare site and materials is subject to our <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license">Creative Commons License</a> and other <a href="../../../common/terms/index.htm" rel="cc:morePermissions">terms of use</a>.</p>
</div>
</div></div>

</div>





                
			</div> <!-- bottom grid end -->
		</footer><!-- footer bottom end -->


   </body>
 </html>
